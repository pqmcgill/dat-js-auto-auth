!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).AutoDat=f()}}(function(){return function(){return function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){return o(e[i][1][r]||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}}()({1:[function(require,module,exports){(function(process){const assert=require("assert"),EventEmitter=require("events"),createSwarm=require("webrtc-swarm"),pump=require("pump"),subSignalhub=require("sub-signalhub"),noop=()=>void 0;module.exports=((...args)=>new class extends EventEmitter{constructor(opts={}){super(),assert("function"==typeof opts.stream,"A `stream` function prop is required."),assert(opts.hub,"A signalhub `hub` instance is required"),this.id=opts.id,this.stream=opts.stream,this.hub=opts.hub,this.channels=new Map,this.destroyed=!1}join(channelName,opts={}){if(assert(channelName,"A channel name is required."),this.channels.has(channelName))return;"object"==typeof channelName&&(channelName=channelName.toString("hex"));const hub=subSignalhub(this.hub,channelName),channel={peers:new Map,swarm:createSwarm(hub,Object.assign({},{uuid:this.id.toString("hex")},opts))};channel.swarm.on("peer",(peer,id)=>{const info={id:id,channel:channelName},conn=this.stream(info);this.emit("handshaking",conn,info),conn.on("handshake",this._handshake.bind(this,channel,conn,info)),pump(peer,conn,peer)}),channel.swarm.on("disconnect",(peer,id)=>{const info={id:id,channel:channelName};channel.peers.delete(id),this.emit("connection-closed",peer,info)}),this.channels.set(channelName,channel)}leave(channelName){const channel=this.channels.get(channelName);channel&&(channel.close(),this.channels.delete(channelName))}close(cb){return this.destroyed?process.nextTick(cb||noop):(this.destroyed=!0,cb&&this.once("close",cb),this.channels.size?void this.channels.forEach((channel,channelName)=>{channel.swarm.close(()=>{this.channels.delete(channelName),this.channels.size||this.emit("close")})}):process.nextTick(()=>{this.emit("close")}))}destroy(cb){this.close(cb)}_handshake(channel,conn,info){const{id:id}=info;if(channel.peers.has(id)){const oldPeer=channel.peers.get(id);this.emit("redundant-connection",oldPeer,info),channel.peers.delete(id),oldPeer.destroy()}channel.peers.set(id,conn),this.emit("connection",conn,info)}}(...args))}).call(this,require("_process"))},{_process:118,assert:5,events:21,pump:124,"sub-signalhub":173,"webrtc-swarm":181}],2:[function(require,module,exports){(function(process){const EventEmitter=require("events").EventEmitter,encoding=(require("run-parallel"),require("dat-encoding")),RAW=require("random-access-web"),RAM=require("random-access-memory"),DiscoverySwarmWeb=require("discovery-swarm-web"),crypto=require("hypercore-crypto"),hypercoreProtocol=require("hypercore-protocol"),hyperdrive=require("hyperdrive");module.exports=class extends EventEmitter{constructor(opts){super(),this.opts=opts||{},this.opts.id||(this.opts.id=crypto.randomBytes(32)),this.archives=[];const discoveryOpts=Object.assign({stream:info=>this._replicate(info)},this.opts);this.swarm=DiscoverySwarmWeb(discoveryOpts);const storageOpts=Object.assign({name:"dats",storeName:"files"},this.opts);this.persistence=RAW(storageOpts)}get(url,opts){const key=encoding.decode(url),normalizedURL=`dat://${encoding.encode(key)}`,archive=this.archives.find(archive=>archive.url===normalizedURL);return archive||this._add(normalizedURL,opts)}_add(url,opts){if(this.destroyed)throw new Error("client is destroyed");opts||(opts={});const finalOpts=Object.assign({},this.opts,opts);let key=null;if(url&&(key=encoding.decode(url)),!key){const keyPair=crypto.keyPair();key=keyPair.publicKey,finalOpts.secretKey=keyPair.secretKey}const keyString=encoding.encode(key),rawStorage=finalOpts.db||(finalOpts.persist?this.persistence:RAM),archive=hyperdrive(file=>rawStorage(keyString+"/"+file),key,Object.assign({sparse:!0},finalOpts));return archive.url="dat://"+keyString,this.archives.push(archive),archive.ready(()=>{this.swarm.join(archive.discoveryKey),this.emit("archive",archive)}),archive}create(opts){return this._add(null,opts)}has(url){const key=encoding.decode(url),normalizedURL=`dat://${encoding.encode(key)}`;return!!this.archives.find(archive=>archive.url===normalizedURL)}_replicate(info){const archive=this.archives.find(a=>encoding.encode(a.discoveryKey)===info.channel),userData=this.opts.userData||{};archive&&(userData.key=encoding.encode(archive.db.local.key));var stream=hypercoreProtocol({id:this.opts.id,live:!0,encrypt:!0,extensions:this.opts.extensions,userData:JSON.stringify(userData)});return stream.on("feed",discoveryKey=>this._replicateFeed(stream,discoveryKey)),stream.on("error",e=>{this.emit("replication-error",e)}),info.channel&&this._replicateFeed(stream,info.channel),stream}_replicateFeed(stream,discoveryKey){if(this.destroyed)return void stream.end();const stringKey=encoding.encode(discoveryKey),archive=this.archives.find(archive=>encoding.encode(archive.discoveryKey)===stringKey);archive&&archive.replicate({stream:stream,live:!0})}close(cb){this.destroyed?cb&&process.nextTick(cb):(this.destroyed=!0,this.swarm.close(),cb&&this.once("close",cb),this.archives=null,this.emit("close"))}destroy(cb){this.close(cb)}}}).call(this,require("_process"))},{_process:118,"dat-encoding":33,"discovery-swarm-web":40,events:21,"hypercore-crypto":47,"hypercore-protocol":49,hyperdrive:84,"random-access-memory":133,"random-access-web":136,"run-parallel":148}],3:[function(require,module,exports){var TABLE=[0,4129,8258,12387,16516,20645,24774,28903,33032,37161,41290,45419,49548,53677,57806,61935,4657,528,12915,8786,21173,17044,29431,25302,37689,33560,45947,41818,54205,50076,62463,58334,9314,13379,1056,5121,25830,29895,17572,21637,42346,46411,34088,38153,58862,62927,50604,54669,13907,9842,5649,1584,30423,26358,22165,18100,46939,42874,38681,34616,63455,59390,55197,51132,18628,22757,26758,30887,2112,6241,10242,14371,51660,55789,59790,63919,35144,39273,43274,47403,23285,19156,31415,27286,6769,2640,14899,10770,56317,52188,64447,60318,39801,35672,47931,43802,27814,31879,19684,23749,11298,15363,3168,7233,60846,64911,52716,56781,44330,48395,36200,40265,32407,28342,24277,20212,15891,11826,7761,3696,65439,61374,57309,53244,48923,44858,40793,36728,37256,33193,45514,41451,53516,49453,61774,57711,4224,161,12482,8419,20484,16421,28742,24679,33721,37784,41979,46042,49981,54044,58239,62302,689,4752,8947,13010,16949,21012,25207,29270,46570,42443,38312,34185,62830,58703,54572,50445,13538,9411,5280,1153,29798,25671,21540,17413,42971,47098,34713,38840,59231,63358,50973,55100,9939,14066,1681,5808,26199,30326,17941,22068,55628,51565,63758,59695,39368,35305,47498,43435,22596,18533,30726,26663,6336,2273,14466,10403,52093,56156,60223,64286,35833,39896,43963,48026,19061,23124,27191,31254,2801,6864,10931,14994,64814,60687,56684,52557,48554,44427,40424,36297,31782,27655,23652,19525,15522,11395,7392,3265,61215,65342,53085,57212,44955,49082,36825,40952,28183,32310,20053,24180,11923,16050,3793,7920];module.exports=function(n){for(var crc=0,r=0,i=0;i<8;i++)n=(n-(r=255&n))/256,crc=65535&(crc<<8^TABLE[255&(crc>>8^r)]);return crc}},{}],4:[function(require,module,exports){var hash=require("./crc16");function LRU(max,opts){if(!(this instanceof LRU))return new LRU(max,opts);for(opts||(opts={}),this.collisions=factorOfTwo(opts.collisions||opts.bucketSize||4),this.buckets=function(n,factor){n=factorOfTwo(n);for(;n&factor-1;)n<<=1;return n}(max,this.collisions)/this.collisions;this.buckets>65536;)this.buckets>>=1,this.collisions<<=1;var mask;this.size=this.buckets*this.collisions,this.wrap=!opts.indexedValues,this.cache=new Array(this.size),this.hash=65536===this.buckets?hash:(mask=this.buckets-1,function(n){return hash(n)&mask}),this.evict=opts.evict||null}function move(list,index,itemIndex,item){for(;itemIndex>index;)list[itemIndex]=list[--itemIndex];list[index]=item}function Node(index,value){this.index=index,this.value=value}function factorOfTwo(n){if(n&&!(n&n-1))return n;for(var p=1;p<n;)p<<=1;return p}module.exports=LRU,LRU.prototype.set=function(index,val){for(var pageStart=this.collisions*this.hash(index),pageEnd=pageStart+this.collisions,ptr=pageStart,page=null;ptr<pageEnd;){if(!(page=this.cache[ptr]))return page=this.cache[ptr]=this.wrap?new Node(index,val):val,void move(this.cache,pageStart,ptr,page);if(page.index===index)return this.wrap?page.value=val:this.cache[ptr]=val,void move(this.cache,pageStart,ptr,page);ptr++}this.wrap?(this.evict&&this.evict(page.index,page.value),page.index=index,page.value=val):(this.evict&&this.evict(page.index,page),this.cache[ptr-1]=val),move(this.cache,pageStart,ptr-1,page)},LRU.prototype.get=function(index){for(var pageStart=this.collisions*this.hash(index),pageEnd=pageStart+this.collisions,ptr=pageStart;ptr<pageEnd;){var page=this.cache[ptr++];if(!page)return null;if(page.index===index)return move(this.cache,pageStart,ptr-1,page),this.wrap?page.value:page}return null}},{"./crc16":3}],5:[function(require,module,exports){(function(global){"use strict";var objectAssign=require("object-assign");function compare(a,b){if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);i<len;++i)if(a[i]!==b[i]){x=a[i],y=b[i];break}return x<y?-1:y<x?1:0}function isBuffer(b){return global.Buffer&&"function"==typeof global.Buffer.isBuffer?global.Buffer.isBuffer(b):!(null==b||!b._isBuffer)}var util=require("util/"),hasOwn=Object.prototype.hasOwnProperty,pSlice=Array.prototype.slice,functionsHaveNames="foo"===function(){}.name;function pToString(obj){return Object.prototype.toString.call(obj)}function isView(arrbuf){return!isBuffer(arrbuf)&&("function"==typeof global.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(arrbuf):!!arrbuf&&(arrbuf instanceof DataView||!!(arrbuf.buffer&&arrbuf.buffer instanceof ArrayBuffer))))}var assert=module.exports=ok,regex=/\s*function\s+([^\(\s]*)\s*/;function getName(func){if(util.isFunction(func)){if(functionsHaveNames)return func.name;var match=func.toString().match(regex);return match&&match[1]}}function truncate(s,n){return"string"==typeof s?s.length<n?s:s.slice(0,n):s}function inspect(something){if(functionsHaveNames||!util.isFunction(something))return util.inspect(something);var rawname=getName(something);return"[Function"+(rawname?": "+rawname:"")+"]"}function fail(actual,expected,message,operator,stackStartFunction){throw new assert.AssertionError({message:message,actual:actual,expected:expected,operator:operator,stackStartFunction:stackStartFunction})}function ok(value,message){value||fail(value,!0,message,"==",assert.ok)}function _deepEqual(actual,expected,strict,memos){if(actual===expected)return!0;if(isBuffer(actual)&&isBuffer(expected))return 0===compare(actual,expected);if(util.isDate(actual)&&util.isDate(expected))return actual.getTime()===expected.getTime();if(util.isRegExp(actual)&&util.isRegExp(expected))return actual.source===expected.source&&actual.global===expected.global&&actual.multiline===expected.multiline&&actual.lastIndex===expected.lastIndex&&actual.ignoreCase===expected.ignoreCase;if(null!==actual&&"object"==typeof actual||null!==expected&&"object"==typeof expected){if(isView(actual)&&isView(expected)&&pToString(actual)===pToString(expected)&&!(actual instanceof Float32Array||actual instanceof Float64Array))return 0===compare(new Uint8Array(actual.buffer),new Uint8Array(expected.buffer));if(isBuffer(actual)!==isBuffer(expected))return!1;var actualIndex=(memos=memos||{actual:[],expected:[]}).actual.indexOf(actual);return-1!==actualIndex&&actualIndex===memos.expected.indexOf(expected)||(memos.actual.push(actual),memos.expected.push(expected),function(a,b,strict,actualVisitedObjects){if(null===a||void 0===a||null===b||void 0===b)return!1;if(util.isPrimitive(a)||util.isPrimitive(b))return a===b;if(strict&&Object.getPrototypeOf(a)!==Object.getPrototypeOf(b))return!1;var aIsArgs=isArguments(a),bIsArgs=isArguments(b);if(aIsArgs&&!bIsArgs||!aIsArgs&&bIsArgs)return!1;if(aIsArgs)return a=pSlice.call(a),b=pSlice.call(b),_deepEqual(a,b,strict);var key,i,ka=objectKeys(a),kb=objectKeys(b);if(ka.length!==kb.length)return!1;for(ka.sort(),kb.sort(),i=ka.length-1;i>=0;i--)if(ka[i]!==kb[i])return!1;for(i=ka.length-1;i>=0;i--)if(key=ka[i],!_deepEqual(a[key],b[key],strict,actualVisitedObjects))return!1;return!0}(actual,expected,strict,memos))}return strict?actual===expected:actual==expected}function isArguments(object){return"[object Arguments]"==Object.prototype.toString.call(object)}function expectedException(actual,expected){if(!actual||!expected)return!1;if("[object RegExp]"==Object.prototype.toString.call(expected))return expected.test(actual);try{if(actual instanceof expected)return!0}catch(e){}return!Error.isPrototypeOf(expected)&&!0===expected.call({},actual)}function _throws(shouldThrow,block,expected,message){var actual;if("function"!=typeof block)throw new TypeError('"block" argument must be a function');"string"==typeof expected&&(message=expected,expected=null),actual=function(block){var error;try{block()}catch(e){error=e}return error}(block),message=(expected&&expected.name?" ("+expected.name+").":".")+(message?" "+message:"."),shouldThrow&&!actual&&fail(actual,expected,"Missing expected exception"+message);var userProvidedMessage="string"==typeof message,isUnwantedException=!shouldThrow&&util.isError(actual),isUnexpectedException=!shouldThrow&&actual&&!expected;if((isUnwantedException&&userProvidedMessage&&expectedException(actual,expected)||isUnexpectedException)&&fail(actual,expected,"Got unwanted exception"+message),shouldThrow&&actual&&expected&&!expectedException(actual,expected)||!shouldThrow&&actual)throw actual}assert.AssertionError=function(options){var self;this.name="AssertionError",this.actual=options.actual,this.expected=options.expected,this.operator=options.operator,options.message?(this.message=options.message,this.generatedMessage=!1):(this.message=truncate(inspect((self=this).actual),128)+" "+self.operator+" "+truncate(inspect(self.expected),128),this.generatedMessage=!0);var stackStartFunction=options.stackStartFunction||fail;if(Error.captureStackTrace)Error.captureStackTrace(this,stackStartFunction);else{var err=new Error;if(err.stack){var out=err.stack,fn_name=getName(stackStartFunction),idx=out.indexOf("\n"+fn_name);if(idx>=0){var next_line=out.indexOf("\n",idx+1);out=out.substring(next_line+1)}this.stack=out}}},util.inherits(assert.AssertionError,Error),assert.fail=fail,assert.ok=ok,assert.equal=function(actual,expected,message){actual!=expected&&fail(actual,expected,message,"==",assert.equal)},assert.notEqual=function(actual,expected,message){actual==expected&&fail(actual,expected,message,"!=",assert.notEqual)},assert.deepEqual=function(actual,expected,message){_deepEqual(actual,expected,!1)||fail(actual,expected,message,"deepEqual",assert.deepEqual)},assert.deepStrictEqual=function(actual,expected,message){_deepEqual(actual,expected,!0)||fail(actual,expected,message,"deepStrictEqual",assert.deepStrictEqual)},assert.notDeepEqual=function(actual,expected,message){_deepEqual(actual,expected,!1)&&fail(actual,expected,message,"notDeepEqual",assert.notDeepEqual)},assert.notDeepStrictEqual=function notDeepStrictEqual(actual,expected,message){_deepEqual(actual,expected,!0)&&fail(actual,expected,message,"notDeepStrictEqual",notDeepStrictEqual)},assert.strictEqual=function(actual,expected,message){actual!==expected&&fail(actual,expected,message,"===",assert.strictEqual)},assert.notStrictEqual=function(actual,expected,message){actual===expected&&fail(actual,expected,message,"!==",assert.notStrictEqual)},assert.throws=function(block,error,message){_throws(!0,block,error,message)},assert.doesNotThrow=function(block,error,message){_throws(!1,block,error,message)},assert.ifError=function(err){if(err)throw err},assert.strict=objectAssign(function strict(value,message){value||fail(value,!0,message,"==",strict)},assert,{equal:assert.strictEqual,deepEqual:assert.deepStrictEqual,notEqual:assert.notStrictEqual,notDeepEqual:assert.notDeepStrictEqual}),assert.strict.strict=assert.strict;var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)hasOwn.call(obj,key)&&keys.push(key);return keys}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"object-assign":113,"util/":8}],6:[function(require,module,exports){"function"==typeof Object.create?module.exports=function(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}},{}],7:[function(require,module,exports){module.exports=function(arg){return arg&&"object"==typeof arg&&"function"==typeof arg.copy&&"function"==typeof arg.fill&&"function"==typeof arg.readUInt8}},{}],8:[function(require,module,exports){(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){for(var objects=[],i=0;i<arguments.length;i++)objects.push(inspect(arguments[i]));return objects.join(" ")}i=1;for(var args=arguments,len=args.length,str=String(f).replace(formatRegExp,function(x){if("%%"===x)return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}}),x=args[i];i<len;x=args[++i])isNull(x)||!isObject(x)?str+=" "+x:str+=" "+inspect(x);return str},exports.deprecate=function(fn,msg){if(isUndefined(global.process))return function(){return exports.deprecate(fn,msg).apply(this,arguments)};if(!0===process.noDeprecation)return fn;var warned=!1;return function(){if(!warned){if(process.throwDeprecation)throw new Error(msg);process.traceDeprecation?console.trace(msg):console.error(msg),warned=!0}return fn.apply(this,arguments)}};var debugEnviron,debugs={};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(ctx.depth=arguments[2]),arguments.length>=4&&(ctx.colors=arguments[3]),isBoolean(opts)?ctx.showHidden=opts:opts&&exports._extend(ctx,opts),isUndefined(ctx.showHidden)&&(ctx.showHidden=!1),isUndefined(ctx.depth)&&(ctx.depth=2),isUndefined(ctx.colors)&&(ctx.colors=!1),isUndefined(ctx.customInspect)&&(ctx.customInspect=!0),ctx.colors&&(ctx.stylize=stylizeWithColor),formatValue(ctx,obj,ctx.depth)}function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];return style?"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m":str}function stylizeNoColor(str,styleType){return str}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&(!value.constructor||value.constructor.prototype!==value)){var ret=value.inspect(recurseTimes,ctx);return isString(ret)||(ret=formatValue(ctx,ret,recurseTimes)),ret}var primitive=function(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}(ctx,value);if(primitive)return primitive;var keys=Object.keys(value),visibleKeys=function(array){var hash={};return array.forEach(function(val,idx){hash[val]=!0}),hash}(keys);if(ctx.showHidden&&(keys=Object.getOwnPropertyNames(value)),isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0))return formatError(value);if(0===keys.length){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value))return ctx.stylize(RegExp.prototype.toString.call(value),"regexp");if(isDate(value))return ctx.stylize(Date.prototype.toString.call(value),"date");if(isError(value))return formatError(value)}var output,base="",array=!1,braces=["{","}"];(isArray(value)&&(array=!0,braces=["[","]"]),isFunction(value))&&(base=" [Function"+(value.name?": "+value.name:"")+"]");return isRegExp(value)&&(base=" "+RegExp.prototype.toString.call(value)),isDate(value)&&(base=" "+Date.prototype.toUTCString.call(value)),isError(value)&&(base=" "+formatError(value)),0!==keys.length||array&&0!=value.length?recurseTimes<0?isRegExp(value)?ctx.stylize(RegExp.prototype.toString.call(value),"regexp"):ctx.stylize("[Object]","special"):(ctx.seen.push(value),output=array?function(ctx,value,recurseTimes,visibleKeys,keys){for(var output=[],i=0,l=value.length;i<l;++i)hasOwnProperty(value,String(i))?output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),!0)):output.push("");return keys.forEach(function(key){key.match(/^\d+$/)||output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,!0))}),output}(ctx,value,recurseTimes,visibleKeys,keys):keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)}),ctx.seen.pop(),function(output,base,braces){if(output.reduce(function(prev,cur){return 0,cur.indexOf("\n")>=0&&0,prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return braces[0]+(""===base?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1];return braces[0]+base+" "+output.join(", ")+" "+braces[1]}(output,base,braces)):braces[0]+base+braces[1]}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;if((desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]}).get?str=desc.set?ctx.stylize("[Getter/Setter]","special"):ctx.stylize("[Getter]","special"):desc.set&&(str=ctx.stylize("[Setter]","special")),hasOwnProperty(visibleKeys,key)||(name="["+key+"]"),str||(ctx.seen.indexOf(desc.value)<0?(str=isNull(recurseTimes)?formatValue(ctx,desc.value,null):formatValue(ctx,desc.value,recurseTimes-1)).indexOf("\n")>-1&&(str=array?str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2):"\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")):str=ctx.stylize("[Circular]","special")),isUndefined(name)){if(array&&key.match(/^\d+$/))return str;(name=JSON.stringify(""+key)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(name=name.substr(1,name.length-2),name=ctx.stylize(name,"name")):(name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),name=ctx.stylize(name,"string"))}return name+": "+str}function isArray(ar){return Array.isArray(ar)}function isBoolean(arg){return"boolean"==typeof arg}function isNull(arg){return null===arg}function isNumber(arg){return"number"==typeof arg}function isString(arg){return"string"==typeof arg}function isUndefined(arg){return void 0===arg}function isRegExp(re){return isObject(re)&&"[object RegExp]"===objectToString(re)}function isObject(arg){return"object"==typeof arg&&null!==arg}function isDate(d){return isObject(d)&&"[object Date]"===objectToString(d)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(arg){return"function"==typeof arg}function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}exports.debuglog=function(set){if(isUndefined(debugEnviron)&&(debugEnviron=process.env.NODE_DEBUG||""),set=set.toUpperCase(),!debugs[set])if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else debugs[set]=function(){};return debugs[set]},exports.inspect=inspect,inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=function(arg){return null==arg},exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=function(arg){return"symbol"==typeof arg},exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=function(arg){return null===arg||"boolean"==typeof arg||"number"==typeof arg||"string"==typeof arg||"symbol"==typeof arg||void 0===arg},exports.isBuffer=require("./support/isBuffer");var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}exports.log=function(){var d,time;console.log("%s - %s",(d=new Date,time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":"),[d.getDate(),months[d.getMonth()],time].join(" ")),exports.format.apply(exports,arguments))},exports.inherits=require("inherits"),exports._extend=function(origin,add){if(!add||!isObject(add))return origin;for(var keys=Object.keys(add),i=keys.length;i--;)origin[keys[i]]=add[keys[i]];return origin}}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":7,_process:118,inherits:6}],9:[function(require,module,exports){module.exports=function(run){var running=!1,pendingBatch=null,pendingCallbacks=null,callbacks=null;return function(val,cb){running?(pendingBatch||(pendingBatch=[],pendingCallbacks=[]),function(list,val){Array.isArray(val)?function(list,val){for(var i=0;i<val.length;i++)list.push(val[i])}(list,val):list.push(val)}(pendingBatch,val),cb&&pendingCallbacks.push(cb)):(cb&&(callbacks=[cb]),running=!0,run(Array.isArray(val)?val:[val],done))};function done(err){callbacks&&function(list,err){for(var i=0;i<list.length;i++)list[i](err)}(callbacks,err),running=!1,callbacks=pendingCallbacks;var nextBatch=pendingBatch;if(pendingBatch=null,pendingCallbacks=null,!nextBatch||!nextBatch.length){if(!callbacks||!callbacks.length)return void(callbacks=null);nextBatch||(nextBatch=[])}running=!0,run(nextBatch,done)}}},{}],10:[function(require,module,exports){"use strict";exports.byteLength=function(b64){var lens=getLens(b64),validLen=lens[0],placeHoldersLen=lens[1];return 3*(validLen+placeHoldersLen)/4-placeHoldersLen},exports.toByteArray=function(b64){for(var tmp,lens=getLens(b64),validLen=lens[0],placeHoldersLen=lens[1],arr=new Arr(function(b64,validLen,placeHoldersLen){return 3*(validLen+placeHoldersLen)/4-placeHoldersLen}(0,validLen,placeHoldersLen)),curByte=0,len=placeHoldersLen>0?validLen-4:validLen,i=0;i<len;i+=4)tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)],arr[curByte++]=tmp>>16&255,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp;2===placeHoldersLen&&(tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4,arr[curByte++]=255&tmp);1===placeHoldersLen&&(tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp);return arr},exports.fromByteArray=function(uint8){for(var tmp,len=uint8.length,extraBytes=len%3,parts=[],i=0,len2=len-extraBytes;i<len2;i+=16383)parts.push(encodeChunk(uint8,i,i+16383>len2?len2:i+16383));1===extraBytes?(tmp=uint8[len-1],parts.push(lookup[tmp>>2]+lookup[tmp<<4&63]+"==")):2===extraBytes&&(tmp=(uint8[len-2]<<8)+uint8[len-1],parts.push(lookup[tmp>>10]+lookup[tmp>>4&63]+lookup[tmp<<2&63]+"="));return parts.join("")};for(var lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;function getLens(b64){var len=b64.length;if(len%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var validLen=b64.indexOf("=");return-1===validLen&&(validLen=len),[validLen,validLen===len?0:4-validLen%4]}function encodeChunk(uint8,start,end){for(var tmp,num,output=[],i=start;i<end;i+=3)tmp=(uint8[i]<<16&16711680)+(uint8[i+1]<<8&65280)+(255&uint8[i+2]),output.push(lookup[(num=tmp)>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[63&num]);return output.join("")}revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63},{}],11:[function(require,module,exports){var varint=require("varint"),alloc=require("buffer-alloc-unsafe");module.exports=function align(n){var exports={};exports.align=align;exports.encode=function encode(bitfield,buffer,offset){offset||(offset=0);buffer||(buffer=alloc(encodingLength(bitfield)));var state=new State(bitfield,buffer,offset);rle(state);encode.bytes=state.outputOffset-offset;return buffer};exports.encode.bytes=0;exports.encodingLength=encodingLength;exports.decode=function decode(buffer,offset){offset||(offset=0);var bitfield=alloc(decodingLength(buffer,offset));var ptr=0;for(;offset<buffer.length;){var next=varint.decode(buffer,offset),repeat=1&next,len=repeat?(next-(3&next))/4:next/2;offset+=varint.decode.bytes,repeat?bitfield.fill(2&next?255:0,ptr,ptr+len):(buffer.copy(bitfield,ptr,offset,offset+len),offset+=len),ptr+=len}bitfield.fill(0,ptr);decode.bytes=buffer.length-offset;return bitfield};exports.decode.bytes=0;exports.decodingLength=decodingLength;return exports;function State(input,output,offset){this.inputOffset=0,this.inputLength=input.length,this.input=input,this.outputOffset=offset,this.output=output}function encodingLength(bitfield){var state=new State(bitfield,null,0);return rle(state),state.outputOffset}function decodingLength(buffer,offset){offset||(offset=0);for(var len=0;offset<buffer.length;){var next=varint.decode(buffer,offset);offset+=varint.decode.bytes;var repeat=1&next,slice=repeat?(next-(3&next))/4:next/2;len+=slice,repeat||(offset+=slice)}if(offset>buffer.length)throw new Error("Invalid RLE bitfield");return len&n-1?len+(n-(len&n-1)):len}function rle(state){for(var len=0,bits=0,input=state.input;state.inputLength>0&&!input[state.inputLength-1];)state.inputLength--;for(var i=0;i<state.inputLength;i++)input[i]!==bits?(len&&encodeUpdate(state,i,len,bits),0===input[i]||255===input[i]?(bits=input[i],len=1):len=0):len++;len&&encodeUpdate(state,state.inputLength,len,bits),function(state){var headLength=state.inputLength-state.inputOffset;if(!headLength)return;state.output?encodeHead(state,state.inputLength):state.outputOffset+=headLength+varint.encodingLength(2*headLength);state.inputOffset=state.inputLength}(state)}function encodeHead(state,end){var headLength=end-state.inputOffset;varint.encode(2*headLength,state.output,state.outputOffset),state.outputOffset+=varint.encode.bytes,state.input.copy(state.output,state.outputOffset,state.inputOffset,end),state.outputOffset+=headLength}function encodeUpdate(state,i,len,bit){var headLength=i-len-state.inputOffset,headCost=headLength?varint.encodingLength(2*headLength)+headLength:0,enc=4*len+(bit?2:0)+1,encCost=headCost+varint.encodingLength(enc),baseCost=varint.encodingLength(2*(i-state.inputOffset))+i-state.inputOffset;if(!(encCost>=baseCost)){if(!state.output)return state.outputOffset+=encCost,void(state.inputOffset=i);headLength&&encodeHead(state,i-len),varint.encode(enc,state.output,state.outputOffset),state.outputOffset+=varint.encode.bytes,state.inputOffset=i}}}(1)},{"buffer-alloc-unsafe":22,varint:14}],12:[function(require,module,exports){module.exports=function read(buf,offset){var b,res=0,offset=offset||0,shift=0,counter=offset,l=buf.length;do{if(counter>=l)return read.bytes=0,void(read.bytesRead=0);b=buf[counter++],res+=shift<28?(b&REST)<<shift:(b&REST)*Math.pow(2,shift),shift+=7}while(b>=MSB);read.bytes=counter-offset;return res};var MSB=128,REST=127},{}],13:[function(require,module,exports){module.exports=function encode(num,out,offset){out=out||[];offset=offset||0;var oldOffset=offset;for(;num>=INT;)out[offset++]=255&num|MSB,num/=128;for(;num&MSBALL;)out[offset++]=255&num|MSB,num>>>=7;out[offset]=0|num;encode.bytes=offset-oldOffset+1;return out};var MSB=128,MSBALL=-128,INT=Math.pow(2,31)},{}],14:[function(require,module,exports){module.exports={encode:require("./encode.js"),decode:require("./decode.js"),encodingLength:require("./length.js")}},{"./decode.js":12,"./encode.js":13,"./length.js":15}],15:[function(require,module,exports){var N1=Math.pow(2,7),N2=Math.pow(2,14),N3=Math.pow(2,21),N4=Math.pow(2,28),N5=Math.pow(2,35),N6=Math.pow(2,42),N7=Math.pow(2,49),N8=Math.pow(2,56),N9=Math.pow(2,63);module.exports=function(value){return value<N1?1:value<N2?2:value<N3?3:value<N4?4:value<N5?5:value<N6?6:value<N7?7:value<N8?8:value<N9?9:10}},{}],16:[function(require,module,exports){function loadWebAssembly(opts){if(!loadWebAssembly.supported)return null;var s,imp=opts&&opts.imports,wasm=(s="AGFzbQEAAAABEANgAn9/AGADf39/AGABfwADBQQAAQICBQUBAQroBwdNBQZtZW1vcnkCAAxibGFrZTJiX2luaXQAAA5ibGFrZTJiX3VwZGF0ZQABDWJsYWtlMmJfZmluYWwAAhBibGFrZTJiX2NvbXByZXNzAAMK00AElgMAIABCADcDACAAQQhqQgA3AwAgAEEQakIANwMAIABBGGpCADcDACAAQSBqQgA3AwAgAEEoakIANwMAIABBMGpCADcDACAAQThqQgA3AwAgAEHAAGpCADcDACAAQcgAakIANwMAIABB0ABqQgA3AwAgAEHYAGpCADcDACAAQeAAakIANwMAIABB6ABqQgA3AwAgAEHwAGpCADcDACAAQfgAakIANwMAIABBgAFqQoiS853/zPmE6gBBACkDAIU3AwAgAEGIAWpCu86qptjQ67O7f0EIKQMAhTcDACAAQZABakKr8NP0r+68tzxBECkDAIU3AwAgAEGYAWpC8e30+KWn/aelf0EYKQMAhTcDACAAQaABakLRhZrv+s+Uh9EAQSApAwCFNwMAIABBqAFqQp/Y+dnCkdqCm39BKCkDAIU3AwAgAEGwAWpC6/qG2r+19sEfQTApAwCFNwMAIABBuAFqQvnC+JuRo7Pw2wBBOCkDAIU3AwAgAEHAAWpCADcDACAAQcgBakIANwMAIABB0AFqQgA3AwALbQEDfyAAQcABaiEDIABByAFqIQQgBCkDAKchBQJAA0AgASACRg0BIAVBgAFGBEAgAyADKQMAIAWtfDcDAEEAIQUgABADCyAAIAVqIAEtAAA6AAAgBUEBaiEFIAFBAWohAQwACwsgBCAFrTcDAAtkAQN/IABBwAFqIQEgAEHIAWohAiABIAEpAwAgAikDAHw3AwAgAEHQAWpCfzcDACACKQMApyEDAkADQCADQYABRg0BIAAgA2pBADoAACADQQFqIQMMAAsLIAIgA603AwAgABADC+U7AiB+CX8gAEGAAWohISAAQYgBaiEiIABBkAFqISMgAEGYAWohJCAAQaABaiElIABBqAFqISYgAEGwAWohJyAAQbgBaiEoICEpAwAhASAiKQMAIQIgIykDACEDICQpAwAhBCAlKQMAIQUgJikDACEGICcpAwAhByAoKQMAIQhCiJLznf/M+YTqACEJQrvOqqbY0Ouzu38hCkKr8NP0r+68tzwhC0Lx7fT4paf9p6V/IQxC0YWa7/rPlIfRACENQp/Y+dnCkdqCm38hDkLr+obav7X2wR8hD0L5wvibkaOz8NsAIRAgACkDACERIABBCGopAwAhEiAAQRBqKQMAIRMgAEEYaikDACEUIABBIGopAwAhFSAAQShqKQMAIRYgAEEwaikDACEXIABBOGopAwAhGCAAQcAAaikDACEZIABByABqKQMAIRogAEHQAGopAwAhGyAAQdgAaikDACEcIABB4ABqKQMAIR0gAEHoAGopAwAhHiAAQfAAaikDACEfIABB+ABqKQMAISAgDSAAQcABaikDAIUhDSAPIABB0AFqKQMAhSEPIAEgBSARfHwhASANIAGFQiCKIQ0gCSANfCEJIAUgCYVCGIohBSABIAUgEnx8IQEgDSABhUIQiiENIAkgDXwhCSAFIAmFQj+KIQUgAiAGIBN8fCECIA4gAoVCIIohDiAKIA58IQogBiAKhUIYiiEGIAIgBiAUfHwhAiAOIAKFQhCKIQ4gCiAOfCEKIAYgCoVCP4ohBiADIAcgFXx8IQMgDyADhUIgiiEPIAsgD3whCyAHIAuFQhiKIQcgAyAHIBZ8fCEDIA8gA4VCEIohDyALIA98IQsgByALhUI/iiEHIAQgCCAXfHwhBCAQIASFQiCKIRAgDCAQfCEMIAggDIVCGIohCCAEIAggGHx8IQQgECAEhUIQiiEQIAwgEHwhDCAIIAyFQj+KIQggASAGIBl8fCEBIBAgAYVCIIohECALIBB8IQsgBiALhUIYiiEGIAEgBiAafHwhASAQIAGFQhCKIRAgCyAQfCELIAYgC4VCP4ohBiACIAcgG3x8IQIgDSAChUIgiiENIAwgDXwhDCAHIAyFQhiKIQcgAiAHIBx8fCECIA0gAoVCEIohDSAMIA18IQwgByAMhUI/iiEHIAMgCCAdfHwhAyAOIAOFQiCKIQ4gCSAOfCEJIAggCYVCGIohCCADIAggHnx8IQMgDiADhUIQiiEOIAkgDnwhCSAIIAmFQj+KIQggBCAFIB98fCEEIA8gBIVCIIohDyAKIA98IQogBSAKhUIYiiEFIAQgBSAgfHwhBCAPIASFQhCKIQ8gCiAPfCEKIAUgCoVCP4ohBSABIAUgH3x8IQEgDSABhUIgiiENIAkgDXwhCSAFIAmFQhiKIQUgASAFIBt8fCEBIA0gAYVCEIohDSAJIA18IQkgBSAJhUI/iiEFIAIgBiAVfHwhAiAOIAKFQiCKIQ4gCiAOfCEKIAYgCoVCGIohBiACIAYgGXx8IQIgDiAChUIQiiEOIAogDnwhCiAGIAqFQj+KIQYgAyAHIBp8fCEDIA8gA4VCIIohDyALIA98IQsgByALhUIYiiEHIAMgByAgfHwhAyAPIAOFQhCKIQ8gCyAPfCELIAcgC4VCP4ohByAEIAggHnx8IQQgECAEhUIgiiEQIAwgEHwhDCAIIAyFQhiKIQggBCAIIBd8fCEEIBAgBIVCEIohECAMIBB8IQwgCCAMhUI/iiEIIAEgBiASfHwhASAQIAGFQiCKIRAgCyAQfCELIAYgC4VCGIohBiABIAYgHXx8IQEgECABhUIQiiEQIAsgEHwhCyAGIAuFQj+KIQYgAiAHIBF8fCECIA0gAoVCIIohDSAMIA18IQwgByAMhUIYiiEHIAIgByATfHwhAiANIAKFQhCKIQ0gDCANfCEMIAcgDIVCP4ohByADIAggHHx8IQMgDiADhUIgiiEOIAkgDnwhCSAIIAmFQhiKIQggAyAIIBh8fCEDIA4gA4VCEIohDiAJIA58IQkgCCAJhUI/iiEIIAQgBSAWfHwhBCAPIASFQiCKIQ8gCiAPfCEKIAUgCoVCGIohBSAEIAUgFHx8IQQgDyAEhUIQiiEPIAogD3whCiAFIAqFQj+KIQUgASAFIBx8fCEBIA0gAYVCIIohDSAJIA18IQkgBSAJhUIYiiEFIAEgBSAZfHwhASANIAGFQhCKIQ0gCSANfCEJIAUgCYVCP4ohBSACIAYgHXx8IQIgDiAChUIgiiEOIAogDnwhCiAGIAqFQhiKIQYgAiAGIBF8fCECIA4gAoVCEIohDiAKIA58IQogBiAKhUI/iiEGIAMgByAWfHwhAyAPIAOFQiCKIQ8gCyAPfCELIAcgC4VCGIohByADIAcgE3x8IQMgDyADhUIQiiEPIAsgD3whCyAHIAuFQj+KIQcgBCAIICB8fCEEIBAgBIVCIIohECAMIBB8IQwgCCAMhUIYiiEIIAQgCCAefHwhBCAQIASFQhCKIRAgDCAQfCEMIAggDIVCP4ohCCABIAYgG3x8IQEgECABhUIgiiEQIAsgEHwhCyAGIAuFQhiKIQYgASAGIB98fCEBIBAgAYVCEIohECALIBB8IQsgBiALhUI/iiEGIAIgByAUfHwhAiANIAKFQiCKIQ0gDCANfCEMIAcgDIVCGIohByACIAcgF3x8IQIgDSAChUIQiiENIAwgDXwhDCAHIAyFQj+KIQcgAyAIIBh8fCEDIA4gA4VCIIohDiAJIA58IQkgCCAJhUIYiiEIIAMgCCASfHwhAyAOIAOFQhCKIQ4gCSAOfCEJIAggCYVCP4ohCCAEIAUgGnx8IQQgDyAEhUIgiiEPIAogD3whCiAFIAqFQhiKIQUgBCAFIBV8fCEEIA8gBIVCEIohDyAKIA98IQogBSAKhUI/iiEFIAEgBSAYfHwhASANIAGFQiCKIQ0gCSANfCEJIAUgCYVCGIohBSABIAUgGnx8IQEgDSABhUIQiiENIAkgDXwhCSAFIAmFQj+KIQUgAiAGIBR8fCECIA4gAoVCIIohDiAKIA58IQogBiAKhUIYiiEGIAIgBiASfHwhAiAOIAKFQhCKIQ4gCiAOfCEKIAYgCoVCP4ohBiADIAcgHnx8IQMgDyADhUIgiiEPIAsgD3whCyAHIAuFQhiKIQcgAyAHIB18fCEDIA8gA4VCEIohDyALIA98IQsgByALhUI/iiEHIAQgCCAcfHwhBCAQIASFQiCKIRAgDCAQfCEMIAggDIVCGIohCCAEIAggH3x8IQQgECAEhUIQiiEQIAwgEHwhDCAIIAyFQj+KIQggASAGIBN8fCEBIBAgAYVCIIohECALIBB8IQsgBiALhUIYiiEGIAEgBiAXfHwhASAQIAGFQhCKIRAgCyAQfCELIAYgC4VCP4ohBiACIAcgFnx8IQIgDSAChUIgiiENIAwgDXwhDCAHIAyFQhiKIQcgAiAHIBt8fCECIA0gAoVCEIohDSAMIA18IQwgByAMhUI/iiEHIAMgCCAVfHwhAyAOIAOFQiCKIQ4gCSAOfCEJIAggCYVCGIohCCADIAggEXx8IQMgDiADhUIQiiEOIAkgDnwhCSAIIAmFQj+KIQggBCAFICB8fCEEIA8gBIVCIIohDyAKIA98IQogBSAKhUIYiiEFIAQgBSAZfHwhBCAPIASFQhCKIQ8gCiAPfCEKIAUgCoVCP4ohBSABIAUgGnx8IQEgDSABhUIgiiENIAkgDXwhCSAFIAmFQhiKIQUgASAFIBF8fCEBIA0gAYVCEIohDSAJIA18IQkgBSAJhUI/iiEFIAIgBiAWfHwhAiAOIAKFQiCKIQ4gCiAOfCEKIAYgCoVCGIohBiACIAYgGHx8IQIgDiAChUIQiiEOIAogDnwhCiAGIAqFQj+KIQYgAyAHIBN8fCEDIA8gA4VCIIohDyALIA98IQsgByALhUIYiiEHIAMgByAVfHwhAyAPIAOFQhCKIQ8gCyAPfCELIAcgC4VCP4ohByAEIAggG3x8IQQgECAEhUIgiiEQIAwgEHwhDCAIIAyFQhiKIQggBCAIICB8fCEEIBAgBIVCEIohECAMIBB8IQwgCCAMhUI/iiEIIAEgBiAffHwhASAQIAGFQiCKIRAgCyAQfCELIAYgC4VCGIohBiABIAYgEnx8IQEgECABhUIQiiEQIAsgEHwhCyAGIAuFQj+KIQYgAiAHIBx8fCECIA0gAoVCIIohDSAMIA18IQwgByAMhUIYiiEHIAIgByAdfHwhAiANIAKFQhCKIQ0gDCANfCEMIAcgDIVCP4ohByADIAggF3x8IQMgDiADhUIgiiEOIAkgDnwhCSAIIAmFQhiKIQggAyAIIBl8fCEDIA4gA4VCEIohDiAJIA58IQkgCCAJhUI/iiEIIAQgBSAUfHwhBCAPIASFQiCKIQ8gCiAPfCEKIAUgCoVCGIohBSAEIAUgHnx8IQQgDyAEhUIQiiEPIAogD3whCiAFIAqFQj+KIQUgASAFIBN8fCEBIA0gAYVCIIohDSAJIA18IQkgBSAJhUIYiiEFIAEgBSAdfHwhASANIAGFQhCKIQ0gCSANfCEJIAUgCYVCP4ohBSACIAYgF3x8IQIgDiAChUIgiiEOIAogDnwhCiAGIAqFQhiKIQYgAiAGIBt8fCECIA4gAoVCEIohDiAKIA58IQogBiAKhUI/iiEGIAMgByARfHwhAyAPIAOFQiCKIQ8gCyAPfCELIAcgC4VCGIohByADIAcgHHx8IQMgDyADhUIQiiEPIAsgD3whCyAHIAuFQj+KIQcgBCAIIBl8fCEEIBAgBIVCIIohECAMIBB8IQwgCCAMhUIYiiEIIAQgCCAUfHwhBCAQIASFQhCKIRAgDCAQfCEMIAggDIVCP4ohCCABIAYgFXx8IQEgECABhUIgiiEQIAsgEHwhCyAGIAuFQhiKIQYgASAGIB58fCEBIBAgAYVCEIohECALIBB8IQsgBiALhUI/iiEGIAIgByAYfHwhAiANIAKFQiCKIQ0gDCANfCEMIAcgDIVCGIohByACIAcgFnx8IQIgDSAChUIQiiENIAwgDXwhDCAHIAyFQj+KIQcgAyAIICB8fCEDIA4gA4VCIIohDiAJIA58IQkgCCAJhUIYiiEIIAMgCCAffHwhAyAOIAOFQhCKIQ4gCSAOfCEJIAggCYVCP4ohCCAEIAUgEnx8IQQgDyAEhUIgiiEPIAogD3whCiAFIAqFQhiKIQUgBCAFIBp8fCEEIA8gBIVCEIohDyAKIA98IQogBSAKhUI/iiEFIAEgBSAdfHwhASANIAGFQiCKIQ0gCSANfCEJIAUgCYVCGIohBSABIAUgFnx8IQEgDSABhUIQiiENIAkgDXwhCSAFIAmFQj+KIQUgAiAGIBJ8fCECIA4gAoVCIIohDiAKIA58IQogBiAKhUIYiiEGIAIgBiAgfHwhAiAOIAKFQhCKIQ4gCiAOfCEKIAYgCoVCP4ohBiADIAcgH3x8IQMgDyADhUIgiiEPIAsgD3whCyAHIAuFQhiKIQcgAyAHIB58fCEDIA8gA4VCEIohDyALIA98IQsgByALhUI/iiEHIAQgCCAVfHwhBCAQIASFQiCKIRAgDCAQfCEMIAggDIVCGIohCCAEIAggG3x8IQQgECAEhUIQiiEQIAwgEHwhDCAIIAyFQj+KIQggASAGIBF8fCEBIBAgAYVCIIohECALIBB8IQsgBiALhUIYiiEGIAEgBiAYfHwhASAQIAGFQhCKIRAgCyAQfCELIAYgC4VCP4ohBiACIAcgF3x8IQIgDSAChUIgiiENIAwgDXwhDCAHIAyFQhiKIQcgAiAHIBR8fCECIA0gAoVCEIohDSAMIA18IQwgByAMhUI/iiEHIAMgCCAafHwhAyAOIAOFQiCKIQ4gCSAOfCEJIAggCYVCGIohCCADIAggE3x8IQMgDiADhUIQiiEOIAkgDnwhCSAIIAmFQj+KIQggBCAFIBl8fCEEIA8gBIVCIIohDyAKIA98IQogBSAKhUIYiiEFIAQgBSAcfHwhBCAPIASFQhCKIQ8gCiAPfCEKIAUgCoVCP4ohBSABIAUgHnx8IQEgDSABhUIgiiENIAkgDXwhCSAFIAmFQhiKIQUgASAFIBx8fCEBIA0gAYVCEIohDSAJIA18IQkgBSAJhUI/iiEFIAIgBiAYfHwhAiAOIAKFQiCKIQ4gCiAOfCEKIAYgCoVCGIohBiACIAYgH3x8IQIgDiAChUIQiiEOIAogDnwhCiAGIAqFQj+KIQYgAyAHIB18fCEDIA8gA4VCIIohDyALIA98IQsgByALhUIYiiEHIAMgByASfHwhAyAPIAOFQhCKIQ8gCyAPfCELIAcgC4VCP4ohByAEIAggFHx8IQQgECAEhUIgiiEQIAwgEHwhDCAIIAyFQhiKIQggBCAIIBp8fCEEIBAgBIVCEIohECAMIBB8IQwgCCAMhUI/iiEIIAEgBiAWfHwhASAQIAGFQiCKIRAgCyAQfCELIAYgC4VCGIohBiABIAYgEXx8IQEgECABhUIQiiEQIAsgEHwhCyAGIAuFQj+KIQYgAiAHICB8fCECIA0gAoVCIIohDSAMIA18IQwgByAMhUIYiiEHIAIgByAVfHwhAiANIAKFQhCKIQ0gDCANfCEMIAcgDIVCP4ohByADIAggGXx8IQMgDiADhUIgiiEOIAkgDnwhCSAIIAmFQhiKIQggAyAIIBd8fCEDIA4gA4VCEIohDiAJIA58IQkgCCAJhUI/iiEIIAQgBSATfHwhBCAPIASFQiCKIQ8gCiAPfCEKIAUgCoVCGIohBSAEIAUgG3x8IQQgDyAEhUIQiiEPIAogD3whCiAFIAqFQj+KIQUgASAFIBd8fCEBIA0gAYVCIIohDSAJIA18IQkgBSAJhUIYiiEFIAEgBSAgfHwhASANIAGFQhCKIQ0gCSANfCEJIAUgCYVCP4ohBSACIAYgH3x8IQIgDiAChUIgiiEOIAogDnwhCiAGIAqFQhiKIQYgAiAGIBp8fCECIA4gAoVCEIohDiAKIA58IQogBiAKhUI/iiEGIAMgByAcfHwhAyAPIAOFQiCKIQ8gCyAPfCELIAcgC4VCGIohByADIAcgFHx8IQMgDyADhUIQiiEPIAsgD3whCyAHIAuFQj+KIQcgBCAIIBF8fCEEIBAgBIVCIIohECAMIBB8IQwgCCAMhUIYiiEIIAQgCCAZfHwhBCAQIASFQhCKIRAgDCAQfCEMIAggDIVCP4ohCCABIAYgHXx8IQEgECABhUIgiiEQIAsgEHwhCyAGIAuFQhiKIQYgASAGIBN8fCEBIBAgAYVCEIohECALIBB8IQsgBiALhUI/iiEGIAIgByAefHwhAiANIAKFQiCKIQ0gDCANfCEMIAcgDIVCGIohByACIAcgGHx8IQIgDSAChUIQiiENIAwgDXwhDCAHIAyFQj+KIQcgAyAIIBJ8fCEDIA4gA4VCIIohDiAJIA58IQkgCCAJhUIYiiEIIAMgCCAVfHwhAyAOIAOFQhCKIQ4gCSAOfCEJIAggCYVCP4ohCCAEIAUgG3x8IQQgDyAEhUIgiiEPIAogD3whCiAFIAqFQhiKIQUgBCAFIBZ8fCEEIA8gBIVCEIohDyAKIA98IQogBSAKhUI/iiEFIAEgBSAbfHwhASANIAGFQiCKIQ0gCSANfCEJIAUgCYVCGIohBSABIAUgE3x8IQEgDSABhUIQiiENIAkgDXwhCSAFIAmFQj+KIQUgAiAGIBl8fCECIA4gAoVCIIohDiAKIA58IQogBiAKhUIYiiEGIAIgBiAVfHwhAiAOIAKFQhCKIQ4gCiAOfCEKIAYgCoVCP4ohBiADIAcgGHx8IQMgDyADhUIgiiEPIAsgD3whCyAHIAuFQhiKIQcgAyAHIBd8fCEDIA8gA4VCEIohDyALIA98IQsgByALhUI/iiEHIAQgCCASfHwhBCAQIASFQiCKIRAgDCAQfCEMIAggDIVCGIohCCAEIAggFnx8IQQgECAEhUIQiiEQIAwgEHwhDCAIIAyFQj+KIQggASAGICB8fCEBIBAgAYVCIIohECALIBB8IQsgBiALhUIYiiEGIAEgBiAcfHwhASAQIAGFQhCKIRAgCyAQfCELIAYgC4VCP4ohBiACIAcgGnx8IQIgDSAChUIgiiENIAwgDXwhDCAHIAyFQhiKIQcgAiAHIB98fCECIA0gAoVCEIohDSAMIA18IQwgByAMhUI/iiEHIAMgCCAUfHwhAyAOIAOFQiCKIQ4gCSAOfCEJIAggCYVCGIohCCADIAggHXx8IQMgDiADhUIQiiEOIAkgDnwhCSAIIAmFQj+KIQggBCAFIB58fCEEIA8gBIVCIIohDyAKIA98IQogBSAKhUIYiiEFIAQgBSARfHwhBCAPIASFQhCKIQ8gCiAPfCEKIAUgCoVCP4ohBSABIAUgEXx8IQEgDSABhUIgiiENIAkgDXwhCSAFIAmFQhiKIQUgASAFIBJ8fCEBIA0gAYVCEIohDSAJIA18IQkgBSAJhUI/iiEFIAIgBiATfHwhAiAOIAKFQiCKIQ4gCiAOfCEKIAYgCoVCGIohBiACIAYgFHx8IQIgDiAChUIQiiEOIAogDnwhCiAGIAqFQj+KIQYgAyAHIBV8fCEDIA8gA4VCIIohDyALIA98IQsgByALhUIYiiEHIAMgByAWfHwhAyAPIAOFQhCKIQ8gCyAPfCELIAcgC4VCP4ohByAEIAggF3x8IQQgECAEhUIgiiEQIAwgEHwhDCAIIAyFQhiKIQggBCAIIBh8fCEEIBAgBIVCEIohECAMIBB8IQwgCCAMhUI/iiEIIAEgBiAZfHwhASAQIAGFQiCKIRAgCyAQfCELIAYgC4VCGIohBiABIAYgGnx8IQEgECABhUIQiiEQIAsgEHwhCyAGIAuFQj+KIQYgAiAHIBt8fCECIA0gAoVCIIohDSAMIA18IQwgByAMhUIYiiEHIAIgByAcfHwhAiANIAKFQhCKIQ0gDCANfCEMIAcgDIVCP4ohByADIAggHXx8IQMgDiADhUIgiiEOIAkgDnwhCSAIIAmFQhiKIQggAyAIIB58fCEDIA4gA4VCEIohDiAJIA58IQkgCCAJhUI/iiEIIAQgBSAffHwhBCAPIASFQiCKIQ8gCiAPfCEKIAUgCoVCGIohBSAEIAUgIHx8IQQgDyAEhUIQiiEPIAogD3whCiAFIAqFQj+KIQUgASAFIB98fCEBIA0gAYVCIIohDSAJIA18IQkgBSAJhUIYiiEFIAEgBSAbfHwhASANIAGFQhCKIQ0gCSANfCEJIAUgCYVCP4ohBSACIAYgFXx8IQIgDiAChUIgiiEOIAogDnwhCiAGIAqFQhiKIQYgAiAGIBl8fCECIA4gAoVCEIohDiAKIA58IQogBiAKhUI/iiEGIAMgByAafHwhAyAPIAOFQiCKIQ8gCyAPfCELIAcgC4VCGIohByADIAcgIHx8IQMgDyADhUIQiiEPIAsgD3whCyAHIAuFQj+KIQcgBCAIIB58fCEEIBAgBIVCIIohECAMIBB8IQwgCCAMhUIYiiEIIAQgCCAXfHwhBCAQIASFQhCKIRAgDCAQfCEMIAggDIVCP4ohCCABIAYgEnx8IQEgECABhUIgiiEQIAsgEHwhCyAGIAuFQhiKIQYgASAGIB18fCEBIBAgAYVCEIohECALIBB8IQsgBiALhUI/iiEGIAIgByARfHwhAiANIAKFQiCKIQ0gDCANfCEMIAcgDIVCGIohByACIAcgE3x8IQIgDSAChUIQiiENIAwgDXwhDCAHIAyFQj+KIQcgAyAIIBx8fCEDIA4gA4VCIIohDiAJIA58IQkgCCAJhUIYiiEIIAMgCCAYfHwhAyAOIAOFQhCKIQ4gCSAOfCEJIAggCYVCP4ohCCAEIAUgFnx8IQQgDyAEhUIgiiEPIAogD3whCiAFIAqFQhiKIQUgBCAFIBR8fCEEIA8gBIVCEIohDyAKIA98IQogBSAKhUI/iiEFICEgISkDACABIAmFhTcDACAiICIpAwAgAiAKhYU3AwAgIyAjKQMAIAMgC4WFNwMAICQgJCkDACAEIAyFhTcDACAlICUpAwAgBSANhYU3AwAgJiAmKQMAIAYgDoWFNwMAICcgJykDACAHIA+FhTcDACAoICgpAwAgCCAQhYU3AwAL","function"==typeof atob?new Uint8Array(atob(s).split("").map(charCodeAt)):new(require("buffer").Buffer)(s,"base64")),ready=null,mod={buffer:wasm,memory:null,exports:null,realloc:function(size){mod.exports.memory.grow(Math.ceil(Math.abs(size-mod.memory.length)/65536)),mod.memory=new Uint8Array(mod.exports.memory.buffer)},onload:onload};return onload(function(){}),mod;function onload(cb){if(mod.exports)return cb();if(ready)ready.then(cb.bind(null,null)).catch(cb);else{try{if(opts&&opts.async)throw new Error("async");setup({instance:new WebAssembly.Instance(new WebAssembly.Module(wasm),imp)})}catch(err){ready=WebAssembly.instantiate(wasm,imp).then(setup)}onload(cb)}}function setup(w){mod.exports=w.instance.exports,mod.memory=mod.exports.memory&&mod.exports.memory.buffer&&new Uint8Array(mod.exports.memory.buffer)}}function charCodeAt(c){return c.charCodeAt(0)}module.exports=loadWebAssembly,loadWebAssembly.supported="undefined"!=typeof WebAssembly},{}],17:[function(require,module,exports){var assert=require("nanoassert"),wasm=require("./blake2b")(),head=64,freeList=[];module.exports=Blake2b;var BYTES_MIN=module.exports.BYTES_MIN=16,BYTES_MAX=module.exports.BYTES_MAX=64,KEYBYTES_MIN=(module.exports.BYTES=32,module.exports.KEYBYTES_MIN=16),KEYBYTES_MAX=module.exports.KEYBYTES_MAX=64,SALTBYTES=(module.exports.KEYBYTES=32,module.exports.SALTBYTES=16),PERSONALBYTES=module.exports.PERSONALBYTES=16;function Blake2b(digestLength,key,salt,personal,noAssert){if(!(this instanceof Blake2b))return new Blake2b(digestLength,key,salt,personal,noAssert);if(!wasm||!wasm.exports)throw new Error("WASM not loaded. Wait for Blake2b.ready(cb)");digestLength||(digestLength=32),!0!==noAssert&&(assert(digestLength>=BYTES_MIN,"digestLength must be at least "+BYTES_MIN+", was given "+digestLength),assert(digestLength<=BYTES_MAX,"digestLength must be at most "+BYTES_MAX+", was given "+digestLength),null!=key&&assert(key.length>=KEYBYTES_MIN,"key must be at least "+KEYBYTES_MIN+", was given "+key.length),null!=key&&assert(key.length<=KEYBYTES_MAX,"key must be at least "+KEYBYTES_MAX+", was given "+key.length),null!=salt&&assert(salt.length===SALTBYTES,"salt must be exactly "+SALTBYTES+", was given "+salt.length),null!=personal&&assert(personal.length===PERSONALBYTES,"personal must be exactly "+PERSONALBYTES+", was given "+personal.length)),freeList.length||(freeList.push(head),head+=216),this.digestLength=digestLength,this.finalized=!1,this.pointer=freeList.pop(),wasm.memory.fill(0,0,64),wasm.memory[0]=this.digestLength,wasm.memory[1]=key?key.length:0,wasm.memory[2]=1,wasm.memory[3]=1,salt&&wasm.memory.set(salt,32),personal&&wasm.memory.set(personal,48),this.pointer+216>wasm.memory.length&&wasm.realloc(this.pointer+216),wasm.exports.blake2b_init(this.pointer,this.digestLength),key&&(this.update(key),wasm.memory.fill(0,head,head+key.length),wasm.memory[this.pointer+200]=128)}function noop(){}function toHex(n){return n<16?"0"+n.toString(16):n.toString(16)}Blake2b.prototype.update=function(input){return assert(!1===this.finalized,"Hash instance finalized"),assert(input,"input must be TypedArray or Buffer"),head+input.length>wasm.memory.length&&wasm.realloc(head+input.length),wasm.memory.set(input,head),wasm.exports.blake2b_update(this.pointer,head,head+input.length),this},Blake2b.prototype.digest=function(enc){if(assert(!1===this.finalized,"Hash instance finalized"),this.finalized=!0,freeList.push(this.pointer),wasm.exports.blake2b_final(this.pointer),!enc||"binary"===enc)return wasm.memory.slice(this.pointer+128,this.pointer+128+this.digestLength);if("hex"===enc)return function(buf,start,len){for(var str="",i=0;i<len;i++)str+=toHex(buf[start+i]);return str}(wasm.memory,this.pointer+128,this.digestLength);assert(enc.length>=this.digestLength,"input must be TypedArray or Buffer");for(var i=0;i<this.digestLength;i++)enc[i]=wasm.memory[this.pointer+128+i];return enc},Blake2b.prototype.final=Blake2b.prototype.digest,Blake2b.WASM=wasm&&wasm.buffer,Blake2b.SUPPORTED="undefined"!=typeof WebAssembly,Blake2b.ready=function(cb){return cb||(cb=noop),wasm?new Promise(function(reject,resolve){wasm.onload(function(err){err?resolve():reject(),cb(err)})}):cb(new Error("WebAssembly not supported"))},Blake2b.prototype.ready=Blake2b.ready},{"./blake2b":16,nanoassert:109}],18:[function(require,module,exports){var assert=require("nanoassert"),b2wasm=require("blake2b-wasm");function ADD64AA(v,a,b){var o0=v[a]+v[b],o1=v[a+1]+v[b+1];o0>=4294967296&&o1++,v[a]=o0,v[a+1]=o1}function ADD64AC(v,a,b0,b1){var o0=v[a]+b0;b0<0&&(o0+=4294967296);var o1=v[a+1]+b1;o0>=4294967296&&o1++,v[a]=o0,v[a+1]=o1}function B2B_GET32(arr,i){return arr[i]^arr[i+1]<<8^arr[i+2]<<16^arr[i+3]<<24}function B2B_G(a,b,c,d,ix,iy){var x0=m[ix],x1=m[ix+1],y0=m[iy],y1=m[iy+1];ADD64AA(v,a,b),ADD64AC(v,a,x0,x1);var xor0=v[d]^v[a],xor1=v[d+1]^v[a+1];v[d]=xor1,v[d+1]=xor0,ADD64AA(v,c,d),xor0=v[b]^v[c],xor1=v[b+1]^v[c+1],v[b]=xor0>>>24^xor1<<8,v[b+1]=xor1>>>24^xor0<<8,ADD64AA(v,a,b),ADD64AC(v,a,y0,y1),xor0=v[d]^v[a],xor1=v[d+1]^v[a+1],v[d]=xor0>>>16^xor1<<16,v[d+1]=xor1>>>16^xor0<<16,ADD64AA(v,c,d),xor0=v[b]^v[c],xor1=v[b+1]^v[c+1],v[b]=xor1>>>31^xor0<<1,v[b+1]=xor0>>>31^xor1<<1}var BLAKE2B_IV32=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),SIGMA82=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3].map(function(x){return 2*x})),v=new Uint32Array(32),m=new Uint32Array(32);function blake2bCompress(ctx,last){var i=0;for(i=0;i<16;i++)v[i]=ctx.h[i],v[i+16]=BLAKE2B_IV32[i];for(v[24]=v[24]^ctx.t,v[25]=v[25]^ctx.t/4294967296,last&&(v[28]=~v[28],v[29]=~v[29]),i=0;i<32;i++)m[i]=B2B_GET32(ctx.b,4*i);for(i=0;i<12;i++)B2B_G(0,8,16,24,SIGMA82[16*i+0],SIGMA82[16*i+1]),B2B_G(2,10,18,26,SIGMA82[16*i+2],SIGMA82[16*i+3]),B2B_G(4,12,20,28,SIGMA82[16*i+4],SIGMA82[16*i+5]),B2B_G(6,14,22,30,SIGMA82[16*i+6],SIGMA82[16*i+7]),B2B_G(0,10,20,30,SIGMA82[16*i+8],SIGMA82[16*i+9]),B2B_G(2,12,22,24,SIGMA82[16*i+10],SIGMA82[16*i+11]),B2B_G(4,14,16,26,SIGMA82[16*i+12],SIGMA82[16*i+13]),B2B_G(6,8,18,28,SIGMA82[16*i+14],SIGMA82[16*i+15]);for(i=0;i<16;i++)ctx.h[i]=ctx.h[i]^v[i]^v[i+16]}var parameter_block=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function Blake2b(outlen,key,salt,personal){parameter_block.fill(0),this.b=new Uint8Array(128),this.h=new Uint32Array(16),this.t=0,this.c=0,this.outlen=outlen,parameter_block[0]=outlen,key&&(parameter_block[1]=key.length),parameter_block[2]=1,parameter_block[3]=1,salt&&parameter_block.set(salt,32),personal&&parameter_block.set(personal,48);for(var i=0;i<16;i++)this.h[i]=BLAKE2B_IV32[i]^B2B_GET32(parameter_block,4*i);key&&(blake2bUpdate(this,key),this.c=128)}function blake2bUpdate(ctx,input){for(var i=0;i<input.length;i++)128===ctx.c&&(ctx.t+=ctx.c,blake2bCompress(ctx,!1),ctx.c=0),ctx.b[ctx.c++]=input[i]}function toHex(n){return n<16?"0"+n.toString(16):n.toString(16)}Blake2b.prototype.update=function(input){return assert(null!=input,"input must be Uint8Array or Buffer"),blake2bUpdate(this,input),this},Blake2b.prototype.digest=function(out){var buf=out&&"binary"!==out&&"hex"!==out?out:new Uint8Array(this.outlen);return assert(buf.length>=this.outlen,"out must have at least outlen bytes of space"),function(ctx,out){ctx.t+=ctx.c;for(;ctx.c<128;)ctx.b[ctx.c++]=0;blake2bCompress(ctx,!0);for(var i=0;i<ctx.outlen;i++)out[i]=ctx.h[i>>2]>>8*(3&i)}(this,buf),"hex"===out?function(buf){for(var str="",i=0;i<buf.length;i++)str+=toHex(buf[i]);return str}(buf):buf},Blake2b.prototype.final=Blake2b.prototype.digest,Blake2b.ready=function(cb){b2wasm.ready(function(){cb()})};var Proto=Blake2b;module.exports=function(outlen,key,salt,personal,noAssert){return!0!==noAssert&&(assert(outlen>=BYTES_MIN,"outlen must be at least "+BYTES_MIN+", was given "+outlen),assert(outlen<=BYTES_MAX,"outlen must be at most "+BYTES_MAX+", was given "+outlen),null!=key&&assert(key.length>=KEYBYTES_MIN,"key must be at least "+KEYBYTES_MIN+", was given "+key.length),null!=key&&assert(key.length<=KEYBYTES_MAX,"key must be at most "+KEYBYTES_MAX+", was given "+key.length),null!=salt&&assert(salt.length===SALTBYTES,"salt must be exactly "+SALTBYTES+", was given "+salt.length),null!=personal&&assert(personal.length===PERSONALBYTES,"personal must be exactly "+PERSONALBYTES+", was given "+personal.length)),new Proto(outlen,key,salt,personal)},module.exports.ready=function(cb){b2wasm.ready(function(){cb()})},module.exports.WASM_SUPPORTED=b2wasm.SUPPORTED,module.exports.WASM_LOADED=!1;var BYTES_MIN=module.exports.BYTES_MIN=16,BYTES_MAX=module.exports.BYTES_MAX=64,KEYBYTES_MIN=(module.exports.BYTES=32,module.exports.KEYBYTES_MIN=16),KEYBYTES_MAX=module.exports.KEYBYTES_MAX=64,SALTBYTES=(module.exports.KEYBYTES=32,module.exports.SALTBYTES=16),PERSONALBYTES=module.exports.PERSONALBYTES=16;b2wasm.ready(function(err){err||(module.exports.WASM_LOADED=!0,Proto=b2wasm)})},{"blake2b-wasm":17,nanoassert:109}],19:[function(require,module,exports){},{}],20:[function(require,module,exports){arguments[4][19][0].apply(exports,arguments)},{dup:19}],21:[function(require,module,exports){var objectCreate=Object.create||function(proto){var F=function(){};return F.prototype=proto,new F},objectKeys=Object.keys||function(obj){var keys=[];for(var k in obj)Object.prototype.hasOwnProperty.call(obj,k)&&keys.push(k);return k},bind=Function.prototype.bind||function(context){var fn=this;return function(){return fn.apply(context,arguments)}};function EventEmitter(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=objectCreate(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0;var hasDefineProperty,defaultMaxListeners=10;try{var o={};Object.defineProperty&&Object.defineProperty(o,"x",{value:0}),hasDefineProperty=0===o.x}catch(err){hasDefineProperty=!1}function $getMaxListeners(that){return void 0===that._maxListeners?EventEmitter.defaultMaxListeners:that._maxListeners}function _addListener(target,type,listener,prepend){var m,events,existing;if("function"!=typeof listener)throw new TypeError('"listener" argument must be a function');if((events=target._events)?(events.newListener&&(target.emit("newListener",type,listener.listener?listener.listener:listener),events=target._events),existing=events[type]):(events=target._events=objectCreate(null),target._eventsCount=0),existing){if("function"==typeof existing?existing=events[type]=prepend?[listener,existing]:[existing,listener]:prepend?existing.unshift(listener):existing.push(listener),!existing.warned&&(m=$getMaxListeners(target))&&m>0&&existing.length>m){existing.warned=!0;var w=new Error("Possible EventEmitter memory leak detected. "+existing.length+' "'+String(type)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');w.name="MaxListenersExceededWarning",w.emitter=target,w.type=type,w.count=existing.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",w.name,w.message)}}else existing=events[type]=listener,++target._eventsCount;return target}function onceWrapper(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var args=new Array(arguments.length),i=0;i<args.length;++i)args[i]=arguments[i];this.listener.apply(this.target,args)}}function _onceWrap(target,type,listener){var state={fired:!1,wrapFn:void 0,target:target,type:type,listener:listener},wrapped=bind.call(onceWrapper,state);return wrapped.listener=listener,state.wrapFn=wrapped,wrapped}function _listeners(target,type,unwrap){var events=target._events;if(!events)return[];var evlistener=events[type];return evlistener?"function"==typeof evlistener?unwrap?[evlistener.listener||evlistener]:[evlistener]:unwrap?function(arr){for(var ret=new Array(arr.length),i=0;i<ret.length;++i)ret[i]=arr[i].listener||arr[i];return ret}(evlistener):arrayClone(evlistener,evlistener.length):[]}function listenerCount(type){var events=this._events;if(events){var evlistener=events[type];if("function"==typeof evlistener)return 1;if(evlistener)return evlistener.length}return 0}function arrayClone(arr,n){for(var copy=new Array(n),i=0;i<n;++i)copy[i]=arr[i];return copy}hasDefineProperty?Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(arg){if("number"!=typeof arg||arg<0||arg!=arg)throw new TypeError('"defaultMaxListeners" must be a positive number');defaultMaxListeners=arg}}):EventEmitter.defaultMaxListeners=defaultMaxListeners,EventEmitter.prototype.setMaxListeners=function(n){if("number"!=typeof n||n<0||isNaN(n))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=n,this},EventEmitter.prototype.getMaxListeners=function(){return $getMaxListeners(this)},EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,events,doError="error"===type;if(events=this._events)doError=doError&&null==events.error;else if(!doError)return!1;if(doError){if(arguments.length>1&&(er=arguments[1]),er instanceof Error)throw er;var err=new Error('Unhandled "error" event. ('+er+")");throw err.context=er,err}if(!(handler=events[type]))return!1;var isFn="function"==typeof handler;switch(len=arguments.length){case 1:!function(handler,isFn,self){if(isFn)handler.call(self);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].call(self)}(handler,isFn,this);break;case 2:!function(handler,isFn,self,arg1){if(isFn)handler.call(self,arg1);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].call(self,arg1)}(handler,isFn,this,arguments[1]);break;case 3:!function(handler,isFn,self,arg1,arg2){if(isFn)handler.call(self,arg1,arg2);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].call(self,arg1,arg2)}(handler,isFn,this,arguments[1],arguments[2]);break;case 4:!function(handler,isFn,self,arg1,arg2,arg3){if(isFn)handler.call(self,arg1,arg2,arg3);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].call(self,arg1,arg2,arg3)}(handler,isFn,this,arguments[1],arguments[2],arguments[3]);break;default:for(args=new Array(len-1),i=1;i<len;i++)args[i-1]=arguments[i];!function(handler,isFn,self,args){if(isFn)handler.apply(self,args);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].apply(self,args)}(handler,isFn,this,args)}return!0},EventEmitter.prototype.addListener=function(type,listener){return _addListener(this,type,listener,!1)},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.prependListener=function(type,listener){return _addListener(this,type,listener,!0)},EventEmitter.prototype.once=function(type,listener){if("function"!=typeof listener)throw new TypeError('"listener" argument must be a function');return this.on(type,_onceWrap(this,type,listener)),this},EventEmitter.prototype.prependOnceListener=function(type,listener){if("function"!=typeof listener)throw new TypeError('"listener" argument must be a function');return this.prependListener(type,_onceWrap(this,type,listener)),this},EventEmitter.prototype.removeListener=function(type,listener){var list,events,position,i,originalListener;if("function"!=typeof listener)throw new TypeError('"listener" argument must be a function');if(!(events=this._events))return this;if(!(list=events[type]))return this;if(list===listener||list.listener===listener)0==--this._eventsCount?this._events=objectCreate(null):(delete events[type],events.removeListener&&this.emit("removeListener",type,list.listener||listener));else if("function"!=typeof list){for(position=-1,i=list.length-1;i>=0;i--)if(list[i]===listener||list[i].listener===listener){originalListener=list[i].listener,position=i;break}if(position<0)return this;0===position?list.shift():function(list,index){for(var i=index,k=i+1,n=list.length;k<n;i+=1,k+=1)list[i]=list[k];list.pop()}(list,position),1===list.length&&(events[type]=list[0]),events.removeListener&&this.emit("removeListener",type,originalListener||listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var listeners,events,i;if(!(events=this._events))return this;if(!events.removeListener)return 0===arguments.length?(this._events=objectCreate(null),this._eventsCount=0):events[type]&&(0==--this._eventsCount?this._events=objectCreate(null):delete events[type]),this;if(0===arguments.length){var key,keys=objectKeys(events);for(i=0;i<keys.length;++i)"removeListener"!==(key=keys[i])&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events=objectCreate(null),this._eventsCount=0,this}if("function"==typeof(listeners=events[type]))this.removeListener(type,listeners);else if(listeners)for(i=listeners.length-1;i>=0;i--)this.removeListener(type,listeners[i]);return this},EventEmitter.prototype.listeners=function(type){return _listeners(this,type,!0)},EventEmitter.prototype.rawListeners=function(type){return _listeners(this,type,!1)},EventEmitter.listenerCount=function(emitter,type){return"function"==typeof emitter.listenerCount?emitter.listenerCount(type):listenerCount.call(emitter,type)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],22:[function(require,module,exports){(function(Buffer){module.exports=function(size){if("number"!=typeof size)throw new TypeError('"size" argument must be a number');if(size<0)throw new RangeError('"size" argument must not be negative');return Buffer.allocUnsafe?Buffer.allocUnsafe(size):new Buffer(size)}}).call(this,require("buffer").Buffer)},{buffer:26}],23:[function(require,module,exports){(function(Buffer){var bufferFill=require("buffer-fill"),allocUnsafe=require("buffer-alloc-unsafe");module.exports=function(size,fill,encoding){if("number"!=typeof size)throw new TypeError('"size" argument must be a number');if(size<0)throw new RangeError('"size" argument must not be negative');if(Buffer.alloc)return Buffer.alloc(size,fill,encoding);var buffer=allocUnsafe(size);return 0===size?buffer:void 0===fill?bufferFill(buffer,0):("string"!=typeof encoding&&(encoding=void 0),bufferFill(buffer,fill,encoding))}}).call(this,require("buffer").Buffer)},{buffer:26,"buffer-alloc-unsafe":22,"buffer-fill":24}],24:[function(require,module,exports){(function(Buffer){var hasFullSupport=function(){try{if(!Buffer.isEncoding("latin1"))return!1;var buf=Buffer.alloc?Buffer.alloc(4):new Buffer(4);return buf.fill("ab","ucs2"),"61006200"===buf.toString("hex")}catch(_){return!1}}();function fillWithNumber(buffer,val,start,end){if(start<0||end>buffer.length)throw new RangeError("Out of range index");return start>>>=0,(end=void 0===end?buffer.length:end>>>0)>start&&buffer.fill(val,start,end),buffer}module.exports=function(buffer,val,start,end,encoding){if(hasFullSupport)return buffer.fill(val,start,end,encoding);if("number"==typeof val)return fillWithNumber(buffer,val,start,end);if("string"==typeof val){if("string"==typeof start?(encoding=start,start=0,end=buffer.length):"string"==typeof end&&(encoding=end,end=buffer.length),void 0!==encoding&&"string"!=typeof encoding)throw new TypeError("encoding must be a string");if("latin1"===encoding&&(encoding="binary"),"string"==typeof encoding&&!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding);if(""===val)return fillWithNumber(buffer,0,start,end);if(function(val){return 1===val.length&&val.charCodeAt(0)<256}(val))return fillWithNumber(buffer,val.charCodeAt(0),start,end);val=new Buffer(val,encoding)}return Buffer.isBuffer(val)?function(buffer,val,start,end){if(start<0||end>buffer.length)throw new RangeError("Out of range index");if(end<=start)return buffer;start>>>=0,end=void 0===end?buffer.length:end>>>0;for(var pos=start,len=val.length;pos<=end-len;)val.copy(buffer,pos),pos+=len;return pos!==end&&val.copy(buffer,pos,0,end-pos),buffer}(buffer,val,start,end):fillWithNumber(buffer,0,start,end)}}).call(this,require("buffer").Buffer)},{buffer:26}],25:[function(require,module,exports){(function(Buffer){var toString=Object.prototype.toString,isModern="function"==typeof Buffer.alloc&&"function"==typeof Buffer.allocUnsafe&&"function"==typeof Buffer.from;module.exports=function(value,encodingOrOffset,length){if("number"==typeof value)throw new TypeError('"value" argument must not be a number');return input=value,"ArrayBuffer"===toString.call(input).slice(8,-1)?function(obj,byteOffset,length){byteOffset>>>=0;var maxLength=obj.byteLength-byteOffset;if(maxLength<0)throw new RangeError("'offset' is out of bounds");if(void 0===length)length=maxLength;else if((length>>>=0)>maxLength)throw new RangeError("'length' is out of bounds");return isModern?Buffer.from(obj.slice(byteOffset,byteOffset+length)):new Buffer(new Uint8Array(obj.slice(byteOffset,byteOffset+length)))}(value,encodingOrOffset,length):"string"==typeof value?function(string,encoding){if("string"==typeof encoding&&""!==encoding||(encoding="utf8"),!Buffer.isEncoding(encoding))throw new TypeError('"encoding" must be a valid string encoding');return isModern?Buffer.from(string,encoding):new Buffer(string,encoding)}(value,encodingOrOffset):isModern?Buffer.from(value):new Buffer(value);var input}}).call(this,require("buffer").Buffer)},{buffer:26}],26:[function(require,module,exports){(function(Buffer){"use strict";var base64=require("base64-js"),ieee754=require("ieee754");exports.Buffer=Buffer,exports.SlowBuffer=function(length){+length!=length&&(length=0);return Buffer.alloc(+length)},exports.INSPECT_MAX_BYTES=50;var K_MAX_LENGTH=2147483647;function createBuffer(length){if(length>K_MAX_LENGTH)throw new RangeError("Invalid typed array length");var buf=new Uint8Array(length);return buf.__proto__=Buffer.prototype,buf}function Buffer(arg,encodingOrOffset,length){if("number"==typeof arg){if("string"==typeof encodingOrOffset)throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(arg)}return from(arg,encodingOrOffset,length)}function from(value,encodingOrOffset,length){if("number"==typeof value)throw new TypeError('"value" argument must not be a number');return isArrayBuffer(value)||value&&isArrayBuffer(value.buffer)?function(array,byteOffset,length){if(byteOffset<0||array.byteLength<byteOffset)throw new RangeError('"offset" is outside of buffer bounds');if(array.byteLength<byteOffset+(length||0))throw new RangeError('"length" is outside of buffer bounds');var buf;buf=void 0===byteOffset&&void 0===length?new Uint8Array(array):void 0===length?new Uint8Array(array,byteOffset):new Uint8Array(array,byteOffset,length);return buf.__proto__=Buffer.prototype,buf}(value,encodingOrOffset,length):"string"==typeof value?function(string,encoding){"string"==typeof encoding&&""!==encoding||(encoding="utf8");if(!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding);var length=0|byteLength(string,encoding),buf=createBuffer(length),actual=buf.write(string,encoding);actual!==length&&(buf=buf.slice(0,actual));return buf}(value,encodingOrOffset):function(obj){if(Buffer.isBuffer(obj)){var len=0|checked(obj.length),buf=createBuffer(len);return 0===buf.length?buf:(obj.copy(buf,0,0,len),buf)}if(obj){if(ArrayBuffer.isView(obj)||"length"in obj)return"number"!=typeof obj.length||numberIsNaN(obj.length)?createBuffer(0):fromArrayLike(obj);if("Buffer"===obj.type&&Array.isArray(obj.data))return fromArrayLike(obj.data)}throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object.")}(value)}function assertSize(size){if("number"!=typeof size)throw new TypeError('"size" argument must be of type number');if(size<0)throw new RangeError('"size" argument must not be negative')}function allocUnsafe(size){return assertSize(size),createBuffer(size<0?0:0|checked(size))}function fromArrayLike(array){for(var length=array.length<0?0:0|checked(array.length),buf=createBuffer(length),i=0;i<length;i+=1)buf[i]=255&array[i];return buf}function checked(length){if(length>=K_MAX_LENGTH)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+K_MAX_LENGTH.toString(16)+" bytes");return 0|length}function byteLength(string,encoding){if(Buffer.isBuffer(string))return string.length;if(ArrayBuffer.isView(string)||isArrayBuffer(string))return string.byteLength;"string"!=typeof string&&(string=""+string);var len=string.length;if(0===len)return 0;for(var loweredCase=!1;;)switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":case void 0:return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase(),loweredCase=!0}}function swap(b,n,m){var i=b[n];b[n]=b[m],b[m]=i}function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(0===buffer.length)return-1;if("string"==typeof byteOffset?(encoding=byteOffset,byteOffset=0):byteOffset>2147483647?byteOffset=2147483647:byteOffset<-2147483648&&(byteOffset=-2147483648),numberIsNaN(byteOffset=+byteOffset)&&(byteOffset=dir?0:buffer.length-1),byteOffset<0&&(byteOffset=buffer.length+byteOffset),byteOffset>=buffer.length){if(dir)return-1;byteOffset=buffer.length-1}else if(byteOffset<0){if(!dir)return-1;byteOffset=0}if("string"==typeof val&&(val=Buffer.from(val,encoding)),Buffer.isBuffer(val))return 0===val.length?-1:arrayIndexOf(buffer,val,byteOffset,encoding,dir);if("number"==typeof val)return val&=255,"function"==typeof Uint8Array.prototype.indexOf?dir?Uint8Array.prototype.indexOf.call(buffer,val,byteOffset):Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset):arrayIndexOf(buffer,[val],byteOffset,encoding,dir);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var i,indexSize=1,arrLength=arr.length,valLength=val.length;if(void 0!==encoding&&("ucs2"===(encoding=String(encoding).toLowerCase())||"ucs-2"===encoding||"utf16le"===encoding||"utf-16le"===encoding)){if(arr.length<2||val.length<2)return-1;indexSize=2,arrLength/=2,valLength/=2,byteOffset/=2}function read(buf,i){return 1===indexSize?buf[i]:buf.readUInt16BE(i*indexSize)}if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++)if(read(arr,i)===read(val,-1===foundIndex?0:i-foundIndex)){if(-1===foundIndex&&(foundIndex=i),i-foundIndex+1===valLength)return foundIndex*indexSize}else-1!==foundIndex&&(i-=i-foundIndex),foundIndex=-1}else for(byteOffset+valLength>arrLength&&(byteOffset=arrLength-valLength),i=byteOffset;i>=0;i--){for(var found=!0,j=0;j<valLength;j++)if(read(arr,i+j)!==read(val,j)){found=!1;break}if(found)return i}return-1}function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;length?(length=Number(length))>remaining&&(length=remaining):length=remaining;var strLen=string.length;length>strLen/2&&(length=strLen/2);for(var i=0;i<length;++i){var parsed=parseInt(string.substr(2*i,2),16);if(numberIsNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(function(str){for(var byteArray=[],i=0;i<str.length;++i)byteArray.push(255&str.charCodeAt(i));return byteArray}(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(function(str,units){for(var c,hi,lo,byteArray=[],i=0;i<str.length&&!((units-=2)<0);++i)c=str.charCodeAt(i),hi=c>>8,lo=c%256,byteArray.push(lo),byteArray.push(hi);return byteArray}(string,buf.length-offset),buf,offset,length)}function base64Slice(buf,start,end){return 0===start&&end===buf.length?base64.fromByteArray(buf):base64.fromByteArray(buf.slice(start,end))}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);for(var res=[],i=start;i<end;){var secondByte,thirdByte,fourthByte,tempCodePoint,firstByte=buf[i],codePoint=null,bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end)switch(bytesPerSequence){case 1:firstByte<128&&(codePoint=firstByte);break;case 2:128==(192&(secondByte=buf[i+1]))&&(tempCodePoint=(31&firstByte)<<6|63&secondByte)>127&&(codePoint=tempCodePoint);break;case 3:secondByte=buf[i+1],thirdByte=buf[i+2],128==(192&secondByte)&&128==(192&thirdByte)&&(tempCodePoint=(15&firstByte)<<12|(63&secondByte)<<6|63&thirdByte)>2047&&(tempCodePoint<55296||tempCodePoint>57343)&&(codePoint=tempCodePoint);break;case 4:secondByte=buf[i+1],thirdByte=buf[i+2],fourthByte=buf[i+3],128==(192&secondByte)&&128==(192&thirdByte)&&128==(192&fourthByte)&&(tempCodePoint=(15&firstByte)<<18|(63&secondByte)<<12|(63&thirdByte)<<6|63&fourthByte)>65535&&tempCodePoint<1114112&&(codePoint=tempCodePoint)}null===codePoint?(codePoint=65533,bytesPerSequence=1):codePoint>65535&&(codePoint-=65536,res.push(codePoint>>>10&1023|55296),codePoint=56320|1023&codePoint),res.push(codePoint),i+=bytesPerSequence}return function(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,codePoints);var res="",i=0;for(;i<len;)res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH));return res}(res)}exports.kMaxLength=K_MAX_LENGTH,Buffer.TYPED_ARRAY_SUPPORT=function(){try{var arr=new Uint8Array(1);return arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===arr.foo()}catch(e){return!1}}(),Buffer.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(Buffer.prototype,"parent",{get:function(){if(this instanceof Buffer)return this.buffer}}),Object.defineProperty(Buffer.prototype,"offset",{get:function(){if(this instanceof Buffer)return this.byteOffset}}),"undefined"!=typeof Symbol&&Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),Buffer.poolSize=8192,Buffer.from=function(value,encodingOrOffset,length){return from(value,encodingOrOffset,length)},Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,Buffer.alloc=function(size,fill,encoding){return function(size,fill,encoding){return assertSize(size),size<=0?createBuffer(size):void 0!==fill?"string"==typeof encoding?createBuffer(size).fill(fill,encoding):createBuffer(size).fill(fill):createBuffer(size)}(size,fill,encoding)},Buffer.allocUnsafe=function(size){return allocUnsafe(size)},Buffer.allocUnsafeSlow=function(size){return allocUnsafe(size)},Buffer.isBuffer=function(b){return null!=b&&!0===b._isBuffer},Buffer.compare=function(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError("Arguments must be Buffers");if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);i<len;++i)if(a[i]!==b[i]){x=a[i],y=b[i];break}return x<y?-1:y<x?1:0},Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(list,length){if(!Array.isArray(list))throw new TypeError('"list" argument must be an Array of Buffers');if(0===list.length)return Buffer.alloc(0);var i;if(void 0===length)for(length=0,i=0;i<list.length;++i)length+=list[i].length;var buffer=Buffer.allocUnsafe(length),pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(ArrayBuffer.isView(buf)&&(buf=Buffer.from(buf)),!Buffer.isBuffer(buf))throw new TypeError('"list" argument must be an Array of Buffers');buf.copy(buffer,pos),pos+=buf.length}return buffer},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var len=this.length;if(len%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var i=0;i<len;i+=2)swap(this,i,i+1);return this},Buffer.prototype.swap32=function(){var len=this.length;if(len%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var i=0;i<len;i+=4)swap(this,i,i+3),swap(this,i+1,i+2);return this},Buffer.prototype.swap64=function(){var len=this.length;if(len%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var i=0;i<len;i+=8)swap(this,i,i+7),swap(this,i+1,i+6),swap(this,i+2,i+5),swap(this,i+3,i+4);return this},Buffer.prototype.toString=function(){var length=this.length;return 0===length?"":0===arguments.length?utf8Slice(this,0,length):function(encoding,start,end){var loweredCase=!1;if((void 0===start||start<0)&&(start=0),start>this.length)return"";if((void 0===end||end>this.length)&&(end=this.length),end<=0)return"";if((end>>>=0)<=(start>>>=0))return"";for(encoding||(encoding="utf8");;)switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}}.apply(this,arguments)},Buffer.prototype.toLocaleString=Buffer.prototype.toString,Buffer.prototype.equals=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b||0===Buffer.compare(this,b)},Buffer.prototype.inspect=function(){var str="",max=exports.INSPECT_MAX_BYTES;return this.length>0&&(str=this.toString("hex",0,max).match(/.{2}/g).join(" "),this.length>max&&(str+=" ... ")),"<Buffer "+str+">"},Buffer.prototype.compare=function(target,start,end,thisStart,thisEnd){if(!Buffer.isBuffer(target))throw new TypeError("Argument must be a Buffer");if(void 0===start&&(start=0),void 0===end&&(end=target?target.length:0),void 0===thisStart&&(thisStart=0),void 0===thisEnd&&(thisEnd=this.length),start<0||end>target.length||thisStart<0||thisEnd>this.length)throw new RangeError("out of range index");if(thisStart>=thisEnd&&start>=end)return 0;if(thisStart>=thisEnd)return-1;if(start>=end)return 1;if(start>>>=0,end>>>=0,thisStart>>>=0,thisEnd>>>=0,this===target)return 0;for(var x=thisEnd-thisStart,y=end-start,len=Math.min(x,y),thisCopy=this.slice(thisStart,thisEnd),targetCopy=target.slice(start,end),i=0;i<len;++i)if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i],y=targetCopy[i];break}return x<y?-1:y<x?1:0},Buffer.prototype.includes=function(val,byteOffset,encoding){return-1!==this.indexOf(val,byteOffset,encoding)},Buffer.prototype.indexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!0)},Buffer.prototype.lastIndexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!1)},Buffer.prototype.write=function(string,offset,length,encoding){if(void 0===offset)encoding="utf8",length=this.length,offset=0;else if(void 0===length&&"string"==typeof offset)encoding=offset,length=this.length,offset=0;else{if(!isFinite(offset))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");offset>>>=0,isFinite(length)?(length>>>=0,void 0===encoding&&(encoding="utf8")):(encoding=length,length=void 0)}var remaining=this.length-offset;if((void 0===length||length>remaining)&&(length=remaining),string.length>0&&(length<0||offset<0)||offset>this.length)throw new RangeError("Attempt to write outside buffer bounds");encoding||(encoding="utf8");for(var loweredCase=!1;;)switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase(),loweredCase=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(127&buf[i]);return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(buf[i]);return ret}function hexSlice(buf,start,end){var len=buf.length;(!start||start<0)&&(start=0),(!end||end<0||end>len)&&(end=len);for(var out="",i=start;i<end;++i)out+=toHex(buf[i]);return out}function utf16leSlice(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}function checkOffset(offset,ext,length){if(offset%1!=0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,0,offset,4),ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,0,offset,8),ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}Buffer.prototype.slice=function(start,end){var len=this.length;start=~~start,end=void 0===end?len:~~end,start<0?(start+=len)<0&&(start=0):start>len&&(start=len),end<0?(end+=len)<0&&(end=0):end>len&&(end=len),end<start&&(end=start);var newBuf=this.subarray(start,end);return newBuf.__proto__=Buffer.prototype,newBuf},Buffer.prototype.readUIntLE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val},Buffer.prototype.readUIntBE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset+--byteLength],mul=1;byteLength>0&&(mul*=256);)val+=this[offset+--byteLength]*mul;return val},Buffer.prototype.readUInt8=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUInt16LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUInt16BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUInt32LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUInt32BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readIntLE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val>=(mul*=128)&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readIntBE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var i=byteLength,mul=1,val=this[offset+--i];i>0&&(mul*=256);)val+=this[offset+--i]*mul;return val>=(mul*=128)&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readInt8=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),128&this[offset]?-1*(255-this[offset]+1):this[offset]},Buffer.prototype.readInt16LE=function(offset,noAssert){offset>>>=0,noAssert||checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt16BE=function(offset,noAssert){offset>>>=0,noAssert||checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt32LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readFloatLE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!0,52,8)},Buffer.prototype.readDoubleBE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!1,52,8)},Buffer.prototype.writeUIntLE=function(value,offset,byteLength,noAssert){(value=+value,offset>>>=0,byteLength>>>=0,noAssert)||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var mul=1,i=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUIntBE=function(value,offset,byteLength,noAssert){(value=+value,offset>>>=0,byteLength>>>=0,noAssert)||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var i=byteLength-1,mul=1;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUInt8=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,255,0),this[offset]=255&value,offset+1},Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=255&value,offset+4},Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4},Buffer.prototype.writeIntLE=function(value,offset,byteLength,noAssert){if(value=+value,offset>>>=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0,mul=1,sub=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i-1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeIntBE=function(value,offset,byteLength,noAssert){if(value=+value,offset>>>=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1,mul=1,sub=0;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i+1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeInt8=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,127,-128),value<0&&(value=255+value+1),this[offset]=255&value,offset+1},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),this[offset]=255&value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24,offset+4},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),value<0&&(value=4294967295+value+1),this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4},Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function(target,targetStart,start,end){if(!Buffer.isBuffer(target))throw new TypeError("argument should be a Buffer");if(start||(start=0),end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),targetStart||(targetStart=0),end>0&&end<start&&(end=start),end===start)return 0;if(0===target.length||0===this.length)return 0;if(targetStart<0)throw new RangeError("targetStart out of bounds");if(start<0||start>=this.length)throw new RangeError("Index out of range");if(end<0)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length),target.length-targetStart<end-start&&(end=target.length-targetStart+start);var len=end-start;if(this===target&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(targetStart,start,end);else if(this===target&&start<targetStart&&targetStart<end)for(var i=len-1;i>=0;--i)target[i+targetStart]=this[i+start];else Uint8Array.prototype.set.call(target,this.subarray(start,end),targetStart);return len},Buffer.prototype.fill=function(val,start,end,encoding){if("string"==typeof val){if("string"==typeof start?(encoding=start,start=0,end=this.length):"string"==typeof end&&(encoding=end,end=this.length),void 0!==encoding&&"string"!=typeof encoding)throw new TypeError("encoding must be a string");if("string"==typeof encoding&&!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding);if(1===val.length){var code=val.charCodeAt(0);("utf8"===encoding&&code<128||"latin1"===encoding)&&(val=code)}}else"number"==typeof val&&(val&=255);if(start<0||this.length<start||this.length<end)throw new RangeError("Out of range index");if(end<=start)return this;var i;if(start>>>=0,end=void 0===end?this.length:end>>>0,val||(val=0),"number"==typeof val)for(i=start;i<end;++i)this[i]=val;else{var bytes=Buffer.isBuffer(val)?val:new Buffer(val,encoding),len=bytes.length;if(0===len)throw new TypeError('The value "'+val+'" is invalid for argument "value"');for(i=0;i<end-start;++i)this[i+start]=bytes[i%len]}return this};var INVALID_BASE64_RE=/[^+/0-9A-Za-z-_]/g;function toHex(n){return n<16?"0"+n.toString(16):n.toString(16)}function utf8ToBytes(string,units){var codePoint;units=units||1/0;for(var length=string.length,leadSurrogate=null,bytes=[],i=0;i<length;++i){if((codePoint=string.charCodeAt(i))>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){(units-=3)>-1&&bytes.push(239,191,189);continue}if(i+1===length){(units-=3)>-1&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){(units-=3)>-1&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=65536+(leadSurrogate-55296<<10|codePoint-56320)}else leadSurrogate&&(units-=3)>-1&&bytes.push(239,191,189);if(leadSurrogate=null,codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(codePoint<1114112))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function base64ToBytes(str){return base64.toByteArray(function(str){if((str=(str=str.split("=")[0]).trim().replace(INVALID_BASE64_RE,"")).length<2)return"";for(;str.length%4!=0;)str+="=";return str}(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length&&!(i+offset>=dst.length||i>=src.length);++i)dst[i+offset]=src[i];return i}function isArrayBuffer(obj){return obj instanceof ArrayBuffer||null!=obj&&null!=obj.constructor&&"ArrayBuffer"===obj.constructor.name&&"number"==typeof obj.byteLength}function numberIsNaN(obj){return obj!=obj}}).call(this,require("buffer").Buffer)},{"base64-js":10,buffer:26,ieee754:91}],27:[function(require,module,exports){var stream=require("readable-stream"),inherits=require("inherits"),SIGNAL_FLUSH=require("buffer-from")([0]),Bulk=function(opts,worker,flush){if(!(this instanceof Bulk))return new Bulk(opts,worker,flush);"function"==typeof opts&&(flush=worker,worker=opts,opts={}),stream.Writable.call(this,opts),this._worker=worker,this._flush=flush,this.destroyed=!1};inherits(Bulk,stream.Writable),Bulk.obj=function(opts,worker,flush){return"function"==typeof opts?Bulk.obj(null,opts,worker):(opts||(opts={}),opts.objectMode=!0,new Bulk(opts,worker,flush))},Bulk.prototype.end=function(data,enc,cb){return this._flush?"function"==typeof data?this.end(null,null,data):"function"==typeof enc?this.end(data,null,enc):(data&&this.write(data),this._writableState.ending||this.write(SIGNAL_FLUSH),stream.Writable.prototype.end.call(this,cb)):stream.Writable.prototype.end.apply(this,arguments)},Bulk.prototype.destroy=function(err){this.destroyed||(this.destroyed=!0,err&&this.emit("error"),this.emit("close"))},Bulk.prototype._write=function(data,enc,cb){data===SIGNAL_FLUSH?this._flush(cb):this._worker([data],cb)},Bulk.prototype._writev=function(batch,cb){var len=batch.length;if(batch[batch.length-1].chunk===SIGNAL_FLUSH&&(cb=this._flusher(cb),!--len))return cb();for(var arr=new Array(len),i=0;i<len;i++)arr[i]=batch[i].chunk;this._worker(arr,cb)},Bulk.prototype._flusher=function(cb){var self=this;return function(err){if(err)return cb(err);self._flush(cb)}},module.exports=Bulk},{"buffer-from":25,inherits:92,"readable-stream":147}],28:[function(require,module,exports){(function(Buffer){module.exports=codecs;var fromBuffer=Buffer.from&&Buffer.from!==Uint8Array.from?Buffer.from:Buffer;function codecs(fmt){if("object"==typeof fmt&&fmt&&fmt.encode&&fmt.decode)return fmt;switch(fmt){case"ndjson":return codecs.ndjson;case"json":return codecs.json;case"ascii":return codecs.ascii;case"utf-8":case"utf8":return codecs.utf8;case"hex":return codecs.hex;case"base64":return codecs.base64;case"ucs-2":case"ucs2":return codecs.ucs2;case"utf16-le":case"utf16le":return codecs.utf16le}return codecs.binary}function createJSON(newline){return{encode:newline?function(val){return new Buffer(JSON.stringify(val)+"\n")}:function(val){return new Buffer(JSON.stringify(val))},decode:function(buf){return JSON.parse(buf.toString())}}}function createString(type){return{encode:function(val){return"string"!=typeof val&&(val=val.toString()),fromBuffer(val,type)},decode:function(buf){return buf.toString(type)}}}codecs.ascii=createString("ascii"),codecs.utf8=createString("utf-8"),codecs.hex=createString("hex"),codecs.base64=createString("base64"),codecs.ucs2=createString("ucs2"),codecs.utf16le=createString("utf16le"),codecs.ndjson=createJSON(!0),codecs.json=createJSON(!1),codecs.binary={encode:function(obj){return"string"==typeof obj?fromBuffer(obj,"utf-8"):obj},decode:function(buf){return buf}}}).call(this,require("buffer").Buffer)},{buffer:26}],29:[function(require,module,exports){module.exports=function(a,b){return a<b?-1:a>b?1:0}},{}],30:[function(require,module,exports){(function(Buffer){function objectToString(o){return Object.prototype.toString.call(o)}exports.isArray=function(arg){return Array.isArray?Array.isArray(arg):"[object Array]"===objectToString(arg)},exports.isBoolean=function(arg){return"boolean"==typeof arg},exports.isNull=function(arg){return null===arg},exports.isNullOrUndefined=function(arg){return null==arg},exports.isNumber=function(arg){return"number"==typeof arg},exports.isString=function(arg){return"string"==typeof arg},exports.isSymbol=function(arg){return"symbol"==typeof arg},exports.isUndefined=function(arg){return void 0===arg},exports.isRegExp=function(re){return"[object RegExp]"===objectToString(re)},exports.isObject=function(arg){return"object"==typeof arg&&null!==arg},exports.isDate=function(d){return"[object Date]"===objectToString(d)},exports.isError=function(e){return"[object Error]"===objectToString(e)||e instanceof Error},exports.isFunction=function(arg){return"function"==typeof arg},exports.isPrimitive=function(arg){return null===arg||"boolean"==typeof arg||"number"==typeof arg||"string"==typeof arg||"symbol"==typeof arg||void 0===arg},exports.isBuffer=Buffer.isBuffer}).call(this,{isBuffer:require("../../is-buffer/index.js")})},{"../../is-buffer/index.js":94}],31:[function(require,module,exports){module.exports=function(v){var c=32;return(v&=-v)&&c--,65535&v&&(c-=16),16711935&v&&(c-=8),252645135&v&&(c-=4),858993459&v&&(c-=2),1431655765&v&&(c-=1),c}},{}],32:[function(require,module,exports){!function(app){"use strict";var c=0,discreteValues=Math.pow(36,4),pad=function(num,size){var s="000000000"+num;return s.substr(s.length-size)},randomBlock=function(){return pad((Math.random()*discreteValues<<0).toString(36),4)},safeCounter=function(){return c=c<discreteValues?c:0,++c-1},api=function(){var timestamp=(new Date).getTime().toString(36),fingerprint=api.fingerprint(),random=randomBlock()+randomBlock();return"c"+timestamp+pad(safeCounter().toString(36),4)+fingerprint+random};api.slug=function(){var counter,date=(new Date).getTime().toString(36),print=api.fingerprint().slice(0,1)+api.fingerprint().slice(-1),random=randomBlock().slice(-2);return counter=safeCounter().toString(36).slice(-4),date.slice(-2)+counter+print+random},api.globalCount=function(){var cache=function(){var i,count=0;for(i in window)count++;return count}();return api.globalCount=function(){return cache},cache},api.fingerprint=function(){return pad((navigator.mimeTypes.length+navigator.userAgent.length).toString(36)+api.globalCount().toString(36),4)},app.register?app.register("cuid",api):void 0!==module?module.exports=api:app.cuid=api}(this.applitude||this)},{}],33:[function(require,module,exports){"use strict";var Buffer=require("safe-buffer").Buffer;function encode(buf){if("string"==typeof buf)return encode(decode(buf));if(!Buffer.isBuffer(buf))throw new Error("Not a buffer");if(32!==buf.length)throw new Error("Invalid buffer");return buf.toString("hex")}function decode(str){if(Buffer.isBuffer(str))return decode(encode(str));if("string"!=typeof str)throw new Error("Not a string");var match=/([a-f0-9]{64,65})/i.exec(str);if(!match||64!==match[1].length)throw new Error("Invalid key");return Buffer.from(match[1],"hex")}exports.encode=exports.toStr=encode,exports.decode=exports.toBuf=decode},{"safe-buffer":149}],34:[function(require,module,exports){(function(process){function load(){var r;try{r=exports.storage.debug}catch(e){}return!r&&void 0!==process&&"env"in process&&(r=process.env.DEBUG),r}(exports=module.exports=require("./debug")).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},exports.formatArgs=function(args){var useColors=this.useColors;if(args[0]=(useColors?"%c":"")+this.namespace+(useColors?" %c":" ")+args[0]+(useColors?"%c ":" ")+"+"+exports.humanize(this.diff),!useColors)return;var c="color: "+this.color;args.splice(1,0,c,"color: inherit");var index=0,lastC=0;args[0].replace(/%[a-zA-Z%]/g,function(match){"%%"!==match&&"%c"===match&&(lastC=++index)}),args.splice(lastC,0,c)},exports.save=function(namespaces){try{null==namespaces?exports.storage.removeItem("debug"):exports.storage.debug=namespaces}catch(e){}},exports.load=load,exports.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},exports.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),exports.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],exports.formatters.j=function(v){try{return JSON.stringify(v)}catch(err){return"[UnexpectedJSONParseError]: "+err.message}},exports.enable(load())}).call(this,require("_process"))},{"./debug":35,_process:118}],35:[function(require,module,exports){var prevTime;function createDebug(namespace){function debug(){if(debug.enabled){var self=debug,curr=+new Date,ms=curr-(prevTime||curr);self.diff=ms,self.prev=prevTime,self.curr=curr,prevTime=curr;for(var args=new Array(arguments.length),i=0;i<args.length;i++)args[i]=arguments[i];args[0]=exports.coerce(args[0]),"string"!=typeof args[0]&&args.unshift("%O");var index=0;args[0]=args[0].replace(/%([a-zA-Z%])/g,function(match,format){if("%%"===match)return match;index++;var formatter=exports.formatters[format];if("function"==typeof formatter){var val=args[index];match=formatter.call(self,val),args.splice(index,1),index--}return match}),exports.formatArgs.call(self,args),(debug.log||exports.log||console.log.bind(console)).apply(self,args)}}return debug.namespace=namespace,debug.enabled=exports.enabled(namespace),debug.useColors=exports.useColors(),debug.color=function(namespace){var i,hash=0;for(i in namespace)hash=(hash<<5)-hash+namespace.charCodeAt(i),hash|=0;return exports.colors[Math.abs(hash)%exports.colors.length]}(namespace),"function"==typeof exports.init&&exports.init(debug),debug}(exports=module.exports=createDebug.debug=createDebug.default=createDebug).coerce=function(val){return val instanceof Error?val.stack||val.message:val},exports.disable=function(){exports.enable("")},exports.enable=function(namespaces){exports.save(namespaces),exports.names=[],exports.skips=[];for(var split=("string"==typeof namespaces?namespaces:"").split(/[\s,]+/),len=split.length,i=0;i<len;i++)split[i]&&("-"===(namespaces=split[i].replace(/\*/g,".*?"))[0]?exports.skips.push(new RegExp("^"+namespaces.substr(1)+"$")):exports.names.push(new RegExp("^"+namespaces+"$")))},exports.enabled=function(name){var i,len;for(i=0,len=exports.skips.length;i<len;i++)if(exports.skips[i].test(name))return!1;for(i=0,len=exports.names.length;i<len;i++)if(exports.names[i].test(name))return!0;return!1},exports.humanize=require("ms"),exports.names=[],exports.skips=[],exports.formatters={}},{ms:107}],36:[function(require,module,exports){(function(Buffer){var EventEmitter=require("events"),DiscoverySwarmStream=require("./"),ProxyStream=require("./proxystream");module.exports=class extends EventEmitter{constructor(options){super();var connection=options.connection;if(!connection)throw new TypeError("Must specify `connection` in options");this.connecting=0,this.queued=0,this.connected=0,this._handleOpen=this._handleOpen.bind(this),this._handleEnd=this._handleEnd.bind(this),options.stream&&(this._replicate=options.stream),this._channels=new Set,this.reconnect(connection)}reconnect(connection){this._protocol&&(this._protocol.removeListener("close",this._handleEnd),this._protocol.end()),this._protocol=new DiscoverySwarmStream(connection),this._protocol.on("swarm:open",this._handleOpen),this._protocol.connect(),this._protocol.once("close",this._handleEnd);for(let key of this._channels)this.join(key)}_handleEnd(){this._protocol=null,this.emit("disconnected")}_handleOpen(streamid,channel){var stream=new ProxyStream(this._protocol,streamid),info={type:"proxy",initiator:!1,id:null,host:streamid.toString("hex"),port:-1,channel:channel},replicationStream=this._replicate(info),self=this;self.emit("handshaking",stream,info),replicationStream.once("handshake",function(remoteId){if(remoteId){var remoteIdHex=remoteId.toString("hex");info.id=remoteIdHex}self.emit("connection",stream,info)}),replicationStream.pipe(stream).pipe(replicationStream)}join(key,options,cb){"string"==typeof key&&(key=Buffer.from(key,"hex")),cb||"function"!=typeof options||(cb=options),this._protocol.join(key),this._channels.add(key.toString("hex")),cb&&cb()}leave(key,cb){"string"==typeof key&&(key=Buffer.from(key,"hex")),this._protocol.leave(key),this._channels.delete(key.toString("hex")),cb&&cb()}listen(){}close(cb){this._protocol.end(cb)}_replicate(info){throw new Error("Missing `stream` in options")}}}).call(this,require("buffer").Buffer)},{"./":37,"./proxystream":39,buffer:26,events:21}],37:[function(require,module,exports){var Duplex=require("readable-stream").Duplex,lps=require("length-prefixed-stream"),messages=require("./messages");module.exports=class extends Duplex{constructor(stream){super(),this.setMaxListeners(256),stream.pipe(lps.decode()).pipe(this).pipe(lps.encode()).pipe(stream)}sendEvent(type,id,data){this.push(messages.SwarmEvent.encode({type:messages.EventType[type],id:id,data:data}))}connect(){this.sendEvent("CONNECT")}join(discoveryKey){this.sendEvent("JOIN",discoveryKey)}leave(discoveryKey){this.sendEvent("LEAVE",discoveryKey)}openStream(streamId,channel){this.sendEvent("OPEN",streamId,channel)}closeStream(streamId){this.sendEvent("CLOSE",streamId)}streamData(streamId,data){this.sendEvent("DATA",streamId,data)}_write(chunk,encoding,callback){try{var decoded=messages.SwarmEvent.decode(chunk);switch(decoded.type){case messages.EventType.CONNECT:this.emit("swarm:connect");break;case messages.EventType.JOIN:this.emit("swarm:join",decoded.id);break;case messages.EventType.LEAVE:this.emit("swarm:leave",decoded.id);break;case messages.EventType.OPEN:this.emit("swarm:open",decoded.id,decoded.data);break;case messages.EventType.CLOSE:this.emit("swarm:close",decoded.id);break;case messages.EventType.DATA:this.emit("swarm:data",decoded.id,decoded.data)}callback()}catch(e){callback(e)}}_read(){}}},{"./messages":38,"length-prefixed-stream":100,"readable-stream":147}],38:[function(require,module,exports){(function(Buffer){var encodings=require("protocol-buffers-encodings"),varint=encodings.varint,skip=encodings.skip;exports.EventType={CONNECT:1,JOIN:2,LEAVE:3,OPEN:4,CLOSE:5,DATA:6};var SwarmEvent=exports.SwarmEvent={buffer:!0,encodingLength:null,encode:null,decode:null};function defined(val){return null!==val&&void 0!==val&&("number"!=typeof val||!isNaN(val))}!function(){var enc=[encodings.enum,encodings.bytes];function encodingLength(obj){var length=0;if(!defined(obj.type))throw new Error("type is required");var len=enc[0].encodingLength(obj.type);if(length+=1+len,defined(obj.id)){var len=enc[1].encodingLength(obj.id);length+=1+len}if(defined(obj.data)){var len=enc[1].encodingLength(obj.data);length+=1+len}return length}SwarmEvent.encodingLength=encodingLength,SwarmEvent.encode=function encode(obj,buf,offset){offset||(offset=0);buf||(buf=Buffer.allocUnsafe(encodingLength(obj)));var oldOffset=offset;if(!defined(obj.type))throw new Error("type is required");buf[offset++]=8;enc[0].encode(obj.type,buf,offset);offset+=enc[0].encode.bytes;defined(obj.id)&&(buf[offset++]=18,enc[1].encode(obj.id,buf,offset),offset+=enc[1].encode.bytes);defined(obj.data)&&(buf[offset++]=26,enc[1].encode(obj.data,buf,offset),offset+=enc[1].encode.bytes);encode.bytes=offset-oldOffset;return buf},SwarmEvent.decode=function decode(buf,offset,end){offset||(offset=0);end||(end=buf.length);if(!(end<=buf.length&&offset<=buf.length))throw new Error("Decoded message is not valid");var oldOffset=offset;var obj={type:1,id:null,data:null};var found0=!1;for(;;){if(end<=offset){if(!found0)throw new Error("Decoded message is not valid");return decode.bytes=offset-oldOffset,obj}var prefix=varint.decode(buf,offset);offset+=varint.decode.bytes;var tag=prefix>>3;switch(tag){case 1:obj.type=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes,found0=!0;break;case 2:obj.id=enc[1].decode(buf,offset),offset+=enc[1].decode.bytes;break;case 3:obj.data=enc[1].decode(buf,offset),offset+=enc[1].decode.bytes;break;default:offset=skip(7&prefix,buf,offset)}}}}()}).call(this,require("buffer").Buffer)},{buffer:26,"protocol-buffers-encodings":119}],39:[function(require,module,exports){var Duplex=require("readable-stream").Duplex;module.exports=class extends Duplex{constructor(protocol,id){super(),this._id=id,this._protocol=protocol,this._isClosed=!1,this._handle_data=this._handleData.bind(this),this._handle_close=this._handleClose.bind(this),this._protocol.on("swarm:data",this._handle_data),this._protocol.on("swarm:close",this._handle_close)}_handleData(streamid,data){this._isId(streamid)&&this.push(data)}_handleClose(streamid){this._isId(streamid)&&(this.end(),this.emit("close"),this._cleanup())}_cleanup(){this._isClosed=!0,this._protocol.removeListener("swarm:data",this._handle_data),this._protocol.removeListener("swarm:close",this._handle_close)}_isId(streamid){return streamid.toString("hex")===this._id.toString("hex")}_read(){}_write(chunk,encoding,callback){this._protocol.streamData(this._id,chunk),callback()}_final(callback){this._isClosed||(this._protocol.closeStream(this._id),this._cleanup()),callback()}}},{"readable-stream":147}],40:[function(require,module,exports){const signalhubws=require("signalhubws"),webrtcSwarm=require("@geut/discovery-swarm-webrtc"),DSS=require("discovery-swarm-stream/client"),websocket=require("websocket-stream"),randomBytes=require("randombytes"),EventEmitter=require("events"),DEFAULT_SIGNALHUB=["wss://signalhubws.mauve.moe"],DEFAULT_DISCOVERY="wss://discoveryswarm.mauve.moe",LOCALHOST_DISCOVERY="ws://localhost:3472",APP_NAME="discovery-swarm-web",DEFAULT_MAX_CONNECTIONS=1/0,JOIN_DELAY=2e3,SYNC_NET_DELAY=5e3,IS_SECURE=self.location.href.startsWith("https");class DiscoverySwarmWeb extends EventEmitter{constructor(opts={}){super();const signalhubURL=opts.signalhub||DEFAULT_SIGNALHUB,discoveryURL=opts.discovery||DEFAULT_DISCOVERY,id=opts.id||randomBytes(32),stream=opts.stream;this.id=id,this.stream=stream,this.maxConnections=opts.maxConnections||DEFAULT_MAX_CONNECTIONS;const hub="object"==typeof signalhubURL&&!Array.isArray(signalhubURL)?signalhubURL:signalhubws(APP_NAME,signalhubURL.map(setSecure));this.channels=new Map,this.hub=hub,this.webrtc=webrtcSwarm({id:id,stream:stream,hub:hub}),this.dss=new DiscoverySwarmStreamWebsocket({id:id,stream:stream,discovery:setSecure(discoveryURL)}),this.webrtc.on("connection",(conn,info)=>this._handleConnection(conn,info)),this.dss.on("connection",(conn,info)=>this._handleConnection(conn,info))}_handleConnection(connection,info){const channelNameString=info.channel.toString("hex"),currentCount=this.channels.get(channelNameString);if(currentCount>=this.maxConnections)connection.end();else{this.channels.set(channelNameString,currentCount+1);let hasClosed=!1;const handleClose=()=>{if(hasClosed)return;if(hasClosed=!0,!this.channels.has(channelNameString))return;const count=this.channels.get(channelNameString);this.channels.set(channelNameString,count-1),count||(this.leave(channelNameString),this.join(channelNameString))};connection.once("close",handleClose),connection.once("error",handleClose),this.emit("connection",connection,info)}}join(channelName,opts={}){const channelNameString=channelName.toString("hex");if(this.channels.has(channelNameString))return;this.channels.set(channelNameString,0),this.webrtc.join(channelName,opts);const joinDSS=()=>{this.channels.has(channelNameString)&&(this.removeListener("connection",handleJoined),this.dss.join(channelName,opts))},handleJoined=(connection,info)=>{info.channel.toString("hex")===channelNameString&&(this.removeListener("connection",handleJoined),clearTimeout(connectTimer),connectTimer=setTimeout(joinDSS,SYNC_NET_DELAY))};let connectTimer=setTimeout(joinDSS,JOIN_DELAY);this.on("connection",handleJoined)}leave(channelName,opts={}){const channelNameString=channelName.toString("hex");this.channels.has(channelNameString)&&(this.channels.delete(channelNameString),this.webrtc.leave(channelName,opts),this.dss.leave(channelName,opts))}listen(){setTimeout(()=>{this.emit("listening")},0)}address(){return{port:-1}}close(cb){this.dss.close(()=>{this.webrtc.close(cb)})}destroy(cb){this.close(cb)}}class DiscoverySwarmStreamWebsocket extends DSS{constructor(opts){const discovery=opts.discovery,stream=opts.stream,id=opts.id;let connection=null;try{connection=websocket(LOCALHOST_DISCOVERY)}catch(e){console.error("Error creating socket to local discovery server",e),connection=websocket(discovery)}super({id:id,connection:connection,stream:stream}),this.connection=connection,this._handleDisconnected=(()=>{this._reconnect()}),this.discoveryURL=discovery,this.connection.once("error",this._handleDisconnected),this.on("disconnected",this._handleDisconnected)}_reconnect(){this.connection=websocket(this.discoveryURL),this.reconnect(this.connection)}close(cb){this.removeListener("disconnected",this._handleDisconnected),this.connection=null,super.close(cb)}}function setSecure(url){return IS_SECURE?url.startsWith("http:")?"https:"+url.slice(6):url.startsWith("ws:")?"wss:"+url.slice(3):url:url.startsWith("https:")?"http:"+url.slice(7):url.startsWith("wss:")?"ws:"+url.slice(4):url}module.exports=(opts=>new DiscoverySwarmWeb(opts)),module.exports.DiscoverySwarmWeb=DiscoverySwarmWeb,module.exports.DiscoverySwarmStreamWebsocket=DiscoverySwarmStreamWebsocket},{"@geut/discovery-swarm-webrtc":1,"discovery-swarm-stream/client":36,events:21,randombytes:138,signalhubws:150,"websocket-stream":182}],41:[function(require,module,exports){(function(process,Buffer){var stream=require("readable-stream"),eos=require("end-of-stream"),inherits=require("inherits"),shift=require("stream-shift"),SIGNAL_FLUSH=Buffer.from&&Buffer.from!==Uint8Array.from?Buffer.from([0]):new Buffer([0]),onuncork=function(self,fn){self._corked?self.once("uncork",fn):fn()},destroyer=function(self,end){return function(err){err?function(self,err){self._autoDestroy&&self.destroy(err)}(self,"premature close"===err.message?null:err):end&&!self._ended&&self.end()}},Duplexify=function(writable,readable,opts){if(!(this instanceof Duplexify))return new Duplexify(writable,readable,opts);stream.Duplex.call(this,opts),this._writable=null,this._readable=null,this._readable2=null,this._autoDestroy=!opts||!1!==opts.autoDestroy,this._forwardDestroy=!opts||!1!==opts.destroy,this._forwardEnd=!opts||!1!==opts.end,this._corked=1,this._ondrain=null,this._drained=!1,this._forwarding=!1,this._unwrite=null,this._unread=null,this._ended=!1,this.destroyed=!1,writable&&this.setWritable(writable),readable&&this.setReadable(readable)};inherits(Duplexify,stream.Duplex),Duplexify.obj=function(writable,readable,opts){return opts||(opts={}),opts.objectMode=!0,opts.highWaterMark=16,new Duplexify(writable,readable,opts)},Duplexify.prototype.cork=function(){1==++this._corked&&this.emit("cork")},Duplexify.prototype.uncork=function(){this._corked&&0==--this._corked&&this.emit("uncork")},Duplexify.prototype.setWritable=function(writable){if(this._unwrite&&this._unwrite(),this.destroyed)writable&&writable.destroy&&writable.destroy();else if(null!==writable&&!1!==writable){var self=this,unend=eos(writable,{writable:!0,readable:!1},destroyer(this,this._forwardEnd)),ondrain=function(){var ondrain=self._ondrain;self._ondrain=null,ondrain&&ondrain()};this._unwrite&&process.nextTick(ondrain),this._writable=writable,this._writable.on("drain",ondrain),this._unwrite=function(){self._writable.removeListener("drain",ondrain),unend()},this.uncork()}else this.end()},Duplexify.prototype.setReadable=function(readable){if(this._unread&&this._unread(),this.destroyed)readable&&readable.destroy&&readable.destroy();else{if(null===readable||!1===readable)return this.push(null),void this.resume();var rs,self=this,unend=eos(readable,{writable:!1,readable:!0},destroyer(this)),onreadable=function(){self._forward()},onend=function(){self.push(null)};this._drained=!0,this._readable=readable,this._readable2=readable._readableState?readable:(rs=readable,new stream.Readable({objectMode:!0,highWaterMark:16}).wrap(rs)),this._readable2.on("readable",onreadable),this._readable2.on("end",onend),this._unread=function(){self._readable2.removeListener("readable",onreadable),self._readable2.removeListener("end",onend),unend()},this._forward()}},Duplexify.prototype._read=function(){this._drained=!0,this._forward()},Duplexify.prototype._forward=function(){if(!this._forwarding&&this._readable2&&this._drained){var data;for(this._forwarding=!0;this._drained&&null!==(data=shift(this._readable2));)this.destroyed||(this._drained=this.push(data));this._forwarding=!1}},Duplexify.prototype.destroy=function(err){if(!this.destroyed){this.destroyed=!0;var self=this;process.nextTick(function(){self._destroy(err)})}},Duplexify.prototype._destroy=function(err){if(err){var ondrain=this._ondrain;this._ondrain=null,ondrain?ondrain(err):this.emit("error",err)}this._forwardDestroy&&(this._readable&&this._readable.destroy&&this._readable.destroy(),this._writable&&this._writable.destroy&&this._writable.destroy()),this.emit("close")},Duplexify.prototype._write=function(data,enc,cb){return this.destroyed?cb():this._corked?onuncork(this,this._write.bind(this,data,enc,cb)):data===SIGNAL_FLUSH?this._finish(cb):this._writable?void(!1===this._writable.write(data)?this._ondrain=cb:cb()):cb()},Duplexify.prototype._finish=function(cb){var self=this;this.emit("preend"),onuncork(this,function(){var ws,fn;ws=self._forwardEnd&&self._writable,fn=function(){!1===self._writableState.prefinished&&(self._writableState.prefinished=!0),self.emit("prefinish"),onuncork(self,cb)},ws?ws._writableState&&ws._writableState.finished?fn():ws._writableState?ws.end(fn):(ws.end(),fn()):fn()})},Duplexify.prototype.end=function(data,enc,cb){return"function"==typeof data?this.end(null,null,data):"function"==typeof enc?this.end(data,null,enc):(this._ended=!0,data&&this.write(data),this._writableState.ending||this.write(SIGNAL_FLUSH),stream.Writable.prototype.end.call(this,cb))},module.exports=Duplexify}).call(this,require("_process"),require("buffer").Buffer)},{_process:118,buffer:26,"end-of-stream":42,inherits:92,"readable-stream":147,"stream-shift":171}],42:[function(require,module,exports){var once=require("once"),noop=function(){},eos=function(stream,opts,callback){if("function"==typeof opts)return eos(stream,null,opts);opts||(opts={}),callback=once(callback||noop);var ws=stream._writableState,rs=stream._readableState,readable=opts.readable||!1!==opts.readable&&stream.readable,writable=opts.writable||!1!==opts.writable&&stream.writable,onlegacyfinish=function(){stream.writable||onfinish()},onfinish=function(){writable=!1,readable||callback.call(stream)},onend=function(){readable=!1,writable||callback.call(stream)},onexit=function(exitCode){callback.call(stream,exitCode?new Error("exited with error code: "+exitCode):null)},onerror=function(err){callback.call(stream,err)},onclose=function(){return(!readable||rs&&rs.ended)&&(!writable||ws&&ws.ended)?void 0:callback.call(stream,new Error("premature close"))},onrequest=function(){stream.req.on("finish",onfinish)};return!function(stream){return stream.setHeader&&"function"==typeof stream.abort}(stream)?writable&&!ws&&(stream.on("end",onlegacyfinish),stream.on("close",onlegacyfinish)):(stream.on("complete",onfinish),stream.on("abort",onclose),stream.req?onrequest():stream.on("request",onrequest)),function(stream){return stream.stdio&&Array.isArray(stream.stdio)&&3===stream.stdio.length}(stream)&&stream.on("exit",onexit),stream.on("end",onend),stream.on("finish",onfinish),!1!==opts.error&&stream.on("error",onerror),stream.on("close",onclose),function(){stream.removeListener("complete",onfinish),stream.removeListener("abort",onclose),stream.removeListener("request",onrequest),stream.req&&stream.req.removeListener("finish",onfinish),stream.removeListener("end",onlegacyfinish),stream.removeListener("close",onlegacyfinish),stream.removeListener("finish",onfinish),stream.removeListener("exit",onexit),stream.removeListener("end",onend),stream.removeListener("error",onerror),stream.removeListener("close",onclose)}};module.exports=eos},{once:114}],43:[function(require,module,exports){"use strict";const ctz=require("count-trailing-zeros");module.exports=(()=>new class{constructor(){this.length=32768,this.littleEndian=LITTLE_ENDIAN,this._path=new Uint16Array(5),this._offsets=new Uint16Array(this._path.buffer,this._path.byteOffset+2,4),this._parents=new Array(4).fill(null),this._page=new Page(0),this._allocs=1}last(){for(var page=this._page,b=0;;){for(var i=2;i>=0;i--){const c=ctz(page.oneOne[i][b]);if(32===c)return-1;b=31-c+(b<<5)}if(this._path[page.level]=b,!page.level)return defactor(this._path);page=page.children[b],b=0}}set(index,bit){const page=this._getPage(index,bit);if(!page)return!1;const i=this._path[0],r=31&i,b=i>>>5,prev=page.bits[b];page.bits[b]=bit?prev|2147483648>>>r:prev&~(2147483648>>>r);const upd=page.bits[b];return upd!==prev&&(this._updateAllOne(page,b,upd),this._updateOneOne(page,b,upd),!0)}get(index){const page=this._getPage(index,!1);if(!page)return!1;const i=this._path[0],r=31&i;return 0!=(page.bits[i>>>5]&2147483648>>>r)}iterator(){return new Iterator(this)}fill(val,start,end){return start||(start=0),!0===val?this._fillBit(!0,start,0===end?end:end||this.length):!1===val?this._fillBit(!1,start,0===end?end:end||this.length):void this._fillBuffer(val,start,0===end?end:end||start+8*val.length)}grow(){if(3===this._page.level)throw new Error("Cannot grow beyond "+this.length);const page=this._page;this._page=new Page(page.level+1),this._page.children[0]=page,3===this._page.level?this.length=Number.MAX_SAFE_INTEGER:this.length*=32768}_fillBuffer(buf,start,end){if(7&start||7&end)throw new Error("Offsets must be a multiple of 8");for(start/=8;end>this.length;)this.grow();end/=8;const offset=start;for(var page=this._getPage(8*start,!0);start<end;){const delta=end-start<4096?end-start:4096,s=start-offset;(start+=this._setPageBuffer(page,buf.subarray(s,s+delta),1023&start))!==end&&(page=this._nextPage(page,8*start))}}_fillBit(bit,start,end){for(var page=this._getPage(start,bit);start<end;){const delta=end-start<32768?end-start:32768;(start+=this._setPageBits(page,bit,32767&start,delta))!==end&&(page=this._nextPage(page,start))}}_nextPage(page,start){const i=++this._offsets[page.level];return 32768===i?this._getPage(start,!0):this._parents[page.level].children[i]||this._addPage(this._parents[page.level],i)}_setPageBuffer(page,buf,start){return new Uint8Array(page.bits.buffer,page.bits.byteOffset,4*page.bits.length).set(buf,start),start>>>=2,this._update(page,start,start+(buf.length>>>2)+(3&buf.length?1:0)),buf.length}_setPageBits(page,bit,start,end){const s=start>>>5,e=end>>>5,sm=4294967295>>>(31&start),em=~(4294967295>>>(31&end));return s===e?(page.bits[s]=bit?page.bits[s]|sm&em:page.bits[s]&~(sm&em),this._update(page,s,s+1),end-start):(page.bits[s]=bit?page.bits[s]|sm:page.bits[s]&~sm,e-s>2&&page.bits.fill(bit?4294967295:0,s+1,e-1),1024===e?(page.bits[e-1]=bit?4294967295:0,this._update(page,s,e),end-start):(page.bits[e]=bit?page.bits[e]|em:page.bits[e]&~em,this._update(page,s,e+1),end-start))}_update(page,start,end){for(;start<end;start++){const upd=page.bits[start];this._updateAllOne(page,start,upd),this._updateOneOne(page,start,upd)}}_updateAllOne(page,b,upd){var i=1;do{for(;i<3;i++){const buf=page.allOne[i],r=31&b,prev=buf[b>>>=5];if(buf[b]=4294967295===upd?prev|2147483648>>>r:prev&~(2147483648>>>r),(upd=buf[b])===prev)return}b+=this._offsets[page.level],page=this._parents[page.level],i=0}while(page)}_updateOneOne(page,b,upd){var i=1;do{for(;i<3;i++){const buf=page.oneOne[i],r=31&b,prev=buf[b>>>=5];if(buf[b]=0!==upd?prev|2147483648>>>r:prev&~(2147483648>>>r),(upd=buf[b])===prev)return}b+=this._offsets[page.level],page=this._parents[page.level],i=0,0===upd&&page&&(page.children[this._offsets[page.level-1]]=void 0)}while(page)}_getPage(index,createIfMissing){for(factor(index,this._path);index>=this.length;){if(!createIfMissing)return null;this.grow()}for(var page=this._page,i=page.level;i>0&&page;i--){const p=this._path[i];this._parents[i-1]=page,page=page.children[p]||(createIfMissing?this._addPage(page,p):null)}return page}_addPage(page,i){return this._allocs++,page=page.children[i]=new Page(page.level-1)}});class Page{constructor(level){const buf=new Uint8Array(level?8456:4360),b=buf.byteOffset;this.buffer=buf,this.bits=level?null:new Uint32Array(buf.buffer,b,1024),this.children=level?new Array(32768):null,this.level=level,this.allOne=level?[new Uint32Array(buf.buffer,b,1024),new Uint32Array(buf.buffer,b+4096,32),new Uint32Array(buf.buffer,b+4224,1)]:[this.bits,new Uint32Array(buf.buffer,b+4096,32),new Uint32Array(buf.buffer,b+4224,1)],this.oneOne=level?[new Uint32Array(buf.buffer,b+4228,1024),new Uint32Array(buf.buffer,b+8324,32),new Uint32Array(buf.buffer,b+8452,1)]:[this.bits,new Uint32Array(buf.buffer,b+4228,32),new Uint32Array(buf.buffer,b+4356,1)]}}const ZEROS=[new Page(0),new Page(1),new Page(2),new Page(3)],MASK=new Uint32Array(32),MASK_INCL=new Uint32Array(32);for(var i=0;i<32;i++)MASK[i]=Math.pow(2,31-i)-1,MASK_INCL[i]=Math.pow(2,32-i)-1;const LITTLE_ENDIAN=255===new Uint8Array(MASK.buffer,MASK.byteOffset,1)[0];class Iterator{constructor(bitfield){this._bitfield=bitfield,this._path=new Uint16Array(5),this._offsets=new Uint16Array(this._path.buffer,this._path.byteOffset+2,4),this._parents=new Array(4).fill(null),this._page=null,this._allocs=bitfield._allocs,this.seek(0)}seek(index){if(this._allocs=this._bitfield._allocs,index>=this._bitfield.length)return this._page=null,this;factor(index,this._path),this._page=this._bitfield._page;for(var i=this._page.level;i>0;i--)this._parents[i-1]=this._page,this._page=this._page.children[this._path[i]]||ZEROS[i-1];return this}next(bit){return bit?this.nextTrue():this.nextFalse()}nextFalse(){this._allocs!==this._bitfield._allocs&&this.seek(defactor(this._path));for(var page=this._page,b=this._path[0],mask=MASK_INCL;page;){for(var i=0;i<3;i++){const r=31&b,clz=Math.clz32(~page.allOne[i][b>>>=5]&mask[r]);if(32!==clz)return this._downLeftFalse(page,i,b,clz);mask=MASK}b=this._offsets[page.level],page=this._parents[page.level]}return-1}_downLeftFalse(page,i,b,clz){for(;;){for(;i;)b=(b<<5)+clz,clz=Math.clz32(~page.allOne[--i][b]);if(b=(b<<5)+clz,!page.level)break;this._parents[page.level-1]=page,this._path[page.level]=b,page=page.children[b],i=3,clz=b=0}return this._page=page,this._path[0]=b,this._inc()}nextTrue(){for(var page=this._page,b=this._path[0],mask=MASK_INCL;page;){for(var i=0;i<3;i++){const r=31&b,clz=Math.clz32(page.oneOne[i][b>>>=5]&mask[r]);if(32!==clz)return this._downLeftTrue(page,i,b,clz);mask=MASK}b=this._offsets[page.level],page=this._parents[page.level]}return-1}_downLeftTrue(page,i,b,clz){for(;;){for(;i;)b=(b<<5)+clz,clz=Math.clz32(page.oneOne[--i][b]);if(b=(b<<5)+clz,!page.level)break;this._parents[page.level-1]=page,this._path[page.level]=b,page=page.children[b],i=3,clz=b=0}return this._page=page,this._path[0]=b,this._inc()}_inc(){const n=defactor(this._path);return this._path[0]<32767?this._path[0]++:this.seek(n+1),n}}function defactor(out){return 32768*(32768*(32768*out[3]+out[2])+out[1])+out[0]}function factor(n,out){n=((n=(n-(out[0]=32767&n))/32768)-(out[1]=32767&n))/32768,out[3]=(n-(out[2]=32767&n))/32768&32767}},{"count-trailing-zeros":31}],44:[function(require,module,exports){function twoPow(n){return n<31?1<<n:(1<<30)*(1<<n-30)}function rightShift(n){return(n-(1&n))/2}function Iterator(index){this.index=0,this.offset=0,this.factor=0}exports.fullRoots=function(index,result){if(1&index)throw new Error("You can only look up roots for depth(0) blocks");result||(result=[]),index/=2;for(var offset=0,factor=1;;){if(!index)return result;for(;2*factor<=index;)factor*=2;result.push(offset+factor-1),offset+=2*factor,index-=factor,factor=1}},exports.depth=function(index){var depth=0;for(index+=1;!(1&index);)depth++,index=rightShift(index);return depth},exports.sibling=function(index,depth){depth||(depth=exports.depth(index));var offset=exports.offset(index,depth);return exports.index(depth,1&offset?offset-1:offset+1)},exports.parent=function(index,depth){depth||(depth=exports.depth(index));var offset=exports.offset(index,depth);return exports.index(depth+1,rightShift(offset))},exports.leftChild=function(index,depth){return 1&index?(depth||(depth=exports.depth(index)),exports.index(depth-1,2*exports.offset(index,depth))):-1},exports.rightChild=function(index,depth){return 1&index?(depth||(depth=exports.depth(index)),exports.index(depth-1,1+2*exports.offset(index,depth))):-1},exports.children=function(index,depth){if(!(1&index))return null;depth||(depth=exports.depth(index));var offset=2*exports.offset(index,depth);return[exports.index(depth-1,offset),exports.index(depth-1,offset+1)]},exports.leftSpan=function(index,depth){return 1&index?(depth||(depth=exports.depth(index)),exports.offset(index,depth)*twoPow(depth+1)):index},exports.rightSpan=function(index,depth){return 1&index?(depth||(depth=exports.depth(index)),(exports.offset(index,depth)+1)*twoPow(depth+1)-2):index},exports.count=function(index,depth){return 1&index?(depth||(depth=exports.depth(index)),twoPow(depth+1)-1):1},exports.spans=function(index,depth){if(!(1&index))return[index,index];depth||(depth=exports.depth(index));var offset=exports.offset(index,depth),width=twoPow(depth+1);return[offset*width,(offset+1)*width-2]},exports.index=function(depth,offset){return(1+2*offset)*twoPow(depth)-1},exports.offset=function(index,depth){return 1&index?(depth||(depth=exports.depth(index)),((index+1)/twoPow(depth)-1)/2):index/2},exports.iterator=function(index){var ite=new Iterator;return ite.seek(index||0),ite},Iterator.prototype.seek=function(index){this.index=index,1&this.index?(this.offset=exports.offset(index),this.factor=twoPow(exports.depth(index)+1)):(this.offset=index/2,this.factor=2)},Iterator.prototype.isLeft=function(){return!(1&this.offset)},Iterator.prototype.isRight=function(){return!this.isLeft()},Iterator.prototype.prev=function(){return this.offset?(this.offset--,this.index-=this.factor,this.index):this.index},Iterator.prototype.next=function(){return this.offset++,this.index+=this.factor,this.index},Iterator.prototype.sibling=function(){return this.isLeft()?this.next():this.prev()},Iterator.prototype.parent=function(){return 1&this.offset?(this.index-=this.factor/2,this.offset=(this.offset-1)/2):(this.index+=this.factor/2,this.offset/=2),this.factor*=2,this.index},Iterator.prototype.leftSpan=function(){return this.index=this.index-this.factor/2+1,this.offset=this.index/2,this.factor=2,this.index},Iterator.prototype.rightSpan=function(){return this.index=this.index+this.factor/2-1,this.offset=this.index/2,this.factor=2,this.index},Iterator.prototype.leftChild=function(){return 2===this.factor?this.index:(this.factor/=2,this.index-=this.factor/2,this.offset*=2,this.index)},Iterator.prototype.rightChild=function(){return 2===this.factor?this.index:(this.factor/=2,this.index+=this.factor/2,this.offset=2*this.offset+1,this.index)}},{}],45:[function(require,module,exports){(function(process){var Readable=require("readable-stream").Readable,inherits=require("inherits");module.exports=from2,from2.ctor=ctor,from2.obj=function(opts,read){("function"==typeof opts||Array.isArray(opts))&&(read=opts,opts={});return(opts=defaults(opts)).objectMode=!0,opts.highWaterMark=16,from2(opts,read)};var Proto=ctor();function from2(opts,read){("object"!=typeof opts||Array.isArray(opts))&&(read=opts,opts={});var list,rs=new Proto(opts);return rs._from=Array.isArray(read)?(list=(list=read).slice(),function(_,cb){var err=null,item=list.length?list.shift():null;item instanceof Error&&(err=item,item=null),cb(err,item)}):read||noop,rs}function ctor(opts,read){function Class(override){if(!(this instanceof Class))return new Class(override);this._reading=!1,this._callback=function(err,data){if(self.destroyed)return;if(err)return self.destroy(err);if(null===data)return self.push(null);self._reading=!1,self.push(data)&&self._read(hwm)},this.destroyed=!1,Readable.call(this,override||opts);var self=this,hwm=this._readableState.highWaterMark}return"function"==typeof opts&&(read=opts,opts={}),opts=defaults(opts),inherits(Class,Readable),Class.prototype._from=read||noop,Class.prototype._read=function(size){this._reading||this.destroyed||(this._reading=!0,this._from(size,this._callback))},Class.prototype.destroy=function(err){if(!this.destroyed){this.destroyed=!0;var self=this;process.nextTick(function(){err&&self.emit("error",err),self.emit("close")})}},Class}function noop(){}function defaults(opts){return opts=opts||{}}}).call(this,require("_process"))},{_process:118,inherits:92,"readable-stream":147}],46:[function(require,module,exports){module.exports=function(){if("undefined"==typeof window)return null;var wrtc={RTCPeerConnection:window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,RTCSessionDescription:window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription,RTCIceCandidate:window.RTCIceCandidate||window.mozRTCIceCandidate||window.webkitRTCIceCandidate};return wrtc.RTCPeerConnection?wrtc:null}},{}],47:[function(require,module,exports){var sodium=require("sodium-universal"),uint64be=require("uint64be"),bufferFrom=require("buffer-from"),bufferAlloc=require("buffer-alloc-unsafe"),LEAF_TYPE=bufferFrom([0]),PARENT_TYPE=bufferFrom([1]),ROOT_TYPE=bufferFrom([2]),HYPERCORE=bufferFrom("hypercore");function encodeUInt64(n){return uint64be.encode(n,bufferAlloc(8))}function blake2b(buffers){var digest=bufferAlloc(32);return sodium.crypto_generichash_batch(digest,buffers),digest}exports.keyPair=function(seed){var publicKey=bufferAlloc(sodium.crypto_sign_PUBLICKEYBYTES),secretKey=bufferAlloc(sodium.crypto_sign_SECRETKEYBYTES);return seed?sodium.crypto_sign_seed_keypair(publicKey,secretKey,seed):sodium.crypto_sign_keypair(publicKey,secretKey),{publicKey:publicKey,secretKey:secretKey}},exports.sign=function(message,secretKey){var signature=bufferAlloc(sodium.crypto_sign_BYTES);return sodium.crypto_sign_detached(signature,message,secretKey),signature},exports.verify=function(message,signature,publicKey){return sodium.crypto_sign_verify_detached(signature,message,publicKey)},exports.data=function(data){return blake2b([LEAF_TYPE,encodeUInt64(data.length),data])},exports.leaf=function(leaf){return exports.data(leaf.data)},exports.parent=function(a,b){if(a.index>b.index){var tmp=a;a=b,b=tmp}return blake2b([PARENT_TYPE,encodeUInt64(a.size+b.size),a.hash,b.hash])},exports.tree=function(roots){var buffers=new Array(3*roots.length+1),j=0;buffers[j++]=ROOT_TYPE;for(var i=0;i<roots.length;i++){var r=roots[i];buffers[j++]=r.hash,buffers[j++]=encodeUInt64(r.index),buffers[j++]=encodeUInt64(r.size)}return blake2b(buffers)},exports.randomBytes=function(n){var buf=bufferAlloc(n);return sodium.randombytes_buf(buf),buf},exports.discoveryKey=function(tree){var digest=bufferAlloc(32);return sodium.crypto_generichash(digest,HYPERCORE,tree),digest}},{"buffer-alloc-unsafe":22,"buffer-from":25,"sodium-universal":167,uint64be:176}],48:[function(require,module,exports){(function(process){var events=require("events"),inherits=require("inherits"),varint=require("varint"),messages=require("./messages"),bufferAlloc=require("buffer-alloc-unsafe");function Feed(stream){if(!(this instanceof Feed))return new Feed(stream);events.EventEmitter.call(this),this.key=null,this.discoveryKey=null,this.stream=stream,this.peer=null,this.id=-1,this.remoteId=-1,this.header=0,this.headerLength=0,this.closed=!1,this._buffer=[]}function decode(enc,data,start,end){try{return enc.decode(data,start,end)}catch(err){return null}}module.exports=Feed,inherits(Feed,events.EventEmitter),Feed.prototype.handshake=function(message){return this._send(1,messages.Handshake,message)},Feed.prototype.info=function(message){return this._send(2,messages.Info,message)},Feed.prototype.have=function(message){return this._send(3,messages.Have,message)},Feed.prototype.unhave=function(message){return this._send(4,messages.Unhave,message)},Feed.prototype.want=function(message){return this._send(5,messages.Want,message)},Feed.prototype.unwant=function(message){return this._send(6,messages.Unwant,message)},Feed.prototype.request=function(message){return this._send(7,messages.Request,message)},Feed.prototype.cancel=function(message){return this._send(8,messages.Cancel,message)},Feed.prototype.data=function(message){return this._send(9,messages.Data,message)},Feed.prototype.extension=function(type,message){var id=this.stream.extensions.indexOf(type);if(-1===id)return!1;var header=15|this.header,len=this.headerLength+varint.encodingLength(id)+message.length,box=bufferAlloc(varint.encodingLength(len)+len),offset=0;return varint.encode(len,box,offset),offset+=varint.encode.bytes,varint.encode(header,box,offset),offset+=varint.encode.bytes,varint.encode(id,box,offset),offset+=varint.encode.bytes,message.copy(box,offset),this.stream._push(box)},Feed.prototype.remoteSupports=function(name){return this.stream.remoteSupports(name)},Feed.prototype.destroy=function(err){this.stream.destroy(err)},Feed.prototype.close=function(){var i=this.stream.feeds.indexOf(this);if(i>-1){if(this.stream.feeds[i]=this.stream.feeds[this.stream.feeds.length-1],this.stream.feeds.pop(),this.stream._localFeeds[this.id]=null,this.id=-1,this.stream.destroyed)return;if(this.stream.expectedFeeds<=0||--this.stream.expectedFeeds)return;this.stream._prefinalize()}},Feed.prototype._onclose=function(){if(!this.closed){if(this.closed=!0,!this.stream.destroyed){this.close(),this.remoteId>-1&&(this.stream._remoteFeeds[this.remoteId]=null);var hex=this.discoveryKey.toString("hex");this.stream._feeds[hex]===this&&delete this.stream._feeds[hex]}this.peer?this.peer.onclose():this.emit("close")}},Feed.prototype._resume=function(){var self=this;process.nextTick(function(){for(;self._buffer.length;){var next=self._buffer.shift();self._emit(next.type,next.message)}self._buffer=null})},Feed.prototype._onextension=function(data,start,end){if(!(end<=start)){var id=varint.decode(data,start),r=this.stream.remoteExtensions,localId=!r||id>=r.length?-1:r[id];if(-1!==localId){var message=data.slice(start+varint.decode.bytes,end),name=this.stream.extensions[localId];this.peer&&this.peer.onextension?this.peer.onextension(name,message):this.emit("extension",name,message)}}},Feed.prototype._onmessage=function(type,data,start,end){var message=function(type,data,start,end){switch(type){case 1:return decode(messages.Handshake,data,start,end);case 2:return decode(messages.Info,data,start,end);case 3:return decode(messages.Have,data,start,end);case 4:return decode(messages.Unhave,data,start,end);case 5:return decode(messages.Want,data,start,end);case 6:return decode(messages.Unwant,data,start,end);case 7:return decode(messages.Request,data,start,end);case 8:return decode(messages.Cancel,data,start,end);case 9:return decode(messages.Data,data,start,end)}}(type,data,start,end);if(message&&!this.closed)return 1===type?this.stream._onhandshake(message):void(this._buffer?this._buffer.length>16?this.destroy(new Error("Remote sent too many messages on an unopened feed")):this._buffer.push({type:type,message:message}):this._emit(type,message))},Feed.prototype._emit=function(type,message){if(this.peer)switch(type){case 2:return this.peer.oninfo(message);case 3:return this.peer.onhave(message);case 4:return this.peer.onunhave(message);case 5:return this.peer.onwant(message);case 6:return this.peer.onunwant(message);case 7:return this.peer.onrequest(message);case 8:return this.peer.oncancel(message);case 9:return this.peer.ondata(message)}else switch(type){case 2:return this.emit("info",message);case 3:return this.emit("have",message);case 4:return this.emit("unhave",message);case 5:return this.emit("want",message);case 6:return this.emit("unwant",message);case 7:return this.emit("request",message);case 8:return this.emit("cancel",message);case 9:return this.emit("data",message)}},Feed.prototype._send=function(type,enc,message){var header=this.header|type,len=this.headerLength+enc.encodingLength(message),box=bufferAlloc(varint.encodingLength(len)+len),offset=0;return varint.encode(len,box,offset),offset+=varint.encode.bytes,varint.encode(header,box,offset),offset+=varint.encode.bytes,enc.encode(message,box,offset),this.stream._push(box)}}).call(this,require("_process"))},{"./messages":50,_process:118,"buffer-alloc-unsafe":22,events:21,inherits:92,varint:53}],49:[function(require,module,exports){(function(process){var stream=require("readable-stream"),inherits=require("inherits"),varint=require("varint"),sodium=require("sodium-universal"),indexOf=require("sorted-indexof"),feed=require("./feed"),messages=require("./messages"),bufferAlloc=require("buffer-alloc-unsafe"),bufferFrom=require("buffer-from");function Protocol(opts){if(!(this instanceof Protocol))return new Protocol(opts);opts||(opts={}),stream.Duplex.call(this);var self=this;this.id=opts.id||randomBytes(32),this.live=!!opts.live,this.ack=!!opts.ack,this.userData=opts.userData||null,this.remoteId=null,this.remoteLive=!1,this.remoteUserData=null,this.destroyed=!1,this.encrypted=!1!==opts.encrypt,this.key=null,this.discoveryKey=null,this.remoteDiscoveryKey=null,this.feeds=[],this.expectedFeeds=opts.expectedFeeds||0,this.extensions=opts.extensions||[],this.remoteExtensions=null,this.maxFeeds=opts.maxFeeds||256,this._localFeeds=[],this._remoteFeeds=[],this._feeds={},this._nonce=null,this._remoteNonce=null,this._xor=null,this._remoteXor=null,this._needsKey=!1,this._length=bufferAlloc(varint.encodingLength(8388608)),this._missing=0,this._buf=null,this._pointer=0,this._data=null,this._start=0,this._cb=null,this._interval=null,this._keepAlive=0,this._remoteKeepAlive=0,this._maybeFinalize=function(err){if(err)return self.destroy(err);self.expectedFeeds||self.finalize()},this._utp=null,0!==opts.timeout&&!1!==opts.timeout&&this.setTimeout(opts.timeout||5e3,this._ontimeout),this.on("finish",this.finalize),this.on("pipe",this._onpipe)}function discoveryKey(key){var buf=bufferAlloc(32);return sodium.crypto_generichash(buf,bufferFrom("hypercore"),key),buf}function randomBytes(n){var buf=bufferAlloc(n);return sodium.randombytes_buf(buf),buf}module.exports=Protocol,inherits(Protocol,stream.Duplex),Protocol.prototype._onpipe=function(stream){"function"==typeof stream.setContentSize&&(this._utp=stream)},Protocol.prototype._prefinalize=function(){this.emit("prefinalize",this._maybeFinalize)||this.finalize()},Protocol.prototype.setTimeout=function(ms,ontimeout){if(!this.destroyed){ontimeout&&this.once("timeout",ontimeout);var self=this;this._keepAlive=0,this._remoteKeepAlive=0,clearInterval(this._interval),ms&&(this._interval=setInterval(function(){self._kick()},ms/4|0),this._interval.unref&&this._interval.unref())}},Protocol.prototype.has=function(key){var hex=discoveryKey(key).toString("hex");return!!this._feeds[hex]},Protocol.prototype.feed=function(key,opts){if(this.destroyed)return null;opts||(opts={});var dk=opts.discoveryKey||discoveryKey(key),ch=this._feed(dk);if(ch.id>-1)return opts.peer&&(ch.peer=opts.peer),ch;if(this._localFeeds.length>=this.maxFeeds)return this._tooManyFeeds(),null;ch.id=this._localFeeds.push(ch)-1,ch.header=ch.id<<4,ch.headerLength=varint.encodingLength(ch.header),ch.key=key,ch.discoveryKey=dk,opts.peer&&(ch.peer=opts.peer),this.feeds.push(ch);var first=!this.key,feed={discoveryKey:dk,nonce:null};if(first){if(this.key=key,this.discoveryKey=dk,!this._sameKey())return null;this.encrypted&&(feed.nonce=this._nonce=randomBytes(24),this._xor=sodium.crypto_stream_xor_instance(this._nonce,this.key),this._remoteNonce&&(this._remoteXor=sodium.crypto_stream_xor_instance(this._remoteNonce,this.key))),this._needsKey&&(this._needsKey=!1,this._resume())}var box=function(feed,id){var header=id<<4,len=varint.encodingLength(header)+messages.Feed.encodingLength(feed),box=bufferAlloc(varint.encodingLength(len)+len),offset=0;return varint.encode(len,box,offset),offset+=varint.encode.bytes,varint.encode(header,box,offset),offset+=varint.encode.bytes,messages.Feed.encode(feed,box,offset),box}(feed,ch.id);return!feed.nonce&&this.encrypted&&this._xor.update(box,box),this._keepAlive=0,this.push(box),this.destroyed?null:(first&&ch.handshake({id:this.id,live:this.live,userData:this.userData,extensions:this.extensions,ack:this.ack}),ch._buffer.length?ch._resume():ch._buffer=null,ch)},Protocol.prototype._resume=function(){var self=this;process.nextTick(function(){if(!self._data)return;var data=self._data,start=self._start,cb=self._cb;self._data=null,self._start=0,self._cb=null,self._parse(data,start,cb)})},Protocol.prototype._kick=function(){if(this._remoteKeepAlive>4)return clearInterval(this._interval),void this.emit("timeout");for(var i=0;i<this.feeds.length;i++){var ch=this.feeds[i];ch.peer?ch.peer.ontick():ch.emit("tick")}this._remoteKeepAlive++,this._keepAlive>2?(this.ping(),this._keepAlive=0):this._keepAlive++},Protocol.prototype.ping=function(){if(!this.key)return!0;var ping=bufferFrom([0]);return this._xor&&this._xor.update(ping,ping),this.push(ping)},Protocol.prototype.destroy=function(err){this.destroyed||(this.destroyed=!0,err&&this.emit("error",err),this._close(),this.emit("close"))},Protocol.prototype.finalize=function(){this.destroyed||(this.destroyed=!0,this._close(),this.push(null))},Protocol.prototype._close=function(){clearInterval(this._interval);var feeds=this.feeds;this.feeds=[];for(var i=0;i<feeds.length;i++)feeds[i]._onclose();this._xor&&(this._xor.final(),this._xor=null)},Protocol.prototype._read=function(){},Protocol.prototype._push=function(data){if(!this.destroyed)return this._keepAlive=0,this._xor&&this._xor.update(data,data),this.push(data)},Protocol.prototype._write=function(data,enc,cb){this._remoteKeepAlive=0,this._parse(data,0,cb)},Protocol.prototype._feed=function(dk){var hex=dk.toString("hex"),ch=this._feeds[hex];return ch||(ch=this._feeds[hex]=feed(this))},Protocol.prototype.remoteSupports=function(name){var i=this.extensions.indexOf(name);return i>-1&&!!this.remoteExtensions&&this.remoteExtensions.indexOf(i)>-1},Protocol.prototype._onhandshake=function(handshake){this.remoteId||(this.remoteId=handshake.id||randomBytes(32),this.remoteLive=handshake.live,this.remoteUserData=handshake.userData,this.remoteExtensions=indexOf(this.extensions,handshake.extensions),this.remoteAck=handshake.ack,this.emit("handshake"))},Protocol.prototype._onopen=function(id,data,start,end){var feed=function(data,start,end){var feed=null;try{feed=messages.Feed.decode(data,start,end)}catch(err){return null}return 32!==feed.discoveryKey.length?null:feed.nonce&&24!==feed.nonce.length?null:feed}(data,start,end);if(!feed)return this._badFeed();if(!this.remoteDiscoveryKey){if(this.remoteDiscoveryKey=feed.discoveryKey,!this._sameKey())return;if(this.encrypted&&!this._remoteNonce){if(!feed.nonce)return void this.destroy(new Error("Remote did not include a nonce"));this._remoteNonce=feed.nonce}this.encrypted&&this.key&&!this._remoteXor&&(this._remoteXor=sodium.crypto_stream_xor_instance(this._remoteNonce,this.key))}this._remoteFeeds[id]=this._feed(feed.discoveryKey),feed.remoteId=id,this.emit("feed",feed.discoveryKey)},Protocol.prototype._onmessage=function(data,start,end){if(!(end-start<2)){var header=function(data,start){try{return varint.decode(data,start)}catch(err){return-1}}(data,start);if(-1===header)return this.destroy(new Error("Remote sent invalid header"));start+=varint.decode.bytes;var id=header>>4,type=15&header;if(id>=this.maxFeeds)return this._tooManyFeeds();for(;this._remoteFeeds.length<id;)this._remoteFeeds.push(null);var ch=this._remoteFeeds[id];return 0===type?(ch&&ch._onclose(),this._onopen(id,data,start,end)):ch?15===type?ch._onextension(data,start,end):void ch._onmessage(type,data,start,end):this._badFeed()}},Protocol.prototype._parse=function(data,start,cb){var decrypted=!!this._remoteXor;for(start&&(data=data.slice(start),start=0),this._remoteXor&&this._remoteXor.update(data,data);start<data.length&&!this.destroyed;){if(start=this._missing?this._parseMessage(data,start):this._parseLength(data,start),this._needsKey)return this._data=data,this._start=start,void(this._cb=cb);if(!decrypted&&this._remoteXor)return this._parse(data,start,cb)}cb()},Protocol.prototype._parseMessage=function(data,start){var end=start+this._missing;if(end<=data.length){var ret=end;return this._buf&&(data.copy(this._buf,this._pointer,start),start=0,end=(data=this._buf).length,this._buf=null),this._missing=0,this._pointer=0,this.encrypted&&!this.key&&(this._needsKey=!0),this._onmessage(data,start,end),ret}this._buf||(this._buf=bufferAlloc(this._missing),this._pointer=0);var rem=data.length-start;return data.copy(this._buf,this._pointer,start),this._pointer+=rem,this._missing-=rem,data.length},Protocol.prototype._parseLength=function(data,start){for(;!this._missing&&start<data.length;){if(!(128&(this._length[this._pointer++]=data[start++]))){if(this._missing=varint.decode(this._length),this._pointer=0,this._missing>8388608)return this._tooBig(data.length);if(this._utp){var reallyMissing=this._missing-(data.length-start);reallyMissing>0&&!this._needsKey&&this._utp.setContentSize(reallyMissing)}return start}if(this._pointer>=this._length.length)return this._tooBig(data.length)}return start},Protocol.prototype._sameKey=function(){return!this.encrypted||(!this.discoveryKey||!this.remoteDiscoveryKey||(this.remoteDiscoveryKey.toString("hex")===this.discoveryKey.toString("hex")||(this.destroy(new Error("First shared hypercore must be the same")),!1)))},Protocol.prototype._tooManyFeeds=function(){this.destroy(new Error("Only "+this.maxFeeds+" feeds currently supported. Open a Github issue if you need more"))},Protocol.prototype._tooBig=function(len){return this.destroy(new Error("Remote message is larger than 8MB (max allowed)")),len},Protocol.prototype._badFeed=function(){this.destroy(new Error("Remote sent invalid feed message"))},Protocol.prototype._ontimeout=function(){this.destroy(new Error("Remote timed out"))}}).call(this,require("_process"))},{"./feed":48,"./messages":50,_process:118,"buffer-alloc-unsafe":22,"buffer-from":25,inherits:92,"readable-stream":147,"sodium-universal":167,"sorted-indexof":169,varint:53}],50:[function(require,module,exports){(function(Buffer){var encodings=require("protocol-buffers-encodings"),varint=encodings.varint,skip=encodings.skip,Feed=exports.Feed={buffer:!0,encodingLength:null,encode:null,decode:null},Handshake=exports.Handshake={buffer:!0,encodingLength:null,encode:null,decode:null},Info=exports.Info={buffer:!0,encodingLength:null,encode:null,decode:null},Have=exports.Have={buffer:!0,encodingLength:null,encode:null,decode:null},Unhave=exports.Unhave={buffer:!0,encodingLength:null,encode:null,decode:null},Want=exports.Want={buffer:!0,encodingLength:null,encode:null,decode:null},Unwant=exports.Unwant={buffer:!0,encodingLength:null,encode:null,decode:null},Request=exports.Request={buffer:!0,encodingLength:null,encode:null,decode:null},Cancel=exports.Cancel={buffer:!0,encodingLength:null,encode:null,decode:null},Data=exports.Data={buffer:!0,encodingLength:null,encode:null,decode:null};function defined(val){return null!==val&&void 0!==val&&("number"!=typeof val||!isNaN(val))}!function(){var enc=[encodings.bytes];function encodingLength(obj){var length=0;if(!defined(obj.discoveryKey))throw new Error("discoveryKey is required");var len=enc[0].encodingLength(obj.discoveryKey);if(length+=1+len,defined(obj.nonce)){var len=enc[0].encodingLength(obj.nonce);length+=1+len}return length}Feed.encodingLength=encodingLength,Feed.encode=function encode(obj,buf,offset){offset||(offset=0);buf||(buf=Buffer.allocUnsafe(encodingLength(obj)));var oldOffset=offset;if(!defined(obj.discoveryKey))throw new Error("discoveryKey is required");buf[offset++]=10;enc[0].encode(obj.discoveryKey,buf,offset);offset+=enc[0].encode.bytes;defined(obj.nonce)&&(buf[offset++]=18,enc[0].encode(obj.nonce,buf,offset),offset+=enc[0].encode.bytes);encode.bytes=offset-oldOffset;return buf},Feed.decode=function decode(buf,offset,end){offset||(offset=0);end||(end=buf.length);if(!(end<=buf.length&&offset<=buf.length))throw new Error("Decoded message is not valid");var oldOffset=offset;var obj={discoveryKey:null,nonce:null};var found0=!1;for(;;){if(end<=offset){if(!found0)throw new Error("Decoded message is not valid");return decode.bytes=offset-oldOffset,obj}var prefix=varint.decode(buf,offset);offset+=varint.decode.bytes;var tag=prefix>>3;switch(tag){case 1:obj.discoveryKey=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes,found0=!0;break;case 2:obj.nonce=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes;break;default:offset=skip(7&prefix,buf,offset)}}}}(),function(){var enc=[encodings.bytes,encodings.bool,encodings.string];function encodingLength(obj){var length=0;if(defined(obj.id)){var len=enc[0].encodingLength(obj.id);length+=1+len}if(defined(obj.live)){var len=enc[1].encodingLength(obj.live);length+=1+len}if(defined(obj.userData)){var len=enc[0].encodingLength(obj.userData);length+=1+len}if(defined(obj.extensions))for(var i=0;i<obj.extensions.length;i++)if(defined(obj.extensions[i])){var len=enc[2].encodingLength(obj.extensions[i]);length+=1+len}if(defined(obj.ack)){var len=enc[1].encodingLength(obj.ack);length+=1+len}return length}Handshake.encodingLength=encodingLength,Handshake.encode=function encode(obj,buf,offset){offset||(offset=0);buf||(buf=Buffer.allocUnsafe(encodingLength(obj)));var oldOffset=offset;defined(obj.id)&&(buf[offset++]=10,enc[0].encode(obj.id,buf,offset),offset+=enc[0].encode.bytes);defined(obj.live)&&(buf[offset++]=16,enc[1].encode(obj.live,buf,offset),offset+=enc[1].encode.bytes);defined(obj.userData)&&(buf[offset++]=26,enc[0].encode(obj.userData,buf,offset),offset+=enc[0].encode.bytes);if(defined(obj.extensions))for(var i=0;i<obj.extensions.length;i++)defined(obj.extensions[i])&&(buf[offset++]=34,enc[2].encode(obj.extensions[i],buf,offset),offset+=enc[2].encode.bytes);defined(obj.ack)&&(buf[offset++]=40,enc[1].encode(obj.ack,buf,offset),offset+=enc[1].encode.bytes);encode.bytes=offset-oldOffset;return buf},Handshake.decode=function decode(buf,offset,end){offset||(offset=0);end||(end=buf.length);if(!(end<=buf.length&&offset<=buf.length))throw new Error("Decoded message is not valid");var oldOffset=offset;var obj={id:null,live:!1,userData:null,extensions:[],ack:!1};for(;;){if(end<=offset)return decode.bytes=offset-oldOffset,obj;var prefix=varint.decode(buf,offset);offset+=varint.decode.bytes;var tag=prefix>>3;switch(tag){case 1:obj.id=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes;break;case 2:obj.live=enc[1].decode(buf,offset),offset+=enc[1].decode.bytes;break;case 3:obj.userData=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes;break;case 4:obj.extensions.push(enc[2].decode(buf,offset)),offset+=enc[2].decode.bytes;break;case 5:obj.ack=enc[1].decode(buf,offset),offset+=enc[1].decode.bytes;break;default:offset=skip(7&prefix,buf,offset)}}}}(),function(){var enc=[encodings.bool];function encodingLength(obj){var length=0;if(defined(obj.uploading)){var len=enc[0].encodingLength(obj.uploading);length+=1+len}if(defined(obj.downloading)){var len=enc[0].encodingLength(obj.downloading);length+=1+len}return length}Info.encodingLength=encodingLength,Info.encode=function encode(obj,buf,offset){offset||(offset=0);buf||(buf=Buffer.allocUnsafe(encodingLength(obj)));var oldOffset=offset;defined(obj.uploading)&&(buf[offset++]=8,enc[0].encode(obj.uploading,buf,offset),offset+=enc[0].encode.bytes);defined(obj.downloading)&&(buf[offset++]=16,enc[0].encode(obj.downloading,buf,offset),offset+=enc[0].encode.bytes);encode.bytes=offset-oldOffset;return buf},Info.decode=function decode(buf,offset,end){offset||(offset=0);end||(end=buf.length);if(!(end<=buf.length&&offset<=buf.length))throw new Error("Decoded message is not valid");var oldOffset=offset;var obj={uploading:!1,downloading:!1};for(;;){if(end<=offset)return decode.bytes=offset-oldOffset,obj;var prefix=varint.decode(buf,offset);offset+=varint.decode.bytes;var tag=prefix>>3;switch(tag){case 1:obj.uploading=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes;break;case 2:obj.downloading=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes;break;default:offset=skip(7&prefix,buf,offset)}}}}(),function(){var enc=[encodings.varint,encodings.bytes];function encodingLength(obj){var length=0;if(!defined(obj.start))throw new Error("start is required");var len=enc[0].encodingLength(obj.start);if(length+=1+len,defined(obj.length)){var len=enc[0].encodingLength(obj.length);length+=1+len}if(defined(obj.bitfield)){var len=enc[1].encodingLength(obj.bitfield);length+=1+len}return length}Have.encodingLength=encodingLength,Have.encode=function encode(obj,buf,offset){offset||(offset=0);buf||(buf=Buffer.allocUnsafe(encodingLength(obj)));var oldOffset=offset;if(!defined(obj.start))throw new Error("start is required");buf[offset++]=8;enc[0].encode(obj.start,buf,offset);offset+=enc[0].encode.bytes;defined(obj.length)&&(buf[offset++]=16,enc[0].encode(obj.length,buf,offset),offset+=enc[0].encode.bytes);defined(obj.bitfield)&&(buf[offset++]=26,enc[1].encode(obj.bitfield,buf,offset),offset+=enc[1].encode.bytes);encode.bytes=offset-oldOffset;return buf},Have.decode=function decode(buf,offset,end){offset||(offset=0);end||(end=buf.length);if(!(end<=buf.length&&offset<=buf.length))throw new Error("Decoded message is not valid");var oldOffset=offset;var obj={start:0,length:1,bitfield:null};var found0=!1;for(;;){if(end<=offset){if(!found0)throw new Error("Decoded message is not valid");return decode.bytes=offset-oldOffset,obj}var prefix=varint.decode(buf,offset);offset+=varint.decode.bytes;var tag=prefix>>3;switch(tag){case 1:obj.start=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes,found0=!0;break;case 2:obj.length=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes;break;case 3:obj.bitfield=enc[1].decode(buf,offset),offset+=enc[1].decode.bytes;break;default:offset=skip(7&prefix,buf,offset)}}}}(),function(){var enc=[encodings.varint];function encodingLength(obj){var length=0;if(!defined(obj.start))throw new Error("start is required");var len=enc[0].encodingLength(obj.start);if(length+=1+len,defined(obj.length)){var len=enc[0].encodingLength(obj.length);length+=1+len}return length}Unhave.encodingLength=encodingLength,Unhave.encode=function encode(obj,buf,offset){offset||(offset=0);buf||(buf=Buffer.allocUnsafe(encodingLength(obj)));var oldOffset=offset;if(!defined(obj.start))throw new Error("start is required");buf[offset++]=8;enc[0].encode(obj.start,buf,offset);offset+=enc[0].encode.bytes;defined(obj.length)&&(buf[offset++]=16,enc[0].encode(obj.length,buf,offset),offset+=enc[0].encode.bytes);encode.bytes=offset-oldOffset;return buf},Unhave.decode=function decode(buf,offset,end){offset||(offset=0);end||(end=buf.length);if(!(end<=buf.length&&offset<=buf.length))throw new Error("Decoded message is not valid");var oldOffset=offset;var obj={start:0,length:1};var found0=!1;for(;;){if(end<=offset){if(!found0)throw new Error("Decoded message is not valid");return decode.bytes=offset-oldOffset,obj}var prefix=varint.decode(buf,offset);offset+=varint.decode.bytes;var tag=prefix>>3;switch(tag){case 1:obj.start=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes,found0=!0;break;case 2:obj.length=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes;break;default:offset=skip(7&prefix,buf,offset)}}}}(),function(){var enc=[encodings.varint];function encodingLength(obj){var length=0;if(!defined(obj.start))throw new Error("start is required");var len=enc[0].encodingLength(obj.start);if(length+=1+len,defined(obj.length)){var len=enc[0].encodingLength(obj.length);length+=1+len}return length}Want.encodingLength=encodingLength,Want.encode=function encode(obj,buf,offset){offset||(offset=0);buf||(buf=Buffer.allocUnsafe(encodingLength(obj)));var oldOffset=offset;if(!defined(obj.start))throw new Error("start is required");buf[offset++]=8;enc[0].encode(obj.start,buf,offset);offset+=enc[0].encode.bytes;defined(obj.length)&&(buf[offset++]=16,enc[0].encode(obj.length,buf,offset),offset+=enc[0].encode.bytes);encode.bytes=offset-oldOffset;return buf},Want.decode=function decode(buf,offset,end){offset||(offset=0);end||(end=buf.length);if(!(end<=buf.length&&offset<=buf.length))throw new Error("Decoded message is not valid");var oldOffset=offset;var obj={start:0,length:0};var found0=!1;for(;;){if(end<=offset){if(!found0)throw new Error("Decoded message is not valid");return decode.bytes=offset-oldOffset,obj}var prefix=varint.decode(buf,offset);offset+=varint.decode.bytes;var tag=prefix>>3;switch(tag){case 1:obj.start=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes,found0=!0;break;case 2:obj.length=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes;break;default:offset=skip(7&prefix,buf,offset)}}}}(),function(){var enc=[encodings.varint];function encodingLength(obj){var length=0;if(!defined(obj.start))throw new Error("start is required");var len=enc[0].encodingLength(obj.start);if(length+=1+len,defined(obj.length)){var len=enc[0].encodingLength(obj.length);length+=1+len}return length}Unwant.encodingLength=encodingLength,Unwant.encode=function encode(obj,buf,offset){offset||(offset=0);buf||(buf=Buffer.allocUnsafe(encodingLength(obj)));var oldOffset=offset;if(!defined(obj.start))throw new Error("start is required");buf[offset++]=8;enc[0].encode(obj.start,buf,offset);offset+=enc[0].encode.bytes;defined(obj.length)&&(buf[offset++]=16,enc[0].encode(obj.length,buf,offset),offset+=enc[0].encode.bytes);encode.bytes=offset-oldOffset;return buf},Unwant.decode=function decode(buf,offset,end){offset||(offset=0);end||(end=buf.length);if(!(end<=buf.length&&offset<=buf.length))throw new Error("Decoded message is not valid");var oldOffset=offset;var obj={start:0,length:0};var found0=!1;for(;;){if(end<=offset){if(!found0)throw new Error("Decoded message is not valid");return decode.bytes=offset-oldOffset,obj}var prefix=varint.decode(buf,offset);offset+=varint.decode.bytes;var tag=prefix>>3;switch(tag){case 1:obj.start=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes,found0=!0;break;case 2:obj.length=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes;break;default:offset=skip(7&prefix,buf,offset)}}}}(),function(){var enc=[encodings.varint,encodings.bool];function encodingLength(obj){var length=0;if(!defined(obj.index))throw new Error("index is required");var len=enc[0].encodingLength(obj.index);if(length+=1+len,defined(obj.bytes)){var len=enc[0].encodingLength(obj.bytes);length+=1+len}if(defined(obj.hash)){var len=enc[1].encodingLength(obj.hash);length+=1+len}if(defined(obj.nodes)){var len=enc[0].encodingLength(obj.nodes);length+=1+len}return length}Request.encodingLength=encodingLength,Request.encode=function encode(obj,buf,offset){offset||(offset=0);buf||(buf=Buffer.allocUnsafe(encodingLength(obj)));var oldOffset=offset;if(!defined(obj.index))throw new Error("index is required");buf[offset++]=8;enc[0].encode(obj.index,buf,offset);offset+=enc[0].encode.bytes;defined(obj.bytes)&&(buf[offset++]=16,enc[0].encode(obj.bytes,buf,offset),offset+=enc[0].encode.bytes);defined(obj.hash)&&(buf[offset++]=24,enc[1].encode(obj.hash,buf,offset),offset+=enc[1].encode.bytes);defined(obj.nodes)&&(buf[offset++]=32,enc[0].encode(obj.nodes,buf,offset),offset+=enc[0].encode.bytes);encode.bytes=offset-oldOffset;return buf},Request.decode=function decode(buf,offset,end){offset||(offset=0);end||(end=buf.length);if(!(end<=buf.length&&offset<=buf.length))throw new Error("Decoded message is not valid");var oldOffset=offset;var obj={index:0,bytes:0,hash:!1,nodes:0};var found0=!1;for(;;){if(end<=offset){if(!found0)throw new Error("Decoded message is not valid");return decode.bytes=offset-oldOffset,obj}var prefix=varint.decode(buf,offset);offset+=varint.decode.bytes;var tag=prefix>>3;switch(tag){case 1:obj.index=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes,found0=!0;break;case 2:obj.bytes=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes;break;case 3:obj.hash=enc[1].decode(buf,offset),offset+=enc[1].decode.bytes;break;case 4:obj.nodes=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes;break;default:offset=skip(7&prefix,buf,offset)}}}}(),function(){var enc=[encodings.varint,encodings.bool];function encodingLength(obj){var length=0;if(!defined(obj.index))throw new Error("index is required");var len=enc[0].encodingLength(obj.index);if(length+=1+len,defined(obj.bytes)){var len=enc[0].encodingLength(obj.bytes);length+=1+len}if(defined(obj.hash)){var len=enc[1].encodingLength(obj.hash);length+=1+len}return length}Cancel.encodingLength=encodingLength,Cancel.encode=function encode(obj,buf,offset){offset||(offset=0);buf||(buf=Buffer.allocUnsafe(encodingLength(obj)));var oldOffset=offset;if(!defined(obj.index))throw new Error("index is required");buf[offset++]=8;enc[0].encode(obj.index,buf,offset);offset+=enc[0].encode.bytes;defined(obj.bytes)&&(buf[offset++]=16,enc[0].encode(obj.bytes,buf,offset),offset+=enc[0].encode.bytes);defined(obj.hash)&&(buf[offset++]=24,enc[1].encode(obj.hash,buf,offset),offset+=enc[1].encode.bytes);encode.bytes=offset-oldOffset;return buf},Cancel.decode=function decode(buf,offset,end){offset||(offset=0);end||(end=buf.length);if(!(end<=buf.length&&offset<=buf.length))throw new Error("Decoded message is not valid");var oldOffset=offset;var obj={index:0,bytes:0,hash:!1};var found0=!1;for(;;){if(end<=offset){if(!found0)throw new Error("Decoded message is not valid");return decode.bytes=offset-oldOffset,obj}var prefix=varint.decode(buf,offset);offset+=varint.decode.bytes;var tag=prefix>>3;switch(tag){case 1:obj.index=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes,found0=!0;break;case 2:obj.bytes=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes;break;case 3:obj.hash=enc[1].decode(buf,offset),offset+=enc[1].decode.bytes;break;default:offset=skip(7&prefix,buf,offset)}}}}(),function(){var Node=Data.Node={buffer:!0,encodingLength:null,encode:null,decode:null};!function(){var enc=[encodings.varint,encodings.bytes];function encodingLength(obj){var length=0;if(!defined(obj.index))throw new Error("index is required");var len=enc[0].encodingLength(obj.index);if(length+=1+len,!defined(obj.hash))throw new Error("hash is required");var len=enc[1].encodingLength(obj.hash);if(length+=1+len,!defined(obj.size))throw new Error("size is required");var len=enc[0].encodingLength(obj.size);return length+=1+len}Node.encodingLength=encodingLength,Node.encode=function encode(obj,buf,offset){offset||(offset=0);buf||(buf=Buffer.allocUnsafe(encodingLength(obj)));var oldOffset=offset;if(!defined(obj.index))throw new Error("index is required");buf[offset++]=8;enc[0].encode(obj.index,buf,offset);offset+=enc[0].encode.bytes;if(!defined(obj.hash))throw new Error("hash is required");buf[offset++]=18;enc[1].encode(obj.hash,buf,offset);offset+=enc[1].encode.bytes;if(!defined(obj.size))throw new Error("size is required");buf[offset++]=24;enc[0].encode(obj.size,buf,offset);offset+=enc[0].encode.bytes;encode.bytes=offset-oldOffset;return buf},Node.decode=function decode(buf,offset,end){offset||(offset=0);end||(end=buf.length);if(!(end<=buf.length&&offset<=buf.length))throw new Error("Decoded message is not valid");var oldOffset=offset;var obj={index:0,hash:null,size:0};var found0=!1;var found1=!1;var found2=!1;for(;;){if(end<=offset){if(!found0||!found1||!found2)throw new Error("Decoded message is not valid");return decode.bytes=offset-oldOffset,obj}var prefix=varint.decode(buf,offset);offset+=varint.decode.bytes;var tag=prefix>>3;switch(tag){case 1:obj.index=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes,found0=!0;break;case 2:obj.hash=enc[1].decode(buf,offset),offset+=enc[1].decode.bytes,found1=!0;break;case 3:obj.size=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes,found2=!0;break;default:offset=skip(7&prefix,buf,offset)}}}}();var enc=[encodings.varint,encodings.bytes,Node];function encodingLength(obj){var length=0;if(!defined(obj.index))throw new Error("index is required");var len=enc[0].encodingLength(obj.index);if(length+=1+len,defined(obj.value)){var len=enc[1].encodingLength(obj.value);length+=1+len}if(defined(obj.nodes))for(var i=0;i<obj.nodes.length;i++)if(defined(obj.nodes[i])){var len=enc[2].encodingLength(obj.nodes[i]);length+=varint.encodingLength(len),length+=1+len}if(defined(obj.signature)){var len=enc[1].encodingLength(obj.signature);length+=1+len}return length}Data.encodingLength=encodingLength,Data.encode=function encode(obj,buf,offset){offset||(offset=0);buf||(buf=Buffer.allocUnsafe(encodingLength(obj)));var oldOffset=offset;if(!defined(obj.index))throw new Error("index is required");buf[offset++]=8;enc[0].encode(obj.index,buf,offset);offset+=enc[0].encode.bytes;defined(obj.value)&&(buf[offset++]=18,enc[1].encode(obj.value,buf,offset),offset+=enc[1].encode.bytes);if(defined(obj.nodes))for(var i=0;i<obj.nodes.length;i++)defined(obj.nodes[i])&&(buf[offset++]=26,varint.encode(enc[2].encodingLength(obj.nodes[i]),buf,offset),offset+=varint.encode.bytes,enc[2].encode(obj.nodes[i],buf,offset),offset+=enc[2].encode.bytes);defined(obj.signature)&&(buf[offset++]=34,enc[1].encode(obj.signature,buf,offset),offset+=enc[1].encode.bytes);encode.bytes=offset-oldOffset;return buf},Data.decode=function decode(buf,offset,end){offset||(offset=0);end||(end=buf.length);if(!(end<=buf.length&&offset<=buf.length))throw new Error("Decoded message is not valid");var oldOffset=offset;var obj={index:0,value:null,nodes:[],signature:null};var found0=!1;for(;;){if(end<=offset){if(!found0)throw new Error("Decoded message is not valid");return decode.bytes=offset-oldOffset,obj}var prefix=varint.decode(buf,offset);offset+=varint.decode.bytes;var tag=prefix>>3;switch(tag){case 1:obj.index=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes,found0=!0;break;case 2:obj.value=enc[1].decode(buf,offset),offset+=enc[1].decode.bytes;break;case 3:var len=varint.decode(buf,offset);offset+=varint.decode.bytes,obj.nodes.push(enc[2].decode(buf,offset,offset+len)),offset+=enc[2].decode.bytes;break;case 4:obj.signature=enc[1].decode(buf,offset),offset+=enc[1].decode.bytes;break;default:offset=skip(7&prefix,buf,offset)}}}}()}).call(this,require("buffer").Buffer)},{buffer:26,"protocol-buffers-encodings":119}],51:[function(require,module,exports){module.exports=function read(buf,offset){var b,res=0,offset=offset||0,shift=0,counter=offset,l=buf.length;do{if(counter>=l)throw read.bytes=0,new RangeError("Could not decode varint");b=buf[counter++],res+=shift<28?(b&REST)<<shift:(b&REST)*Math.pow(2,shift),shift+=7}while(b>=MSB);read.bytes=counter-offset;return res};var MSB=128,REST=127},{}],52:[function(require,module,exports){arguments[4][13][0].apply(exports,arguments)},{dup:13}],53:[function(require,module,exports){arguments[4][14][0].apply(exports,arguments)},{"./decode.js":51,"./encode.js":52,"./length.js":54,dup:14}],54:[function(require,module,exports){arguments[4][15][0].apply(exports,arguments)},{dup:15}],55:[function(require,module,exports){(function(Buffer){var low=require("last-one-wins"),remove=require("unordered-array-remove"),set=require("unordered-set"),merkle=require("merkle-tree-stream/generator"),flat=require("flat-tree"),bulk=require("bulk-write-stream"),from=require("from2"),codecs=require("codecs"),thunky=require("thunky"),batcher=require("atomic-batcher"),inherits=require("inherits"),events=require("events"),raf=require("random-access-file"),bitfield=require("./lib/bitfield"),sparseBitfield=require("sparse-bitfield"),treeIndex=require("./lib/tree-index"),storage=require("./lib/storage"),crypto=require("hypercore-crypto"),nextTick=require("process-nextick-args"),bufferFrom=require("buffer-from"),bufferAlloc=require("buffer-alloc-unsafe"),inspect=require("inspect-custom-symbol"),pretty=require("pretty-hash"),safeBufferEquals=require("./lib/safe-buffer-equals"),replicate=null;function Feed(createStorage,key,opts){if(!(this instanceof Feed))return new Feed(createStorage,key,opts);var dir;if(events.EventEmitter.call(this),"string"==typeof createStorage&&(dir=createStorage,createStorage=function(name){try{var lock="bitfield"===name?require("fd-lock"):null}catch(err){}return raf(name,{directory:dir,lock:lock})}),"function"!=typeof createStorage)throw new Error("Storage should be a function or string");"string"==typeof key&&(key=bufferFrom(key,"hex")),Buffer.isBuffer(key)||opts||(opts=key,key=null),opts||(opts={});var self=this,secretKey=opts.secretKey||null;"string"==typeof secretKey&&(secretKey=bufferFrom(secretKey,"hex")),this.id=opts.id||crypto.randomBytes(32),this.live=!1!==opts.live,this.sparse=!!opts.sparse,this.length=0,this.byteLength=0,this.maxRequests=opts.maxRequests||16,this.key=key||opts.key||null,this.discoveryKey=this.key&&crypto.discoveryKey(this.key),this.secretKey=secretKey,this.bitfield=null,this.tree=null,this.writable=!!opts.writable,this.readable=!0,this.opened=!1,this.closed=!1,this.allowPush=!!opts.allowPush,this.peers=[],this._onwrite=opts.onwrite||null,this._ready=thunky(function(cb){self._open(cb)}),this._indexing=!!opts.indexing,this._createIfMissing=!1!==opts.createIfMissing,this._overwrite=!!opts.overwrite,this._storeSecretKey=!1!==opts.storeSecretKey,this._merkle=null,this._storage=storage(createStorage,opts.storageCacheSize),this._batch=batcher(this._onwrite?function workHook(values,cb){if(!self._merkle)return self._reloadMerkleStateBeforeAppend(workHook,values,cb);self._appendHook(values,cb)}:function work(values,cb){if(!self._merkle)return self._reloadMerkleStateBeforeAppend(work,values,cb);self._append(values,cb)}),this._seq=0,this._waiting=[],this._selections=[],this._reserved=sparseBitfield(),this._synced=null,this._stats=void 0===opts.stats||opts.stats?{downloadedBlocks:0,downloadedBytes:0,uploadedBlocks:0,uploadedBytes:0}:null,this._codec=toCodec(opts.valueEncoding),this._sync=low(function(_,cb){self._syncBitfield(cb)}),this.sparse||this.download({start:0,end:-1}),this._ready(function(err){err&&self.emit("error",err)})}function noop(){}function verifyNode(trusted,node){return trusted&&trusted.index===node.index&&0===Buffer.compare(trusted.hash,node.hash)}function addSize(size,node){return size+node.size}function isBlock(index){return 0==(1&index)}function toCodec(enc){return codecs("json"===enc?"ndjson":enc)}function wrapCodec(enc,cb){return function(err,buf){if(err)return cb(err);try{buf=enc.decode(buf)}catch(err){return cb(err)}cb(null,buf)}}function timeoutCallback(cb,timeout){var failed=!1,id=setTimeout(function(){failed=!0;var err=new Error("ETIMEDOUT");err.code="ETIMEDOUT",cb(err)},timeout);return function(err,val){if(failed)return;clearTimeout(id),cb(err,val)}}function toWantRange(i){return 1024*Math.floor(i/1024/1024)*1024}function createError(code,errno,msg){var err=new Error(msg);return err.code=code,err.errno=errno,err}module.exports=Feed,inherits(Feed,events.EventEmitter),Feed.discoveryKey=crypto.discoveryKey,Feed.prototype[inspect]=function(depth,opts){var indent="";if("number"==typeof opts.indentationLvl)for(;indent.length<opts.indentationLvl;)indent+=" ";return"Hypercore(\n"+indent+"  key: "+opts.stylize(this.key&&pretty(this.key),"string")+"\n"+indent+"  discoveryKey: "+opts.stylize(this.discoveryKey&&pretty(this.discoveryKey),"string")+"\n"+indent+"  opened: "+opts.stylize(this.opened,"boolean")+"\n"+indent+"  writable: "+opts.stylize(this.writable,"boolean")+"\n"+indent+"  length: "+opts.stylize(this.length,"number")+"\n"+indent+"  byteLength: "+opts.stylize(this.byteLength,"number")+"\n"+indent+"  peers: "+opts.stylize(this.peers.length,"number")+"\n"+indent+")"},Object.defineProperty(Feed.prototype,"remoteLength",{enumerable:!0,get:function(){for(var len=0,i=0;i<this.peers.length;i++){var remoteLength=this.peers[i].remoteLength;remoteLength>len&&(len=remoteLength)}return len}}),Object.defineProperty(Feed.prototype,"stats",{enumerable:!0,get:function(){if(!this._stats)return null;for(var peerStats=[],i=0;i<this.peers.length;i++){var peer=this.peers[i];peerStats[i]=peer._stats}return{peers:peerStats,totals:this._stats}}}),Feed.prototype.replicate=function(opts){return replicate||(replicate=require("./lib/replicate")),this._selections.length&&-1===this._selections[0].end||this.sparse||opts&&opts.live||this.download({start:0,end:-1}),(opts=opts||{}).stats=!!this._stats,replicate(this,opts)},Feed.prototype.ready=function(onready){this._ready(function(err){err||onready()})},Feed.prototype.update=function(len,cb){if("function"==typeof len)return this.update(-1,len);"number"!=typeof len&&(len=-1),cb||(cb=noop);var self=this;this.ready(function(err){return err?cb(err):(-1===len&&(len=self.length+1),self.length>=len?cb(null):(self.writable&&(cb=self._writeStateReloader(cb)),self._waiting.push({hash:!0,bytes:0,index:len-1,update:!0,callback:cb}),void self._updatePeers()))})},Feed.prototype._writeStateReloader=function(cb){var self=this;return function(err){if(err)return cb(err);self._reloadMerkleState(cb)}},Feed.prototype._reloadMerkleState=function(cb){var self=this;this._roots(self.length,function(err,roots){if(err)return cb(err);self._merkle=merkle(crypto,roots),cb(null)})},Feed.prototype._reloadMerkleStateBeforeAppend=function(work,values,cb){this._reloadMerkleState(function(err){if(err)return cb(err);work(values,cb)})},Feed.prototype._open=function(cb){var self=this,generatedKey=!1;function onopen(err,state){if(err)return cb(err);if(!state.key&&state.bitfield.length&&(self._overwrite=!0),self._overwrite&&(state.bitfield=[],state.key=state.secretKey=null),self.bitfield=bitfield(state.bitfieldPageSize,state.bitfield),self.tree=treeIndex(self.bitfield.tree),self.length=self.tree.blocks(),self._seq=self.length,state.key&&self.key&&0!==Buffer.compare(state.key,self.key))return cb(new Error("Another hypercore is stored here"));if(state.key&&(self.key=state.key),state.secretKey&&(self.secretKey=state.secretKey),self.key&&self.secretKey){var challenge=bufferAlloc(0);if(!crypto.verify(challenge,crypto.sign(challenge,self.secretKey),self.key))return cb(new Error("Key and secret do not match"))}if(!self.length)return onsignature(null,null);function onsignature(_,sig){if(self.length&&(self.live=!!sig),(generatedKey||!self.key)&&!self._createIfMissing)return cb(new Error("No hypercore is stored here"));if(!self.key&&self.live){var keyPair=crypto.keyPair();self.secretKey=keyPair.secretKey,self.key=keyPair.publicKey}var writable=!!self.secretKey||null===self.key;if(!writable&&self.writable)return cb(new Error("Feed is not writable"));self.writable=writable,self.discoveryKey=self.key&&crypto.discoveryKey(self.key),self._storeSecretKey&&!self.secretKey&&(self._storeSecretKey=!1);var shouldWriteKey=generatedKey||!safeBufferEquals(self.key,state.key),shouldWriteSecretKey=self._storeSecretKey&&(generatedKey||!safeBufferEquals(self.secretKey,state.secretKey)),missing=1+(shouldWriteKey?1:0)+(shouldWriteSecretKey?1:0)+(self._overwrite?1:0),error=null;function done(err){if(err&&(error=err),!--missing)return error?cb(error):void self._roots(self.length,onroots)}function onroots(err,roots){if(err)return cb(err);self._merkle=merkle(crypto,roots),self.byteLength=roots.reduce(addSize,0),self.opened=!0,self.emit("ready"),cb(null)}shouldWriteKey&&self._storage.key.write(0,self.key,done),shouldWriteSecretKey&&self._storage.secretKey.write(0,self.secretKey,done),self._overwrite&&self._storage.bitfield.del(0,1/0,done),done(null)}self._storage.getSignature(self.length-1,onsignature)}this._storage.openKey(function(_,key){if(!key||self._overwrite||self.key||(self.key=key),!self.key&&self.live){var keyPair=crypto.keyPair();self.secretKey=keyPair.secretKey,self.key=keyPair.publicKey,generatedKey=!0}self.discoveryKey=self.key&&crypto.discoveryKey(self.key),self._storage.open({key:self.key,discoveryKey:self.discoveryKey},onopen)})},Feed.prototype.download=function(range,cb){if("function"==typeof range)return this.download(null,range);if("number"==typeof range&&(range={start:range,end:range+1}),range||(range={}),cb||(cb=noop),!this.readable)return cb(new Error("Feed is closed"));var sel={_index:this._selections.length,hash:!!range.hash,iterator:null,start:range.start||0,end:range.end||-1,want:0,linear:!!range.linear,callback:cb};return sel.want=toWantRange(sel.start),this._selections.push(sel),this._updatePeers(),sel},Feed.prototype.undownload=function(range){if("number"==typeof range&&(range={start:range,end:range+1}),range||(range={}),range.callback&&range._index>-1)return set.remove(this._selections,range),void nextTick(range.callback,createError("ECANCELED",-11,"Download was cancelled"));for(var start=range.start||0,end=range.end||-1,hash=!!range.hash,linear=!!range.linear,i=0;i<this._selections.length;i++){var s=this._selections[i];if(s.start===start&&s.end===end&&s.hash===hash&&s.linear===linear)return set.remove(this._selections,s),void nextTick(range.callback,createError("ECANCELED",-11,"Download was cancelled"))}},Feed.prototype.digest=function(index){return this.tree.digest(2*index)},Feed.prototype.proof=function(index,opts,cb){if("function"==typeof opts)return this.proof(index,null,opts);if(!this.opened)return this._readyAndProof(index,opts,cb);opts||(opts={});var proof=this.tree.proof(2*index,opts);if(!proof)return cb(new Error("No proof available for this index"));var needsSig=this.live&&!!proof.verifiedBy,pending=proof.nodes.length+(needsSig?1:0),error=null,signature=null,nodes=new Array(proof.nodes.length);if(!pending)return cb(null,{nodes:nodes,signature:null});for(var i=0;i<proof.nodes.length;i++)this._storage.getNode(proof.nodes[i],onnode);function onnode(err,node){if(err&&(error=err),node&&(nodes[proof.nodes.indexOf(node.index)]=node),!--pending)return error?cb(error):void cb(null,{nodes:nodes,signature:signature})}needsSig&&this._storage.getSignature(proof.verifiedBy/2-1,function(err,sig){sig&&(signature=sig);onnode(err,null)})},Feed.prototype._readyAndProof=function(index,opts,cb){var self=this;this._ready(function(err){if(err)return cb(err);self.proof(index,opts,cb)})},Feed.prototype.put=function(index,data,proof,cb){if(!this.opened)return this._readyAndPut(index,data,proof,cb);this._putBuffer(index,this._codec.encode(data),proof,null,cb)},Feed.prototype.cancel=function(start,end){end||(end=start+1);for(var i=this._selections.length-1;i>=0;i--){var sel=this._selections[i];start<=sel.start&&sel.end<=end&&this.undownload(sel)}this.opened?this._cancel(start,end):this._readyAndCancel(start,end)},Feed.prototype._cancel=function(start,end){var i=0;for(i=start;i<end;i++)this._reserved.set(i,!1);for(i=this._waiting.length-1;i>=0;i--){var w=this._waiting[i];(start<=w.start&&w.end<=end||start<=w.index&&w.index<end)&&(remove(this._waiting,i),w.callback&&nextTick(w.callback,new Error("Request cancelled")))}},Feed.prototype.clear=function(start,end,opts,cb){if("function"==typeof end)return this.clear(start,start+1,null,end);if("function"==typeof opts)return this.clear(start,end,null,opts);opts||(opts={}),end||(end=start+1),cb||(cb=noop);var self=this,byteOffset=0===start?0:"number"==typeof opts.byteOffset?opts.byteOffset:-1,byteLength="number"==typeof opts.byteLength?opts.byteLength:-1;this._ready(function(err){if(err)return cb(err);for(var modified=!1,i=start;i<end;i++)self.bitfield.set(i,!1)&&(modified=!0);if(!modified)return nextTick(cb);if(self._unannounce({start:start,length:end-start}),!1===opts.delete||self._indexing)return sync();if(byteOffset>-1)return onstartbytes(null,byteOffset);function sync(){self.emit("clear",start,end),self._sync(null,cb)}function onstartbytes(err,offset){return err?cb(err):(byteOffset=offset,byteLength>-1?onendbytes(null,byteLength+byteOffset):end===self.length?onendbytes(null,self.byteLength):void self._storage.dataOffset(end,[],onendbytes))}function onendbytes(err,end){return err?cb(err):self._storage.data.del?void self._storage.data.del(byteOffset,end-byteOffset,sync):sync()}self._storage.dataOffset(start,[],onstartbytes)})},Feed.prototype.signature=function(index,cb){return"function"==typeof index?this.signature(this.length-1,index):index<0||index>=this.length?cb(new Error("No signature available for this index")):void this._storage.nextSignature(index,cb)},Feed.prototype.verify=function(index,signature,cb){var self=this;this.rootHashes(index,function(err,roots){if(err)return cb(err);var checksum=crypto.tree(roots);crypto.verify(checksum,signature,self.key)?cb(null,!0):cb(new Error("Signature verification failed"))})},Feed.prototype.rootHashes=function(index,cb){this._getRootsToVerify(2*index+2,{},[],cb)},Feed.prototype.seek=function(bytes,opts,cb){if("function"==typeof opts)return this.seek(bytes,null,opts);if(opts||(opts={}),!this.opened)return this._readyAndSeek(bytes,opts,cb);var self=this;this._seek(bytes,function(err,index,offset){if(!err&&isBlock(index))return function(index,offset){for(var i=0;i<self.peers.length;i++)self.peers[i].haveBytes(bytes);cb(null,index,offset)}(index/2,offset);if(!1===opts.wait)return cb(err||new Error("Unable to seek to this offset"));var start=opts.start||0,end=opts.end||-1;if(!err){var left=flat.leftSpan(index)/2,right=flat.rightSpan(index)/2+1;left>start&&(start=left),(right<end||-1===end)&&(end=right)}if(end>-1&&end<=start)return cb(new Error("Unable to seek to this offset"));self._waiting.push({hash:!1!==opts.hash,bytes:bytes,index:-1,start:start,end:end,want:toWantRange(start),callback:cb||noop}),self._updatePeers()})},Feed.prototype._seek=function(offset,cb){if(0===offset)return cb(null,0,0);var self=this,roots=flat.fullRoots(2*this.length),nearestRoot=0;function onroot(top){if(isBlock(top))return cb(null,top,offset);for(var left=flat.leftChild(top);!self.tree.get(left);){if(isBlock(left))return cb(null,nearestRoot,offset);left=flat.leftChild(left)}self._storage.getNode(left,onleftchild)}function onleftchild(err,node){if(err)return cb(err);node.size>offset?(nearestRoot=node.index,onroot(node.index)):(offset-=node.size,onroot(flat.sibling(node.index)))}!function loop(err,node){if(err)return cb(err);if(node){if(node.size>offset)return nearestRoot=node.index,onroot(node.index);offset-=node.size}if(!roots.length)return cb(new Error("Out of bounds"));self._storage.getNode(roots.shift(),loop)}(null,null)},Feed.prototype._readyAndSeek=function(bytes,opts,cb){var self=this;this._ready(function(err){if(err)return cb(err);self.seek(bytes,opts,cb)})},Feed.prototype._getBuffer=function(index,cb){this._storage.getData(index,cb)},Feed.prototype._putBuffer=function(index,data,proof,from,cb){for(var self=this,trusted=-1,missing=[],next=2*index,i=data?0:1;;){if(this.tree.get(next)){trusted=next;break}var sib=flat.sibling(next);if(next=flat.parent(next),i<proof.nodes.length&&proof.nodes[i].index===sib)i++;else{if(!this.tree.get(sib))break;missing.push(sib)}}-1===trusted&&this.tree.get(next)&&(trusted=next);var error=null,trustedNode=null,missingNodes=new Array(missing.length),pending=missing.length+(trusted>-1?1:0);for(i=0;i<missing.length;i++)this._storage.getNode(missing[i],onmissing);function onmissing(err,node){err&&(error=err),node&&(missingNodes[missing.indexOf(node.index)]=node),--pending||onmissingloaded(error)}function onmissingloaded(err){if(err)return cb(err);self._verifyAndWrite(index,data,proof,missingNodes,trustedNode,from,cb)}trusted>-1&&this._storage.getNode(trusted,function(err,node){err&&(error=err);node&&(trustedNode=node);--pending||onmissingloaded(error)}),missing.length||-1!==trusted||onmissingloaded(null)},Feed.prototype._readyAndPut=function(index,data,proof,cb){var self=this;this._ready(function(err){if(err)return cb(err);self.put(index,data,proof,cb)})},Feed.prototype._write=function(index,data,nodes,sig,from,cb){if(!this._onwrite)return this._writeAfterHook(index,data,nodes,sig,from,cb);this._onwrite(index,data,from,function(self,index,data,nodes,sig,from,cb){return function(err){if(err)return cb(err);self._writeAfterHook(index,data,nodes,sig,from,cb)}}(this,index,data,nodes,sig,from,cb))},Feed.prototype._writeAfterHook=function(index,data,nodes,sig,from,cb){for(var self=this,pending=nodes.length+1+(sig?1:0),error=null,i=0;i<nodes.length;i++)this._storage.putNode(nodes[i].index,nodes[i],ondone);function ondone(err){if(err&&(error=err),!--pending)return error?cb(error):void self._writeDone(index,data,nodes,from,cb)}data?this._storage.putData(index,data,nodes,ondone):ondone(),sig&&this._storage.putSignature(sig.index,sig.signature,ondone)},Feed.prototype._writeDone=function(index,data,nodes,from,cb){for(var i=0;i<nodes.length;i++)this.tree.set(nodes[i].index);this.tree.set(2*index),data&&(this.bitfield.set(index,!0)&&(this._stats&&(this._stats.downloadedBlocks+=1,this._stats.downloadedBytes+=data.length),this.emit("download",index,data,from)),this.peers.length&&this._announce({start:index},from),this.writable||(this._synced||(this._synced=this.bitfield.iterator(0,this.length)),-1===this._synced.next()&&(this._synced.range(0,this.length),this._synced.seek(0),-1===this._synced.next()&&this.emit("sync")))),this._sync(null,cb)},Feed.prototype._verifyAndWrite=function(index,data,proof,localNodes,trustedNode,from,cb){var visited=[],remoteNodes=proof.nodes,top=data?new storage.Node(2*index,crypto.data(data),data.length):remoteNodes.shift();if(verifyNode(trustedNode,top))this._write(index,data,visited,null,from,cb);else for(;;){var node=null,next=flat.sibling(top.index);if(remoteNodes.length&&remoteNodes[0].index===next)node=remoteNodes.shift(),visited.push(node);else{if(!localNodes.length||localNodes[0].index!==next)return void this._verifyRootsAndWrite(index,data,top,proof,visited,from,cb);node=localNodes.shift()}if(visited.push(top),verifyNode(trustedNode,top=new storage.Node(flat.parent(top.index),crypto.parent(top,node),top.size+node.size)))return void this._write(index,data,visited,null,from,cb)}},Feed.prototype._verifyRootsAndWrite=function(index,data,top,proof,nodes,from,cb){var remoteNodes=proof.nodes,lastNode=remoteNodes.length?remoteNodes[remoteNodes.length-1].index:top.index,verifiedBy=Math.max(flat.rightSpan(top.index),flat.rightSpan(lastNode))+2,self=this;this._getRootsToVerify(verifiedBy,top,remoteNodes,function(err,roots,extraNodes){if(err)return cb(err);var checksum=crypto.tree(roots),signature=null;if(self.length&&self.live&&!proof.signature)return cb(new Error("Remote did not include a signature"));if(proof.signature){if(!crypto.verify(checksum,proof.signature,self.key))return cb(new Error("Remote signature could not be verified"));signature={index:verifiedBy/2-1,signature:proof.signature}}else if(0!==Buffer.compare(checksum,self.key))return cb(new Error("Remote checksum failed"));self.live=!!signature;var length=verifiedBy/2;length>self.length&&(self.writable&&(self._merkle=null),self.length=length,self._seq=length,self.byteLength=roots.reduce(addSize,0),self._synced&&self._synced.seek(0,self.length),self.emit("append")),self._write(index,data,nodes.concat(extraNodes),signature,from,cb)})},Feed.prototype._getRootsToVerify=function(verifiedBy,top,remoteNodes,cb){for(var indexes=flat.fullRoots(verifiedBy),roots=new Array(indexes.length),nodes=[],error=null,pending=roots.length,i=0;i<indexes.length;i++)indexes[i]===top.index?(nodes.push(top),onnode(null,top)):remoteNodes.length&&indexes[i]===remoteNodes[0].index?(nodes.push(remoteNodes[0]),onnode(null,remoteNodes.shift())):this.tree.get(indexes[i])?this._storage.getNode(indexes[i],onnode):onnode(new Error("Missing tree roots needed for verify"));function onnode(err,node){err&&(error=err),node&&(roots[indexes.indexOf(node.index)]=node),--pending||function(err){if(err)return cb(err);cb(null,roots,nodes)}(error)}},Feed.prototype._announce=function(message,from){for(var i=0;i<this.peers.length;i++){var peer=this.peers[i];peer!==from&&peer.have(message)}},Feed.prototype._unannounce=function(message){for(var i=0;i<this.peers.length;i++)this.peers[i].unhave(message)},Feed.prototype.downloaded=function(start,end){return this.bitfield.total(start,end)},Feed.prototype.has=function(start,end){return void 0===end?this.bitfield.get(start):end-start===this.bitfield.total(start,end)},Feed.prototype.head=function(opts,cb){if("function"==typeof opts)return this.head({},opts);var self=this;this._ready(function(err){if(err)return cb(err);0===self.length?cb(new Error("feed is empty")):self.get(self.length-1,cb)})},Feed.prototype.get=function(index,opts,cb){return"function"==typeof opts?this.get(index,null,opts):this.opened?this.readable?(opts&&opts.timeout&&(cb=timeoutCallback(cb,opts.timeout)),this.bitfield.get(index)?(opts&&opts.valueEncoding?cb=wrapCodec(toCodec(opts.valueEncoding),cb):this._codec!==codecs.binary&&(cb=wrapCodec(this._codec,cb)),void this._getBuffer(index,cb)):opts&&!1===opts.wait?cb(new Error("Block not downloaded")):(this._waiting.push({bytes:0,hash:!1,index:index,options:opts,callback:cb}),void this._updatePeers())):cb(new Error("Feed is closed")):this._readyAndGet(index,opts,cb)},Feed.prototype._readyAndGet=function(index,opts,cb){var self=this;this._ready(function(err){if(err)return cb(err);self.get(index,opts,cb)})},Feed.prototype.getBatch=function(start,end,opts,cb){if("function"==typeof opts)return this.getBatch(start,end,null,opts);if(!this.opened)return this._readyAndGetBatch(start,end,opts,cb);var self=this,wait=!opts||!1!==opts.wait;return this.has(start,end)?this._getBatch(start,end,opts,cb):wait?(opts&&opts.timeout&&(cb=timeoutCallback(cb,opts.timeout)),void this.download({start:start,end:end},function(err){if(err)return cb(err);self._getBatch(start,end,opts,cb)})):cb(new Error("Block not downloaded"))},Feed.prototype._getBatch=function(start,end,opts,cb){var enc=opts&&opts.valueEncoding,codec=enc?toCodec(enc):this._codec;this._storage.getDataBatch(start,end-start,function(err,buffers){if(err)return cb(err);for(var batch=new Array(buffers.length),i=0;i<buffers.length;i++)try{batch[i]=codec?codec.decode(buffers[i]):buffers[i]}catch(err){return cb(err)}cb(null,batch)})},Feed.prototype._readyAndGetBatch=function(start,end,opts,cb){var self=this;this._ready(function(err){if(err)return cb(err);self.getBatch(start,end,opts,cb)})},Feed.prototype._updatePeers=function(){for(var i=0;i<this.peers.length;i++)this.peers[i].update()},Feed.prototype.createWriteStream=function(){var self=this;return bulk.obj(function(batch,cb){self.append(batch,cb)})},Feed.prototype.createReadStream=function(opts){opts||(opts={});var self=this,start=opts.start||0,end="number"==typeof opts.end?opts.end:-1,live=!!opts.live,snapshot=!1!==opts.snapshot,first=!0,range=this.download({start:start,end:end,linear:!0});return from.obj(read).on("end",cleanup).on("close",cleanup);function read(size,cb){if(!self.opened)return function(size,cb){self._ready(function(err){if(err)return cb(err);read(size,cb)})}(size,cb);if(!self.readable)return cb(new Error("Feed is closed"));if(first){if(-1===end&&(live?end=1/0:snapshot&&(end=self.length),start>end))return cb(null,null);opts.tail&&(start=self.length),first=!1}if(start===end||-1===end&&start===self.length)return cb(null,null);range.start++,range.iterator&&range.iterator.start++,self.get(start++,opts,cb)}function cleanup(){range&&(self.undownload(range),range=null)}},Feed.prototype.finalize=function(cb){this.key||(this.key=crypto.tree(this._merkle.roots),this.discoveryKey=crypto.discoveryKey(this.key)),this._storage.key.write(0,this.key,cb)},Feed.prototype.append=function(batch,cb){cb||(cb=noop);var self=this,list=Array.isArray(batch)?batch:[batch];this._batch(list,function(err){if(err)return cb(err);var seq=self._seq;self._seq+=list.length,cb(null,seq)})},Feed.prototype.flush=function(cb){this.append([],cb)},Feed.prototype.close=function(cb){var self=this;this._ready(function(){self.writable=!1,self.readable=!1,self._storage.close(function(err){self.closed||err||self._onclose(),cb&&cb(err)})})},Feed.prototype._onclose=function(){for(this.closed=!0;this._waiting.length;)this._waiting.pop().callback(new Error("Feed is closed"));for(;this._selections.length;)this._selections.pop().callback(new Error("Feed is closed"));this.emit("close")},Feed.prototype._appendHook=function(batch,cb){var self=this,missing=batch.length,error=null;if(!missing)return this._append(batch,cb);for(var i=0;i<batch.length;i++)this._onwrite(i+this.length,batch[i],null,done);function done(err){if(err&&(error=err),!--missing)return error?cb(error):void self._append(batch,cb)}},Feed.prototype._append=function(batch,cb){if(!this.opened)return this._readyAndAppend(batch,cb);if(!this.writable)return cb(new Error("This feed is not writable. Did you create it?"));var self=this,pending=1,offset=0,error=null,nodeBatch=new Array(batch.length?2*batch.length-1:0),nodeOffset=2*this.length,dataBatch=new Array(batch.length);if(!pending)return cb();for(var i=0;i<batch.length;i++){var data=this._codec.encode(batch[i]),nodes=this._merkle.next(data);if(this.live&&i===batch.length-1){pending++;var sig=crypto.sign(crypto.tree(this._merkle.roots),this.secretKey);this._storage.putSignature(this.length+i,sig,done)}offset+=data.length,dataBatch[i]=data;for(var j=0;j<nodes.length;j++){var node=nodes[j];node.index>=nodeOffset&&node.index-nodeOffset<nodeBatch.length?nodeBatch[node.index-nodeOffset]=node:(pending++,this._storage.putNode(node.index,node,done))}}function done(err){if(err&&(error=err),!--pending){if(error)return cb(error);var start=self.length;self.byteLength+=offset;for(var i=0;i<batch.length;i++)self.bitfield.set(self.length,!0),self.tree.set(2*self.length++);self.emit("append");var message=self.length-start>1?{start:start,length:self.length-start}:{start:start};self.peers.length&&self._announce(message),self._sync(null,cb)}}this._indexing||(pending++,1===dataBatch.length?this._storage.data.write(this.byteLength,dataBatch[0],done):this._storage.data.write(this.byteLength,Buffer.concat(dataBatch),done)),this._storage.putNodeBatch(nodeOffset,nodeBatch,done)},Feed.prototype._readyAndAppend=function(batch,cb){var self=this;this._ready(function(err){if(err)return cb(err);self._append(batch,cb)})},Feed.prototype._readyAndCancel=function(start,end){var self=this;this.ready(function(){self._cancel(start,end)})},Feed.prototype._pollWaiting=function(){for(var len=this._waiting.length,i=0;i<len;i++){var next=this._waiting[i];(next.bytes||this.bitfield.get(next.index))&&(remove(this._waiting,i--),len--,next.bytes?this.seek(next.bytes,next,next.callback):next.update?this.update(next.index+1,next.callback):this.get(next.index,next.options,next.callback))}},Feed.prototype._syncBitfield=function(cb){var missing=this.bitfield.pages.updates.length,next=null,error=null;if(!missing)return this._pollWaiting(),cb(null);for(;null!==(next=this.bitfield.pages.lastUpdate());)this._storage.putBitfield(next.offset,next.buffer,ondone);function ondone(err){err&&(error=err),--missing||cb(error)}this._pollWaiting()},Feed.prototype._roots=function(index,cb){var roots=flat.fullRoots(2*index),result=new Array(roots.length),pending=roots.length,error=null;if(!pending)return cb(null,result);for(var i=0;i<roots.length;i++)this._storage.getNode(roots[i],onnode);function onnode(err,node){if(err&&(error=err),node&&(result[roots.indexOf(node.index)]=node),!--pending)return error?cb(error):void cb(null,result)}},Feed.prototype.audit=function(cb){cb||(cb=noop);var self=this,report={valid:0,invalid:0};this.ready(function(err){if(err)return cb(err);var block=0,max=self.length;function onnode(err,node){if(err)return ondata(null,null);function ondata(_,data){var verified=data&&crypto.data(data).equals(node.hash);verified?report.valid++:report.invalid++,self.bitfield.set(block,verified),block++,next()}self._storage.getData(block,ondata)}function next(){for(;block<max&&!self.bitfield.get(block);)block++;block>=max?self._sync(null,function(err){if(err)return cb(err);cb(null,report)}):self._storage.getNode(2*block,onnode)}next()})}}).call(this,require("buffer").Buffer)},{"./lib/bitfield":56,"./lib/replicate":57,"./lib/safe-buffer-equals":58,"./lib/storage":59,"./lib/tree-index":60,"atomic-batcher":9,buffer:26,"buffer-alloc-unsafe":22,"buffer-from":25,"bulk-write-stream":27,codecs:28,events:21,"fd-lock":19,"flat-tree":44,from2:45,"hypercore-crypto":47,inherits:92,"inspect-custom-symbol":93,"last-one-wins":97,"merkle-tree-stream/generator":106,"pretty-hash":116,"process-nextick-args":61,"random-access-file":126,"sparse-bitfield":170,thunky:62,"unordered-array-remove":177,"unordered-set":63}],56:[function(require,module,exports){(function(Buffer){for(var flat=require("flat-tree"),rle=require("bitfield-rle"),pager=require("memory-pager"),bitfield=require("sparse-bitfield"),allocUnsafe=require("buffer-alloc-unsafe"),INDEX_UPDATE_MASK=[63,207,243,252],INDEX_ITERATE_MASK=[0,192,240,252],DATA_ITERATE_MASK=[128,192,224,240,248,252,254,255],DATA_UPDATE_MASK=[127,191,223,239,247,251,253,254],MAP_PARENT_RIGHT=new Array(256),MAP_PARENT_LEFT=new Array(256),NEXT_DATA_0_BIT=new Array(256),NEXT_INDEX_0_BIT=new Array(256),TOTAL_1_BITS=new Array(256),i=0;i<256;i++){var a=(240&i)>>4,b=15&i,nibble=[0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,4];MAP_PARENT_RIGHT[i]=(15===a?3:0===a?0:1)<<2|(15===b?3:0===b?0:1),MAP_PARENT_LEFT[i]=MAP_PARENT_RIGHT[i]<<4,NEXT_DATA_0_BIT[i]=255===i?-1:8-Math.ceil(Math.log(256-i)/Math.log(2)),NEXT_INDEX_0_BIT[i]=255===i?-1:Math.floor(NEXT_DATA_0_BIT[i]/2),TOTAL_1_BITS[i]=nibble[i>>4]+nibble[15&i]}function Bitfield(pageSize,pages){if(!(this instanceof Bitfield))return new Bitfield(pageSize,pages);pageSize||(pageSize=3584);var deduplicate=allocUnsafe(pageSize);if(deduplicate.fill(255),this.indexSize=pageSize-2048-1024,this.pages=pager(pageSize,{deduplicate:deduplicate}),pages)for(var i=0;i<pages.length;i++)this.pages.set(i,pages[i]);this.data=bitfield({pageSize:1024,pageOffset:0,pages:this.pages,trackUpdates:!0}),this.tree=bitfield({pageSize:2048,pageOffset:1024,pages:this.pages,trackUpdates:!0}),this.index=bitfield({pageSize:this.indexSize,pageOffset:3072,pages:this.pages,trackUpdates:!0}),this.length=this.data.length,this._iterator=flat.iterator(0)}function setByteNoAlloc(bitfield,i,b){return!(8*i>=bitfield.length)&&bitfield.setByte(i,b)}function Iterator(bitfield){this.start=0,this.end=0,this._indexEnd=0,this._pos=0,this._byte=0,this._bitfield=bitfield}function rightSpan(ite){return ite.index+ite.factor/2-1}function isParent(ite){return 1&ite.index}module.exports=Bitfield,Bitfield.prototype.set=function(i,value){var o=7&i;i=(i-o)/8;var v=value?this.data.getByte(i)|128>>o:this.data.getByte(i)&DATA_UPDATE_MASK[o];return!!this.data.setByte(i,v)&&(this.length=this.data.length,this._setIndex(i,v),!0)},Bitfield.prototype.get=function(i){return this.data.get(i)},Bitfield.prototype.total=function(start,end){if((!start||start<0)&&(start=0),end||(end=this.data.length),end<start)return 0;end>this.data.length&&this._expand(end);var o=7&start,e=7&end,pos=(start-o)/8,last=(end-e)/8,leftMask=255-(o?DATA_ITERATE_MASK[o-1]:0),rightMask=e?DATA_ITERATE_MASK[e-1]:0,byte=this.data.getByte(pos);if(pos===last)return TOTAL_1_BITS[byte&leftMask&rightMask];for(var total=TOTAL_1_BITS[byte&leftMask],i=pos+1;i<last;i++)total+=TOTAL_1_BITS[this.data.getByte(i)];return total+=TOTAL_1_BITS[this.data.getByte(last)&rightMask]},Bitfield.prototype.compress=function(start,length){if(!start&&!length)return rle.encode(this.data.toBuffer());for(var buf=Buffer.alloc(length),p=start/this.data.pageSize/8,end=p+length/this.data.pageSize/8,offset=p*this.data.pageSize;p<end;p++){var page=this.data.pages.get(p,!0);page&&page.buffer&&page.buffer.copy(buf,p*this.data.pageSize-offset,this.data.pageOffset,this.data.pageOffset+this.data.pageSize)}return rle.encode(buf)},Bitfield.prototype._setIndex=function(i,value){var o=3&i;i=(i-o)/4;var bitfield=this.index,ite=this._iterator,start=2*i,byte=bitfield.getByte(start)&INDEX_UPDATE_MASK[o]|function(n){switch(n){case 255:return 192;case 0:return 0;default:return 64}}(value)>>2*o,len=bitfield.length,maxLength=this.pages.length*this.indexSize;for(ite.seek(start);ite.index<maxLength&&bitfield.setByte(ite.index,byte);)byte=ite.isLeft()?MAP_PARENT_LEFT[byte]|MAP_PARENT_RIGHT[bitfield.getByte(ite.sibling())]:MAP_PARENT_RIGHT[byte]|MAP_PARENT_LEFT[bitfield.getByte(ite.sibling())],ite.parent();return len!==bitfield.length&&this._expand(len),ite.index!==start},Bitfield.prototype._expand=function(len){for(var roots=flat.fullRoots(2*len),bitfield=this.index,ite=this._iterator,byte=0,i=0;i<roots.length;i++){ite.seek(roots[i]),byte=bitfield.getByte(ite.index);do{byte=ite.isLeft()?MAP_PARENT_LEFT[byte]|MAP_PARENT_RIGHT[bitfield.getByte(ite.sibling())]:MAP_PARENT_RIGHT[byte]|MAP_PARENT_LEFT[bitfield.getByte(ite.sibling())]}while(setByteNoAlloc(bitfield,ite.parent(),byte))}},Bitfield.prototype.iterator=function(start,end){var ite=new Iterator(this);return ite.range(start||0,end||this.length),ite.seek(0),ite},Iterator.prototype.range=function(start,end){return this.start=start,this.end=end,this._indexEnd=2*Math.ceil(end/32),this.end>this._bitfield.length&&this._bitfield._expand(this.end),this},Iterator.prototype.seek=function(offset){if((offset+=this.start)<this.start&&(offset=this.start),offset>=this.end)return this._pos=-1,this;var o=7&offset;return this._pos=(offset-o)/8,this._byte=this._bitfield.data.getByte(this._pos)|(o?DATA_ITERATE_MASK[o-1]:0),this},Iterator.prototype.random=function(){var i=this.seek(Math.floor(Math.random()*(this.end-this.start))).next();return-1===i?this.seek(0).next():i},Iterator.prototype.next=function(){if(-1===this._pos)return-1;for(var dataBitfield=this._bitfield.data,free=NEXT_DATA_0_BIT[this._byte];-1===free;)if(this._byte=dataBitfield.getByte(++this._pos),-1===(free=NEXT_DATA_0_BIT[this._byte])){if(this._pos=this._skipAhead(this._pos),-1===this._pos)return-1;this._byte=dataBitfield.getByte(this._pos),free=NEXT_DATA_0_BIT[this._byte]}this._byte|=DATA_ITERATE_MASK[free];var n=8*this._pos+free;return n<this.end?n:-1},Iterator.prototype.peek=function(){if(-1===this._pos)return-1;var free=NEXT_DATA_0_BIT[this._byte],n=8*this._pos+free;return n<this.end?n:-1},Iterator.prototype._skipAhead=function(start){var indexBitfield=this._bitfield.index,treeEnd=this._indexEnd,ite=this._bitfield._iterator,o=3&start;ite.seek((start-o)/4*2);for(var treeByte=indexBitfield.getByte(ite.index)|INDEX_ITERATE_MASK[o];-1===NEXT_INDEX_0_BIT[treeByte];){if(ite.isLeft()?ite.next():(ite.next(),ite.parent()),rightSpan(ite)>=treeEnd){for(;rightSpan(ite)>=treeEnd&&isParent(ite);)ite.leftChild();if(rightSpan(ite)>=treeEnd)return-1}treeByte=indexBitfield.getByte(ite.index)}for(;ite.factor>2;)NEXT_INDEX_0_BIT[treeByte]<2?ite.leftChild():ite.rightChild(),treeByte=indexBitfield.getByte(ite.index);var free=NEXT_INDEX_0_BIT[treeByte];-1===free&&(free=4);var next=2*ite.index+free;return next<=start?start+1:next}}).call(this,require("buffer").Buffer)},{"bitfield-rle":11,buffer:26,"buffer-alloc-unsafe":22,"flat-tree":44,"memory-pager":105,"sparse-bitfield":170}],57:[function(require,module,exports){var protocol=require("hypercore-protocol"),bitfield=require("fast-bitfield"),set=require("unordered-set"),rle=require("bitfield-rle").align(4),safeBufferEquals=require("./safe-buffer-equals"),treeIndex=require("./tree-index"),EMPTY=new Uint8Array(1024);function Peer(feed,opts){this.feed=feed,this.stream=null,this.remoteId=null,this.wants=bitfield(),this.remoteBitfield=bitfield(),this.remoteLength=0,this.remoteWant=!1,this.remoteTree=null,this.live=!!opts.live,this.sparse=feed.sparse,this.remoteDownloading=!0,this.downloading="boolean"==typeof opts.download?opts.download:!feed.writable,this.uploading=!0,this.maxRequests=opts.maxRequests||feed.maxRequests||16,this.inflightRequests=[],this.inflightWants=0,this._index=-1,this._lastBytes=0,this._first=!0,this._closed=!1,this._destroyed=!1,this._defaultDownloading=this.downloading,this._iterator=this.remoteBitfield.iterator(),this._stats=opts.stats?{uploadedBytes:0,uploadedBlocks:0,downloadedBytes:0,downloadedBlocks:0}:null}function createView(page){var buf=page?page.buffer:EMPTY;return new DataView(buf.buffer,buf.byteOffset,1024)}module.exports=function(feed,opts){var stream=opts.stream;stream||(opts.expectedFeeds||(opts.expectedFeeds=1),opts.id||(opts.id=feed.id),stream=protocol(opts));return feed.ready(function(err){if(err)return stream.destroy(err);if(!stream.destroyed){var peer=new Peer(feed,opts);peer.feed=feed,peer.stream=stream.feed(feed.key,{peer:peer}),peer.remoteId=stream.remoteId,stream.setMaxListeners(0),stream.on("handshake",function(){safeBufferEquals(peer.remoteId,stream.remoteId)||(peer.remoteId=stream.remoteId,triggerReady()||peer.feed.emit("remote-update",peer))});var firstTime=!0;triggerReady()}function triggerReady(){return!(!firstTime||!peer.remoteId||(firstTime=!1,stream.destroyed||(peer.ready(),0)))}}),stream},Peer.prototype.onwant=function(want){if(!(8191&want.start||8191&want.length)){!this.remoteWant&&this.feed.length&&this.feed.bitfield.get(this.feed.length-1)&&this.stream.have({start:this.feed.length-1}),this.remoteWant=!0;var rle=this.feed.bitfield.compress(want.start,want.length);this.stream.have({start:want.start,length:want.length,bitfield:rle})}},Peer.prototype.ondata=function(data){var self=this;if(!(this.feed.allowPush||!data.value)&&!this.feed._reserved.get(data.index))return self.feed.bitfield.get(data.index)||self.unhave({start:data.index}),void self._clear(data.index,!data.value);this.feed._putBuffer(data.index,data.value,data,this,function(err){if(err)return self.destroy(err);data.value&&self.remoteBitfield.set(data.index,!1),self._stats&&data.value&&(self._stats.downloadedBlocks+=1,self._stats.downloadedBytes+=data.value.length),self._clear(data.index,!data.value)})},Peer.prototype._clear=function(index,hash){for(var i=0;i<this.inflightRequests.length;i++)this.inflightRequests[i].index===index&&(this.inflightRequests.splice(i,1),i--);this.feed._reserved.set(index,!1),this.feed._updatePeers()},Peer.prototype.onrequest=function(request){if(request.bytes)return this._onbytes(request);this.remoteTree||(this.remoteTree=treeIndex());var self=this,opts={digest:request.nodes,hash:request.hash,tree:this.remoteTree};this.feed.proof(request.index,opts,function(err,proof){if(err)return self.destroy(err);request.hash?onvalue(null,null):self.feed.bitfield.get(request.index)&&self.feed._getBuffer(request.index,onvalue);function onvalue(err,value){if(err)return self.destroy(err);value&&(self._stats&&(self._stats.uploadedBlocks+=1,self._stats.uploadedBytes+=value.length,self.feed._stats.uploadedBlocks+=1,self.feed._stats.uploadedBytes+=value.length),self.feed.emit("upload",request.index,value,self)),request.index+1>self.remoteLength&&(self.remoteLength=request.index+1,self._updateEnd()),self.stream.data({index:request.index,value:value,nodes:proof.nodes,signature:proof.signature})}})},Peer.prototype._onbytes=function(request){var self=this;this.feed.seek(request.bytes,{wait:!1},function(err,index){if(err)return request.bytes=0,void self.onrequest(request);self._lastBytes!==request.bytes&&(self._lastBytes=request.bytes,request.bytes=0,request.index=index,request.nodes=0,self.onrequest(request))})},Peer.prototype.ontick=function(){if(this.inflightRequests.length){var first=this.inflightRequests[0];if(!--first.tick)return(first.hash?this.feed.tree.get(2*first.index):this.feed.bitfield.get(first.index))?(this.inflightRequests.shift(),void this.feed._reserved.set(first.index,!1)):void this.destroy(new Error("Request timeout"))}},Peer.prototype.onhave=function(have){var updated=this._first;if(this._first&&(this._first=!1),1048576===have.length&&this.inflightWants--,have.bitfield){0!==have.length&&1!==have.length||(this.wants=null);var buf=rle.decode(have.bitfield),bits=8*buf.length;!function(local,buf,le,start){for(var remote=new DataView(buf.buffer,buf.byteOffset),len=Math.floor(buf.length/4),arr=new Uint32Array(buf.buffer,buf.byteOffset,len),p=start/8192,l=0,page=createView(local.pages.get(p++,!0)),i=0;i<len;i++)arr[i]=remote.getUint32(4*i,!le)&~page.getUint32(4*l++,!le),256===l&&(page=createView(local.pages.get(p++,!0)),l=0)}(this.feed.bitfield,buf,this.remoteBitfield.littleEndian,have.start),this.remoteBitfield.fill(buf,have.start),bits>this.remoteLength&&(this.remoteLength=this.remoteBitfield.last()+1,updated=!0)}else{for(var start=have.start,len=have.length||1;len--;)this.remoteBitfield.set(start,!this.feed.bitfield.get(start++));start>this.remoteLength&&(this.remoteLength=start,updated=!0)}updated&&this.feed.emit("remote-update",this),this._updateEnd(),this.update()},Peer.prototype._updateEnd=function(){if(!this.live&&!this.feed.sparse&&this.feed._selections.length){for(var sel=this.feed._selections[0],remoteLength=this.feed.length||-1,i=0;i<this.feed.peers.length;i++)this.feed.peers[i].remoteLength>remoteLength&&(remoteLength=this.feed.peers[i].remoteLength);sel.end=remoteLength}},Peer.prototype.oninfo=function(info){this.remoteDownloading=info.downloading,info.downloading||this.live||(this.update(),this.feed._selections.length&&this.downloading||this.end())},Peer.prototype.onunhave=function(unhave){for(var start=unhave.start,len=unhave.length||1;len--;)this.remoteBitfield.set(start++,!1)},Peer.prototype.onunwant=Peer.prototype.oncancel=function(){},Peer.prototype.onclose=function(){this.destroy()},Peer.prototype.have=function(have){this.stream&&this.remoteWant&&this.stream.have(have);for(var start=have.start,len=have.length;len--;)this.remoteBitfield.set(start++,!1)},Peer.prototype.unhave=function(unhave){this.stream&&this.remoteWant&&this.stream.unhave(unhave)},Peer.prototype.haveBytes=function(bytes){for(var i=0;i<this.inflightRequests.length;i++)this.inflightRequests[i].bytes===bytes&&(this.feed._reserved.set(this.inflightRequests[i].index,!1),this.inflightRequests.splice(i,1),i--);this.update()},Peer.prototype.update=function(){for(;this._update(););this._sendWantsMaybe()},Peer.prototype._update=function(){if(!this.downloading)return!1;for(var selections=this.feed._selections,waiting=this.feed._waiting,wlen=waiting.length,slen=selections.length,inflight=this.inflightRequests.length,offset=0,i=0;inflight<this.maxRequests;){for(offset=Math.floor(Math.random()*waiting.length),i=0;i<waiting.length;i++){var w=waiting[offset++];if(offset===waiting.length&&(offset=0),this._downloadWaiting(w),waiting.length!==wlen)return!0;if(this.inflightRequests.length>=this.maxRequests)return!1}if(inflight===this.inflightRequests.length)break;inflight=this.inflightRequests.length}for(;inflight<this.maxRequests;){for(offset=Math.floor(Math.random()*selections.length),i=0;i<selections.length;i++){var s=selections[offset++];if(offset===selections.length&&(offset=0),s.iterator||(s.iterator=this.feed.bitfield.iterator(s.start,s.end)),this._downloadRange(s),selections.length!==slen)return!0;if(this.inflightRequests.length>=this.maxRequests)return!1}if(inflight===this.inflightRequests.length)return!1;inflight=this.inflightRequests.length}return!1},Peer.prototype.ready=function(){set.add(this.feed.peers,this),this._sendWants(),this.feed.emit("peer-add",this)},Peer.prototype.end=function(){if(!this.downloading&&!this.remoteDownloading&&!this.live)return this._defaultDownloading||this.stream.info({downloading:!1,uploading:!1}),void this._close();this._closed?this.live||this._close():(this._closed=!0,this.downloading=!1,this.stream.info({downloading:!1,uploading:!0}))},Peer.prototype._close=function(){if(-1!==this._index){this._destroyed||(this.stream.close(),this._destroyed=!0),set.remove(this.feed.peers,this),this._index=-1;for(var i=0;i<this.inflightRequests.length;i++)this.feed._reserved.set(this.inflightRequests[i].index,!1);this._updateEnd(),this.remoteWant=!1,this.feed._updatePeers(),this.feed.emit("peer-remove",this)}},Peer.prototype.destroy=function(err){-1===this._index||this._destroyed||(this.stream.destroy(err),this._destroyed=!0,this._close())},Peer.prototype._sendWantsMaybe=function(){this.inflightRequests.length<this.maxRequests&&this._sendWants()},Peer.prototype._sendWants=function(){if(this.wants&&this.downloading&&!(this.inflightWants>=16)){var i;for(i=0;i<this.feed._waiting.length;i++){var w=this.feed._waiting[i];if(-1===w.index?this._sendWantRange(w):this._sendWant(w.index),this.inflightWants>=16)return}for(i=0;i<this.feed._selections.length;i++){var s=this.feed._selections[i];if(this._sendWantRange(s),this.inflightWants>=16)return}this._sendWant(0)}},Peer.prototype._sendWantRange=function(s){for(var want=0;;){if(want>=this.remoteLength)return;if(-1!==s.end&&want>=s.end)return;if(this._sendWant(want))return;if(!this.wants.get(Math.floor(want/1024/1024)))return;want+=1048576}},Peer.prototype._sendWant=function(index){var j=Math.floor(index/1048576);return!this.wants.get(j)&&(this.wants.set(j,!0),this.inflightWants++,this.stream.want({start:1048576*j,length:1048576}),!0)},Peer.prototype._downloadWaiting=function(wait){if(wait.bytes)this._downloadRange(wait);else{if(!this.remoteBitfield.get(wait.index)||!this.feed._reserved.set(wait.index,!0))return;this._request(wait.index,0,!1)}},Peer.prototype._downloadRange=function(range){range.iterator||(range.iterator=this.feed.bitfield.iterator(range.start,range.end));var reserved=this.feed._reserved,ite=this._iterator,wantedEnd=Math.min(-1===range.end?this.remoteLength:range.end,this.remoteLength),i=range.linear?ite.seek(range.start).next(!0):function(ite,start,end){var len=end-start,i=ite.seek(Math.floor(Math.random()*len)+start).next(!0);return-1===i||i>=end?ite.seek(start).next(!0):i}(ite,range.start,wantedEnd),start=i;if(-1===i||i>=wantedEnd)!range.bytes&&range.end>-1&&this.feed.length>=range.end&&-1===range.iterator.seek(0).next()&&(set.remove(this.feed._selections,range),range.callback(null),this.live||this.sparse||this.feed._selections.length||this.end());else{for(;range.hash&&this.feed.tree.get(2*i)||!reserved.set(i,!0);)if(!((i=ite.next(!0))>-1&&i<wantedEnd)&&(range.linear||0===start||(start=0,!((i=ite.seek(range.start).next(!0))>-1&&i<wantedEnd)))){if(range.hash){for(var j=range.start;j<wantedEnd;j++)if(!this.feed.tree.get(2*j))return;range.bytes||(set.remove(this.feed._selections,range),range.callback(null))}return}this._request(i,range.bytes||0,range.hash)}},Peer.prototype._request=function(index,bytes,hash){var request={tick:6,bytes:bytes,index:index,hash:hash,nodes:this.feed.digest(index)};this.inflightRequests.push(request),this.stream.request(request)}},{"./safe-buffer-equals":58,"./tree-index":60,"bitfield-rle":11,"fast-bitfield":43,"hypercore-protocol":49,"unordered-set":63}],58:[function(require,module,exports){(function(Buffer){module.exports=function(a,b){return a?b?0===Buffer.compare(a,b):!a:!b}}).call(this,require("buffer").Buffer)},{buffer:26}],59:[function(require,module,exports){var uint64be=require("uint64be"),flat=require("flat-tree"),alru=require("array-lru"),bufferAlloc=require("buffer-alloc-unsafe"),bufferAllocSafe=require("buffer-alloc");module.exports=Storage;var noarr=[];function Storage(create,cacheSize){if(!(this instanceof Storage))return new Storage(create,cacheSize);cacheSize=void 0===cacheSize?65536:cacheSize,this.cache=cacheSize>0?alru(cacheSize,{indexedValues:!0}):null,this.key=null,this.secretKey=null,this.tree=null,this.data=null,this.bitfield=null,this.signatures=null,this.create=create}function noop(){}function header(type,size,name){var buf=bufferAlloc(32);return buf.fill(0),buf[0]=5,buf[1]=2,buf[2]=87,buf[3]=type,buf[4]=0,buf.writeUInt16BE(size,5),name&&(buf[7]=name.length,buf.write(name,8)),buf}function Node(index,hash,size){this.index=index,this.hash=hash,this.size=size}function findNode(nodes,index){for(var i=0;i<nodes.length;i++)if(nodes[i].index===index)return nodes[i];return null}function isBlank(buf){for(var i=0;i<buf.length;i++)if(buf[i])return!1;return!0}function close(st,cb){st.close?st.close(cb):cb()}Storage.prototype.putData=function(index,data,nodes,cb){cb||(cb=noop);var self=this;if(!data.length)return cb(null);this.dataOffset(index,nodes,function(err,offset,size){return err?cb(err):size!==data.length?cb(new Error("Unexpected data size")):void self.data.write(offset,data,cb)})},Storage.prototype.getData=function(index,cb){var self=this;this.dataOffset(index,noarr,function(err,offset,size){if(err)return cb(err);self.data.read(offset,size,cb)})},Storage.prototype.nextSignature=function(index,cb){var self=this;this._getSignature(index,function(err,signature){return err?cb(err):isBlank(signature)?self.nextSignature(index+1,cb):void cb(null,{index:index,signature:signature})})},Storage.prototype.getSignature=function(index,cb){this._getSignature(index,function(err,signature){return err?cb(err):isBlank(signature)?cb(new Error("No signature found")):void cb(null,signature)})},Storage.prototype._getSignature=function(index,cb){this.signatures.read(32+64*index,64,cb)},Storage.prototype.putSignature=function(index,signature,cb){this.signatures.write(32+64*index,signature,cb)},Storage.prototype.dataOffset=function(index,cachedNodes,cb){var roots=flat.fullRoots(2*index),self=this,offset=0,pending=roots.length,error=null,blk=2*index;if(!pending)return pending=1,void onnode(null,null);for(var i=0;i<roots.length;i++){var node=findNode(cachedNodes,roots[i]);node?onnode(null,node):this.getNode(roots[i],onnode)}function onlast(err,node){if(err)return cb(err);cb(null,offset,node.size)}function onnode(err,node){if(err&&(error=err),node&&(offset+=node.size),!--pending){if(error)return cb(error);var last=findNode(cachedNodes,blk);last?onlast(null,last):self.getNode(blk,onlast)}}},Storage.prototype.getDataBatch=function(start,n,cb){var result=new Array(n),sizes=new Array(n),self=this;this.dataOffset(start,noarr,function(err,offset,size){if(err)return cb(err);if(start++,--n<=0)return ontree(null,null);function ontree(err,buf){if(err)return cb(err);var total=sizes[0]=size;if(buf)for(var i=1;i<sizes.length;i++)sizes[i]=uint64be.decode(buf,32+80*(i-1)),total+=sizes[i];self.data.read(offset,total,ondata)}function ondata(err,buf){if(err)return cb(err);for(var total=0,i=0;i<result.length;i++)result[i]=buf.slice(total,total+=sizes[i]);cb(null,result)}self.tree.read(32+80*start,80*n-40,ontree)})},Storage.prototype.getNode=function(index,cb){if(this.cache){var cached=this.cache.get(index);if(cached)return cb(null,cached)}var self=this;this.tree.read(32+40*index,40,function(err,buf){if(err)return cb(err);var hash=buf.slice(0,32),size=uint64be.decode(buf,32);if(!size&&isBlank(hash))return cb(new Error("No node found"));var val=new Node(index,hash,size,null);self.cache&&self.cache.set(index,val),cb(null,val)})},Storage.prototype.putNodeBatch=function(index,nodes,cb){cb||(cb=noop);for(var buf=bufferAllocSafe(40*nodes.length),i=0;i<nodes.length;i++){var offset=40*i,node=nodes[i];node&&(node.hash.copy(buf,offset),uint64be.encode(node.size,buf,32+offset))}this.tree.write(32+40*index,buf,cb)},Storage.prototype.putNode=function(index,node,cb){cb||(cb=noop);var buf=bufferAlloc(40);node.hash.copy(buf,0),uint64be.encode(node.size,buf,32),this.tree.write(32+40*index,buf,cb)},Storage.prototype.putBitfield=function(offset,data,cb){this.bitfield.write(32+offset,data,cb)},Storage.prototype.close=function(cb){cb||(cb=noop);var missing=6,error=null;function done(err){err&&(error=err),--missing||cb(error)}close(this.bitfield,done),close(this.tree,done),close(this.data,done),close(this.key,done),close(this.secretKey,done),close(this.signatures,done)},Storage.prototype.openKey=function(opts,cb){if("function"==typeof opts)return this.openKey({},opts);this.key||(this.key=this.create("key",opts)),this.key.read(0,32,cb)},Storage.prototype.open=function(opts,cb){if("function"==typeof opts)return this.open({},opts);var self=this,error=null,missing=5;this.key||(this.key=this.create("key",opts)),this.secretKey||(this.secretKey=this.create("secret_key",opts)),this.tree||(this.tree=this.create("tree",opts)),this.data||(this.data=this.create("data",opts)),this.bitfield||(this.bitfield=this.create("bitfield",opts)),this.signatures||(this.signatures=this.create("signatures",opts));var result={bitfield:[],bitfieldPageSize:3584,secretKey:null,key:null};function done(err){err&&(error=err),--missing||(error?cb(error):cb(null,result))}this.bitfield.read(0,32,function(_,h){h&&(result.bitfieldPageSize=h.readUInt16BE(5)),self.bitfield.write(0,header(0,result.bitfieldPageSize,null),function(err){if(err)return cb(err);!function(st,offset,pageSize,cb){if(!0===st.statable)return function(st,offset,pageSize,cb){st.stat(function(err,stat){if(err)return cb(null,[]);var result=[];!function loop(err,batch){if(err)return cb(err);if(batch){offset+=batch.length;for(var i=0;i<batch.length;i+=pageSize)result.push(batch.slice(i,i+pageSize))}var next=Math.min(stat.size-offset,32*pageSize);if(!next)return cb(null,result);st.read(offset,next,loop)}(null,null)})}(st,offset,pageSize,cb);var bufs=[];st.read(offset,pageSize,function loop(err,buf){if(err)return cb(null,bufs);bufs.push(buf);st.read(offset+bufs.length*pageSize,pageSize,loop)})}(self.bitfield,32,result.bitfieldPageSize,function(err,pages){pages&&(result.bitfield=pages),done(err)})})}),this.signatures.write(0,header(1,64,"Ed25519"),done),this.tree.write(0,header(2,40,"BLAKE2b"),done),this.secretKey.read(0,64,function(_,data){data&&(result.secretKey=data),done(null)}),this.key.read(0,32,function(_,data){data&&(result.key=data),done(null)})},Storage.Node=Node},{"array-lru":4,"buffer-alloc":23,"buffer-alloc-unsafe":22,"flat-tree":44,uint64be:176}],60:[function(require,module,exports){var flat=require("flat-tree"),bitfield=require("sparse-bitfield");function TreeIndex(bits){if(!(this instanceof TreeIndex))return new TreeIndex(bits);this.bitfield=bits||bitfield()}function rightShift(n){return(n-(1&n))/2}function addFullRoots(verifiedBy,nodes,root,remoteTree){for(var roots=flat.fullRoots(verifiedBy),i=0;i<roots.length;i++)roots[i]===root||remoteTree.get(roots[i])||nodes.push(roots[i])}module.exports=TreeIndex,TreeIndex.prototype.proof=function(index,opts){opts||(opts={});var nodes=[],remoteTree=opts.tree||new TreeIndex,digest=opts.digest||0;if(!this.get(index))return null;if(opts.hash&&nodes.push(index),1===digest)return{nodes:nodes,verifiedBy:0};var roots=null,sibling=index,next=index,hasRoot=1&digest;for(digest=rightShift(digest);digest;){if(1===digest&&hasRoot){this.get(next)&&remoteTree.set(next),flat.sibling(next)<next&&(next=flat.sibling(next)),roots=flat.fullRoots(flat.rightSpan(next)+2);for(var i=0;i<roots.length;i++)this.get(roots[i])&&remoteTree.set(roots[i]);break}sibling=flat.sibling(next),1&digest&&this.get(sibling)&&remoteTree.set(sibling),next=flat.parent(next),digest=rightShift(digest)}for(next=index;!remoteTree.get(next);){if(sibling=flat.sibling(next),!this.get(sibling)){var verifiedBy=this.verifiedBy(next);return addFullRoots(verifiedBy,nodes,next,remoteTree),{nodes:nodes,verifiedBy:verifiedBy}}remoteTree.get(sibling)||nodes.push(sibling),next=flat.parent(next)}return{nodes:nodes,verifiedBy:0}},TreeIndex.prototype.digest=function(index){if(this.get(index))return 1;for(var digest=0,next=flat.sibling(index),max=Math.max(next+2,this.bitfield.length),bit=2,depth=flat.depth(index),parent=flat.parent(next,depth++);flat.rightSpan(next)<max||flat.leftSpan(parent)>0;){if(this.get(next)&&(digest+=bit),this.get(parent))return 1&(digest+=2*bit)||(digest+=1),digest+1===4*bit?1:digest;next=flat.sibling(parent),parent=flat.parent(next,depth++),bit*=2}return digest},TreeIndex.prototype.blocks=function(){for(var top=0,next=0,max=this.bitfield.length;flat.rightSpan(next)<max;)next=flat.parent(next),this.get(next)&&(top=next);return(this.get(top)?this.verifiedBy(top):0)/2},TreeIndex.prototype.roots=function(){return flat.fullRoots(2*this.blocks())},TreeIndex.prototype.verifiedBy=function(index,nodes){if(!this.get(index))return 0;for(var depth=flat.depth(index),top=index,parent=flat.parent(top,depth++);this.get(parent)&&this.get(flat.sibling(top));)top=parent,parent=flat.parent(top,depth++);for(depth--;depth;){for(top=flat.leftChild(flat.index(depth,flat.offset(top,depth)+1),depth),depth--;!this.get(top)&&depth;)top=flat.leftChild(top,depth--);nodes&&this.get(top)&&nodes.push(top)}return this.get(top)?top+2:top},TreeIndex.prototype.get=function(index){return this.bitfield.get(index)},TreeIndex.prototype.set=function(index){if(!this.bitfield.set(index,!0))return!1;for(;this.bitfield.get(flat.sibling(index))&&(index=flat.parent(index),this.bitfield.set(index,!0)););return!0}},{"flat-tree":44,"sparse-bitfield":170}],61:[function(require,module,exports){(function(process){"use strict";!process.version||0===process.version.indexOf("v0.")||0===process.version.indexOf("v1.")&&0!==process.version.indexOf("v1.8.")?module.exports=function(fn,arg1,arg2,arg3){if("function"!=typeof fn)throw new TypeError('"callback" argument must be a function');var args,i,len=arguments.length;switch(len){case 0:case 1:return process.nextTick(fn);case 2:return process.nextTick(function(){fn.call(null,arg1)});case 3:return process.nextTick(function(){fn.call(null,arg1,arg2)});case 4:return process.nextTick(function(){fn.call(null,arg1,arg2,arg3)});default:for(args=new Array(len-1),i=0;i<args.length;)args[i++]=arguments[i];return process.nextTick(function(){fn.apply(null,args)})}}:module.exports=process.nextTick}).call(this,require("_process"))},{_process:118}],62:[function(require,module,exports){(function(process){"use strict";var nextTick=function(fn,a,b){process.nextTick(function(){fn(a,b)})};function noop(){}function apply(callback,args){callback.apply(null,args)}process.nextTick(function(val){42===val&&(nextTick=process.nextTick)},42),module.exports=function(fn){var state=function(callback){var stack=[callback];state=function(callback){stack.push(callback)};fn(function(err){var args=arguments;state=function(err){return"[object Error]"===Object.prototype.toString.call(err)}(err)?run:finished;for(;stack.length;)finished(stack.shift());function finished(callback){nextTick(apply,callback,args)}})};return function(callback){state(callback||noop)};function run(callback){var stack=[callback];state=function(callback){stack.push(callback)},fn(function(err){var args=arguments;state=function(err){return"[object Error]"===Object.prototype.toString.call(err)}(err)?run:finished;for(;stack.length;)finished(stack.shift());function finished(callback){nextTick(apply,callback,args)}})}}}).call(this,require("_process"))},{_process:118}],63:[function(require,module,exports){function has(list,item){return item._index<list.length&&list[item._index]===item}exports.add=function(list,item){return has(list,item)?item:(item._index=list.length,list.push(item),item)},exports.has=has,exports.remove=function(list,item){if(!has(list,item))return null;var last=list.pop();last!==item&&(list[item._index]=last,last._index=item._index);return item},exports.swap=function(list,a,b){if(!has(list,a)||!has(list,b))return;var tmp=a._index;a._index=b._index,list[a._index]=a,b._index=tmp,list[b._index]=b}},{}],64:[function(require,module,exports){(function(process,Buffer){var hypercore=require("hypercore"),protocol=require("hypercore-protocol"),thunky=require("thunky"),remove=require("unordered-array-remove"),toStream=require("nanoiterator/to-stream"),varint=require("varint"),mutexify=require("mutexify"),codecs=require("codecs"),raf=require("random-access-file"),path=require("path"),util=require("util"),bulk=require("bulk-write-stream"),events=require("events"),sodium=require("sodium-universal"),alru=require("array-lru"),inherits=require("inherits"),hash=require("./lib/hash"),iterator=require("./lib/iterator"),differ=require("./lib/differ"),history=require("./lib/history"),keyHistory=require("./lib/key-history"),get=require("./lib/get"),put=require("./lib/put"),messages=require("./lib/messages"),trie=require("./lib/trie-encoding"),watch=require("./lib/watch"),normalizeKey=require("./lib/normalize"),derive=require("./lib/derive");function HyperDB(storage,key,opts){if(!(this instanceof HyperDB))return new HyperDB(storage,key,opts);events.EventEmitter.call(this),isOptions(key)&&(opts=key,key=null),(opts=Object.assign({},opts)).firstNode&&(opts.reduce=reduceFirst);var st,checkout=opts.checkout;this.key="string"==typeof key?Buffer.from(key,"hex"):key,this.discoveryKey=this.key?hypercore.discoveryKey(this.key):null,this.source=checkout?checkout.source:null,this.local=checkout?checkout.local:null,this.localContent=checkout?checkout.localContent:null,this.feeds=checkout?checkout.feeds:[],this.contentFeeds=checkout?checkout.contentFeeds:opts.contentFeed?[]:null,this.ready=thunky(this._ready.bind(this)),this.opened=!1,this.sparse=!!opts.sparse,this.sparseContent=void 0!==opts.sparseContent?!!opts.sparseContent:this.sparse,this.id=Buffer.alloc(32),sodium.randombytes_buf(this.id),this._storage="function"==typeof(st=storage)?st:function(name){return raf(path.join(st,name))},this._contentStorage="function"==typeof opts.contentFeed?opts.contentFeed:opts.contentFeed?this._storage:null,this._writers=checkout?checkout._writers:[],this._watching=checkout?checkout._watching:[],this._replicating=[],this._localWriter=null,this._byKey=new Map,this._heads=opts.heads||null,this._version=opts.version||null,this._checkout=checkout||null,this._lock=mutexify(),this._map=opts.map||null,this._reduce=opts.reduce||null,this._valueEncoding=codecs(opts.valueEncoding||"binary"),this._batching=null,this._batchingNodes=null,this._secretKey=opts.secretKey||null,this._storeSecretKey=!1!==opts.storeSecretKey,this._onwrite=opts.onwrite||null,this._authorized=[],this.ready()}function Writer(db,feed){events.EventEmitter.call(this),this._id=0,this._db=db,this._feed=feed,this._contentFeed=null,this._feeds=0,this._feedsMessage=null,this._feedsLoaded=-1,this._entry=0,this._clock=0,this._encodeMap=[],this._decodeMap=[],this._checkout=!1,this._length=0,this._authorized=!1,this._cache=alru(4096),this._writes=new Map,this._writeLength=0,this.setMaxListeners(0)}function isHead(node,list){if(!node)return!1;for(var clock=node.seq+1,i=0;i<list.length;i++){var other=list[i];if(other!==node&&other&&(other.clock[node.feed]||0)>=clock)return!1}return!0}function isOptions(opts){return"object"==typeof opts&&!!opts&&!Buffer.isBuffer(opts)}function reduceFirst(a,b){return a}function noop(){}function inspect(){return`Node(key=${this.key}`+`, value=${util.inspect(this.value)}`+`, seq=${this.seq}`+`, feed=${this.feed})`+")"}module.exports=HyperDB,inherits(HyperDB,events.EventEmitter),HyperDB.prototype.batch=function(batch,cb){cb||(cb=noop);var self=this;this._lock(function(release){var clock=self._clock();self._batching=[],self._batchingNodes=[],self.heads(function(err,heads){if(err)return cb(err);var i=0;function done(err){var nodes=self._batchingNodes;return self._batching=null,self._batchingNodes=null,release(cb,err,nodes)}!function loop(err,node){if(err)return done(err);node&&(node.path=hash(node.key,!0),heads=[node]);if(i===batch.length)return void self.local.append(self._batching,done);var next=batch[i++];put(self,clock,heads,normalizeKey(next.key),next.value,{delete:"del"===next.type},loop)}(null)})})},HyperDB.prototype.put=function(key,val,opts,cb){if("function"==typeof opts)return this.put(key,val,null,opts);if(cb||(cb=noop),this._checkout)return process.nextTick(cb,new Error("Cannot put on a checkout"));var self=this;key=normalizeKey(key),this._lock(function(release){var clock=self._clock();function unlock(err,node){release(cb,err,node)}self._getHeads(!1,function(err,heads){if(err)return unlock(err);put(self,clock,heads,key,val,opts,unlock)})})},HyperDB.prototype.del=function(key,cb){this.put(key,null,{delete:!0},cb)},HyperDB.prototype.watch=function(key,cb){return"function"==typeof key?this.watch("",key):watch(this,normalizeKey(key),cb)},HyperDB.prototype.get=function(key,opts,cb){if("function"==typeof opts)return this.get(key,null,opts);var self=this;this._getHeads(!1!==(opts&&opts.update),function(err,heads){if(err)return cb(err);get(self,heads,normalizeKey(key),opts,cb)})},HyperDB.prototype.version=function(cb){var self=this;this.heads(function(err,heads){if(err)return cb(err);for(var buffers=[],i=0;i<heads.length;i++)buffers.push(self.feeds[heads[i].feed].key),buffers.push(Buffer.from(varint.encode(heads[i].seq)));cb(null,Buffer.concat(buffers))})},HyperDB.prototype.checkout=function(version,opts){return opts||(opts={}),"string"==typeof version&&(version=Buffer.from(version,"hex")),Array.isArray(version)&&(opts.heads=version,version=null),new HyperDB(this._storage,this.key,{checkout:this,version:version,map:void 0!==opts.map?opts.map:this._map,reduce:void 0!==opts.reduce?opts.reduce:this._reduce,heads:opts.heads})},HyperDB.prototype.snapshot=function(opts){return this.checkout(null,opts)},HyperDB.prototype.heads=function(cb){this._getHeads(!0,cb)},HyperDB.prototype._getHeads=function(update,cb){if(!this.opened)return function(self,update,cb){self.ready(function(err){if(err)return cb(err);self._getHeads(update,cb)})}(this,update,cb);if(this._heads)return process.nextTick(cb,null,this._heads);if(update&&this._waitForUpdate())return this.setMaxListeners(0),void this.once("remote-update",this.heads.bind(this,cb));for(var self=this,len=this._writers.length,missing=len,error=null,nodes=new Array(len),i=0;i<len;i++)this._writers[i].head(onhead);function onhead(err,head,i){if(err?error=err:nodes[i]=head,!--missing)return error?cb(error):len!==self._writers.length?self.heads(cb):1===nodes.length?cb(null,nodes[0]?nodes:[]):void cb(null,function(list){for(var heads=[],i=0;i<list.length;i++)isHead(list[i],list)&&heads.push(list[i]);return heads}(nodes))}},HyperDB.prototype._waitForUpdate=function(){return!this._writers[0].length()&&this.local.length<2},HyperDB.prototype._index=function(key){key.key&&(key=key.key);for(var i=0;i<this.feeds.length;i++)if(this.feeds[i].key.equals(key))return i;return-1},HyperDB.prototype.authorized=function(key,cb){var self=this;this._getHeads(!1,function(err){if(err)return cb(err);cb(null,self._writers[0].authorizes(key,null))})},HyperDB.prototype.authorize=function(key,cb){cb||(cb=noop);var self=this;this.heads(function(err){if(err)return cb(err);self._addWriter(key,function(err){if(err)return cb(err);self.put("",null,cb)})})},HyperDB.prototype.replicate=function(opts){opts=Object.assign({},opts);var self=this,expectedFeeds=Math.max(1,this._authorized.length),factor=this.contentFeeds?2:1;opts.expectedFeeds=expectedFeeds*factor,opts.id||(opts.id=this.id),opts.stream||(opts.stream=protocol(opts));var stream=opts.stream;return opts.live||stream.on("prefinalize",function(cb){self.heads(function(err){if(err)return cb(err);stream.expectedFeeds+=factor*(self._authorized.length-expectedFeeds),expectedFeeds=self._writers.length,cb()})}),this.ready(function(err){if(err)return stream.destroy(err);if(stream.destroyed)return;self.contentFeeds&&!self.contentFeeds[0]&&self._writers[0].get(1,noop);var i=0;function oncontent(){this._contentFeed.replicate(opts)}function replicate(){for(;i<self._authorized.length;i++){var j=self._authorized[i];if(self.feeds[j].replicate(opts),self.contentFeeds){var w=self._writers[j];w._contentFeed?w._contentFeed.replicate(opts):w.once("content-feed",oncontent)}}}function onclose(){var i=self._replicating.indexOf(replicate);for(i>-1&&remove(self._replicating,i),i=0;i<self._writers.length;i++)self._writers[i].removeListener("content-feed",oncontent)}self._replicating.push(replicate),stream.on("close",onclose),stream.on("end",onclose),replicate()}),stream},HyperDB.prototype._clock=function(){for(var clock=new Array(this._writers.length),i=0;i<clock.length;i++){var w=this._writers[i];clock[i]=w===this._localWriter?w._clock:w.length()}return clock},HyperDB.prototype._getPointer=function(feed,index,isPut,cb){isPut&&this._batching&&feed===this._localWriter._id&&index>=this._localWriter._feed.length?process.nextTick(cb,null,this._batchingNodes[index-this._localWriter._feed.length]):this._writers[feed].get(index,cb)},HyperDB.prototype._getAllPointers=function(list,isPut,cb){var error=null,result=new Array(list.length),missing=result.length;if(!missing)return process.nextTick(cb,null,result);for(var i=0;i<result.length;i++)this._getPointer(list[i].feed,list[i].seq,isPut,done);function done(err,node){err?error=err:result[function(list,ptr){for(var i=0;i<list.length;i++){var p=list[i];if(ptr.feed===p.feed&&ptr.seq===p.seq)return i}return-1}(list,node)]=node,--missing||cb(error,result)}},HyperDB.prototype._writer=function(dir,key,opts){var writer=key&&this._byKey.get(key.toString("hex"));if(writer)return writer;opts=Object.assign({},opts,{sparse:this.sparse,onwrite:this._onwrite?function(index,data,peer,cb){if(!index)return cb(null);peer&&peer.maxRequests++;index>=writer._writeLength&&(writer._writeLength=index+1);writer._writes.set(index,data),writer._decode(index,data,function(err,entry){if(err)return done(cb,index,peer,err);self._onwrite(entry,peer,function(err){done(cb,index,peer,err)})})}:null});var self=this,feed=hypercore(function(name){return self._storage(dir+"/"+name,{feed:feed})},key,opts);return writer=new Writer(self,feed),feed.on("append",function(){for(var i=0;i<self._watching.length;i++)self._watching[i]._kick();self.emit("append",feed,writer._id)}),feed.on("remote-update",function(){self.emit("remote-update",feed,writer._id)}),feed.on("sync",function(){writer.head(noop)}),key?addWriter(null):feed.ready(addWriter),writer;function done(cb,index,peer,err){peer&&peer.maxRequests--,writer._writes.delete(index),cb(err)}function addWriter(err){err||self._byKey.set(feed.key.toString("hex"),writer)}},HyperDB.prototype._getWriter=function(key){return this._byKey.get(key.toString("hex"))},HyperDB.prototype._addWriter=function(key,cb){var self=this,writer=this._writer("peers/"+hypercore.discoveryKey(key).toString("hex"),key);writer._feed.ready(function(err){if(err)return cb(err);self._index(key)<=-1&&self._pushWriter(writer),cb(null)})},HyperDB.prototype._pushWriter=function(writer){if(writer._id=this._writers.push(writer)-1,this.feeds.push(writer._feed),this.contentFeeds&&this.contentFeeds.push(null),this.opened)for(var i=0;i<this._replicating.length;i++)this._replicating[i]()},HyperDB.prototype.list=function(prefix,opts,cb){if("function"==typeof prefix)return this.list("",null,prefix);if("function"==typeof opts)return this.list(prefix,null,opts);var ite=this.iterator(prefix,opts),list=[];ite.next(function loop(err,nodes){if(err)return cb(err);if(!nodes)return cb(null,list);list.push(nodes);ite.next(loop)})},HyperDB.prototype.history=function(opts){return history(this,opts)},HyperDB.prototype.keyHistory=function(prefix,opts){return keyHistory(this,prefix,opts)},HyperDB.prototype.diff=function(other,prefix,opts){return isOptions(prefix)?this.diff(other,null,prefix):differ(this,other||this.checkout(Buffer.from([])),prefix||"",opts)},HyperDB.prototype.iterator=function(prefix,opts){return isOptions(prefix)?this.iterator("",prefix):iterator(this,normalizeKey(prefix||""),opts)},HyperDB.prototype.createHistoryStream=function(opts){return toStream(this.history(opts))},HyperDB.prototype.createKeyHistoryStream=function(prefix,opts){return toStream(this.keyHistory(prefix,opts))},HyperDB.prototype.createDiffStream=function(other,prefix,opts){return isOptions(prefix)?this.createDiffStream(other,"",prefix):toStream(this.diff(other,prefix,opts))},HyperDB.prototype.createReadStream=function(prefix,opts){return toStream(this.iterator(prefix,opts))},HyperDB.prototype.createWriteStream=function(cb){var self=this;return bulk.obj(function(batch,cb){for(var flattened=[],i=0;i<batch.length;i++){var content=batch[i];if(Array.isArray(content))for(var j=0;j<content.length;j++)flattened.push(content[j]);else flattened.push(content)}self.batch(flattened,cb)})},HyperDB.prototype._ready=function(cb){var self=this;function done(err){if(err)return cb(err);self._localWriter.ensureHeader(function(err){if(err)return cb(err);self.opened=!0,self.emit("ready"),cb(null)})}function feed(dir,key,feedOpts){var writer=self._writer(dir,key,feedOpts);return self._pushWriter(writer),writer._feed}function oncheckout(err,heads){if(err)return done(err);self.opened=!0,self.source=self._checkout.source,self.local=self._checkout.local,self.localContent=self._checkout.localContent,self._localWriter=self._checkout._localWriter,self.key=self._checkout.key,self.discoveryKey=self._checkout.discoveryKey,self._heads=heads,done(null)}this._checkout?this._heads?oncheckout(null,this._heads):this._version?this._checkout.heads(function(err){if(err)return done(err);var offset=0,missing=0,nodes=[],error=null;if("number"==typeof self._version)return missing=1,void self._checkout._writers[0].get(self._version,onnode);for(;offset<self._version.length;){var key=self._version.slice(offset,offset+32),seq=varint.decode(self._version,offset+32);offset+=32+varint.decode.bytes;var writer=self._checkout._byKey.get(key.toString("hex"));writer?(missing++,writer.get(seq,onnode)):error=new Error("Invalid version")}missing||oncheckout(error,[]);function onnode(err,node){err?error=err:nodes.push(node),--missing||oncheckout(error,nodes)}}):this._checkout.heads(oncheckout):(this.source||(this.source=feed("source",this.key,{secretKey:this._secretKey,storeSecretKey:this._storeSecretKey})),this.source.ready(function(err){if(err)return done(err);self.source.writable&&(self.local=self.source),self.local||(self.local=feed("local")),self.key=self.source.key,self.discoveryKey=self.source.discoveryKey,self._writers[0].authorize(),self.local.ready(function(err){if(err)return done(err);self._localWriter=self._writers[self.feeds.indexOf(self.local)],self._contentStorage&&(self._localWriter._ensureContentFeed(null),self.localContent=self._localWriter._contentFeed),self._localWriter.head(function(err){return err?done(err):self.localContent?void self.localContent.ready(done):done(null)})})}))},inherits(Writer,events.EventEmitter),Writer.prototype.authorize=function(){this._authorized||(this._authorized=!0,this._db._authorized.push(this._id),this._feedsMessage&&this._updateFeeds())},Writer.prototype.ensureHeader=function(cb){if(this._feed.length)return cb(null);this._feed.append(messages.Header.encode({protocol:"hyperdb"}),cb)},Writer.prototype.append=function(entry,cb){this._clock||(this._clock=this._feed.length);var enc=messages.Entry;this._entry=this._clock++,entry.clock[this._id]=this._clock,entry.seq=this._clock-1,entry.feed=this._id,entry[util.inspect.custom]=inspect;var v,mapped={key:entry.key,value:null,deleted:entry.deleted,inflate:0,clock:null,trie:null,feeds:null,contentFeed:null};if(this._needsInflate()&&(enc=messages.InflatedEntry,mapped.feeds=this._mapList(this._db.feeds,this._encodeMap,null),this._db.contentFeeds&&(mapped.contentFeed=this._db.contentFeeds[this._id].key),this._feedsMessage=mapped,this._feedsLoaded=this._feeds=this._entry,this._updateFeeds()),mapped.clock=this._mapList(entry.clock,this._encodeMap,0),mapped.inflate=this._feeds,mapped.trie=trie.encode(entry.trie,this._encodeMap),null!==(v=entry.value)&&void 0!==v&&(mapped.value=this._db._valueEncoding.encode(entry.value)),this._db._batching)return this._db._batching.push(enc.encode(mapped)),this._db._batchingNodes.push(entry),cb(null);this._feed.append(enc.encode(mapped),cb)},Writer.prototype._needsInflate=function(){var msg=this._feedsMessage;return!msg||msg.feeds.length!==this._db.feeds.length},Writer.prototype._maybeUpdateFeeds=function(){if(this._feedsMessage){var writers=this._feedsMessage.feeds||[];this._decodeMap.length===writers.length&&this._encodeMap.length===this._db.feeds.length||this._updateFeeds()}},Writer.prototype._decode=function(seq,buf,cb){try{var val=messages.Entry.decode(buf)}catch(e){return cb(e)}val[util.inspect.custom]=inspect,val.seq=seq,val.path=hash(val.key,!0);try{val.value=val.value&&this._db._valueEncoding.decode(val.value)}catch(e){return cb(e)}if(this._feedsMessage&&this._feedsLoaded===val.inflate)return this._maybeUpdateFeeds(),val.feed=this._id,val.clock.length>this._decodeMap.length?cb(new Error("Missing feed mappings")):(val.clock=this._mapList(val.clock,this._decodeMap,0),val.trie=trie.decode(val.trie,this._decodeMap),this._cache.set(val.seq,val),cb(null,val,this._id));this._loadFeeds(val,buf,cb)},Writer.prototype.get=function(seq,cb){var self=this,cached=this._cache.get(seq);if(cached)return process.nextTick(cb,null,cached,this._id);this._getFeed(seq,function(err,val){if(err)return cb(err);self._decode(seq,val,cb)})},Writer.prototype._getFeed=function(seq,cb){if(this._writes&&this._writes.size){var buf=this._writes.get(seq);if(buf)return process.nextTick(cb,null,buf)}this._feed.get(seq,cb)},Writer.prototype.head=function(cb){var len=this.length();if(len<2)return process.nextTick(cb,null,null,this._id);this.get(len-1,cb)},Writer.prototype._mapList=function(list,map,def){var i,mapped=[];for(i=0;i<map.length;i++)mapped[map[i]]=i<list.length?list[i]:def;for(;i<list.length;i++)mapped[i]=list[i];for(i=0;i<mapped.length;i++)mapped[i]||(mapped[i]=def);return mapped},Writer.prototype._loadFeeds=function(head,buf,cb){var self=this;function onfeeds(err,buf){if(err)return cb(err);try{var msg=messages.InflatedEntry.decode(buf)}catch(e){return cb(e)}done(msg)}function done(msg){self._addWriters(head,msg,cb)}head.feeds?done(head):head.inflate===head.seq?onfeeds(null,buf):this._getFeed(head.inflate,onfeeds)},Writer.prototype._addWriters=function(head,inflated,cb){for(var self=this,id=this._id,writers=inflated.feeds||[],missing=writers.length+1,error=null,i=0;i<writers.length;i++)this._db._addWriter(writers[i].key,done);function done(err){if(err&&(error=err),!--missing){if(error)return cb(error);var seq=head.inflate;if(seq>self._feedsLoaded&&(self._feedsLoaded=self._feeds=seq,self._feedsMessage=inflated),self._updateFeeds(),head.feed=self._id,head.clock.length>self._decodeMap.length)return cb(new Error("Missing feed mappings"));head.clock=self._mapList(head.clock,self._decodeMap,0),head.trie=trie.decode(head.trie,self._decodeMap),self._cache.set(head.seq,head),cb(null,head,id)}}done(null)},Writer.prototype._ensureContentFeed=function(key){if(!this._contentFeed){var self=this,secretKey=null;if(!key){var pair=derive(this._db.local.secretKey);secretKey=pair.secretKey,key=pair.publicKey}this._contentFeed=hypercore(function(name){return name="content/"+self._feed.discoveryKey.toString("hex")+"/"+name,self._db._contentStorage(name,{metadata:self._feed,feed:self._contentFeed})},key,{sparse:this._db.sparseContent,storeSecretKey:!1,secretKey:secretKey}),this._db.contentFeeds&&(this._db.contentFeeds[this._id]=this._contentFeed),this.emit("content-feed")}},Writer.prototype._updateFeeds=function(){var i,updateReplicates=!1;this._feedsMessage.contentFeed&&this._db.contentFeeds&&!this._contentFeed&&(this._ensureContentFeed(this._feedsMessage.contentFeed),updateReplicates=!0);var writers=this._feedsMessage.feeds||[],map=new Map;for(i=0;i<this._db.feeds.length;i++)map.set(this._db.feeds[i].key.toString("hex"),i);for(i=0;i<writers.length;i++){var id=map.get(writers[i].key.toString("hex"));this._decodeMap[i]=id,this._encodeMap[id]=i,this._authorized&&(this._db._writers[id].authorize(),updateReplicates=!0)}if(updateReplicates)for(i=0;i<this._db._replicating.length;i++)this._db._replicating[i]()},Writer.prototype.authorizes=function(key,visited){if(visited||(visited=new Array(this._db._writers.length)),this._feed.key.equals(key))return!0;if(!this._feedsMessage||visited[this._id])return!1;visited[this._id]=!0;for(var feeds=this._feedsMessage.feeds||[],i=0;i<feeds.length;i++){var authedKey=feeds[i].key;if(authedKey.equals(key))return!0;if(this._db._getWriter(authedKey).authorizes(key,visited))return!0}return!1},Writer.prototype.length=function(){return this._checkout?this._length:Math.max(this._writeLength,Math.max(this._feed.length,this._feed.remoteLength))}}).call(this,require("_process"),require("buffer").Buffer)},{"./lib/derive":65,"./lib/differ":66,"./lib/get":67,"./lib/hash":68,"./lib/history":69,"./lib/iterator":70,"./lib/key-history":71,"./lib/messages":72,"./lib/normalize":73,"./lib/put":75,"./lib/trie-encoding":76,"./lib/watch":77,_process:118,"array-lru":4,buffer:26,"bulk-write-stream":27,codecs:28,events:21,hypercore:55,"hypercore-protocol":49,inherits:92,mutexify:108,"nanoiterator/to-stream":111,path:115,"random-access-file":126,"sodium-universal":167,thunky:78,"unordered-array-remove":177,util:180,varint:82}],65:[function(require,module,exports){(function(Buffer){var sodium=require("sodium-universal"),CONTEXT=Buffer.from("hyperdb1");module.exports=function(secretKey){var seed=Buffer.alloc(sodium.crypto_sign_SEEDBYTES),keyPair={publicKey:Buffer.alloc(sodium.crypto_sign_PUBLICKEYBYTES),secretKey:Buffer.alloc(sodium.crypto_sign_SECRETKEYBYTES)};return sodium.crypto_kdf_derive_from_key(seed,1,CONTEXT,secretKey),sodium.crypto_sign_seed_keypair(keyPair.publicKey,keyPair.secretKey,seed),seed.fill(0),keyPair}}).call(this,require("buffer").Buffer)},{buffer:26,"sodium-universal":167}],66:[function(require,module,exports){var nanoiterator=require("nanoiterator"),inherits=require("inherits"),iterator=require("./iterator"),options=require("./options");function Differ(db,otherDb,prefix,opts){if(!(this instanceof Differ))return new Differ(db,otherDb,prefix,opts);nanoiterator.call(this),this._map=options.map(opts,db),this._reduce=options.reduce(opts,db),this._left=iterator(db,prefix,opts),this._right=iterator(otherDb,prefix,opts),this._leftNodes=null,this._rightNodes=null,noMapReduce(this._left),noMapReduce(this._right)}function noMapReduce(ite){ite._map=ite._reduce=null}module.exports=Differ,inherits(Differ,nanoiterator),Differ.prototype._next=function(cb){var self=this;this._nextLeft(function(err,l){if(err)return cb(err);self._nextRight(function(err,r){if(err)return cb(err);if(!r&&!l)return cb(null,null);if(!r||!l)return self._leftNodes=self._rightNodes=null,cb(null,{left:self._prereturn(l),right:self._prereturn(r)});var kl=l[0].key,kr=r[0].key;if(kl===kr)return function(l,r){if(l.length!==r.length)return!1;for(var i=0;i<l.length;i++){var a=l[i],b=r[i];if(a.feed!==b.feed||a.seq!==b.seq)return!1}return!0}(l,r)?self._skip(cb):(self._leftNodes=self._rightNodes=null,cb(null,{left:self._prereturn(l),right:self._prereturn(r)}));l[0].path.join("")+"@"+kl<r[0].path.join("")+"@"+kr?(self._leftNodes=null,cb(null,{left:self._prereturn(l),right:null})):(self._rightNodes=null,cb(null,{left:null,right:self._prereturn(r)}))})})},Differ.prototype._prereturn=function(nodes){return nodes?(this._map&&(nodes=nodes.map(this._map)),this._reduce&&(nodes=nodes.reduce(this._reduce)),nodes):nodes},Differ.prototype._skip=function(cb){this._leftNodes=this._rightNodes=null,this._next(cb)},Differ.prototype._nextRight=function(cb){if(this._rightNodes)return cb(null,this._rightNodes);var self=this;this._right.next(function(err,nodes){if(err)return cb(err);self._rightNodes=nodes,cb(null,nodes)})},Differ.prototype._nextLeft=function(cb){if(this._leftNodes)return cb(null,this._leftNodes);var self=this;this._left.next(function(err,nodes){if(err)return cb(err);self._leftNodes=nodes,cb(null,nodes)})}},{"./iterator":70,"./options":74,inherits:92,nanoiterator:110}],67:[function(require,module,exports){(function(process){var hash=require("./hash"),options=require("./options");function GetRequest(db,key,opts){this.key=key,this.results=[],this._deletes=!(!opts||!opts.deletes),this._callback=noop,this._options=opts||null,this._prefixed=!(!opts||!opts.prefix),this._path=opts&&opts.path||hash(key,!this._prefixed),this._onlookup=opts&&opts.onlookup||null,this._db=db,this._error=null,this._active=0,this._workers=[]}function Worker(head,i){this.i=i,this.head=head,this.lock=head}function noop(){}function finalize(req){req._finalize()}function mapPointers(fn,ptrs){for(var i=0;i<ptrs.length;i++)fn(ptrs[i])}module.exports=function get(db,heads,key,opts,cb){if("function"==typeof opts)return get(db,heads,key,null,opts);var req=new GetRequest(db,key,opts);req.start(heads,cb)},GetRequest.prototype._push=function(node){this._prefixed?this.results.push(node):node.key===this.key&&this.results.push(node)},GetRequest.prototype.start=function(heads,cb){if(cb&&(this._callback=cb),!heads.length)return process.nextTick(finalize,this);if(this._onlookup)for(var i=0;i<heads.length;i++)this._onlookup({feed:heads[i].feed,seq:heads[i].seq});this._update(heads,null)},GetRequest.prototype._update=function(nodes,worker){if(worker){var r=this._workers.indexOf(worker);r>-1&&this._workers.splice(r,1)}this._active+=nodes.length;for(var i=0;i<nodes.length;i++){var next=new Worker(nodes[i],worker?worker.i+1:0);this._workers.push(next),this._isHead(next.lock,next)?this._moveCloser(next):this._end(next,null,!0)}worker&&this._end(worker,null)},GetRequest.prototype._end=function(worker,err,removeWorker){if(removeWorker){var i=this._workers.indexOf(worker);i>-1&&this._workers.splice(i,1)}err&&(this._error=err),--this._active||this._finalize()},GetRequest.prototype._finalize=function(){var error=this._error,cb=this._callback;this._error=this._callback=null,error?cb(error):cb(null,this._prereturn(this.results))},GetRequest.prototype._prereturn=function(results){this._deletes||!function(list){for(var i=0;i<list.length;i++)if(!list[i].deleted)return!1;return!0}(results)||this._prefixed||(results=[]);var map=options.map(this._options,this._db),reduce=options.reduce(this._options,this._db);return map&&(results=results.map(map)),reduce?results.length?results.reduce(reduce):null:results},GetRequest.prototype._updatePointers=function(ptrs,worker){var self=this;this._onlookup&&mapPointers(this._onlookup,ptrs),this._db._getAllPointers(ptrs,!1,function(err,nodes){if(err)return self._end(worker,err,!1);self._update(nodes,worker)})},GetRequest.prototype._getAndMoveCloser=function(ptr,worker){var self=this;this._onlookup&&this._onlookup(ptr),this._db._getPointer(ptr.feed,ptr.seq,!1,function(err,node){if(err)return self._end(worker,err,!1);if(!self._isHead(node,worker))return self._end(worker,null,!0);worker.head=node,worker.i++,self._moveCloser(worker)})},GetRequest.prototype._pushPointers=function(ptrs,worker){var self=this;this._onlookup&&mapPointers(this._onlookup,ptrs),this._db._getAllPointers(ptrs,!1,function(err,nodes){if(err)return self._end(worker,err,!1);for(var i=0;i<nodes.length;i++){var node=nodes[i];self._isHead(node,worker)&&self._push(node)}self._end(worker,null,!1)})},GetRequest.prototype._moveCloser=function(worker){var path=this._path,head=worker.head;if(!head)return this._end(worker,null,!1);for(;worker.i<path.length;worker.i++){var i=worker.i,val=path[i];if(head.path[i]!==val){var remoteValues=(head.trie[i]||[])[val]||[];return remoteValues.length?void(remoteValues.length>1?this._updatePointers(remoteValues,worker):this._getAndMoveCloser(remoteValues[0],worker)):this._end(worker,null,!1)}}this._push(head);var top=path.length-1,last=head.trie[top],lastValues=last&&last[path[top]];if(!lastValues||!lastValues.length)return this._end(worker,null,!1);this._pushPointers(lastValues,worker)},GetRequest.prototype._isHead=function(head,worker){for(var clock=head.seq+1,i=0;i<this._workers.length;i++){var otherWorker=this._workers[i];if(otherWorker!==worker)if(clock<=otherWorker.lock.clock[head.feed])return!1}return!0}}).call(this,require("_process"))},{"./hash":68,"./options":74,_process:118}],68:[function(require,module,exports){(function(Buffer){var sodium=require("sodium-universal"),KEY=Buffer.alloc(16),OUT=Buffer.alloc(8);function hash(keys,terminate){"string"==typeof keys&&(keys=function(key){var list=key.split("/");""===list[0]&&list.shift();""===list[list.length-1]&&list.pop();return list}(keys));for(var all=new Array(32*keys.length+(terminate?1:0)),i=0;i<keys.length;i++)sodium.crypto_shorthash(OUT,Buffer.from(keys[i]),KEY),expandHash(OUT,all,32*i);return terminate&&(all[all.length-1]=4),all}function expandHash(next,out,offset){for(var i=0;i<next.length;i++)for(var n=next[i],j=0;j<4;j++){var r=3&n;out[offset++]=r,n-=r,n/=4}}hash.TERMINATE=4,hash.LENGTH=32,module.exports=hash}).call(this,require("buffer").Buffer)},{buffer:26,"sodium-universal":167}],69:[function(require,module,exports){(function(process){var nanoiterator=require("nanoiterator"),inherits=require("inherits");function Iterator(db,opts){if(!(this instanceof Iterator))return new Iterator(db,opts);nanoiterator.call(this),this._db=db,this._reverse=!(!opts||!opts.reverse),this._end=[],this._nodes=[]}function lt(a,b){var clock=a.feed<b.clock.length?b.clock[a.feed]:0;return a.seq+1<clock}function gt(a,b){var clock=a.feed<b.clock.length?b.clock[a.feed]:0;return a.seq+1>clock}function highestClock(heads,i){for(var max=0,j=0;j<heads.length;j++)heads[j].clock.length<=i||(max=Math.max(max,heads[j].clock[i]));return max}module.exports=Iterator,inherits(Iterator,nanoiterator),Iterator.prototype._open=function(cb){var self=this;this._db.heads(function(err,heads){if(err)return cb(err);for(var writers=self._db._writers,i=0;i<writers.length;i++)self._end.push(highestClock(heads,i)),self._nodes.push(null);self._updateAll(cb)})},Iterator.prototype._updateAll=function(cb){for(var self=this,missing=0,error=null,writers=this._db._writers,i=0;i<this._nodes.length;i++)this._end[i]>1&&!this._nodes[i]&&(missing++,writers[i].get(this._reverse?this._end[i]-1:1,onnode));function onnode(err,node){err?error=err:self._nodes[node.feed]=node,--missing||cb(error)}missing||cb(null)},Iterator.prototype._next=function(cb){var node=this._reverse?this._max():this._min();if(!node)return process.nextTick(cb,null,null);this._reverse?this._pop(node,cb):this._shift(node,cb)},Iterator.prototype._pop=function(node,cb){var self=this,w=self._db._writers[node.feed],seq=node.seq-1;if(seq<=0)return this._nodes[node.feed]=null,process.nextTick(cb,null,node);w.get(seq,function(err,next){if(err)return cb(err);self._nodes[next.feed]=next,cb(null,node)})},Iterator.prototype._shift=function(node,cb){var self=this,w=self._db._writers[node.feed],seq=node.seq+1;if(seq>=this._end[node.feed])return this._nodes[node.feed]=null,process.nextTick(cb,null,node);w.get(seq,function(err,next){if(err)return cb(err);self._nodes[next.feed]=next,cb(null,node)})},Iterator.prototype._compare=function(fn){for(var node=null,i=0;i<this._nodes.length;i++){var t=this._nodes[i];!t||node&&!fn(t,node)||(node=t)}return node},Iterator.prototype._min=function(){return this._compare(lt)},Iterator.prototype._max=function(){return this._compare(gt)}}).call(this,require("_process"))},{_process:118,inherits:92,nanoiterator:110}],70:[function(require,module,exports){var nanoiterator=require("nanoiterator"),inherits=require("inherits"),cmp=require("compare"),hash=require("./hash"),options=require("./options"),SORT_GT=[3,2,1,0],SORT_GTE=[3,2,1,0,4];function Iterator(db,prefix,opts){if(!(this instanceof Iterator))return new Iterator(db,prefix,opts);opts||(opts={}),nanoiterator.call(this),this._db=db,this._stack=[{path:prefix?hash(prefix,!1):[],node:null,i:0}],this._recursive=!1!==opts.recursive,this._reverse=!!opts.reverse,this._order={gt:this._reverse?SORT_GT.slice().reverse():SORT_GT,gte:this._reverse?SORT_GTE.slice().reverse():SORT_GTE},this._gt=!!opts.gt,this._start=this._stack[0].path.length,this._end=this._recursive?1/0:this._start+hash.LENGTH,this._map=options.map(opts,db),this._reduce=options.reduce(opts,db),this._collisions=[],this._deletes=!(!opts||!opts.deletes),this._prefix=prefix,this._pending=0,this._error=null}function byKey(a,b,reverse){var k=cmp(b.key,a.key);return(reverse?-1:1)*(k||b.feed-a.feed)}function allDeletes(nodes){for(var i=0;i<nodes.length;i++)if(!nodes[i].deleted)return!1;return!0}function visitTrie(nodes,ptr,val){for(var i=0;i<nodes.length;i++){var node=nodes[i],bucket=ptr<node.trie.length&&node.trie[ptr];if(bucket&&bucket[val])return!0;if(node.path[ptr]===val)return!0}return!1}function isPrefix(s,prefix){return!prefix||(s.startsWith?s.startsWith(prefix):s.slice(0,prefix.length)===prefix)}module.exports=Iterator,inherits(Iterator,nanoiterator),Iterator.prototype._pushPointer=function(ptr,i,cb){var self=this,top={path:null,node:null,i:i};this._pending++,this._stack.push(top),this._db._getPointer(ptr.feed,ptr.seq,!1,function(err,node){err?self._error=err:top.node=node;if(--self._pending)return;if(self._error)return cb(self._error);self._next(cb)})},Iterator.prototype._pushNode=function(node,i){this._stack.push({path:null,node:node,i:i})},Iterator.prototype._pushPrefix=function(path,i,val){this._stack.push({path:(i<path.length?path.slice(0,i):path).concat(val),node:null,i:i})},Iterator.prototype._singleNode=function(top,cb){for(var node=top.node,end=Math.min(this._end,node.trie.length),i=top.i;i<end;i++){var bucket=i<node.trie.length&&node.trie[i];if(bucket){for(var val=node.path[i],order=this._sortOrder(i),j=0;j<order.length;j++){var sortValue=order[j],values=sortValue<bucket.length&&bucket[sortValue];sortValue!==val?values&&(values.length>1?this._pushPrefix(node.path,i,sortValue):this._pushPointer(values[0],i+1,cb)):values?this._pushPrefix(node.path,i,sortValue):this._pushNode(node,i+1)}return 0===this._pending}}return!((this._deletes||!node.deleted)&&isPrefix(node.key,this._prefix))||(cb(null,this._prereturn([node])),!1)},Iterator.prototype._multiNode=function(path,nodes,cb){if(!nodes.length)return this._next(cb);if(1===nodes.length)return this._pushNode(nodes[0],path.length),this._next(cb);var ptr=path.length;if(ptr<this._end)for(var order=this._sortOrder(ptr),i=0;i<order.length;i++){var sortValue=order[i];visitTrie(nodes,ptr,sortValue)&&this._pushPrefix(path,path.length,sortValue)}if((nodes=this._filterResult(nodes,ptr))&&(this._deletes||!allDeletes(nodes)))return cb(null,this._prereturn(nodes));this._next(cb)},Iterator.prototype._filterResult=function(nodes,i){var result=null;nodes.sort(byKey,this._reverse);for(var j=0;j<nodes.length;j++){var node=nodes[j];node.path.length!==i&&i!==this._end||isPrefix(node.key,this._prefix)&&(result||(result=[]),result.length&&result[0].key!==node.key&&(this._collisions.push(result),result=[]),result.push(node))}return result},Iterator.prototype._next=function(cb){var nodes=function(collisions){for(;collisions.length;){var collision=collisions.pop();if(this._deletes||!allDeletes(collision))return collision}return null}(this._collisions);if(nodes)return cb(null,this._prereturn(nodes));for(var top=null;;){if(!(top=this._stack.pop()))return cb(null,null);if(!top.node)break;if(!this._singleNode(top,cb))return}this._lookupPrefix(top.path,cb)},Iterator.prototype._lookupPrefix=function(path,cb){var self=this;this._db.get("",{path:path,prefix:!0,map:!1,reduce:!1},function(err,nodes){if(err)return cb(err);self._multiNode(path,nodes,cb)})},Iterator.prototype._prereturn=function(nodes){return this._map&&(nodes=nodes.map(this._map)),this._reduce?nodes.reduce(this._reduce):nodes},Iterator.prototype._sortOrder=function(i){return(this._gt||!this._start)&&this._start===i?this._order.gt:this._order.gte}},{"./hash":68,"./options":74,compare:29,inherits:92,nanoiterator:110}],71:[function(require,module,exports){var nanoiterator=require("nanoiterator"),inherits=require("inherits"),get=require("./get"),normalizeKey=require("./normalize");function Iterator(db,prefix,opts){if(!(this instanceof Iterator))return new Iterator(db,prefix,opts);nanoiterator.call(this),this._db=db,this._prefix=normalizeKey(prefix),this._heads=void 0}function isHead(node,list){if(!node)return!1;for(var clock=node.seq+1,i=0;i<list.length;i++){var other=list[i];if(other!==node&&other&&(other.clock[node.feed]||0)>=clock)return!1}return!0}module.exports=Iterator,inherits(Iterator,nanoiterator),Iterator.prototype._open=function(cb){this._db.heads((err,heads)=>{if(err)return cb(err);this._heads=heads,cb()})},Iterator.prototype._next=function(cb){if(!this._heads||!this._heads.length)return cb(null,null);get(this._db,this._heads,this._prefix,{reduce:!1,deletes:!0},(err,nodes)=>err?cb(err):0===nodes.length?cb(null,null):void this._nextHeads(nodes,(err,heads)=>{if(err)return cb(err);this._heads=heads,cb(null,nodes)}))},Iterator.prototype._nextHeads=function(nodes,cb){var i,heads=[],error=null,missing=0;for(i=0;i<nodes.length;i++)for(var node=nodes[i],c=0;c<node.clock.length;c++){var seq=node.clock[c];c!==node.feed&&seq>2?(missing++,this._db._writers[c].get(seq-1,onHead)):c===node.feed&&node.seq>1&&(missing++,this._db._writers[node.feed].get(node.seq-1,onHead))}function onHead(err,head){head&&heads.push(head),err&&(error=err),--missing||cb(error,function(list){for(var heads=[],i=0;i<list.length;i++)isHead(list[i],list)&&heads.push(list[i]);return heads}(heads))}0===missing&&cb(null,void 0)}},{"./get":67,"./normalize":73,inherits:92,nanoiterator:110}],72:[function(require,module,exports){(function(Buffer){var encodings=require("protocol-buffers-encodings"),varint=encodings.varint,skip=encodings.skip,Entry=exports.Entry={buffer:!0,encodingLength:null,encode:null,decode:null},InflatedEntry=exports.InflatedEntry={buffer:!0,encodingLength:null,encode:null,decode:null},Header=exports.Header={buffer:!0,encodingLength:null,encode:null,decode:null};function defined(val){return null!==val&&void 0!==val&&("number"!=typeof val||!isNaN(val))}!function(){var enc=[encodings.string,encodings.bytes,encodings.bool,encodings.varint];function encodingLength(obj){var length=0;if(!defined(obj.key))throw new Error("key is required");var len=enc[0].encodingLength(obj.key);if(length+=1+len,defined(obj.value)){var len=enc[1].encodingLength(obj.value);length+=1+len}if(defined(obj.deleted)){var len=enc[2].encodingLength(obj.deleted);length+=1+len}if(!defined(obj.trie))throw new Error("trie is required");var len=enc[1].encodingLength(obj.trie);if(length+=1+len,defined(obj.clock))for(var i=0;i<obj.clock.length;i++)if(defined(obj.clock[i])){var len=enc[3].encodingLength(obj.clock[i]);length+=1+len}if(defined(obj.inflate)){var len=enc[3].encodingLength(obj.inflate);length+=1+len}return length}Entry.encodingLength=encodingLength,Entry.encode=function encode(obj,buf,offset){offset||(offset=0);buf||(buf=Buffer.allocUnsafe(encodingLength(obj)));var oldOffset=offset;if(!defined(obj.key))throw new Error("key is required");buf[offset++]=10;enc[0].encode(obj.key,buf,offset);offset+=enc[0].encode.bytes;defined(obj.value)&&(buf[offset++]=18,enc[1].encode(obj.value,buf,offset),offset+=enc[1].encode.bytes);defined(obj.deleted)&&(buf[offset++]=24,enc[2].encode(obj.deleted,buf,offset),offset+=enc[2].encode.bytes);if(!defined(obj.trie))throw new Error("trie is required");buf[offset++]=34;enc[1].encode(obj.trie,buf,offset);offset+=enc[1].encode.bytes;if(defined(obj.clock))for(var i=0;i<obj.clock.length;i++)defined(obj.clock[i])&&(buf[offset++]=40,enc[3].encode(obj.clock[i],buf,offset),offset+=enc[3].encode.bytes);defined(obj.inflate)&&(buf[offset++]=48,enc[3].encode(obj.inflate,buf,offset),offset+=enc[3].encode.bytes);encode.bytes=offset-oldOffset;return buf},Entry.decode=function decode(buf,offset,end){offset||(offset=0);end||(end=buf.length);if(!(end<=buf.length&&offset<=buf.length))throw new Error("Decoded message is not valid");var oldOffset=offset;var obj={key:"",value:null,deleted:!1,trie:null,clock:[],inflate:0};var found0=!1;var found3=!1;for(;;){if(end<=offset){if(!found0||!found3)throw new Error("Decoded message is not valid");return decode.bytes=offset-oldOffset,obj}var prefix=varint.decode(buf,offset);offset+=varint.decode.bytes;var tag=prefix>>3;switch(tag){case 1:obj.key=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes,found0=!0;break;case 2:obj.value=enc[1].decode(buf,offset),offset+=enc[1].decode.bytes;break;case 3:obj.deleted=enc[2].decode(buf,offset),offset+=enc[2].decode.bytes;break;case 4:obj.trie=enc[1].decode(buf,offset),offset+=enc[1].decode.bytes,found3=!0;break;case 5:obj.clock.push(enc[3].decode(buf,offset)),offset+=enc[3].decode.bytes;break;case 6:obj.inflate=enc[3].decode(buf,offset),offset+=enc[3].decode.bytes;break;default:offset=skip(7&prefix,buf,offset)}}}}(),function(){var Feed=InflatedEntry.Feed={buffer:!0,encodingLength:null,encode:null,decode:null};!function(){var enc=[encodings.bytes];function encodingLength(obj){var length=0;if(!defined(obj.key))throw new Error("key is required");var len=enc[0].encodingLength(obj.key);return length+=1+len}Feed.encodingLength=encodingLength,Feed.encode=function encode(obj,buf,offset){offset||(offset=0);buf||(buf=Buffer.allocUnsafe(encodingLength(obj)));var oldOffset=offset;if(!defined(obj.key))throw new Error("key is required");buf[offset++]=10;enc[0].encode(obj.key,buf,offset);offset+=enc[0].encode.bytes;encode.bytes=offset-oldOffset;return buf},Feed.decode=function decode(buf,offset,end){offset||(offset=0);end||(end=buf.length);if(!(end<=buf.length&&offset<=buf.length))throw new Error("Decoded message is not valid");var oldOffset=offset;var obj={key:null};var found0=!1;for(;;){if(end<=offset){if(!found0)throw new Error("Decoded message is not valid");return decode.bytes=offset-oldOffset,obj}var prefix=varint.decode(buf,offset);offset+=varint.decode.bytes;var tag=prefix>>3;switch(tag){case 1:obj.key=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes,found0=!0;break;default:offset=skip(7&prefix,buf,offset)}}}}();var enc=[encodings.string,encodings.bytes,encodings.bool,encodings.varint,Feed];function encodingLength(obj){var length=0;if(!defined(obj.key))throw new Error("key is required");var len=enc[0].encodingLength(obj.key);if(length+=1+len,defined(obj.value)){var len=enc[1].encodingLength(obj.value);length+=1+len}if(defined(obj.deleted)){var len=enc[2].encodingLength(obj.deleted);length+=1+len}if(!defined(obj.trie))throw new Error("trie is required");var len=enc[1].encodingLength(obj.trie);if(length+=1+len,defined(obj.clock))for(var i=0;i<obj.clock.length;i++)if(defined(obj.clock[i])){var len=enc[3].encodingLength(obj.clock[i]);length+=1+len}if(defined(obj.inflate)){var len=enc[3].encodingLength(obj.inflate);length+=1+len}if(defined(obj.feeds))for(var i=0;i<obj.feeds.length;i++)if(defined(obj.feeds[i])){var len=enc[4].encodingLength(obj.feeds[i]);length+=varint.encodingLength(len),length+=1+len}if(defined(obj.contentFeed)){var len=enc[1].encodingLength(obj.contentFeed);length+=1+len}return length}InflatedEntry.encodingLength=encodingLength,InflatedEntry.encode=function encode(obj,buf,offset){offset||(offset=0);buf||(buf=Buffer.allocUnsafe(encodingLength(obj)));var oldOffset=offset;if(!defined(obj.key))throw new Error("key is required");buf[offset++]=10;enc[0].encode(obj.key,buf,offset);offset+=enc[0].encode.bytes;defined(obj.value)&&(buf[offset++]=18,enc[1].encode(obj.value,buf,offset),offset+=enc[1].encode.bytes);defined(obj.deleted)&&(buf[offset++]=24,enc[2].encode(obj.deleted,buf,offset),offset+=enc[2].encode.bytes);if(!defined(obj.trie))throw new Error("trie is required");buf[offset++]=34;enc[1].encode(obj.trie,buf,offset);offset+=enc[1].encode.bytes;if(defined(obj.clock))for(var i=0;i<obj.clock.length;i++)defined(obj.clock[i])&&(buf[offset++]=40,enc[3].encode(obj.clock[i],buf,offset),offset+=enc[3].encode.bytes);defined(obj.inflate)&&(buf[offset++]=48,enc[3].encode(obj.inflate,buf,offset),offset+=enc[3].encode.bytes);if(defined(obj.feeds))for(var i=0;i<obj.feeds.length;i++)defined(obj.feeds[i])&&(buf[offset++]=58,varint.encode(enc[4].encodingLength(obj.feeds[i]),buf,offset),offset+=varint.encode.bytes,enc[4].encode(obj.feeds[i],buf,offset),offset+=enc[4].encode.bytes);defined(obj.contentFeed)&&(buf[offset++]=66,enc[1].encode(obj.contentFeed,buf,offset),offset+=enc[1].encode.bytes);encode.bytes=offset-oldOffset;return buf},InflatedEntry.decode=function decode(buf,offset,end){offset||(offset=0);end||(end=buf.length);if(!(end<=buf.length&&offset<=buf.length))throw new Error("Decoded message is not valid");var oldOffset=offset;var obj={key:"",value:null,deleted:!1,trie:null,clock:[],inflate:0,feeds:[],contentFeed:null};var found0=!1;var found3=!1;for(;;){if(end<=offset){if(!found0||!found3)throw new Error("Decoded message is not valid");return decode.bytes=offset-oldOffset,obj}var prefix=varint.decode(buf,offset);offset+=varint.decode.bytes;var tag=prefix>>3;switch(tag){case 1:obj.key=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes,found0=!0;break;case 2:obj.value=enc[1].decode(buf,offset),offset+=enc[1].decode.bytes;break;case 3:obj.deleted=enc[2].decode(buf,offset),offset+=enc[2].decode.bytes;break;case 4:obj.trie=enc[1].decode(buf,offset),offset+=enc[1].decode.bytes,found3=!0;break;case 5:obj.clock.push(enc[3].decode(buf,offset)),offset+=enc[3].decode.bytes;break;case 6:obj.inflate=enc[3].decode(buf,offset),offset+=enc[3].decode.bytes;break;case 7:var len=varint.decode(buf,offset);offset+=varint.decode.bytes,obj.feeds.push(enc[4].decode(buf,offset,offset+len)),offset+=enc[4].decode.bytes;break;case 8:obj.contentFeed=enc[1].decode(buf,offset),offset+=enc[1].decode.bytes;break;default:offset=skip(7&prefix,buf,offset)}}}}(),function(){var enc=[encodings.string];function encodingLength(obj){var length=0;if(!defined(obj.protocol))throw new Error("protocol is required");var len=enc[0].encodingLength(obj.protocol);return length+=1+len}Header.encodingLength=encodingLength,Header.encode=function encode(obj,buf,offset){offset||(offset=0);buf||(buf=Buffer.allocUnsafe(encodingLength(obj)));var oldOffset=offset;if(!defined(obj.protocol))throw new Error("protocol is required");buf[offset++]=10;enc[0].encode(obj.protocol,buf,offset);offset+=enc[0].encode.bytes;encode.bytes=offset-oldOffset;return buf},Header.decode=function decode(buf,offset,end){offset||(offset=0);end||(end=buf.length);if(!(end<=buf.length&&offset<=buf.length))throw new Error("Decoded message is not valid");var oldOffset=offset;var obj={protocol:""};var found0=!1;for(;;){if(end<=offset){if(!found0)throw new Error("Decoded message is not valid");return decode.bytes=offset-oldOffset,obj}var prefix=varint.decode(buf,offset);offset+=varint.decode.bytes;var tag=prefix>>3;switch(tag){case 1:obj.protocol=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes,found0=!0;break;default:offset=skip(7&prefix,buf,offset)}}}}()}).call(this,require("buffer").Buffer)},{buffer:26,"protocol-buffers-encodings":119}],73:[function(require,module,exports){module.exports=function(key){return key.length?"/"===key[0]?key.slice(1):key:""}},{}],74:[function(require,module,exports){exports.map=function(opts,db){if(!opts)return db._map;var map=opts.map;return void 0===map?db._map:map},exports.reduce=function(opts,db){if(!opts)return db._reduce;var reduce=opts.reduce;return void 0===reduce?db._reduce:reduce}},{}],75:[function(require,module,exports){var hash=require("./hash");function PutRequest(db,key,value,clock,opts){this.key=key,this.value=value,this.delete=!(!opts||!opts.delete),this.ifNotExists=!(!opts||!opts.ifNotExists),this._clock=clock,this._active=0,this._error=null,this._callback=noop,this._db=db,this._path=hash(key,!0),this._trie=[]}function Worker(head,i){this.i=i,this.head=head,this.lock=head,this.pending=0,this.error=null,this.ended=!1}function noop(){}module.exports=function put(db,clock,heads,key,value,opts,cb){if("function"==typeof opts)return put(db,clock,heads,key,value,null,opts);var req=new PutRequest(db,key,value,clock,opts);req.start(heads,cb)},PutRequest.prototype.start=function(heads,cb){if(cb&&(this._callback=cb),!heads.length)return this._finalize();this._update(heads,0)},PutRequest.prototype._finalize=function(){var cb=this._callback,err=this._error;if(this._error=this._callback=null,err)return cb(err);var node={key:this.key,value:this.value,trie:this._trie,clock:this._clock};this.delete&&(node.deleted=!0),this._db._localWriter.append(node,function(err){if(err)return cb(err);cb(null,node)})},PutRequest.prototype._update=function(heads,offset){this._active+=heads.length;for(var i=0;i<heads.length;i++){var worker=new Worker(heads[i],offset);this._moveCloser(worker)}},PutRequest.prototype._updateHead=function(worker,feed,seq){var self=this;worker.pending++,this._db._getPointer(feed,seq,!0,function(err,node){err||(worker.head=node),self._workerDone(worker,err)})},PutRequest.prototype._workerDone=function(worker,err){err&&(worker.error=err),--worker.pending||(worker.error||worker.ended?this._end(worker,worker.error):(worker.i++,this._moveCloser(worker)))},PutRequest.prototype._fork=function(worker,ptrs){var self=this;worker.pending++,this._db._getAllPointers(ptrs,!0,function(err,nodes){if(err)return self._workerDone(worker,err);self._update(nodes,worker.i+1),self._workerDone(worker,null)})},PutRequest.prototype._checkCollision=function(worker,i,feed,seq){var self=this;worker.pending++,this._db._getPointer(feed,seq,!0,function(err,node){if(err)return self._workerDone(worker,err);node.key!==self.key&&self._push(worker,i,feed,seq),self._workerDone(worker,null)})},PutRequest.prototype._copyTrie=function(worker,bucket,val){for(var i=0;i<bucket.length;i++)if(i!==val||4===val)for(var ptrs=bucket[i]||[],k=0;k<ptrs.length;k++){var ptr=ptrs[k];4===val?this._checkCollision(worker,i,ptr.feed,ptr.seq):this._push(worker,i,ptr.feed,ptr.seq)}},PutRequest.prototype._splitTrie=function(worker,bucket,val){var head=worker.head,headVal=head.path[worker.i];if(headVal!==val||!(headVal<4||head.key===this.key)){this._push(worker,headVal,head.feed,head.seq);var ptrs=bucket[val];ptrs&&ptrs.length?(this._updateHead(worker,ptrs[0].feed,ptrs[0].seq),ptrs.length>1&&this._fork(worker,ptrs.slice(1))):worker.ended=!0}},PutRequest.prototype._moveCloser=function(worker){for(var path=this._path,head=worker.head;worker.i<path.length;worker.i++){var i=worker.i,val=path[i],bucket=head.trie[i]||[];if(this._copyTrie(worker,bucket,val),this._splitTrie(worker,bucket,val),worker.pending)return;if(worker.ended)break}this._end(worker,worker.error)},PutRequest.prototype._end=function(worker,err){if(err&&(this._error=err),!--this._active){if(this.ifNotExists&&worker.head.key===this.key)return this._callback?this._callback(err,worker.head):void 0;this._finalize()}},PutRequest.prototype._push=function(worker,val,feed,seq){var i=worker.i,bucket=this._trie[i];bucket||(bucket=this._trie[i]=[]);var values=bucket[val];values||(bucket[val]=values=[]);for(var j=0;j<values.length;j++){var ref=values[j];if(ref.feed===feed&&ref.seq===seq)return}values.push({feed:feed,seq:seq})}},{"./hash":68}],76:[function(require,module,exports){(function(Buffer){var varint=require("varint"),buf=Buffer.allocUnsafe(524288),offset=0;function encodeBucket(bucket,map,buf,offset){var i,bits=0,bit=1;for(i=0;i<bucket.length;i++)bucket[i]&&bucket[i].length&&(bits|=bit),bit*=2;for(varint.encode(bits,buf,offset),offset+=varint.encode.bytes,i=0;i<bucket.length;i++){var vals=bucket[i];if(vals)for(var j=0;j<vals.length;j++)offset=encodeValue(vals[j],j<vals.length-1,map,buf,offset)}return offset}function encodeValue(ptr,more,map,buf,offset){return varint.encode(2*map[ptr.feed]+(more?1:0),buf,offset),offset+=varint.encode.bytes,varint.encode(ptr.seq,buf,offset),offset+=varint.encode.bytes}function decodeBucket(buf,offset,bucket,map){var i=0,bits=varint.decode(buf,offset);for(offset+=varint.decode.bytes;bits;)1&bits?(bucket[i]=[],offset=decodeValues(buf,offset,bucket[i],map),bits=(bits-1)/2):bits/=2,i++;return offset}function decodeValues(buf,offset,values,map){for(var more=1;more;){var feed=varint.decode(buf,offset);offset+=varint.decode.bytes;var seq=varint.decode(buf,offset);offset+=varint.decode.bytes,(feed=(feed-(more=1&feed))/2)<map.length&&(feed=map[feed]),values.push({feed:feed,seq:seq})}return offset}exports.encode=function(trie,map){buf.length-offset<65536&&(offset=0,buf=Buffer.allocUnsafe(buf.length));for(var oldOffset=offset,i=0;i<trie.length;i++)trie[i]&&(varint.encode(i,buf,offset),offset+=varint.encode.bytes,offset=encodeBucket(trie[i],map,buf,offset));return buf.slice(oldOffset,offset)},exports.decode=function(buf,map){var trie=[],offset=0;for(;offset<buf.length;){var i=varint.decode(buf,offset);offset+=varint.decode.bytes,trie[i]=[],offset=decodeBucket(buf,offset,trie[i],map)}return trie}}).call(this,require("buffer").Buffer)},{buffer:26,varint:82}],77:[function(require,module,exports){var unordered=require("unordered-set"),util=require("util"),events=require("events");function Watcher(db,key){events.EventEmitter.call(this),this.key=key,this._index=0,this._db=db,this._kicked=0,this._nodes=null,this._destroyed=!1,this._onkick=function(err,nodes){if(err)return this.destroy(err);var kicked=this._kicked;this._kicked=0,nodes=nodes.sort(sortByFeed),this._nodes||(this._nodes=nodes,this.emit("watching"));if(!function(a,b){if(a.length!==b.length)return!1;for(var i=0;i<a.length;i++)if(a[i].feed!==b[i].feed||a[i].seq!==b[i].seq)return!1;return!0}(nodes,this._nodes))return this._nodes=nodes,void this.emit("change");kicked>1&&this._kick()}.bind(this)}function sortByFeed(a,b){return a.feed-b.feed}module.exports=function(db,key,cb){var w=new Watcher(db,key);return w._index=db._watching.push(w)-1,w.start(cb),w},util.inherits(Watcher,events.EventEmitter),Watcher.prototype.destroy=function(err){this._destroyed||(this._destroyed=!0,unordered.remove(this._db._watching,this),err&&this.emit("error",err),this.emit("close"))},Watcher.prototype.start=function(onchange){onchange&&this.on("change",onchange),this._kick()},Watcher.prototype._kick=function(){this._kicked++,this._db.get(this.key,{update:!1,prefix:!0,map:!1,reduce:!1},this._onkick)}},{events:21,"unordered-set":79,util:180}],78:[function(require,module,exports){arguments[4][62][0].apply(exports,arguments)},{_process:118,dup:62}],79:[function(require,module,exports){arguments[4][63][0].apply(exports,arguments)},{dup:63}],80:[function(require,module,exports){arguments[4][51][0].apply(exports,arguments)},{dup:51}],81:[function(require,module,exports){arguments[4][13][0].apply(exports,arguments)},{dup:13}],82:[function(require,module,exports){arguments[4][14][0].apply(exports,arguments)},{"./decode.js":80,"./encode.js":81,"./length.js":83,dup:14}],83:[function(require,module,exports){arguments[4][15][0].apply(exports,arguments)},{dup:15}],84:[function(require,module,exports){(function(Buffer){const hyperdb=require("hyperdb"),bulk=require("bulk-write-stream"),from=require("from2"),inherits=require("inherits"),path=require("path"),events=require("events"),mutexify=require("mutexify"),isOptions=require("is-options"),messages=require("./lib/messages"),stat=require("./lib/stat"),errors=require("./lib/errors"),iterator=require("./lib/iterator"),DEFAULT_DMODE=493;function Hyperdrive(storage,key,opts){if(!(this instanceof Hyperdrive))return new Hyperdrive(storage,key,opts);isOptions(key)&&(opts=key,key=null),opts||(opts={}),opts.files&&(opts.latest=!0),events.EventEmitter.call(this);const self=this,db=opts.checkout||hyperdb(storage,key,{valueEncoding:messages.Stat,contentFeed:!opts.files||function(storage,dir,name,opts){return name.endsWith("/data")?require("./lib/storage")(dir,opts):"string"!=typeof storage?storage(name):require("random-access-file")(name,{directory:storage})}.bind(this,storage,opts.files),secretKey:opts.secretKey,sparse:opts.sparse,sparseContent:opts.sparse||opts.latest||opts.sparseContent,reduce:reduce,onwrite:opts.latest&&function(entry,peer,cb){if(!peer)return cb(null);const data=self.localContentData;if(!data.onunlink||!entry.key)return cb(null);!function(entry,cb){self.db.get(entry.key,function(err,latest){return err?cb(err):!latest||latest.seq===entry.seq&&latest.feed===entry.feed?void cb(null,!0):cb(null,!1)})}(entry,function(err,latest){if(err||!latest)return cb(err);data.onunlink(entry.key,function(err){if(err)return cb(err);entry.deleted||self.sparse||downloadEntry(self.db,entry,noop),cb(null)})})}});this.key=db.key,this.discoveryKey=db.discoveryKey,this.local=null,this.localContent=null,this.sparse=db.sparse,this.feeds=db.feeds,this.contentFeeds=db.contentFeeds,this.db=db,this._lock=mutexify(),this.ready(function(){self.key=db.key,self.discoveryKey=db.discoveryKey,self.local=db.local,self.localContent=db.localContent,self.localContentData=db.localContent._storage.data,self.emit("ready")})}function directoryNameOffset(path){return path&&"/"===path[path.length-1]&&(path=path.slice(0,-1)),path&&"/"===path[0]&&(path=path.slice(1)),path.length?path.length+1:0}function directoryName(node,offset){const key=node.key,idx=key.indexOf("/",offset);return key.slice(offset,idx>-1?idx:key.length)}function reduce(a,b){return a.value.mtime>b.value.mtime?a:b}function noop(){}function getTime(date){return"number"==typeof date?date:date?date.getTime():Date.now()}function normalizePath(p){return path.resolve("/",p||"").slice(1)}function downloadEntry(db,node,cb){const feed=db.contentFeeds[node.feed];if(!feed.bitfield)return function(feed,db,node,cb){feed.ready(function(err){if(err)return cb(err);downloadEntry(db,node,cb)})}(feed,db,node,cb);const start=node.value.offset,end=start+node.value.blocks;if(start===end||feed.has(start,end))return cb(null);feed.download({start:start,end:end},cb)}module.exports=Hyperdrive,inherits(Hyperdrive,events.EventEmitter),Hyperdrive.prototype.iterator=function(path,opts){return iterator(this,path,opts)},Hyperdrive.prototype.download=function(path,cb){if("function"==typeof path)return this.download(null,path);cb||(cb=noop),path=normalizePath(path);const db=this.db,ite=db.iterator(path);return ite.next(loop),ite;function loop(err,node){return err?cb(err):node?node.value&&0!==node.value.blocks?void downloadEntry(db,node,ondownload):ite.next(loop):cb(null)}function ondownload(err){if(err)return cb(err);ite.next(loop)}},Hyperdrive.prototype.snapshot=function(){return new Hyperdrive(null,null,{checkout:this.db.snapshot()})},Hyperdrive.prototype.checkout=function(version){return new Hyperdrive(null,null,{checkout:this.db.checkout(version)})},Hyperdrive.prototype.authorize=function(key,cb){this.db.authorize(key,cb)},Hyperdrive.prototype.version=function(cb){this.db.version(cb)},Hyperdrive.prototype.replicate=function(opts){return this.db.replicate(opts)},Hyperdrive.prototype.lstat=function(path,cb){path=normalizePath(path),this.db.get(path,{prefix:!0},function(err,node){if(err)return cb(err);if(!node)return path?cb(new errors.ENOENT("stat",path)):cb(null,function(source){const opts={mode:stat.IFDIR|DEFAULT_DMODE,uid:0,gid:0,size:0,offset:0,byteOffset:0,blocks:0,atime:0,mtime:0,ctime:0};return stat(opts,source,!0)}(node));if(node.key!==path){const implicit=stat(node.value,node,!0);return implicit.mode=DEFAULT_DMODE|stat.IFDIR,cb(null,implicit)}cb(null,stat(node.value,node,!1))})},Hyperdrive.prototype.stat=Hyperdrive.prototype.lstat,Hyperdrive.prototype.mkdir=function(path,opts,cb){if("function"==typeof opts)return this.mkdir(path,null,opts);"number"==typeof opts&&(opts={mode:opts}),opts||(opts={}),cb||(cb=noop),path=normalizePath(path);const db=this.db,self=this;db.ready(function(err){if(err)return cb(err);self._lock(function(release){const st={mode:(opts.mode||DEFAULT_DMODE)|stat.IFDIR,uid:opts.uid,gid:opts.gid,mtime:getTime(opts.mtime),ctime:getTime(opts.ctime),offset:db.localContent.length,byteOffset:db.localContent.byteLength};db.put(path,st,function(err){release(cb,err)})})})},Hyperdrive.prototype.rmdir=function(path,opts,cb){if("function"==typeof opts)return this.rmdri(path,null,opts);opts||(opts={}),cb||(cb=noop),path=normalizePath(path);const db=this.db,self=this;this._lock(function(release){function done(err){release(cb,err)}self.stat(path,function(err,st){return err?done(err):st?st.isDirectory()?void db.iterator(path).next(function(err,node){if(err)return done(err);if(node)return done(new errors.ENOTEMPTY("rmdir",path));if(st.implicit)return done(null);const del={mode:0,mtime:getTime(opts.mtime),ctime:getTime(opts.ctime),offset:db.localContent.length,byteOffset:db.localContent.byteLength};db.put(path,del,{delete:!0},done)}):done(new errors.ENOTDIR("rmdir",path)):done(new errors.ENOENT("stat",path))})})},Hyperdrive.prototype.createReadStream=function(path,opts){opts||(opts={}),path=normalizePath(path);const db=this.db,slicing=opts.start||"number"==typeof opts.end;var content=null,st=null,offset=0,end=0,rel=0,bytesMissing=0,missing=1,range=null,ended=!1,downloaded=!1;const stream=from(slicing?readSlice:read).on("end",cleanup).on("close",cleanup);return stream;function cleanup(){range&&content&&content.undownload(range,noop),range=null,ended=!0}function open(size,cb){db.get(path,function(err,node){if(err)return cb(err);if(ended||stream.destroyed)return cb(null);if(!node)return cb(new errors.ENOENT("stat",path));if(!(content=db.contentFeeds[node.feed]))return cb(new errors.EPROTO("open_content",path));if(st=node.value,offset=st.offset,end=offset+st.blocks,!slicing||!st.size)return range=content.download({start:offset,end:end,linear:!0}),read(size,cb);const bytesStart=opts.start||0,bytesEnd=Math.max(bytesStart,"number"==typeof opts.end?opts.end:st.size-1);function onend(err,end){!err&&range&&(ended||stream.destroyed||(missing++,content.undownload(range),range=content.download({start:offset,end:end,linear:!0},ondownload)))}function onstart(err,index,relativeOffset){if(err)return cb(err);ended||stream.destroyed||(rel=relativeOffset,offset=index,range=content.download({start:offset,end:end,linear:!0},ondownload),bytesEnd<st.size&&content.seek(st.byteOffset+bytesEnd,{start:offset,end:end},onend),readSlice(size,cb))}function ondownload(err){--missing||(!err||ended||downloaded?downloaded=!0:stream.destroy(err))}bytesMissing=bytesEnd-bytesStart+1,bytesStart?content.seek(st.byteOffset+bytesStart,{start:offset,end:end},onstart):onstart(null,bytesStart,0)})}function readSlice(size,cb){if(!content)return open(size,cb);if(!bytesMissing)return cb(null,null);content.get(offset++,function(err,data){if(err)return cb(err);rel&&(data=data.slice(rel),rel=0);bytesMissing&&(bytesMissing<data.length&&(data=data.slice(0,bytesMissing)),bytesMissing-=data.length);cb(null,data)})}function read(size,cb){return content?offset>=end?cb(null,null):void content.get(offset++,cb):open(size,cb)}},Hyperdrive.prototype.readFile=function(path,opts,cb){if("function"==typeof opts)return this.readFile(path,null,opts);"string"==typeof opts&&(opts={encoding:opts}),path=normalizePath(path);const enc=opts&&opts.encoding,bufs=[],rs=this.createReadStream(path);rs.on("data",function(data){bufs.push(data)}),rs.once("error",cb),rs.once("end",function(){const buf=1===bufs.length?bufs[0]:Buffer.concat(bufs);cb(null,enc&&"binary"!==enc?buf.toString(enc):buf)})},Hyperdrive.prototype.createDirectoryStream=function(path,opts){if(isOptions(path))return this.createDirectoryStream(null,path);const offset=directoryNameOffset(path=normalizePath(path)),recursive=!(!opts||!opts.recursive),ite=this.db.iterator(path,{recursive:recursive,gt:!0});return from.obj(function(size,cb){ite.next(function(err,node){return err?cb(err):node?recursive?cb(null,node.key):void cb(null,directoryName(node,offset)):cb(null,null)})})},Hyperdrive.prototype.readdir=function(path,cb){const offset=directoryNameOffset(path=normalizePath(path));this.db.list(path,{gt:!0,recursive:!1},function(err,nodes){if(err)return cb(err);for(var names=new Array(nodes.length),i=0;i<nodes.length;i++)names[i]=directoryName(nodes[i],offset);cb(null,names)})},Hyperdrive.prototype.writeFile=function(path,buf,opts,cb){if("function"==typeof opts)return this.writeFile(path,buf,null,opts);"string"==typeof opts&&(opts={encoding:opts}),opts||(opts={}),cb||(cb=noop),"string"==typeof buf&&(buf=Buffer.from(buf,opts.encoding));const ws=this.createWriteStream(path,opts);for(var i=0;i<buf.length;i+=65536)ws.write(buf.slice(i,i+65536));ws.once("finish",cb),ws.once("error",cb),ws.end()},Hyperdrive.prototype.createWriteStream=function(path,opts){opts||(opts={}),path=normalizePath(path);const self=this,db=this.db,st={size:0,blocks:0,offset:0,byteOffset:0,mode:(opts.mode||420)|stat.IFREG,uid:opts.uid,gid:opts.gid,mtime:getTime(opts.mtime),ctime:getTime(opts.ctime)};var opened=!1,release=null;return bulk(write,flush).once("close",unlock).once("finish",unlock);function open(batch,cb){db.ready(function(err){if(err)return cb(err);function done(err){if(err)return cb(err);batch?write(batch,cb):flush(cb)}self._lock(function(r){release=r,opened=!0,st.offset=db.localContent.length,st.byteOffset=db.localContent.byteLength;const data=self.localContentData;data.onappend?data.onappend(path,st,done):done(null)})})}function write(batch,cb){if(!opened)return open(batch,cb);db.localContent.append(batch,cb)}function flush(cb){if(!opened)return open(null,cb);st.size=db.localContent.byteLength-st.byteOffset,st.blocks=db.localContent.length-st.offset,db.put(path,st,cb)}function unlock(){if(!release)return;const r=release;release=null,r()}},Hyperdrive.prototype.unlink=function(path,opts,cb){if("function"==typeof opts)return this.unlink(path,null,opts);opts||(opts={}),cb||(cb=noop);const self=this,db=this.db;path=normalizePath(path),this.ready(function(err){if(err)return cb(err);self._lock(function(release){const data=self.localContentData;if(!data.onunlink)return onunlink(null);function onunlink(err){if(err)return done(err);const del={mode:0,mtime:getTime(opts.mtime),ctime:getTime(opts.ctime),offset:db.localContent.length,byteOffset:db.localContent.byteLength};db.put(path,del,{delete:!0},done)}function done(err){release(cb,err)}data.onunlink(path,onunlink)})})},Hyperdrive.prototype.access=function(path,cb){this.stat(path,function(err){cb(err)})},Hyperdrive.prototype.exists=function(path,cb){this.access(path,function(err){cb(!err)})},Hyperdrive.prototype.ready=function(cb){this.db.ready(cb)}}).call(this,require("buffer").Buffer)},{"./lib/errors":85,"./lib/iterator":86,"./lib/messages":87,"./lib/stat":88,"./lib/storage":89,buffer:26,"bulk-write-stream":27,events:21,from2:45,hyperdb:64,inherits:92,"is-options":95,mutexify:108,path:115,"random-access-file":126}],85:[function(require,module,exports){class ExtendableError extends Error{constructor(msg,syscall,path,errno){super(msg),this.name=this.constructor.name,this.message=`${msg}, ${syscall} '${path}'`,this.code=this.name,this.errno=errno,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error(msg).stack}}exports.ENOENT=class extends ExtendableError{constructor(syscall,path){super("no such file or directory",syscall,path,-2)}},exports.EPROTO=class extends ExtendableError{constructor(syscall,path){super("protocol error",syscall,path,38)}},exports.ENOTEMPTY=class extends ExtendableError{constructor(syscall,path){super("directory not empty",syscall,path,53)}},exports.ENOTDIR=class extends ExtendableError{constructor(syscall,path){super("not a directory",syscall,path,27)}}},{}],86:[function(require,module,exports){const thunky=require("thunky");function Iterator(archive,path,opts){if(!(this instanceof Iterator))return new Iterator(archive,path,opts);const self=this;this.path=path,this.opened=!1,this.position=0,this.index=0,this.offset=0,this.open=thunky(function(cb){archive.stat(path,function(err,st){return err?cb(err):st.isFile()?(self._content=archive.db.contentFeeds[st.feed],self._stat=st,self._start=st.offset,self._end=st.offset+st.blocks,0===self._seekTo&&self._download&&(self._range=self._content.download({start:self._start,end:self._end,linear:!0})),void cb(null)):cb(new Error("Not a file"))})}),this._content=null,this._stat=null,this._seekTo=0,this._seeking=!0,this._start=0,this._end=0,this._range=null,this._download=!opts||!1!==opts.download,this.open()}function noop(){}module.exports=Iterator,Iterator.prototype.seek=function(pos){return pos===this.position&&-1===this._seekTo?this:(this._seeking=!0,this._seekTo=pos,this)},Iterator.prototype._seek=function(bytes,cb){const self=this;function onseek(err,index,offset){if(err)return cb(err);cb(null,bytes,index,offset)}this.open(function(err){if(err)return cb(err);bytes<0&&(bytes+=self._stat.size),bytes<0&&(bytes=0),bytes>self._stat.size&&(bytes=self._stat.size);const st=self._stat,opts={start:self._start,end:self._end};return 0===bytes?onseek(null,self._start,0):bytes===self._stat.size?onseek(self._end,0):void self._content.seek(st.byteOffset+bytes,opts,onseek)})},Iterator.prototype.next=function(cb){this._seeking?this._seekAndNext(cb):this._next(this.position,this.index,this.offset,cb)},Iterator.prototype.close=function(cb){cb||(cb=noop);const self=this;this.open(function(err){if(err)return cb(err);self._range&&self._content.undownload(self._range),cb()})},Iterator.prototype._next=function(pos,index,offset,cb){if(index<this._start||index>=this._end)return cb(null,null);const self=this;this._content.get(this.index,function(err,data){if(err)return cb(err);offset&&(data=data.slice(offset)),self.position=pos+data.length,self.offset=0,self.index++,cb(null,data)})},Iterator.prototype._seekAndNext=function(cb){const self=this,seekTo=this._seekTo;this._seek(seekTo,function(err,pos,index,offset){if(err)return cb(err);seekTo===self._seekTo&&(self._seeking=!1,self._seekTo=-1,self.position=pos,self.index=index,self.offset=offset,self._download&&(self._range&&self._content.undownload(self._range),self._range=self._content.download({start:self.index,end:self._end,linear:!0}))),self._next(pos,index,offset,cb)})}},{thunky:90}],87:[function(require,module,exports){(function(Buffer){var encodings=require("protocol-buffers-encodings"),varint=encodings.varint,skip=encodings.skip,Index=exports.Index={buffer:!0,encodingLength:null,encode:null,decode:null},Stat=exports.Stat={buffer:!0,encodingLength:null,encode:null,decode:null};function defined(val){return null!==val&&void 0!==val&&("number"!=typeof val||!isNaN(val))}!function(){var enc=[encodings.string,encodings.bytes];function encodingLength(obj){var length=0;if(!defined(obj.type))throw new Error("type is required");var len=enc[0].encodingLength(obj.type);if(length+=1+len,defined(obj.content)){var len=enc[1].encodingLength(obj.content);length+=1+len}return length}Index.encodingLength=encodingLength,Index.encode=function encode(obj,buf,offset){offset||(offset=0);buf||(buf=Buffer.allocUnsafe(encodingLength(obj)));var oldOffset=offset;if(!defined(obj.type))throw new Error("type is required");buf[offset++]=10;enc[0].encode(obj.type,buf,offset);offset+=enc[0].encode.bytes;defined(obj.content)&&(buf[offset++]=18,enc[1].encode(obj.content,buf,offset),offset+=enc[1].encode.bytes);encode.bytes=offset-oldOffset;return buf},Index.decode=function decode(buf,offset,end){offset||(offset=0);end||(end=buf.length);if(!(end<=buf.length&&offset<=buf.length))throw new Error("Decoded message is not valid");var oldOffset=offset;var obj={type:"",content:null};var found0=!1;for(;;){if(end<=offset){if(!found0)throw new Error("Decoded message is not valid");return decode.bytes=offset-oldOffset,obj}var prefix=varint.decode(buf,offset);offset+=varint.decode.bytes;var tag=prefix>>3;switch(tag){case 1:obj.type=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes,found0=!0;break;case 2:obj.content=enc[1].decode(buf,offset),offset+=enc[1].decode.bytes;break;default:offset=skip(7&prefix,buf,offset)}}}}(),function(){var enc=[encodings.varint];function encodingLength(obj){var length=0;if(!defined(obj.mode))throw new Error("mode is required");var len=enc[0].encodingLength(obj.mode);if(length+=1+len,defined(obj.uid)){var len=enc[0].encodingLength(obj.uid);length+=1+len}if(defined(obj.gid)){var len=enc[0].encodingLength(obj.gid);length+=1+len}if(defined(obj.size)){var len=enc[0].encodingLength(obj.size);length+=1+len}if(defined(obj.blocks)){var len=enc[0].encodingLength(obj.blocks);length+=1+len}if(defined(obj.offset)){var len=enc[0].encodingLength(obj.offset);length+=1+len}if(defined(obj.byteOffset)){var len=enc[0].encodingLength(obj.byteOffset);length+=1+len}if(defined(obj.mtime)){var len=enc[0].encodingLength(obj.mtime);length+=1+len}if(defined(obj.ctime)){var len=enc[0].encodingLength(obj.ctime);length+=1+len}return length}Stat.encodingLength=encodingLength,Stat.encode=function encode(obj,buf,offset){offset||(offset=0);buf||(buf=Buffer.allocUnsafe(encodingLength(obj)));var oldOffset=offset;if(!defined(obj.mode))throw new Error("mode is required");buf[offset++]=8;enc[0].encode(obj.mode,buf,offset);offset+=enc[0].encode.bytes;defined(obj.uid)&&(buf[offset++]=16,enc[0].encode(obj.uid,buf,offset),offset+=enc[0].encode.bytes);defined(obj.gid)&&(buf[offset++]=24,enc[0].encode(obj.gid,buf,offset),offset+=enc[0].encode.bytes);defined(obj.size)&&(buf[offset++]=32,enc[0].encode(obj.size,buf,offset),offset+=enc[0].encode.bytes);defined(obj.blocks)&&(buf[offset++]=40,enc[0].encode(obj.blocks,buf,offset),offset+=enc[0].encode.bytes);defined(obj.offset)&&(buf[offset++]=48,enc[0].encode(obj.offset,buf,offset),offset+=enc[0].encode.bytes);defined(obj.byteOffset)&&(buf[offset++]=56,enc[0].encode(obj.byteOffset,buf,offset),offset+=enc[0].encode.bytes);defined(obj.mtime)&&(buf[offset++]=64,enc[0].encode(obj.mtime,buf,offset),offset+=enc[0].encode.bytes);defined(obj.ctime)&&(buf[offset++]=72,enc[0].encode(obj.ctime,buf,offset),offset+=enc[0].encode.bytes);encode.bytes=offset-oldOffset;return buf},Stat.decode=function decode(buf,offset,end){offset||(offset=0);end||(end=buf.length);if(!(end<=buf.length&&offset<=buf.length))throw new Error("Decoded message is not valid");var oldOffset=offset;var obj={mode:0,uid:0,gid:0,size:0,blocks:0,offset:0,byteOffset:0,mtime:0,ctime:0};var found0=!1;for(;;){if(end<=offset){if(!found0)throw new Error("Decoded message is not valid");return decode.bytes=offset-oldOffset,obj}var prefix=varint.decode(buf,offset);offset+=varint.decode.bytes;var tag=prefix>>3;switch(tag){case 1:obj.mode=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes,found0=!0;break;case 2:obj.uid=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes;break;case 3:obj.gid=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes;break;case 4:obj.size=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes;break;case 5:obj.blocks=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes;break;case 6:obj.offset=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes;break;case 7:obj.byteOffset=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes;break;case 8:obj.mtime=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes;break;case 9:obj.ctime=enc[0].decode(buf,offset),offset+=enc[0].decode.bytes;break;default:offset=skip(7&prefix,buf,offset)}}}}()}).call(this,require("buffer").Buffer)},{buffer:26,"protocol-buffers-encodings":119}],88:[function(require,module,exports){function Stat(data,source,implicit){if(!(this instanceof Stat))return new Stat(data,source,implicit);this.dev=0,this.nlink=1,this.rdev=0,this.blksize=0,this.ino=0,this.mode=data?data.mode:0,this.uid=data?data.uid:0,this.gid=data?data.gid:0,this.size=data?data.size:0,this.offset=data?data.offset:0,this.byteOffset=data?data.byteOffset:0,this.blocks=data?data.blocks:0,this.atime=new Date(data?data.mtime:0),this.mtime=new Date(data?data.mtime:0),this.ctime=new Date(data?data.ctime:0),this.implicit=implicit,this.feed=source?source.feed:0,this.seq=source?source.seq:0}function check(mask){return function(){return(mask&this.mode)===mask}}module.exports=Stat,Stat.IFSOCK=49152,Stat.IFLNK=40960,Stat.IFREG=32768,Stat.IFBLK=24576,Stat.IFDIR=16384,Stat.IFCHR=8192,Stat.IFIFO=4096,Stat.prototype.isSocket=check(Stat.IFSOCK),Stat.prototype.isSymbolicLink=check(Stat.IFLNK),Stat.prototype.isFile=check(Stat.IFREG),Stat.prototype.isBlockDevice=check(Stat.IFBLK),Stat.prototype.isDirectory=check(Stat.IFDIR),Stat.prototype.isCharacterDevice=check(Stat.IFCHR),Stat.prototype.isFIFO=check(Stat.IFIFO)},{}],89:[function(require,module,exports){const inherits=require("inherits"),sorted=require("sorted-array-functions"),raf=require("random-access-file"),ras=require("random-access-storage"),Entry=require("hyperdb/lib/messages").Entry,Stat=require("./messages").Stat,fs=require("fs"),path=require("path");function Storage(dir,opts){if(!(this instanceof Storage))return new Storage(dir,opts);ras.call(this),this.cache=[],this.metadata=opts.metadata,this.content=opts.feed,this.directory=dir}function find(cache,target){const index=sorted.lte(cache,target,compare),found=index>-1?cache[index]:null;return found&&0===compare(found,target)?found:null}function compare(a,b){const end=a.byteOffset+a.size;return b.byteOffset>=a.byteOffset&&b.byteOffset<end?0:end<=b.byteOffset?-1:1}function midpoint(a,b,feed){return Math.floor((a+b)/2)}module.exports=Storage,inherits(Storage,ras),Storage.prototype.onunlink=function(filename,cb){filename=path.join("/",filename),fs.unlink(path.join(this.directory,filename),function(){cb(null)})},Storage.prototype.onappend=function(filename,st,cb){if(this.cache.length){const top=this.cache[this.cache.length-1];top.size===1/0&&(top.size=this.content.byteLength-top.byteOffset)}const self=this;this._limitCache(function retry(err){return err?cb(err):self.cache.length>=128?self._limitCache(retry):(self.cache.push({byteOffset:self.content.byteLength,size:1/0,storage:raf(filename,{truncate:!0,directory:self.directory})}),void cb(null))})},Storage.prototype._limitCache=function(cb){if(this.cache.length<128)return cb(null);for(;;){const i=Math.floor(Math.random()*this.cache.length),close=this.cache[i];if(close.size!==1/0){if(this.cache.splice(i,1),!(this.cache.length>=128))return void close.storage.close(cb);close.storage.close()}}},Storage.prototype._open=function(req){var missing=2,error=null;function done(err){err&&(error=err),--missing||req.callback(error)}this.content.ready(done),this.metadata.ready(done)},Storage.prototype._write=Storage.prototype._read=function(req){this._switch(req,null)},Storage.prototype._switchAsync=function(req){const self=this,target={byteOffset:req.offset};!function(feed,search,cb){var top=feed.length,btm=1,mid=midpoint(btm,top);feed.get(mid,{valueEncoding:Entry},function loop(err,entry){if(err)return cb(err);const val=Stat.decode(entry.value);const cmp=compare(val,search);if(!cmp)return cb(null,entry,val);if(top-btm<=1)return cb(null,entry,null);cmp>0?top=mid:btm=mid;mid=midpoint(btm,top,feed);if(-1===mid)return cb(null,null,null);feed.get(mid,{valueEncoding:Entry},loop)})}(this.metadata,target,function(err,entry,val){return err?req.callback(err):val?find(self.cache,target)?self._switch(req):void self._limitCache(function retry(err){if(err)return req.callback(err);if(self.cache.length>=128)return self._limitCache(retry);const file={byteOffset:val.byteOffset,size:val.size,storage:raf(entry.key,{directory:self.directory})};sorted.add(self.cache,file,compare),self._switch(req,file)}):req.callback(new Error("Offset not found"))})},Storage.prototype._switch=function(req,found){if(found||(found=find(this.cache,{byteOffset:req.offset})),!found)return this._switchAsync(req);const offset=req.offset-found.byteOffset,cb=req.callback.bind(req);switch(req.type){case 1:found.storage.read(offset,req.size,cb);break;case 2:found.storage.write(offset,req.data,cb)}}},{"./messages":87,fs:20,"hyperdb/lib/messages":72,inherits:92,path:115,"random-access-file":126,"random-access-storage":135,"sorted-array-functions":168}],90:[function(require,module,exports){arguments[4][62][0].apply(exports,arguments)},{_process:118,dup:62}],91:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:1/0*(s?-1:1);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=value<0||0===value&&1/value<0?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),(value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias))*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},{}],92:[function(require,module,exports){arguments[4][6][0].apply(exports,arguments)},{dup:6}],93:[function(require,module,exports){module.exports=Symbol.for("util.inspect.custom")},{}],94:[function(require,module,exports){function isBuffer(obj){return!!obj.constructor&&"function"==typeof obj.constructor.isBuffer&&obj.constructor.isBuffer(obj)}module.exports=function(obj){return null!=obj&&(isBuffer(obj)||function(obj){return"function"==typeof obj.readFloatLE&&"function"==typeof obj.slice&&isBuffer(obj.slice(0,0))}(obj)||!!obj._isBuffer)}},{}],95:[function(require,module,exports){(function(Buffer){module.exports=function(opts){return"object"==typeof opts&&opts&&!Buffer.isBuffer(opts)}}).call(this,{isBuffer:require("../is-buffer/index.js")})},{"../is-buffer/index.js":94}],96:[function(require,module,exports){var toString={}.toString;module.exports=Array.isArray||function(arr){return"[object Array]"==toString.call(arr)}},{}],97:[function(require,module,exports){function noop(_){}module.exports=function(work){var pending=null,callback=null,callbacks=null,next=null;return function(val,cb){next=val,update(cb||noop)};function update(cb){if(callback)return pending||(pending=[]),void pending.push(cb);var val=next;next=null,callback=cb,work(val,done)}function done(err){var cb=callback,cbs=callbacks;if(callbacks=null,callback=null,pending&&(callbacks=pending,pending=null,update(noop)),cbs)for(var i=0;i<cbs.length;i++)cbs[i](err);cb(err)}}},{}],98:[function(require,module,exports){var varint=require("varint"),stream=require("readable-stream"),util=require("util"),bufferAlloc=require("buffer-alloc-unsafe"),Decoder=function(opts){if(!(this instanceof Decoder))return new Decoder(opts);stream.Transform.call(this),this._destroyed=!1,this._missing=0,this._message=null,this._limit=opts&&opts.limit||0,this._allowEmpty=!(!opts||!opts.allowEmpty),this._prefix=bufferAlloc(this._limit?varint.encodingLength(this._limit):100),this._ptr=0,this._allowEmpty&&(this._readableState.highWaterMark=16,this._readableState.objectMode=!0)};util.inherits(Decoder,stream.Transform),Decoder.prototype._push=function(message){this._ptr=0,this._missing=0,this._message=null,this.push(message)},Decoder.prototype._parseLength=function(data,offset){for(;offset<data.length;offset++){if(this._ptr>=this._prefix.length)return this._prefixError(data);if(this._prefix[this._ptr++]=data[offset],!(128&data[offset]))return this._missing=varint.decode(this._prefix),this._limit&&this._missing>this._limit?this._prefixError(data):(!this._missing&&this._allowEmpty&&this._push(bufferAlloc(0)),this._ptr=0,offset+1)}return data.length},Decoder.prototype._prefixError=function(data){return this.destroy(new Error("Message is larger than max length")),data.length},Decoder.prototype._parseMessage=function(data,offset){var free=data.length-offset,missing=this._missing;if(!this._message){if(missing<=free)return this._push(data.slice(offset,offset+missing)),offset+missing;this._message=bufferAlloc(missing)}return data.copy(this._message,this._ptr,offset,offset+missing),missing<=free?(this._push(this._message),offset+missing):(this._missing-=free,this._ptr+=free,data.length)},Decoder.prototype._transform=function(data,enc,cb){for(var offset=0;!this._destroyed&&offset<data.length;)offset=this._missing?this._parseMessage(data,offset):this._parseLength(data,offset);cb()},Decoder.prototype.destroy=function(err){this._destroyed||(this._destroyed=!0,err&&this.emit("error",err),this.emit("close"))},module.exports=Decoder},{"buffer-alloc-unsafe":22,"readable-stream":147,util:180,varint:103}],99:[function(require,module,exports){var varint=require("varint"),stream=require("readable-stream"),util=require("util"),bufferAlloc=require("buffer-alloc-unsafe"),pool=bufferAlloc(10240),used=0,Encoder=function(){if(!(this instanceof Encoder))return new Encoder;stream.Transform.call(this),this._destroyed=!1};util.inherits(Encoder,stream.Transform),Encoder.prototype._transform=function(data,enc,cb){if(this._destroyed)return cb();varint.encode(data.length,pool,used),used+=varint.encode.bytes,this.push(pool.slice(used-varint.encode.bytes,used)),this.push(data),pool.length-used<100&&(pool=bufferAlloc(10240),used=0),cb()},Encoder.prototype.destroy=function(err){this._destroyed||(this._destroyed=!0,err&&this.emit("error",err),this.emit("close"))},module.exports=Encoder},{"buffer-alloc-unsafe":22,"readable-stream":147,util:180,varint:103}],100:[function(require,module,exports){exports.encode=require("./encode"),exports.decode=require("./decode")},{"./decode":98,"./encode":99}],101:[function(require,module,exports){arguments[4][51][0].apply(exports,arguments)},{dup:51}],102:[function(require,module,exports){arguments[4][13][0].apply(exports,arguments)},{dup:13}],103:[function(require,module,exports){arguments[4][14][0].apply(exports,arguments)},{"./decode.js":101,"./encode.js":102,"./length.js":104,dup:14}],104:[function(require,module,exports){arguments[4][15][0].apply(exports,arguments)},{dup:15}],105:[function(require,module,exports){(function(Buffer){function Pager(pageSize,opts){if(!(this instanceof Pager))return new Pager(pageSize,opts);this.length=0,this.updates=[],this.path=new Uint16Array(4),this.pages=new Array(32768),this.maxPages=this.pages.length,this.level=0,this.pageSize=pageSize||1024,this.deduplicate=opts?opts.deduplicate:null,this.zeros=this.deduplicate?alloc(this.deduplicate.length):null}function alloc(size){if(Buffer.alloc)return Buffer.alloc(size);var buf=new Buffer(size);return buf.fill(0),buf}function Page(i,buf){this.offset=i*buf.length,this.buffer=buf,this.updated=!1,this.deduplicate=0}module.exports=Pager,Pager.prototype.updated=function(page){for(;this.deduplicate&&page.buffer[page.deduplicate]===this.deduplicate[page.deduplicate];)if(page.deduplicate++,page.deduplicate===this.deduplicate.length){page.deduplicate=0,page.buffer.equals&&page.buffer.equals(this.deduplicate)&&(page.buffer=this.deduplicate);break}!page.updated&&this.updates&&(page.updated=!0,this.updates.push(page))},Pager.prototype.lastUpdate=function(){if(!this.updates||!this.updates.length)return null;var page=this.updates.pop();return page.updated=!1,page},Pager.prototype._array=function(i,noAllocate){if(i>=this.maxPages){if(noAllocate)return;!function(pager,index){for(;pager.maxPages<index;){var old=pager.pages;pager.pages=new Array(32768),pager.pages[0]=old,pager.level++,pager.maxPages*=32768}}(this,i)}var n,out;n=i,out=this.path,n=((n=(n-(out[0]=32767&n))/32768)-(out[1]=32767&n))/32768,out[3]=(n-(out[2]=32767&n))/32768&32767;for(var arr=this.pages,j=this.level;j>0;j--){var p=this.path[j],next=arr[p];if(!next){if(noAllocate)return;next=arr[p]=new Array(32768)}arr=next}return arr},Pager.prototype.get=function(i,noAllocate){var buf,cpy,arr=this._array(i,noAllocate),first=this.path[0],page=arr&&arr[first];return page||noAllocate||(page=arr[first]=new Page(i,alloc(this.pageSize)),i>=this.length&&(this.length=i+1)),page&&page.buffer===this.deduplicate&&this.deduplicate&&!noAllocate&&(page.buffer=(buf=page.buffer,cpy=Buffer.allocUnsafe?Buffer.allocUnsafe(buf.length):new Buffer(buf.length),buf.copy(cpy),cpy),page.deduplicate=0),page},Pager.prototype.set=function(i,buf){var arr=this._array(i,!1),first=this.path[0];if(i>=this.length&&(this.length=i+1),!buf||this.zeros&&buf.equals&&buf.equals(this.zeros))arr[first]=void 0;else{this.deduplicate&&buf.equals&&buf.equals(this.deduplicate)&&(buf=this.deduplicate);var page=arr[first],b=function(buf,len){if(buf.length===len)return buf;if(buf.length>len)return buf.slice(0,len);var cpy=alloc(len);return buf.copy(cpy),cpy}(buf,this.pageSize);page?page.buffer=b:arr[first]=new Page(i,b)}},Pager.prototype.toBuffer=function(){for(var list=new Array(this.length),empty=alloc(this.pageSize),ptr=0;ptr<list.length;)for(var arr=this._array(ptr,!0),i=0;i<32768&&ptr<list.length;i++)list[ptr++]=arr&&arr[i]?arr[i].buffer:empty;return Buffer.concat(list)}}).call(this,require("buffer").Buffer)},{buffer:26}],106:[function(require,module,exports){(function(Buffer){var flat=require("flat-tree");function MerkleGenerator(opts,roots){if(!(this instanceof MerkleGenerator))return new MerkleGenerator(opts,roots);if(!opts||!opts.leaf||!opts.parent)throw new Error("opts.leaf and opts.parent required");this.roots=roots||opts.roots||[],this.blocks=this.roots.length?1+flat.rightSpan(this.roots[this.roots.length-1].index)/2:0;for(var i=0;i<this.roots.length;i++){var r=this.roots[i];r&&!r.parent&&(r.parent=flat.parent(r.index))}this._leaf=opts.leaf,this._parent=opts.parent}module.exports=MerkleGenerator,MerkleGenerator.prototype.next=function(data,nodes){Buffer.isBuffer(data)||(data=new Buffer(data)),nodes||(nodes=[]);var index=2*this.blocks++,leaf={index:index,parent:flat.parent(index),hash:null,size:data.length,data:data};for(leaf.hash=this._leaf(leaf,this.roots),this.roots.push(leaf),nodes.push(leaf);this.roots.length>1;){var left=this.roots[this.roots.length-2],right=this.roots[this.roots.length-1];if(left.parent!==right.parent)break;this.roots.pop(),this.roots[this.roots.length-1]=leaf={index:left.parent,parent:flat.parent(left.parent),hash:this._parent(left,right),size:left.size+right.size,data:null},nodes.push(leaf)}return nodes}}).call(this,require("buffer").Buffer)},{buffer:26,"flat-tree":44}],107:[function(require,module,exports){var s=1e3,m=60*s,h=60*m,d=24*h,y=365.25*d;function plural(ms,n,name){if(!(ms<n))return ms<1.5*n?Math.floor(ms/n)+" "+name:Math.ceil(ms/n)+" "+name+"s"}module.exports=function(val,options){options=options||{};var ms,type=typeof val;if("string"===type&&val.length>0)return function(str){if((str=String(str)).length>100)return;var match=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(str);if(!match)return;var n=parseFloat(match[1]);switch((match[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*y;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"hrs":case"hr":case"h":return n*h;case"minutes":case"minute":case"mins":case"min":case"m":return n*m;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(val);if("number"===type&&!1===isNaN(val))return options.long?plural(ms=val,d,"day")||plural(ms,h,"hour")||plural(ms,m,"minute")||plural(ms,s,"second")||ms+" ms":function(ms){if(ms>=d)return Math.round(ms/d)+"d";if(ms>=h)return Math.round(ms/h)+"h";if(ms>=m)return Math.round(ms/m)+"m";if(ms>=s)return Math.round(ms/s)+"s";return ms+"ms"}(val);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(val))}},{}],108:[function(require,module,exports){(function(process){module.exports=function(){var queue=[],used=null,call=function(){used(release)},acquire=function(fn){return used?queue.push(fn):(used=fn,acquire.locked=!0,process.nextTick(call),0)};acquire.locked=!1;var release=function(fn,err,value){used=null,acquire.locked=!1,queue.length&&acquire(queue.shift()),fn&&fn(err,value)};return acquire}}).call(this,require("_process"))},{_process:118}],109:[function(require,module,exports){function assert(t,m){if(!t)throw new Error(m||"AssertionError")}assert.notEqual=function(a,b,m){assert(a!=b,m)},assert.notOk=function(t,m){assert(!t,m)},assert.equal=function(a,b,m){assert(a==b,m)},assert.ok=assert,module.exports=assert},{}],110:[function(require,module,exports){(function(process){function NanoIterator(opts){if(!(this instanceof NanoIterator))return new NanoIterator(opts);this.opened=!1,this.closed=!1,this.ended=!1,this._nextSync=!1,this._nextQueue=[],this._nextCallback=null,this._nextDone=nextDone.bind(null,this),this._openDone=function(self,err){if(err)return nextDone(self,err,null);self.opened=!0,update(self)}.bind(null,this),opts&&(opts.open&&(this._open=opts.open),opts.next&&(this._next=opts.next),opts.destroy&&(this._destroy=opts.destroy))}function noop(){}function nextDone(self,err,value){if(self._nextSync)return nextDoneNT(self,err,value);self.closed&&(err=new Error("Iterator is destroyed"),value=null);var cb=self._nextCallback;self._nextCallback=null,err||null!==value||(self.ended=!0),cb(err,value),!self._nextCallback&&self._nextQueue.length&&(self._nextCallback=self._nextQueue.shift(),update(self))}function update(self){self.ended||self.closed?nextDoneNT(self,null,null):self._next(self._nextDone)}function nextDoneNT(self,err,val){process.nextTick(nextDone,self,err,val)}module.exports=NanoIterator,NanoIterator.prototype.next=function(cb){this._nextCallback||this._nextQueue.length?this._nextQueue.push(cb):(this._nextCallback=cb,this._nextSync=!0,this.opened?update(this):this._open(this._openDone),this._nextSync=!1)},NanoIterator.prototype.destroy=function(cb){cb||(cb=noop),this.closed?this.next(()=>cb()):(this.closed=!0,this._nextCallback||(this.opened=!0),this.next(()=>this._destroy(cb)))},NanoIterator.prototype._open=function(cb){cb(null)},NanoIterator.prototype._destroy=function(cb){cb(null)},NanoIterator.prototype._next=function(cb){cb(new Error("_next is not implemented"))},"undefined"!=typeof Symbol&&Symbol.asyncIterator&&(NanoIterator.prototype[Symbol.asyncIterator]=function(){var self=this;return{next:function(){return new Promise(function(resolve,reject){self.next(function(err,val){if(err)return reject(err);resolve({value:val,done:null===val})})})}}})}).call(this,require("_process"))},{_process:118}],111:[function(require,module,exports){var stream=require("readable-stream"),inherits=require("inherits");function IteratorStream(ite){if(!(this instanceof IteratorStream))return new IteratorStream(ite);stream.Readable.call(this,{objectMode:!0}),this.iterator=ite,this.onread=function(self,err,value){err?self.destroy(err):self.push(value)}.bind(null,this),this.destroyed=!1}module.exports=IteratorStream,inherits(IteratorStream,stream.Readable),IteratorStream.prototype._read=function(){this.iterator.next(this.onread)},IteratorStream.prototype.destroy=function(err){if(!this.destroyed){this.destroyed=!0;var self=this;this.iterator.destroy(function(error){err||(err=error),err&&self.emit("error",err),self.emit("close")})}}},{inherits:92,"readable-stream":147}],112:[function(require,module,exports){(function(process,setImmediate){"use strict";var callable,byObserver;callable=function(fn){if("function"!=typeof fn)throw new TypeError(fn+" is not a function");return fn},byObserver=function(Observer){var queue,currentQueue,node=document.createTextNode(""),i=0;return new Observer(function(){var callback;if(queue)currentQueue&&(queue=currentQueue.concat(queue));else{if(!currentQueue)return;queue=currentQueue}if(currentQueue=queue,queue=null,"function"==typeof currentQueue)return callback=currentQueue,currentQueue=null,void callback();for(node.data=i=++i%2;currentQueue;)callback=currentQueue.shift(),currentQueue.length||(currentQueue=null),callback()}).observe(node,{characterData:!0}),function(fn){callable(fn),queue?"function"==typeof queue?queue=[queue,fn]:queue.push(fn):(queue=fn,node.data=i=++i%2)}},module.exports=function(){if("object"==typeof process&&process&&"function"==typeof process.nextTick)return process.nextTick;if("object"==typeof document&&document){if("function"==typeof MutationObserver)return byObserver(MutationObserver);if("function"==typeof WebKitMutationObserver)return byObserver(WebKitMutationObserver)}return"function"==typeof setImmediate?function(cb){setImmediate(callable(cb))}:"function"==typeof setTimeout||"object"==typeof setTimeout?function(cb){setTimeout(callable(cb),0)}:null}()}).call(this,require("_process"),require("timers").setImmediate)},{_process:118,timers:175}],113:[function(require,module,exports){"use strict";var getOwnPropertySymbols=Object.getOwnPropertySymbols,hasOwnProperty=Object.prototype.hasOwnProperty,propIsEnumerable=Object.prototype.propertyIsEnumerable;module.exports=function(){try{if(!Object.assign)return!1;var test1=new String("abc");if(test1[5]="de","5"===Object.getOwnPropertyNames(test1)[0])return!1;for(var test2={},i=0;i<10;i++)test2["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(test2).map(function(n){return test2[n]}).join(""))return!1;var test3={};return"abcdefghijklmnopqrst".split("").forEach(function(letter){test3[letter]=letter}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},test3)).join("")}catch(err){return!1}}()?Object.assign:function(target,source){for(var from,symbols,to=function(val){if(null===val||void 0===val)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(val)}(target),s=1;s<arguments.length;s++){for(var key in from=Object(arguments[s]))hasOwnProperty.call(from,key)&&(to[key]=from[key]);if(getOwnPropertySymbols){symbols=getOwnPropertySymbols(from);for(var i=0;i<symbols.length;i++)propIsEnumerable.call(from,symbols[i])&&(to[symbols[i]]=from[symbols[i]])}}return to}},{}],114:[function(require,module,exports){var wrappy=require("wrappy");function once(fn){var f=function(){return f.called?f.value:(f.called=!0,f.value=fn.apply(this,arguments))};return f.called=!1,f}function onceStrict(fn){var f=function(){if(f.called)throw new Error(f.onceError);return f.called=!0,f.value=fn.apply(this,arguments)},name=fn.name||"Function wrapped with `once`";return f.onceError=name+" shouldn't be called more than once",f.called=!1,f}module.exports=wrappy(once),module.exports.strict=wrappy(onceStrict),once.proto=once(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return once(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return onceStrict(this)},configurable:!0})})},{wrappy:184}],115:[function(require,module,exports){(function(process){function normalizeArray(parts,allowAboveRoot){for(var up=0,i=parts.length-1;i>=0;i--){var last=parts[i];"."===last?parts.splice(i,1):".."===last?(parts.splice(i,1),up++):up&&(parts.splice(i,1),up--)}if(allowAboveRoot)for(;up--;up)parts.unshift("..");return parts}function filter(xs,f){if(xs.filter)return xs.filter(f);for(var res=[],i=0;i<xs.length;i++)f(xs[i],i,xs)&&res.push(xs[i]);return res}exports.resolve=function(){for(var resolvedPath="",resolvedAbsolute=!1,i=arguments.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if("string"!=typeof path)throw new TypeError("Arguments to path.resolve must be strings");path&&(resolvedPath=path+"/"+resolvedPath,resolvedAbsolute="/"===path.charAt(0))}return resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/"),(resolvedAbsolute?"/":"")+resolvedPath||"."},exports.normalize=function(path){var isAbsolute=exports.isAbsolute(path),trailingSlash="/"===substr(path,-1);return(path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/"))||isAbsolute||(path="."),path&&trailingSlash&&(path+="/"),(isAbsolute?"/":"")+path},exports.isAbsolute=function(path){return"/"===path.charAt(0)},exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p,index){if("string"!=typeof p)throw new TypeError("Arguments to path.join must be strings");return p}).join("/"))},exports.relative=function(from,to){function trim(arr){for(var start=0;start<arr.length&&""===arr[start];start++);for(var end=arr.length-1;end>=0&&""===arr[end];end--);return start>end?[]:arr.slice(start,end-start+1)}from=exports.resolve(from).substr(1),to=exports.resolve(to).substr(1);for(var fromParts=trim(from.split("/")),toParts=trim(to.split("/")),length=Math.min(fromParts.length,toParts.length),samePartsLength=length,i=0;i<length;i++)if(fromParts[i]!==toParts[i]){samePartsLength=i;break}var outputParts=[];for(i=samePartsLength;i<fromParts.length;i++)outputParts.push("..");return(outputParts=outputParts.concat(toParts.slice(samePartsLength))).join("/")},exports.sep="/",exports.delimiter=":",exports.dirname=function(path){if("string"!=typeof path&&(path+=""),0===path.length)return".";for(var code=path.charCodeAt(0),hasRoot=47===code,end=-1,matchedSlash=!0,i=path.length-1;i>=1;--i)if(47===(code=path.charCodeAt(i))){if(!matchedSlash){end=i;break}}else matchedSlash=!1;return-1===end?hasRoot?"/":".":hasRoot&&1===end?"/":path.slice(0,end)},exports.basename=function(path,ext){var f=function(path){"string"!=typeof path&&(path+="");var i,start=0,end=-1,matchedSlash=!0;for(i=path.length-1;i>=0;--i)if(47===path.charCodeAt(i)){if(!matchedSlash){start=i+1;break}}else-1===end&&(matchedSlash=!1,end=i+1);return-1===end?"":path.slice(start,end)}(path);return ext&&f.substr(-1*ext.length)===ext&&(f=f.substr(0,f.length-ext.length)),f},exports.extname=function(path){"string"!=typeof path&&(path+="");for(var startDot=-1,startPart=0,end=-1,matchedSlash=!0,preDotState=0,i=path.length-1;i>=0;--i){var code=path.charCodeAt(i);if(47!==code)-1===end&&(matchedSlash=!1,end=i+1),46===code?-1===startDot?startDot=i:1!==preDotState&&(preDotState=1):-1!==startDot&&(preDotState=-1);else if(!matchedSlash){startPart=i+1;break}}return-1===startDot||-1===end||0===preDotState||1===preDotState&&startDot===end-1&&startDot===startPart+1?"":path.slice(startDot,end)};var substr="b"==="ab".substr(-1)?function(str,start,len){return str.substr(start,len)}:function(str,start,len){return start<0&&(start=str.length+start),str.substr(start,len)}}).call(this,require("_process"))},{_process:118}],116:[function(require,module,exports){(function(Buffer){module.exports=function(buf){return Buffer.isBuffer(buf)&&(buf=buf.toString("hex")),"string"==typeof buf&&buf.length>8?buf.slice(0,6)+".."+buf.slice(-2):buf}}).call(this,{isBuffer:require("../is-buffer/index.js")})},{"../is-buffer/index.js":94}],117:[function(require,module,exports){(function(process){"use strict";!process.version||0===process.version.indexOf("v0.")||0===process.version.indexOf("v1.")&&0!==process.version.indexOf("v1.8.")?module.exports={nextTick:function(fn,arg1,arg2,arg3){if("function"!=typeof fn)throw new TypeError('"callback" argument must be a function');var args,i,len=arguments.length;switch(len){case 0:case 1:return process.nextTick(fn);case 2:return process.nextTick(function(){fn.call(null,arg1)});case 3:return process.nextTick(function(){fn.call(null,arg1,arg2)});case 4:return process.nextTick(function(){fn.call(null,arg1,arg2,arg3)});default:for(args=new Array(len-1),i=0;i<args.length;)args[i++]=arguments[i];return process.nextTick(function(){fn.apply(null,args)})}}}:module.exports=process}).call(this,require("_process"))},{_process:118}],118:[function(require,module,exports){var cachedSetTimeout,cachedClearTimeout,process=module.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=runTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,function(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(marker);try{cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(name){return[]},process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],119:[function(require,module,exports){(function(Buffer){var varint=require("varint"),svarint=require("signed-varint");function encoder(type,encode,decode,encodingLength){return encode.bytes=decode.bytes=0,{type:type,encode:encode,decode:decode,encodingLength:encodingLength}}function bufferLength(val){return Buffer.isBuffer(val)?val.length:Buffer.byteLength(val)}exports.make=encoder,exports.name=function(enc){for(var keys=Object.keys(exports),i=0;i<keys.length;i++)if(exports[keys[i]]===enc)return keys[i];return null},exports.skip=function(type,buffer,offset){switch(type){case 0:return varint.decode(buffer,offset),offset+varint.decode.bytes;case 1:return offset+8;case 2:var len=varint.decode(buffer,offset);return offset+varint.decode.bytes+len;case 3:case 4:throw new Error("Groups are not supported");case 5:return offset+4}throw new Error("Unknown wire type: "+type)},exports.bytes=encoder(2,function encode(val,buffer,offset){var oldOffset=offset,len=bufferLength(val);return varint.encode(len,buffer,offset),offset+=varint.encode.bytes,Buffer.isBuffer(val)?val.copy(buffer,offset):buffer.write(val,offset,len),encode.bytes=(offset+=len)-oldOffset,buffer},function decode(buffer,offset){var oldOffset=offset,len=varint.decode(buffer,offset);offset+=varint.decode.bytes;var val=buffer.slice(offset,offset+len);return offset+=val.length,decode.bytes=offset-oldOffset,val},function(val){var len=bufferLength(val);return varint.encodingLength(len)+len}),exports.string=encoder(2,function encode(val,buffer,offset){var oldOffset=offset,len=Buffer.byteLength(val);return varint.encode(len,buffer,offset,"utf-8"),offset+=varint.encode.bytes,buffer.write(val,offset,len),encode.bytes=(offset+=len)-oldOffset,buffer},function decode(buffer,offset){var oldOffset=offset,len=varint.decode(buffer,offset);offset+=varint.decode.bytes;var val=buffer.toString("utf-8",offset,offset+len);return decode.bytes=(offset+=len)-oldOffset,val},function(val){var len=Buffer.byteLength(val);return varint.encodingLength(len)+len}),exports.bool=encoder(0,function encode(val,buffer,offset){return buffer[offset]=val?1:0,encode.bytes=1,buffer},function decode(buffer,offset){var bool=buffer[offset]>0;return decode.bytes=1,bool},function(){return 1}),exports.int32=encoder(0,function encode(val,buffer,offset){return varint.encode(val<0?val+4294967296:val,buffer,offset),encode.bytes=varint.encode.bytes,buffer},function decode(buffer,offset){var val=varint.decode(buffer,offset);return decode.bytes=varint.decode.bytes,val>2147483647?val-4294967296:val},function(val){return varint.encodingLength(val<0?val+4294967296:val)}),exports.int64=encoder(0,function encode(val,buffer,offset){if(val<0){var last=offset+9;for(varint.encode(-1*val,buffer,offset),buffer[offset+=varint.encode.bytes-1]=128|buffer[offset];offset<last-1;)buffer[++offset]=255;buffer[last]=1,encode.bytes=10}else varint.encode(val,buffer,offset),encode.bytes=varint.encode.bytes;return buffer},function decode(buffer,offset){var val=varint.decode(buffer,offset);if(val>=Math.pow(2,63)){for(var limit=9;255===buffer[offset+limit-1];)limit--;limit=limit||9;var subset=Buffer.allocUnsafe(limit);buffer.copy(subset,0,offset,offset+limit),subset[limit-1]=127&subset[limit-1],val=-1*varint.decode(subset,0),decode.bytes=10}else decode.bytes=varint.decode.bytes;return val},function(val){return val<0?10:varint.encodingLength(val)}),exports.sint32=exports.sint64=encoder(0,svarint.encode,svarint.decode,svarint.encodingLength),exports.uint32=exports.uint64=exports.enum=exports.varint=encoder(0,varint.encode,varint.decode,varint.encodingLength),exports.fixed64=exports.sfixed64=encoder(1,function encode(val,buffer,offset){return val.copy(buffer,offset),encode.bytes=8,buffer},function decode(buffer,offset){var val=buffer.slice(offset,offset+8);return decode.bytes=8,val},function(){return 8}),exports.double=encoder(1,function encode(val,buffer,offset){return buffer.writeDoubleLE(val,offset),encode.bytes=8,buffer},function decode(buffer,offset){var val=buffer.readDoubleLE(offset);return decode.bytes=8,val},function(){return 8}),exports.fixed32=encoder(5,function encode(val,buffer,offset){return buffer.writeUInt32LE(val,offset),encode.bytes=4,buffer},function decode(buffer,offset){var val=buffer.readUInt32LE(offset);return decode.bytes=4,val},function(){return 4}),exports.sfixed32=encoder(5,function encode(val,buffer,offset){return buffer.writeInt32LE(val,offset),encode.bytes=4,buffer},function decode(buffer,offset){var val=buffer.readInt32LE(offset);return decode.bytes=4,val},function(){return 4}),exports.float=encoder(5,function encode(val,buffer,offset){return buffer.writeFloatLE(val,offset),encode.bytes=4,buffer},function decode(buffer,offset){var val=buffer.readFloatLE(offset);return decode.bytes=4,val},function(){return 4})}).call(this,require("buffer").Buffer)},{buffer:26,"signed-varint":152,varint:122}],120:[function(require,module,exports){arguments[4][51][0].apply(exports,arguments)},{dup:51}],121:[function(require,module,exports){arguments[4][13][0].apply(exports,arguments)},{dup:13}],122:[function(require,module,exports){arguments[4][14][0].apply(exports,arguments)},{"./decode.js":120,"./encode.js":121,"./length.js":123,dup:14}],123:[function(require,module,exports){arguments[4][15][0].apply(exports,arguments)},{dup:15}],124:[function(require,module,exports){(function(process){var once=require("once"),eos=require("end-of-stream"),fs=require("fs"),noop=function(){},ancient=/^v?\.0/.test(process.version),isFn=function(fn){return"function"==typeof fn},destroyer=function(stream,reading,writing,callback){callback=once(callback);var closed=!1;stream.on("close",function(){closed=!0}),eos(stream,{readable:reading,writable:writing},function(err){if(err)return callback(err);closed=!0,callback()});var destroyed=!1;return function(err){if(!closed&&!destroyed)return destroyed=!0,function(stream){return!!ancient&&!!fs&&(stream instanceof(fs.ReadStream||noop)||stream instanceof(fs.WriteStream||noop))&&isFn(stream.close)}(stream)?stream.close(noop):function(stream){return stream.setHeader&&isFn(stream.abort)}(stream)?stream.abort():isFn(stream.destroy)?stream.destroy():void callback(err||new Error("stream was destroyed"))}},call=function(fn){fn()},pipe=function(from,to){return from.pipe(to)};module.exports=function(){var error,streams=Array.prototype.slice.call(arguments),callback=isFn(streams[streams.length-1]||noop)&&streams.pop()||noop;if(Array.isArray(streams[0])&&(streams=streams[0]),streams.length<2)throw new Error("pump requires two streams per minimum");var destroys=streams.map(function(stream,i){var reading=i<streams.length-1;return destroyer(stream,reading,i>0,function(err){error||(error=err),err&&destroys.forEach(call),reading||(destroys.forEach(call),callback(error))})});return streams.reduce(pipe)}}).call(this,require("_process"))},{_process:118,"end-of-stream":42,fs:19,once:114}],125:[function(require,module,exports){(function(Buffer){const ras=require("random-access-storage"),TYPE={type:"octet/stream"},requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,persistentStorage=navigator.persistentStorage||navigator.webkitPersistentStorage,FileReader=window.FileReader,Blob=window.Blob;function requestQuota(n,force,cb){if("function"==typeof force)return requestQuota(n,!0,force);persistentStorage.queryUsageAndQuota(function(used,quota){if(quota&&!force)return cb(null,quota);persistentStorage.requestQuota(n,function(quota){cb(null,quota)},cb)},cb)}function createFile(name,opts){opts||(opts={});const maxSize=opts.maxSize||createFile.DEFAULT_MAX_SIZE,mutex=new Mutex;var fs=null,file=null,entry=null,toDestroy=null,readers=[],writers=[];return ras({read:function(req){(readers.pop()||new ReadRequest(readers,file,entry,mutex)).run(req)},write:function(req){(writers.pop()||new WriteRequest(writers,file,entry,mutex)).run(req)},open:function(req){function onerror(err){fs=file=entry=null,req.callback(err)}requestQuota(maxSize,!1,function(err,granted){if(err)return onerror(err);requestFileSystem(window.PERSISTENT,granted,function(res){fs=res,function mkdirp(name,ondone){if(!name)return ondone();fs.root.getDirectory(name,{create:!0},ondone,function(){mkdirp(parentFolder(name),function(){fs.root.getDirectory(name,{create:!0},ondone,ondone)})})}(parentFolder(name),function(){fs.root.getFile(name,{create:!0},function(e){(entry=toDestroy=e).file(function(f){file=f,req.callback(null)},onerror)},onerror)})},onerror)})},stat:function(req){req.callback(null,file)},close:function(req){readers=writers=entry=file=fs=null,req.callback(null)},destroy:function(req){toDestroy.remove(function(){toDestroy=null,req.callback(null,null)},function(err){toDestroy=null,req.callback(err,null)})}})}function parentFolder(path){const i=path.lastIndexOf("/"),j=path.lastIndexOf("\\"),p=path.slice(0,Math.max(0,i,j));return/^\w:$/.test(p)?"":p}function WriteRequest(pool,file,entry,mutex){this.writer=null,this.entry=entry,this.file=file,this.req=null,this.pool=pool,this.mutex=mutex,this.locked=!1,this.truncating=!1}function Mutex(){this.queued=null}function ReadRequest(pool,file,entry,mutex){this.reader=new FileReader,this.file=file,this.req=null,this.pool=pool,this.retry=!0,this.mutex=mutex,this.locked=!1;const self=this;this.reader.onerror=function(){self.onread(this.error,null)},this.reader.onload=function(){const buf=Buffer.from(this.result);self.onread(null,buf)}}createFile.DEFAULT_MAX_SIZE=Number.MAX_SAFE_INTEGER,createFile.requestQuota=requestQuota,module.exports=createFile,WriteRequest.prototype.makeWriter=function(){const self=this;this.entry.createWriter(function(writer){self.writer=writer,writer.onwriteend=function(){self.onwrite(null)},writer.onerror=function(err){self.onwrite(err)},self.run(self.req)})},WriteRequest.prototype.onwrite=function(err){const req=this.req;if(this.req=null,this.locked&&(this.locked=!1,this.mutex.release()),this.truncating&&(this.truncating=!1,!err))return this.run(req);this.pool.push(this),req.callback(err,null)},WriteRequest.prototype.truncate=function(){this.truncating=!0,this.writer.truncate(this.req.offset)},WriteRequest.prototype.lock=function(){return!!this.locked||(this.locked=this.mutex.lock(this),this.locked)},WriteRequest.prototype.run=function(req){if(this.req=req,!this.writer||this.writer.length!==this.file.size)return this.makeWriter();if(!(req.offset+req.size>this.file.size)||this.lock()){if(req.offset>this.writer.length)return req.offset>this.file.size?this.truncate():this.makeWriter();this.writer.seek(req.offset),this.writer.write(new Blob([req.data],TYPE))}},Mutex.prototype.release=function(){const queued=this.queued;this.queued=null;for(var i=0;i<queued.length;i++)queued[i].run(queued[i].req)},Mutex.prototype.lock=function(req){return this.queued?(this.queued.push(req),!1):(this.queued=[],!0)},ReadRequest.prototype.lock=function(){return!!this.locked||(this.locked=this.mutex.lock(this),this.locked)},ReadRequest.prototype.onread=function(err,buf){const req=this.req;if(err&&this.retry)return this.retry=!1,void(this.lock(this)&&this.run(req));this.req=null,this.pool.push(this),this.retry=!0,this.locked&&(this.locked=!1,this.mutex.release()),req.callback(err,buf)},ReadRequest.prototype.run=function(req){const end=req.offset+req.size;if(this.req=req,end>this.file.size)return this.onread(new Error("Could not satisfy length"),null);this.reader.readAsArrayBuffer(this.file.slice(req.offset,end))}}).call(this,require("buffer").Buffer)},{buffer:26,"random-access-storage":135}],126:[function(require,module,exports){module.exports=function(){throw new Error("random-access-file is not supported in the browser")}},{}],127:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.indexedDB=window.indexedDB},{}],128:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_randomAccessStorage=require("random-access-storage"),_randomAccessStorage2=(obj=_randomAccessStorage)&&obj.__esModule?obj:{default:obj},_IndexedDB=require("./IndexedDB"),_buffer=require("buffer");const promise=request=>new Promise((resolve,reject)=>{request.onsuccess=(()=>resolve(request.result)),request.onerror=(()=>reject(request.error))});class RandomAccessIDBFileVolume{constructor(db,name,version,storeName,options){this.db=db,this.name=name,this.version=version,this.storeName=storeName,this.options=options}store(){const{db:db,storeName:storeName}=this;return db.transaction([storeName],"readwrite").objectStore(storeName)}async delete(url){return await promise(this.store().delete(url))}async save(url,file){return await promise(this.store().put(file,url))}async open(url,mode){const file=await promise(this.store().get(url));if(file)return file;if("readwrite"===mode){const file=await promise(this.db.createMutableFile(url,"binary/random"));return await this.save(url,file),file}throw new RangeError(`File ${url} does not exist`)}mount(file,options){return new RandomAccessProvider(this,`/${file}`,options)}}class RandomAccessProvider extends _randomAccessStorage2.default{static async mount(options={}){if(self.IDBMutableFile){const name=options.name||"RandomAccess",version=options.version||1,storeName=options.storeName||"IDBMutableFile",request=_IndexedDB.indexedDB.open(name,version);request.onupgradeneeded=(()=>{const db=request.result;db.objectStoreNames.contains(storeName)||db.createObjectStore(storeName)});const db=await promise(request),volume=new RandomAccessIDBFileVolume(db,name,version,storeName,options);return(path,options)=>volume.mount(path,options)}throw Error("Runtime does not supports IDBMutableFile https://developer.mozilla.org/en-US/docs/Web/API/IDBMutableFile")}static async open(self,request){const{options:options}=self,mode=request.preferReadonly?"readonly":"readwrite";if(self.debug&&console.log(`>> open ${self.url} ${mode}`),(!self.file||self.mode!==mode&&"readwrite"===mode)&&(self.mode=mode,self.file=await self.volume.open(self.url,mode)),"readonly"!==mode&&options.truncate){const file=self.activate();await promise(file.truncate(options.size||0))}self.debug&&console.log(`<< open ${self.url} ${mode}`)}static async read(self,{data:data,offset:offset,size:size}){self.debug&&console.log(`>> read ${self.url} <${offset}, ${size}>`);const buffer=data||_buffer.Buffer.allocUnsafe(size);if(0===size)return buffer;const file=self.activate();file.location=offset;const chunk=await promise(file.readAsArrayBuffer(size));if(chunk.byteLength!==size)throw new Error("Could not satisfy length");return _buffer.Buffer.from(chunk).copy(buffer),self.debug&&console.log(`<< read ${self.url} <${offset}, ${size}>`,buffer),buffer}static async write(self,{data:data,offset:offset,size:size}){self.debug&&console.log(`>> write ${self.url} <${offset}, ${size}>`,data);const{byteLength:byteLength,byteOffset:byteOffset}=data,chunk=byteLength===size?data:data.slice(0,size),file=self.activate();file.location=offset;const wrote=await promise(file.write(chunk));return self.debug&&console.log(`<< write ${self.url} <${offset}, ${size}>`),wrote}static async delete(self,{offset:offset,size:size}){if(self.debug&&console.log(`>> delete ${self.url} <${offset}, ${size}>`),offset+size>=(await this.stat(self)).size){const file=self.activate();await promise(file.truncate(offset))}self.debug&&console.log(`<< delete ${self.url} <${offset}, ${size}>`)}static async stat(self){self.debug&&console.log(`>> stat ${self.url}`);const file=self.activate(),stat=await promise(file.getMetadata());return self.debug&&console.log(`<< stat {size:${stat.size}} ${self.url} `),stat}static async close(self){self.debug&&console.log(`>> close ${self.url}`);const{lockedFile:lockedFile}=self;lockedFile&&lockedFile.active&&await promise(lockedFile.flush()),self.lockedFile=null,self.file=null,self.debug&&console.log(`<< close ${self.url}`)}static async destroy(self){self.debug&&console.log(`>> destroy ${self.url}`),await self.volume.delete(self.url),self.debug&&console.log(`<< destroy ${self.url}`)}static async awake(self){const{workQueue:workQueue}=self;self.isIdle=!1;let index=0;for(;index<workQueue.length;){const request=workQueue[index++];await this.perform(self,request)}workQueue.length=0,self.isIdle=!0}static schedule(self,request){self.workQueue.push(request),self.isIdle&&this.awake(self)}static async perform(self,request){try{switch(request.type){case RequestType.open:return request.callback(null,await this.open(self,request));case RequestType.read:return request.callback(null,await this.read(self,request));case RequestType.write:return request.callback(null,await this.write(self,request));case RequestType.delete:return request.callback(null,await this.delete(self,request));case RequestType.stat:return request.callback(null,await this.stat(self));case RequestType.close:return request.callback(null,await this.close(self));case RequestType.destroy:return request.callback(null,await this.destroy(self))}}catch(error){request.callback(error)}}_open(request){RandomAccessProvider.schedule(this,request)}_openReadonly(request){RandomAccessProvider.schedule(this,request)}_write(request){RandomAccessProvider.schedule(this,request)}_read(request){RandomAccessProvider.schedule(this,request)}_del(request){RandomAccessProvider.schedule(this,request)}_stat(request){RandomAccessProvider.perform(this,request)}_close(request){RandomAccessProvider.schedule(this,request)}_destroy(request){RandomAccessProvider.schedule(this,request)}constructor(volume,url,options={}){super(),this.volume=volume,this.url=url,this.options=options,this.mode="readonly",this.file=null,this.lockedFile=null,this.workQueue=[],this.isIdle=!0,this.debug=!!volume.options.debug}activate(){const{lockedFile:lockedFile,file:file,mode:mode}=this;if(lockedFile&&lockedFile.active)return lockedFile;if(file){const lockedFile=file.open(mode);return this.lockedFile=lockedFile,lockedFile}throw new RangeError("Unable to activate file, likely provider was destroyed")}}const RequestType={open:0,read:1,write:2,delete:3,stat:4,close:5,destroy:6};exports.default=RandomAccessProvider,module.exports=exports.default},{"./IndexedDB":127,buffer:26,"random-access-storage":129}],129:[function(require,module,exports){(function(process){var events=require("events"),inherits=require("inherits"),NOT_READABLE=defaultImpl(new Error("Not readable")),NOT_WRITABLE=defaultImpl(new Error("Not writable")),NOT_DELETABLE=defaultImpl(new Error("Not deletable")),NOT_STATABLE=defaultImpl(new Error("Not statable")),NO_OPEN_READABLE=defaultImpl(new Error("No readonly open"));function RandomAccess(opts){if(!(this instanceof RandomAccess))return new RandomAccess(opts);events.EventEmitter.call(this),this._queued=[],this._pending=0,this._needsOpen=!0,this.opened=!1,this.closed=!1,this.destroyed=!1,opts&&(opts.openReadonly&&(this._openReadonly=opts.openReadonly),opts.open&&(this._open=opts.open),opts.read&&(this._read=opts.read),opts.write&&(this._write=opts.write),opts.del&&(this._del=opts.del),opts.stat&&(this._stat=opts.stat),opts.close&&(this._close=opts.close),opts.destroy&&(this._destroy=opts.destroy)),this.preferReadonly=this._openReadonly!==NO_OPEN_READABLE,this.readable=this._read!==NOT_READABLE,this.writable=this._write!==NOT_WRITABLE,this.deletable=this._del!==NOT_DELETABLE,this.statable=this._stat!==NOT_STATABLE}function noop(){}function Request(self,type,offset,size,data,cb){this.type=type,this.offset=offset,this.data=data,this.size=size,this.storage=self,this._sync=!1,this._callback=cb,this._openError=null}function queueAndRun(self,req){self._queued.push(req),self._pending||req._run()}function openWritable(self){self.preferReadonly&&(self._needsOpen=!0,self.preferReadonly=!1)}function defaultImpl(err){return function(req){nextTick(req,err)}}function nextTick(req,err,val){process.nextTick(nextTickCallback,req,err,val)}function nextTickCallback(req,err,val){req.callback(err,val)}module.exports=RandomAccess,inherits(RandomAccess,events.EventEmitter),RandomAccess.prototype.open=function(cb){if(cb||(cb=noop),this.opened&&!this._needsOpen)return process.nextTick(cb,null);queueAndRun(this,new Request(this,0,0,0,null,cb))},RandomAccess.prototype._open=defaultImpl(null),RandomAccess.prototype._openReadonly=NO_OPEN_READABLE,RandomAccess.prototype.read=function(offset,size,cb){this.run(new Request(this,1,offset,size,null,cb))},RandomAccess.prototype._read=NOT_READABLE,RandomAccess.prototype.write=function(offset,data,cb){cb||(cb=noop),openWritable(this),this.run(new Request(this,2,offset,data.length,data,cb))},RandomAccess.prototype._write=NOT_WRITABLE,RandomAccess.prototype.del=function(offset,size,cb){cb||(cb=noop),openWritable(this),this.run(new Request(this,3,offset,size,null,cb))},RandomAccess.prototype._del=NOT_DELETABLE,RandomAccess.prototype.stat=function(cb){this.run(new Request(this,4,0,0,null,cb))},RandomAccess.prototype._stat=NOT_STATABLE,RandomAccess.prototype.close=function(cb){if(cb||(cb=noop),this.closed)return process.nextTick(cb,null);queueAndRun(this,new Request(this,5,0,0,null,cb))},RandomAccess.prototype._close=defaultImpl(null),RandomAccess.prototype.destroy=function(cb){cb||(cb=noop),this.closed||this.close(noop),queueAndRun(this,new Request(this,6,0,0,null,cb))},RandomAccess.prototype._destroy=defaultImpl(null),RandomAccess.prototype.run=function(req){this._needsOpen&&this.open(noop),this._queued.length?this._queued.push(req):req._run()},Request.prototype._maybeOpenError=function(err){if(0===this.type)for(var queued=this.storage._queued,i=0;i<queued.length;i++)queued[i]._openError=err},Request.prototype._unqueue=function(err){var ra=this.storage,queued=ra._queued;if(err)this._maybeOpenError(err);else switch(this.type){case 0:ra.opened||(ra.opened=!0,ra.emit("open"));break;case 5:ra.closed||(ra.closed=!0,ra.emit("close"));break;case 6:ra.destroyed||(ra.destroyed=!0,ra.emit("destroy"))}queued.length&&queued[0]===this&&queued.shift(),!--ra._pending&&queued.length&&queued[0]._run()},Request.prototype.callback=function(err,val){if(this._sync)return nextTick(this,err,val);this._unqueue(err),this._callback(err,val)},Request.prototype._openAndNotClosed=function(){var ra=this.storage;return!(!ra.opened||ra.closed)||(ra.opened?ra.closed&&nextTick(this,new Error("Closed")):nextTick(this,this._openError||new Error("Not opened")),!1)},Request.prototype._open=function(){var ra=this.storage;return ra.opened&&!ra._needsOpen?nextTick(this,null):ra.closed?nextTick(this,new Error("Closed")):(ra._needsOpen=!1,void(ra.preferReadonly?ra._openReadonly(this):ra._open(this)))},Request.prototype._run=function(){var ra=this.storage;switch(ra._pending++,this._sync=!0,this.type){case 0:this._open();break;case 1:this._openAndNotClosed()&&ra._read(this);break;case 2:this._openAndNotClosed()&&ra._write(this);break;case 3:this._openAndNotClosed()&&ra._del(this);break;case 4:this._openAndNotClosed()&&ra._stat(this);break;case 5:ra.closed||!ra.opened?nextTick(this,null):ra._close(this);break;case 6:ra.destroyed?nextTick(this,null):ra._destroy(this)}this._sync=!1}}).call(this,require("_process"))},{_process:118,events:21,inherits:92}],130:[function(require,module,exports){(function(Buffer){var RandomAccess=require("random-access-storage"),inherits=require("inherits"),nextTick=require("next-tick"),once=require("once"),blocks=require("./lib/blocks.js"),bufferFrom=require("buffer-from"),bufferAlloc=require("buffer-alloc"),DELIM="\0",win="undefined"!=typeof window?window:"undefined"!=typeof self?self:{};function Store(opts){if(!(this instanceof Store))return new Store(opts);RandomAccess.call(this),opts||(opts={}),"string"==typeof opts&&(opts={name:opts}),this.size=opts.size||4096,this.name=opts.name,this.length=opts.length||0,this._getdb=opts.db}function backify(r,cb){r.addEventListener("success",function(ev){cb(null,ev)}),r.addEventListener("error",cb)}module.exports=function(dbname,xopts){xopts||(xopts={});var idb=xopts.idb||(void 0!==win?win.indexedDB||win.mozIndexedDB||win.webkitIndexedDB||win.msIndexedDB:null);if(!idb)throw new Error("indexedDB not present and not given");var db=null,dbqueue=[];if("function"==typeof idb.open){var req=idb.open(dbname);req.addEventListener("upgradeneeded",function(){(db=req.result).createObjectStore("data")}),req.addEventListener("success",function(){db=req.result,dbqueue.forEach(function(cb){cb(db)}),dbqueue=null})}else db=idb;return function(name,opts){return"object"==typeof name&&(name=(opts=name).name),opts||(opts={}),opts.name=name,new Store(Object.assign({db:getdb},xopts,opts))};function getdb(cb){db?nextTick(function(){cb(db)}):dbqueue.push(cb)}},inherits(Store,RandomAccess),Store.prototype._blocks=function(i,j){return blocks(this.size,i,j)},Store.prototype._read=function(req){var self=this,buffers=[];self._store("readonly",function(err,store){if((self.length||0)<req.offset+req.size)return req.callback(new Error("Could not satisfy length"));if(err)return req.callback(err);for(var offsets=self._blocks(req.offset,req.offset+req.size),pending=offsets.length+1,firstBlock=offsets.length>0?offsets[0].block:0,i=0;i<offsets.length;i++)!function(o){var key=self.name+DELIM+o.block;backify(store.get(key),function(err,ev){if(err)return req.callback(err);buffers[o.block-firstBlock]=ev.target.result?bufferFrom(ev.target.result.subarray(o.start,o.end)):bufferAlloc(o.end-o.start),0==--pending&&req.callback(null,Buffer.concat(buffers))})}(offsets[i]);0==--pending&&req.callback(null,Buffer.concat(buffers))})},Store.prototype._write=function(req){var self=this;function write(store,offsets,buffers){for(var i=0,j=0;i<offsets.length;i++){var o=offsets[i],len=o.end-o.start;len===self.size?block=bufferFrom(req.data.slice(j,j+len)):(block=buffers[i],req.data.copy(block,o.start,j,j+len)),store.put(block,self.name+DELIM+o.block),j+=len}var length=Math.max(self.length||0,req.offset+req.data.length);store.put(length,self.name+DELIM+"length"),store.transaction.addEventListener("complete",function(){self.length=length,req.callback(null)}),store.transaction.addEventListener("error",function(err){req.callback(err)})}self._store("readwrite",function(err,store){if(err)return req.callback(err);for(var offsets=self._blocks(req.offset,req.offset+req.data.length),pending=1,buffers={},i=0;i<offsets.length;i++)!function(o,i){if(o.end-o.start!==self.size){pending++;var key=self.name+DELIM+o.block;backify(store.get(key),function(err,ev){if(err)return req.callback(err);buffers[i]=bufferFrom(ev.target.result||bufferAlloc(self.size)),0==--pending&&write(store,offsets,buffers)})}}(offsets[i],i);0==--pending&&write(store,offsets,buffers)})},Store.prototype._store=function(mode,cb){cb=once(cb);this._getdb(function(db){var tx=db.transaction(["data"],mode),store=tx.objectStore("data");tx.addEventListener("error",cb),cb(null,store)})},Store.prototype._open=function(req){var self=this;this._getdb(function(db){self._store("readonly",function(err,store){backify(store.get(self.name+DELIM+"length"),function(err,ev){self.length=ev.target.result||0,req.callback(null)})})})},Store.prototype._close=function(req){this._getdb(function(db){db.close(),req.callback()})},Store.prototype._stat=function(req){var self=this;nextTick(function(){req.callback(null,{size:self.length})})}}).call(this,require("buffer").Buffer)},{"./lib/blocks.js":131,buffer:26,"buffer-alloc":23,"buffer-from":132,inherits:92,"next-tick":112,once:114,"random-access-storage":135}],131:[function(require,module,exports){module.exports=function(size,start,end){for(var result=[],n=Math.floor(start/size)*size;n<end;n+=size)result.push({block:Math.floor(n/size),start:Math.max(n,start)%size,end:Math.min(n+size,end)%size||size});return result}},{}],132:[function(require,module,exports){arguments[4][25][0].apply(exports,arguments)},{buffer:26,dup:25}],133:[function(require,module,exports){(function(Buffer){var nextTick=require("process-nextick-args");function RAM(length,opts){if(!(this instanceof RAM))return new RAM(length,opts);Buffer.isBuffer(length)&&(opts||(opts={}),opts.buffer=length,length=opts.buffer.length),"object"==typeof length&&(opts=length,length=0),opts||(opts={}),"number"!=typeof length&&(length=0),this.pageSize=length||opts.pageSize||1048576,this.length=length||0,this.buffers=[],opts.buffer&&this.buffers.push(opts.buffer)}function calloc(len){if(Buffer.alloc)return Buffer.alloc(len);var buf=new Buffer(len);return buf.fill(0),buf}module.exports=RAM,RAM.prototype.open=function(cb){cb&&nextTick(cb)},RAM.prototype.write=function(offset,data,cb){offset+data.length>this.length&&(this.length=data.length+offset);for(var i=Math.floor(offset/this.pageSize),rel=offset-i*this.pageSize;data.length;){var next=rel+data.length>this.pageSize?data.slice(0,this.pageSize-rel):data,buf=this.buffers[i];if(buf||(buf=0===rel&&next.length===this.pageSize?next:calloc(this.pageSize),this.buffers[i]=buf),buf!==next&&next.copy(buf,rel),next===data)break;i++,rel=0,data=data.slice(next.length)}cb&&nextTick(cb)},RAM.prototype.read=function(offset,length,cb){if(offset+length>this.length)return nextTick(cb,new Error("Could not satisfy length"));for(var data=new Buffer(length),ptr=0,i=Math.floor(offset/this.pageSize),rel=offset-i*this.pageSize;ptr<data.length;){var buf=this.buffers[i],len=this.pageSize-rel;buf?buf.copy(data,ptr,rel):data.fill(0,ptr,Math.min(data.length,ptr+len)),ptr+=len,i++,rel=0}nextTick(cb,null,data)},RAM.prototype.del=function(offset,length,cb){var overflow=offset%this.pageSize,inc=overflow&&this.pageSize-overflow;if(inc<length)for(var end=(offset+=inc)+(length-=overflow),i=offset/this.pageSize;offset+this.pageSize<=end&&i<this.buffers.length;)this.buffers[i++]=void 0,offset+=this.pageSize;cb&&nextTick(cb)},RAM.prototype.close=function(cb){cb&&nextTick(cb)},RAM.prototype.destroy=function(cb){this.buffers=[],cb&&nextTick(cb)},RAM.prototype.toBuffer=function(){var buf=1===this.buffers.length?this.buffers[0]:Buffer.concat(this.buffers);return buf.length===this.length?buf:buf.slice(0,this.length)}}).call(this,require("buffer").Buffer)},{buffer:26,"process-nextick-args":134}],134:[function(require,module,exports){arguments[4][61][0].apply(exports,arguments)},{_process:118,dup:61}],135:[function(require,module,exports){(function(process){var events=require("events"),inherits=require("inherits"),NOT_READABLE=defaultImpl(new Error("Not readable")),NOT_WRITABLE=defaultImpl(new Error("Not writable")),NOT_DELETABLE=defaultImpl(new Error("Not deletable")),NOT_STATABLE=defaultImpl(new Error("Not statable")),NO_OPEN_READABLE=defaultImpl(new Error("No readonly open"));function RandomAccess(opts){if(!(this instanceof RandomAccess))return new RandomAccess(opts);events.EventEmitter.call(this),this._queued=[],this._pending=0,this._needsOpen=!0,this.opened=!1,this.closed=!1,this.destroyed=!1,opts&&(opts.openReadonly&&(this._openReadonly=opts.openReadonly),opts.open&&(this._open=opts.open),opts.read&&(this._read=opts.read),opts.write&&(this._write=opts.write),opts.del&&(this._del=opts.del),opts.stat&&(this._stat=opts.stat),opts.close&&(this._close=opts.close),opts.destroy&&(this._destroy=opts.destroy)),this.preferReadonly=this._openReadonly!==NO_OPEN_READABLE,this.readable=this._read!==NOT_READABLE,this.writable=this._write!==NOT_WRITABLE,this.deletable=this._del!==NOT_DELETABLE,this.statable=this._stat!==NOT_STATABLE}function noop(){}function Request(self,type,offset,size,data,cb){this.type=type,this.offset=offset,this.data=data,this.size=size,this.storage=self,this._sync=!1,this._callback=cb,this._openError=null}function queueAndRun(self,req){self._queued.push(req),self._pending||req._run()}function openWritable(self){self.preferReadonly&&(self._needsOpen=!0,self.preferReadonly=!1)}function defaultImpl(err){return function(req){nextTick(req,err)}}function nextTick(req,err,val){process.nextTick(nextTickCallback,req,err,val)}function nextTickCallback(req,err,val){req.callback(err,val)}module.exports=RandomAccess,inherits(RandomAccess,events.EventEmitter),RandomAccess.prototype.read=function(offset,size,cb){this.run(new Request(this,0,offset,size,null,cb))},RandomAccess.prototype._read=NOT_READABLE,RandomAccess.prototype.write=function(offset,data,cb){cb||(cb=noop),openWritable(this),this.run(new Request(this,1,offset,data.length,data,cb))},RandomAccess.prototype._write=NOT_WRITABLE,RandomAccess.prototype.del=function(offset,size,cb){cb||(cb=noop),openWritable(this),this.run(new Request(this,2,offset,size,null,cb))},RandomAccess.prototype._del=NOT_DELETABLE,RandomAccess.prototype.stat=function(cb){this.run(new Request(this,3,0,0,null,cb))},RandomAccess.prototype._stat=NOT_STATABLE,RandomAccess.prototype.open=function(cb){if(cb||(cb=noop),this.opened&&!this._needsOpen)return process.nextTick(cb,null);queueAndRun(this,new Request(this,4,0,0,null,cb))},RandomAccess.prototype._open=defaultImpl(null),RandomAccess.prototype._openReadonly=NO_OPEN_READABLE,RandomAccess.prototype.close=function(cb){if(cb||(cb=noop),this.closed)return process.nextTick(cb,null);queueAndRun(this,new Request(this,5,0,0,null,cb))},RandomAccess.prototype._close=defaultImpl(null),RandomAccess.prototype.destroy=function(cb){cb||(cb=noop),this.closed||this.close(noop),queueAndRun(this,new Request(this,6,0,0,null,cb))},RandomAccess.prototype._destroy=defaultImpl(null),RandomAccess.prototype.run=function(req){this._needsOpen&&this.open(noop),this._queued.length?this._queued.push(req):req._run()},Request.prototype._maybeOpenError=function(err){if(4===this.type)for(var queued=this.storage._queued,i=0;i<queued.length;i++)queued[i]._openError=err},Request.prototype._unqueue=function(err){var ra=this.storage,queued=ra._queued;if(err)this._maybeOpenError(err);else switch(this.type){case 4:ra.opened||(ra.opened=!0,ra.emit("open"));break;case 5:ra.closed||(ra.closed=!0,ra.emit("close"));break;case 6:ra.destroyed||(ra.destroyed=!0,ra.emit("destroy"))}queued.length&&queued[0]===this&&queued.shift(),--ra._pending||function(self){var queued=self._queued;for(;queued.length>0;){if(queued[0]._run(),queued[0].type>3)return;queued.shift()}}(ra)},Request.prototype.callback=function(err,val){if(this._sync)return nextTick(this,err,val);this._unqueue(err),this._callback(err,val)},Request.prototype._openAndNotClosed=function(){var ra=this.storage;return!(!ra.opened||ra.closed)||(ra.opened?ra.closed&&nextTick(this,new Error("Closed")):nextTick(this,this._openError||new Error("Not opened")),!1)},Request.prototype._open=function(){var ra=this.storage;return ra.opened&&!ra._needsOpen?nextTick(this,null):ra.closed?nextTick(this,new Error("Closed")):(ra._needsOpen=!1,void(ra.preferReadonly?ra._openReadonly(this):ra._open(this)))},Request.prototype._run=function(){var ra=this.storage;switch(ra._pending++,this._sync=!0,this.type){case 0:this._openAndNotClosed()&&ra._read(this);break;case 1:this._openAndNotClosed()&&ra._write(this);break;case 2:this._openAndNotClosed()&&ra._del(this);break;case 3:this._openAndNotClosed()&&ra._stat(this);break;case 4:this._open();break;case 5:ra.closed||!ra.opened?nextTick(this,null):ra._close(this);break;case 6:ra.destroyed?nextTick(this,null):ra._destroy(this)}this._sync=!1}}).call(this,require("_process"))},{_process:118,events:21,inherits:92}],136:[function(require,module,exports){const global="undefined"!=typeof window?window:self,requestFileSystem=global.requestFileSystem||global.webkitRequestFileSystem,mutableFile=global.IDBMutableFile,idb=global.indexedDB;let storage=()=>require("random-access-memory");requestFileSystem?storage=(options=>{const RACF=require("random-access-chrome-file");return"object"==typeof options&&options.maxSize&&(RACF.DEFAULT_MAX_SIZE=options.maxSize),RACF}):mutableFile?storage=((options={})=>("string"==typeof options&&(options={name:options}),function(options){const randomAccess=require("random-access-storage"),mutableAccess=require("random-access-idb-mutable-file");let mounted=null,loading=null;function doMount(){return mutableAccess.mount(options).then(requestFile=>{mounted=requestFile,loading=null})}return name=>{let file=null;return randomAccess({open:function(req){mounted||(loading=doMount()),loading?loading.then(()=>{this._open(req)},err=>{req.callback(err)}):(file=mounted(name))._open(req)},openReadonly:function(req){mounted||(loading=doMount()),loading?loading.then(()=>{this._openReadonly(req)},err=>{req.callback(err)}):(file=mounted(name))._openReadonly(req)},write:function(req){file._write(req)},read:function(req){file._read(req)},del:function(req){file._del(req)},stat:function(req){file._stat(req)},close:function(req){file._close(req)},destroy:function(req){file._destroy(req)}})}}(options))):idb&&(storage=((options={})=>{"string"==typeof options&&(options={name:options});const name=options.name||"random-access-web";return require("random-access-idb")(name,options)})),module.exports=storage},{"random-access-chrome-file":125,"random-access-idb":130,"random-access-idb-mutable-file":128,"random-access-memory":137,"random-access-storage":135}],137:[function(require,module,exports){(function(process,Buffer){const RandomAccess=require("random-access-storage"),isOptions=require("is-options"),inherits=require("inherits"),DEFAULT_PAGE_SIZE=1048576;function RAM(opts){if(!(this instanceof RAM))return new RAM(opts);"number"==typeof opts&&(opts={length:opts}),opts||(opts={}),RandomAccess.call(this),Buffer.isBuffer(opts)&&(opts={length:opts.length,buffer:opts}),isOptions(opts)||(opts={}),this.length=opts.length||0,this.pageSize=opts.length||opts.pageSize||DEFAULT_PAGE_SIZE,this.buffers=[],opts.buffer&&this.buffers.push(opts.buffer)}function callback(req,err,data){process.nextTick(callbackNT,req,err,data)}function callbackNT(req,err,data){req.callback(err,data)}module.exports=RAM,inherits(RAM,RandomAccess),RAM.prototype._stat=function(req){callback(req,null,{size:this.length})},RAM.prototype._write=function(req){var i=Math.floor(req.offset/this.pageSize),rel=req.offset-i*this.pageSize,start=0;const len=req.offset+req.size;for(len>this.length&&(this.length=len);start<req.size;){const page=this._page(i++,!0),free=this.pageSize-rel,end=free<req.size-start?start+free:req.size;req.data.copy(page,rel,start,end),start=end,rel=0}callback(req,null,null)},RAM.prototype._read=function(req){var i=Math.floor(req.offset/this.pageSize),rel=req.offset-i*this.pageSize,start=0;if(req.offset+req.size>this.length)return callback(req,new Error("Could not satisfy length"),null);const data=Buffer.alloc(req.size);for(;start<req.size;){const page=this._page(i++,!1),avail=this.pageSize-rel,wanted=req.size-start,len=avail<wanted?avail:wanted;page&&page.copy(data,start,rel,rel+len),start+=len,rel=0}callback(req,null,data)},RAM.prototype._del=function(req){var i=Math.floor(req.offset/this.pageSize),rel=req.offset-i*this.pageSize,start=0;for(req.offset+req.size>this.length&&(req.size=Math.max(0,this.length-req.offset));start<req.size;)0===rel&&req.size-start>=this.pageSize&&(this.buffers[i++]=void 0),rel=0,start+=this.pageSize-rel;req.offset+req.size>=this.length&&(this.length=req.offset),callback(req,null,null)},RAM.prototype._destroy=function(req){this._buffers=[],this.length=0,callback(req,null,null)},RAM.prototype._page=function(i,upsert){var page=this.buffers[i];return page||!upsert?page:page=this.buffers[i]=Buffer.alloc(this.pageSize)},RAM.prototype.toBuffer=function(){const buf=Buffer.alloc(this.length);for(var i=0;i<this.buffers.length;i++)this.buffers[i]&&this.buffers[i].copy(buf,i*this.pageSize);return buf}}).call(this,require("_process"),require("buffer").Buffer)},{_process:118,buffer:26,inherits:92,"is-options":95,"random-access-storage":135}],138:[function(require,module,exports){(function(process,global){"use strict";var MAX_BYTES=65536,MAX_UINT32=4294967295;var Buffer=require("safe-buffer").Buffer,crypto=global.crypto||global.msCrypto;crypto&&crypto.getRandomValues?module.exports=function(size,cb){if(size>MAX_UINT32)throw new RangeError("requested too many random bytes");var bytes=Buffer.allocUnsafe(size);if(size>0)if(size>MAX_BYTES)for(var generated=0;generated<size;generated+=MAX_BYTES)crypto.getRandomValues(bytes.slice(generated,generated+MAX_BYTES));else crypto.getRandomValues(bytes);if("function"==typeof cb)return process.nextTick(function(){cb(null,bytes)});return bytes}:module.exports=function(){throw new Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:118,"safe-buffer":149}],139:[function(require,module,exports){"use strict";var pna=require("process-nextick-args"),objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)keys.push(key);return keys};module.exports=Duplex;var util=require("core-util-is");util.inherits=require("inherits");var Readable=require("./_stream_readable"),Writable=require("./_stream_writable");util.inherits(Duplex,Readable);for(var keys=objectKeys(Writable.prototype),v=0;v<keys.length;v++){var method=keys[v];Duplex.prototype[method]||(Duplex.prototype[method]=Writable.prototype[method])}function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options),Writable.call(this,options),options&&!1===options.readable&&(this.readable=!1),options&&!1===options.writable&&(this.writable=!1),this.allowHalfOpen=!0,options&&!1===options.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",onend)}function onend(){this.allowHalfOpen||this._writableState.ended||pna.nextTick(onEndNT,this)}function onEndNT(self){self.end()}Object.defineProperty(Duplex.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(Duplex.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(value){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=value,this._writableState.destroyed=value)}}),Duplex.prototype._destroy=function(err,cb){this.push(null),this.end(),pna.nextTick(cb,err)}},{"./_stream_readable":141,"./_stream_writable":143,"core-util-is":30,inherits:92,"process-nextick-args":117}],140:[function(require,module,exports){"use strict";module.exports=PassThrough;var Transform=require("./_stream_transform"),util=require("core-util-is");function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}util.inherits=require("inherits"),util.inherits(PassThrough,Transform),PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{"./_stream_transform":142,"core-util-is":30,inherits:92}],141:[function(require,module,exports){(function(process,global){"use strict";var pna=require("process-nextick-args");module.exports=Readable;var Duplex,isArray=require("isarray");Readable.ReadableState=ReadableState;require("events").EventEmitter;var EElistenerCount=function(emitter,type){return emitter.listeners(type).length},Stream=require("./internal/streams/stream"),Buffer=require("safe-buffer").Buffer,OurUint8Array=global.Uint8Array||function(){};var util=require("core-util-is");util.inherits=require("inherits");var debugUtil=require("util"),debug=void 0;debug=debugUtil&&debugUtil.debuglog?debugUtil.debuglog("stream"):function(){};var StringDecoder,BufferList=require("./internal/streams/BufferList"),destroyImpl=require("./internal/streams/destroy");util.inherits(Readable,Stream);var kProxyEvents=["error","close","destroy","pause","resume"];function ReadableState(options,stream){Duplex=Duplex||require("./_stream_duplex"),options=options||{};var isDuplex=stream instanceof Duplex;this.objectMode=!!options.objectMode,isDuplex&&(this.objectMode=this.objectMode||!!options.readableObjectMode);var hwm=options.highWaterMark,readableHwm=options.readableHighWaterMark,defaultHwm=this.objectMode?16:16384;this.highWaterMark=hwm||0===hwm?hwm:isDuplex&&(readableHwm||0===readableHwm)?readableHwm:defaultHwm,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new BufferList,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=options.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,options.encoding&&(StringDecoder||(StringDecoder=require("string_decoder/").StringDecoder),this.decoder=new StringDecoder(options.encoding),this.encoding=options.encoding)}function Readable(options){if(Duplex=Duplex||require("./_stream_duplex"),!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this),this.readable=!0,options&&("function"==typeof options.read&&(this._read=options.read),"function"==typeof options.destroy&&(this._destroy=options.destroy)),Stream.call(this)}function readableAddChunk(stream,chunk,encoding,addToFront,skipChunkCheck){var er,state=stream._readableState;null===chunk?(state.reading=!1,function(stream,state){if(state.ended)return;if(state.decoder){var chunk=state.decoder.end();chunk&&chunk.length&&(state.buffer.push(chunk),state.length+=state.objectMode?1:chunk.length)}state.ended=!0,emitReadable(stream)}(stream,state)):(skipChunkCheck||(er=function(state,chunk){var er;obj=chunk,Buffer.isBuffer(obj)||obj instanceof OurUint8Array||"string"==typeof chunk||void 0===chunk||state.objectMode||(er=new TypeError("Invalid non-string/buffer chunk"));var obj;return er}(state,chunk)),er?stream.emit("error",er):state.objectMode||chunk&&chunk.length>0?("string"==typeof chunk||state.objectMode||Object.getPrototypeOf(chunk)===Buffer.prototype||(chunk=function(chunk){return Buffer.from(chunk)}(chunk)),addToFront?state.endEmitted?stream.emit("error",new Error("stream.unshift() after end event")):addChunk(stream,state,chunk,!0):state.ended?stream.emit("error",new Error("stream.push() after EOF")):(state.reading=!1,state.decoder&&!encoding?(chunk=state.decoder.write(chunk),state.objectMode||0!==chunk.length?addChunk(stream,state,chunk,!1):maybeReadMore(stream,state)):addChunk(stream,state,chunk,!1))):addToFront||(state.reading=!1));return function(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||0===state.length)}(state)}function addChunk(stream,state,chunk,addToFront){state.flowing&&0===state.length&&!state.sync?(stream.emit("data",chunk),stream.read(0)):(state.length+=state.objectMode?1:chunk.length,addToFront?state.buffer.unshift(chunk):state.buffer.push(chunk),state.needReadable&&emitReadable(stream)),maybeReadMore(stream,state)}Object.defineProperty(Readable.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(value){this._readableState&&(this._readableState.destroyed=value)}}),Readable.prototype.destroy=destroyImpl.destroy,Readable.prototype._undestroy=destroyImpl.undestroy,Readable.prototype._destroy=function(err,cb){this.push(null),cb(err)},Readable.prototype.push=function(chunk,encoding){var skipChunkCheck,state=this._readableState;return state.objectMode?skipChunkCheck=!0:"string"==typeof chunk&&((encoding=encoding||state.defaultEncoding)!==state.encoding&&(chunk=Buffer.from(chunk,encoding),encoding=""),skipChunkCheck=!0),readableAddChunk(this,chunk,encoding,!1,skipChunkCheck)},Readable.prototype.unshift=function(chunk){return readableAddChunk(this,chunk,null,!0,!1)},Readable.prototype.isPaused=function(){return!1===this._readableState.flowing},Readable.prototype.setEncoding=function(enc){return StringDecoder||(StringDecoder=require("string_decoder/").StringDecoder),this._readableState.decoder=new StringDecoder(enc),this._readableState.encoding=enc,this};var MAX_HWM=8388608;function howMuchToRead(n,state){return n<=0||0===state.length&&state.ended?0:state.objectMode?1:n!=n?state.flowing&&state.length?state.buffer.head.data.length:state.length:(n>state.highWaterMark&&(state.highWaterMark=function(n){return n>=MAX_HWM?n=MAX_HWM:(n--,n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,n|=n>>>16,n++),n}(n)),n<=state.length?n:state.ended?state.length:(state.needReadable=!0,0))}function emitReadable(stream){var state=stream._readableState;state.needReadable=!1,state.emittedReadable||(debug("emitReadable",state.flowing),state.emittedReadable=!0,state.sync?pna.nextTick(emitReadable_,stream):emitReadable_(stream))}function emitReadable_(stream){debug("emit readable"),stream.emit("readable"),flow(stream)}function maybeReadMore(stream,state){state.readingMore||(state.readingMore=!0,pna.nextTick(maybeReadMore_,stream,state))}function maybeReadMore_(stream,state){for(var len=state.length;!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark&&(debug("maybeReadMore read 0"),stream.read(0),len!==state.length);)len=state.length;state.readingMore=!1}function nReadingNextTick(self){debug("readable nexttick read 0"),self.read(0)}function resume_(stream,state){state.reading||(debug("resume read 0"),stream.read(0)),state.resumeScheduled=!1,state.awaitDrain=0,stream.emit("resume"),flow(stream),state.flowing&&!state.reading&&stream.read(0)}function flow(stream){var state=stream._readableState;for(debug("flow",state.flowing);state.flowing&&null!==stream.read(););}function fromList(n,state){return 0===state.length?null:(state.objectMode?ret=state.buffer.shift():!n||n>=state.length?(ret=state.decoder?state.buffer.join(""):1===state.buffer.length?state.buffer.head.data:state.buffer.concat(state.length),state.buffer.clear()):ret=function(n,list,hasStrings){var ret;n<list.head.data.length?(ret=list.head.data.slice(0,n),list.head.data=list.head.data.slice(n)):ret=n===list.head.data.length?list.shift():hasStrings?function(n,list){var p=list.head,c=1,ret=p.data;n-=ret.length;for(;p=p.next;){var str=p.data,nb=n>str.length?str.length:n;if(nb===str.length?ret+=str:ret+=str.slice(0,n),0===(n-=nb)){nb===str.length?(++c,p.next?list.head=p.next:list.head=list.tail=null):(list.head=p,p.data=str.slice(nb));break}++c}return list.length-=c,ret}(n,list):function(n,list){var ret=Buffer.allocUnsafe(n),p=list.head,c=1;p.data.copy(ret),n-=p.data.length;for(;p=p.next;){var buf=p.data,nb=n>buf.length?buf.length:n;if(buf.copy(ret,ret.length-n,0,nb),0===(n-=nb)){nb===buf.length?(++c,p.next?list.head=p.next:list.head=list.tail=null):(list.head=p,p.data=buf.slice(nb));break}++c}return list.length-=c,ret}(n,list);return ret}(n,state.buffer,state.decoder),ret);var ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error('"endReadable()" called on non-empty stream');state.endEmitted||(state.ended=!0,pna.nextTick(endReadableNT,state,stream))}function endReadableNT(state,stream){state.endEmitted||0!==state.length||(state.endEmitted=!0,stream.readable=!1,stream.emit("end"))}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++)if(xs[i]===x)return i;return-1}Readable.prototype.read=function(n){debug("read",n),n=parseInt(n,10);var state=this._readableState,nOrig=n;if(0!==n&&(state.emittedReadable=!1),0===n&&state.needReadable&&(state.length>=state.highWaterMark||state.ended))return debug("read: emitReadable",state.length,state.ended),0===state.length&&state.ended?endReadable(this):emitReadable(this),null;if(0===(n=howMuchToRead(n,state))&&state.ended)return 0===state.length&&endReadable(this),null;var ret,doRead=state.needReadable;return debug("need readable",doRead),(0===state.length||state.length-n<state.highWaterMark)&&debug("length less than watermark",doRead=!0),state.ended||state.reading?debug("reading or ended",doRead=!1):doRead&&(debug("do read"),state.reading=!0,state.sync=!0,0===state.length&&(state.needReadable=!0),this._read(state.highWaterMark),state.sync=!1,state.reading||(n=howMuchToRead(nOrig,state))),null===(ret=n>0?fromList(n,state):null)?(state.needReadable=!0,n=0):state.length-=n,0===state.length&&(state.ended||(state.needReadable=!0),nOrig!==n&&state.ended&&endReadable(this)),null!==ret&&this.emit("data",ret),ret},Readable.prototype._read=function(n){this.emit("error",new Error("_read() is not implemented"))},Readable.prototype.pipe=function(dest,pipeOpts){var src=this,state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest)}state.pipesCount+=1,debug("pipe count=%d opts=%j",state.pipesCount,pipeOpts);var endFn=(!pipeOpts||!1!==pipeOpts.end)&&dest!==process.stdout&&dest!==process.stderr?onend:unpipe;function onunpipe(readable,unpipeInfo){debug("onunpipe"),readable===src&&unpipeInfo&&!1===unpipeInfo.hasUnpiped&&(unpipeInfo.hasUnpiped=!0,debug("cleanup"),dest.removeListener("close",onclose),dest.removeListener("finish",onfinish),dest.removeListener("drain",ondrain),dest.removeListener("error",onerror),dest.removeListener("unpipe",onunpipe),src.removeListener("end",onend),src.removeListener("end",unpipe),src.removeListener("data",ondata),cleanedUp=!0,!state.awaitDrain||dest._writableState&&!dest._writableState.needDrain||ondrain())}function onend(){debug("onend"),dest.end()}state.endEmitted?pna.nextTick(endFn):src.once("end",endFn),dest.on("unpipe",onunpipe);var ondrain=function(src){return function(){var state=src._readableState;debug("pipeOnDrain",state.awaitDrain),state.awaitDrain&&state.awaitDrain--,0===state.awaitDrain&&EElistenerCount(src,"data")&&(state.flowing=!0,flow(src))}}(src);dest.on("drain",ondrain);var cleanedUp=!1;var increasedAwaitDrain=!1;function ondata(chunk){debug("ondata"),increasedAwaitDrain=!1,!1!==dest.write(chunk)||increasedAwaitDrain||((1===state.pipesCount&&state.pipes===dest||state.pipesCount>1&&-1!==indexOf(state.pipes,dest))&&!cleanedUp&&(debug("false write response, pause",src._readableState.awaitDrain),src._readableState.awaitDrain++,increasedAwaitDrain=!0),src.pause())}function onerror(er){debug("onerror",er),unpipe(),dest.removeListener("error",onerror),0===EElistenerCount(dest,"error")&&dest.emit("error",er)}function onclose(){dest.removeListener("finish",onfinish),unpipe()}function onfinish(){debug("onfinish"),dest.removeListener("close",onclose),unpipe()}function unpipe(){debug("unpipe"),src.unpipe(dest)}return src.on("data",ondata),function(emitter,event,fn){if("function"==typeof emitter.prependListener)return emitter.prependListener(event,fn);emitter._events&&emitter._events[event]?isArray(emitter._events[event])?emitter._events[event].unshift(fn):emitter._events[event]=[fn,emitter._events[event]]:emitter.on(event,fn)}(dest,"error",onerror),dest.once("close",onclose),dest.once("finish",onfinish),dest.emit("pipe",src),state.flowing||(debug("pipe resume"),src.resume()),dest},Readable.prototype.unpipe=function(dest){var state=this._readableState,unpipeInfo={hasUnpiped:!1};if(0===state.pipesCount)return this;if(1===state.pipesCount)return dest&&dest!==state.pipes?this:(dest||(dest=state.pipes),state.pipes=null,state.pipesCount=0,state.flowing=!1,dest&&dest.emit("unpipe",this,unpipeInfo),this);if(!dest){var dests=state.pipes,len=state.pipesCount;state.pipes=null,state.pipesCount=0,state.flowing=!1;for(var i=0;i<len;i++)dests[i].emit("unpipe",this,unpipeInfo);return this}var index=indexOf(state.pipes,dest);return-1===index?this:(state.pipes.splice(index,1),state.pipesCount-=1,1===state.pipesCount&&(state.pipes=state.pipes[0]),dest.emit("unpipe",this,unpipeInfo),this)},Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if("data"===ev)!1!==this._readableState.flowing&&this.resume();else if("readable"===ev){var state=this._readableState;state.endEmitted||state.readableListening||(state.readableListening=state.needReadable=!0,state.emittedReadable=!1,state.reading?state.length&&emitReadable(this):pna.nextTick(nReadingNextTick,this))}return res},Readable.prototype.addListener=Readable.prototype.on,Readable.prototype.resume=function(){var state=this._readableState;return state.flowing||(debug("resume"),state.flowing=!0,function(stream,state){state.resumeScheduled||(state.resumeScheduled=!0,pna.nextTick(resume_,stream,state))}(this,state)),this},Readable.prototype.pause=function(){return debug("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(debug("pause"),this._readableState.flowing=!1,this.emit("pause")),this},Readable.prototype.wrap=function(stream){var _this=this,state=this._readableState,paused=!1;for(var i in stream.on("end",function(){if(debug("wrapped end"),state.decoder&&!state.ended){var chunk=state.decoder.end();chunk&&chunk.length&&_this.push(chunk)}_this.push(null)}),stream.on("data",function(chunk){(debug("wrapped data"),state.decoder&&(chunk=state.decoder.write(chunk)),!state.objectMode||null!==chunk&&void 0!==chunk)&&((state.objectMode||chunk&&chunk.length)&&(_this.push(chunk)||(paused=!0,stream.pause())))}),stream)void 0===this[i]&&"function"==typeof stream[i]&&(this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i));for(var n=0;n<kProxyEvents.length;n++)stream.on(kProxyEvents[n],this.emit.bind(this,kProxyEvents[n]));return this._read=function(n){debug("wrapped _read",n),paused&&(paused=!1,stream.resume())},this},Object.defineProperty(Readable.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Readable._fromList=fromList}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./_stream_duplex":139,"./internal/streams/BufferList":144,"./internal/streams/destroy":145,"./internal/streams/stream":146,_process:118,"core-util-is":30,events:21,inherits:92,isarray:96,"process-nextick-args":117,"safe-buffer":149,"string_decoder/":172,util:19}],142:[function(require,module,exports){"use strict";module.exports=Transform;var Duplex=require("./_stream_duplex"),util=require("core-util-is");function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options),this._transformState={afterTransform:function(er,data){var ts=this._transformState;ts.transforming=!1;var cb=ts.writecb;if(!cb)return this.emit("error",new Error("write callback called multiple times"));ts.writechunk=null,ts.writecb=null,null!=data&&this.push(data),cb(er);var rs=this._readableState;rs.reading=!1,(rs.needReadable||rs.length<rs.highWaterMark)&&this._read(rs.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,options&&("function"==typeof options.transform&&(this._transform=options.transform),"function"==typeof options.flush&&(this._flush=options.flush)),this.on("prefinish",prefinish)}function prefinish(){var _this=this;"function"==typeof this._flush?this._flush(function(er,data){done(_this,er,data)}):done(this,null,null)}function done(stream,er,data){if(er)return stream.emit("error",er);if(null!=data&&stream.push(data),stream._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(stream._transformState.transforming)throw new Error("Calling transform done when still transforming");return stream.push(null)}util.inherits=require("inherits"),util.inherits(Transform,Duplex),Transform.prototype.push=function(chunk,encoding){return this._transformState.needTransform=!1,Duplex.prototype.push.call(this,chunk,encoding)},Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("_transform() is not implemented")},Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;if(ts.writecb=cb,ts.writechunk=chunk,ts.writeencoding=encoding,!ts.transforming){var rs=this._readableState;(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)&&this._read(rs.highWaterMark)}},Transform.prototype._read=function(n){var ts=this._transformState;null!==ts.writechunk&&ts.writecb&&!ts.transforming?(ts.transforming=!0,this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)):ts.needTransform=!0},Transform.prototype._destroy=function(err,cb){var _this2=this;Duplex.prototype._destroy.call(this,err,function(err2){cb(err2),_this2.emit("close")})}},{"./_stream_duplex":139,"core-util-is":30,inherits:92}],143:[function(require,module,exports){(function(process,global,setImmediate){"use strict";var pna=require("process-nextick-args");function CorkedRequest(state){var _this=this;this.next=null,this.entry=null,this.finish=function(){!function(corkReq,state,err){var entry=corkReq.entry;corkReq.entry=null;for(;entry;){var cb=entry.callback;state.pendingcb--,cb(err),entry=entry.next}state.corkedRequestsFree?state.corkedRequestsFree.next=corkReq:state.corkedRequestsFree=corkReq}(_this,state)}}module.exports=Writable;var Duplex,asyncWrite=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:pna.nextTick;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var internalUtil={deprecate:require("util-deprecate")},Stream=require("./internal/streams/stream"),Buffer=require("safe-buffer").Buffer,OurUint8Array=global.Uint8Array||function(){};var realHasInstance,destroyImpl=require("./internal/streams/destroy");function nop(){}function WritableState(options,stream){Duplex=Duplex||require("./_stream_duplex"),options=options||{};var isDuplex=stream instanceof Duplex;this.objectMode=!!options.objectMode,isDuplex&&(this.objectMode=this.objectMode||!!options.writableObjectMode);var hwm=options.highWaterMark,writableHwm=options.writableHighWaterMark,defaultHwm=this.objectMode?16:16384;this.highWaterMark=hwm||0===hwm?hwm:isDuplex&&(writableHwm||0===writableHwm)?writableHwm:defaultHwm,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var noDecode=!1===options.decodeStrings;this.decodeStrings=!noDecode,this.defaultEncoding=options.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(er){!function(stream,er){var state=stream._writableState,sync=state.sync,cb=state.writecb;if(function(state){state.writing=!1,state.writecb=null,state.length-=state.writelen,state.writelen=0}(state),er)!function(stream,state,sync,er,cb){--state.pendingcb,sync?(pna.nextTick(cb,er),pna.nextTick(finishMaybe,stream,state),stream._writableState.errorEmitted=!0,stream.emit("error",er)):(cb(er),stream._writableState.errorEmitted=!0,stream.emit("error",er),finishMaybe(stream,state))}(stream,state,sync,er,cb);else{var finished=needFinish(state);finished||state.corked||state.bufferProcessing||!state.bufferedRequest||clearBuffer(stream,state),sync?asyncWrite(afterWrite,stream,state,finished,cb):afterWrite(stream,state,finished,cb)}}(stream,er)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new CorkedRequest(this)}function Writable(options){if(Duplex=Duplex||require("./_stream_duplex"),!(realHasInstance.call(Writable,this)||this instanceof Duplex))return new Writable(options);this._writableState=new WritableState(options,this),this.writable=!0,options&&("function"==typeof options.write&&(this._write=options.write),"function"==typeof options.writev&&(this._writev=options.writev),"function"==typeof options.destroy&&(this._destroy=options.destroy),"function"==typeof options.final&&(this._final=options.final)),Stream.call(this)}function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len,state.writecb=cb,state.writing=!0,state.sync=!0,writev?stream._writev(chunk,state.onwrite):stream._write(chunk,encoding,state.onwrite),state.sync=!1}function afterWrite(stream,state,finished,cb){finished||function(stream,state){0===state.length&&state.needDrain&&(state.needDrain=!1,stream.emit("drain"))}(stream,state),state.pendingcb--,cb(),finishMaybe(stream,state)}function clearBuffer(stream,state){state.bufferProcessing=!0;var entry=state.bufferedRequest;if(stream._writev&&entry&&entry.next){var l=state.bufferedRequestCount,buffer=new Array(l),holder=state.corkedRequestsFree;holder.entry=entry;for(var count=0,allBuffers=!0;entry;)buffer[count]=entry,entry.isBuf||(allBuffers=!1),entry=entry.next,count+=1;buffer.allBuffers=allBuffers,doWrite(stream,state,!0,state.length,buffer,"",holder.finish),state.pendingcb++,state.lastBufferedRequest=null,holder.next?(state.corkedRequestsFree=holder.next,holder.next=null):state.corkedRequestsFree=new CorkedRequest(state),state.bufferedRequestCount=0}else{for(;entry;){var chunk=entry.chunk,encoding=entry.encoding,cb=entry.callback;if(doWrite(stream,state,!1,state.objectMode?1:chunk.length,chunk,encoding,cb),entry=entry.next,state.bufferedRequestCount--,state.writing)break}null===entry&&(state.lastBufferedRequest=null)}state.bufferedRequest=entry,state.bufferProcessing=!1}function needFinish(state){return state.ending&&0===state.length&&null===state.bufferedRequest&&!state.finished&&!state.writing}function callFinal(stream,state){stream._final(function(err){state.pendingcb--,err&&stream.emit("error",err),state.prefinished=!0,stream.emit("prefinish"),finishMaybe(stream,state)})}function finishMaybe(stream,state){var need=needFinish(state);return need&&(!function(stream,state){state.prefinished||state.finalCalled||("function"==typeof stream._final?(state.pendingcb++,state.finalCalled=!0,pna.nextTick(callFinal,stream,state)):(state.prefinished=!0,stream.emit("prefinish")))}(stream,state),0===state.pendingcb&&(state.finished=!0,stream.emit("finish"))),need}util.inherits(Writable,Stream),WritableState.prototype.getBuffer=function(){for(var current=this.bufferedRequest,out=[];current;)out.push(current),current=current.next;return out},function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:internalUtil.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(_){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(realHasInstance=Function.prototype[Symbol.hasInstance],Object.defineProperty(Writable,Symbol.hasInstance,{value:function(object){return!!realHasInstance.call(this,object)||this===Writable&&(object&&object._writableState instanceof WritableState)}})):realHasInstance=function(object){return object instanceof this},Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},Writable.prototype.write=function(chunk,encoding,cb){var obj,state=this._writableState,ret=!1,isBuf=!state.objectMode&&(obj=chunk,Buffer.isBuffer(obj)||obj instanceof OurUint8Array);return isBuf&&!Buffer.isBuffer(chunk)&&(chunk=function(chunk){return Buffer.from(chunk)}(chunk)),"function"==typeof encoding&&(cb=encoding,encoding=null),isBuf?encoding="buffer":encoding||(encoding=state.defaultEncoding),"function"!=typeof cb&&(cb=nop),state.ended?function(stream,cb){var er=new Error("write after end");stream.emit("error",er),pna.nextTick(cb,er)}(this,cb):(isBuf||function(stream,state,chunk,cb){var valid=!0,er=!1;return null===chunk?er=new TypeError("May not write null values to stream"):"string"==typeof chunk||void 0===chunk||state.objectMode||(er=new TypeError("Invalid non-string/buffer chunk")),er&&(stream.emit("error",er),pna.nextTick(cb,er),valid=!1),valid}(this,state,chunk,cb))&&(state.pendingcb++,ret=function(stream,state,isBuf,chunk,encoding,cb){if(!isBuf){var newChunk=function(state,chunk,encoding){state.objectMode||!1===state.decodeStrings||"string"!=typeof chunk||(chunk=Buffer.from(chunk,encoding));return chunk}(state,chunk,encoding);chunk!==newChunk&&(isBuf=!0,encoding="buffer",chunk=newChunk)}var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;ret||(state.needDrain=!0);if(state.writing||state.corked){var last=state.lastBufferedRequest;state.lastBufferedRequest={chunk:chunk,encoding:encoding,isBuf:isBuf,callback:cb,next:null},last?last.next=state.lastBufferedRequest:state.bufferedRequest=state.lastBufferedRequest,state.bufferedRequestCount+=1}else doWrite(stream,state,!1,len,chunk,encoding,cb);return ret}(this,state,isBuf,chunk,encoding,cb)),ret},Writable.prototype.cork=function(){this._writableState.corked++},Writable.prototype.uncork=function(){var state=this._writableState;state.corked&&(state.corked--,state.writing||state.corked||state.finished||state.bufferProcessing||!state.bufferedRequest||clearBuffer(this,state))},Writable.prototype.setDefaultEncoding=function(encoding){if("string"==typeof encoding&&(encoding=encoding.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((encoding+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+encoding);return this._writableState.defaultEncoding=encoding,this},Object.defineProperty(Writable.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("_write() is not implemented"))},Writable.prototype._writev=null,Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;"function"==typeof chunk?(cb=chunk,chunk=null,encoding=null):"function"==typeof encoding&&(cb=encoding,encoding=null),null!==chunk&&void 0!==chunk&&this.write(chunk,encoding),state.corked&&(state.corked=1,this.uncork()),state.ending||state.finished||function(stream,state,cb){state.ending=!0,finishMaybe(stream,state),cb&&(state.finished?pna.nextTick(cb):stream.once("finish",cb));state.ended=!0,stream.writable=!1}(this,state,cb)},Object.defineProperty(Writable.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(value){this._writableState&&(this._writableState.destroyed=value)}}),Writable.prototype.destroy=destroyImpl.destroy,Writable.prototype._undestroy=destroyImpl.undestroy,Writable.prototype._destroy=function(err,cb){this.end(),cb(err)}}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},require("timers").setImmediate)},{"./_stream_duplex":139,"./internal/streams/destroy":145,"./internal/streams/stream":146,_process:118,"core-util-is":30,inherits:92,"process-nextick-args":117,"safe-buffer":149,timers:175,"util-deprecate":178}],144:[function(require,module,exports){"use strict";var Buffer=require("safe-buffer").Buffer,util=require("util");module.exports=function(){function BufferList(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,BufferList),this.head=null,this.tail=null,this.length=0}return BufferList.prototype.push=function(v){var entry={data:v,next:null};this.length>0?this.tail.next=entry:this.head=entry,this.tail=entry,++this.length},BufferList.prototype.unshift=function(v){var entry={data:v,next:this.head};0===this.length&&(this.tail=entry),this.head=entry,++this.length},BufferList.prototype.shift=function(){if(0!==this.length){var ret=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,ret}},BufferList.prototype.clear=function(){this.head=this.tail=null,this.length=0},BufferList.prototype.join=function(s){if(0===this.length)return"";for(var p=this.head,ret=""+p.data;p=p.next;)ret+=s+p.data;return ret},BufferList.prototype.concat=function(n){if(0===this.length)return Buffer.alloc(0);if(1===this.length)return this.head.data;for(var src,target,offset,ret=Buffer.allocUnsafe(n>>>0),p=this.head,i=0;p;)src=p.data,target=ret,offset=i,src.copy(target,offset),i+=p.data.length,p=p.next;return ret},BufferList}(),util&&util.inspect&&util.inspect.custom&&(module.exports.prototype[util.inspect.custom]=function(){var obj=util.inspect({length:this.length});return this.constructor.name+" "+obj})},{"safe-buffer":149,util:19}],145:[function(require,module,exports){"use strict";var pna=require("process-nextick-args");function emitErrorNT(self,err){self.emit("error",err)}module.exports={destroy:function(err,cb){var _this=this,readableDestroyed=this._readableState&&this._readableState.destroyed,writableDestroyed=this._writableState&&this._writableState.destroyed;return readableDestroyed||writableDestroyed?(cb?cb(err):!err||this._writableState&&this._writableState.errorEmitted||pna.nextTick(emitErrorNT,this,err),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(err||null,function(err){!cb&&err?(pna.nextTick(emitErrorNT,_this,err),_this._writableState&&(_this._writableState.errorEmitted=!0)):cb&&cb(err)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},{"process-nextick-args":117}],146:[function(require,module,exports){module.exports=require("events").EventEmitter},{events:21}],147:[function(require,module,exports){(exports=module.exports=require("./lib/_stream_readable.js")).Stream=exports,exports.Readable=exports,exports.Writable=require("./lib/_stream_writable.js"),exports.Duplex=require("./lib/_stream_duplex.js"),exports.Transform=require("./lib/_stream_transform.js"),exports.PassThrough=require("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":139,"./lib/_stream_passthrough.js":140,"./lib/_stream_readable.js":141,"./lib/_stream_transform.js":142,"./lib/_stream_writable.js":143}],148:[function(require,module,exports){(function(process){module.exports=function(tasks,cb){var results,pending,keys,isSync=!0;Array.isArray(tasks)?(results=[],pending=tasks.length):(keys=Object.keys(tasks),results={},pending=keys.length);function done(err){function end(){cb&&cb(err,results),cb=null}isSync?process.nextTick(end):end()}function each(i,err,result){results[i]=result,(0==--pending||err)&&done(err)}pending?keys?keys.forEach(function(key){tasks[key](function(err,result){each(key,err,result)})}):tasks.forEach(function(task,i){task(function(err,result){each(i,err,result)})}):done(null);isSync=!1}}).call(this,require("_process"))},{_process:118}],149:[function(require,module,exports){var buffer=require("buffer"),Buffer=buffer.Buffer;function copyProps(src,dst){for(var key in src)dst[key]=src[key]}function SafeBuffer(arg,encodingOrOffset,length){return Buffer(arg,encodingOrOffset,length)}Buffer.from&&Buffer.alloc&&Buffer.allocUnsafe&&Buffer.allocUnsafeSlow?module.exports=buffer:(copyProps(buffer,exports),exports.Buffer=SafeBuffer),copyProps(Buffer,SafeBuffer),SafeBuffer.from=function(arg,encodingOrOffset,length){if("number"==typeof arg)throw new TypeError("Argument must not be a number");return Buffer(arg,encodingOrOffset,length)},SafeBuffer.alloc=function(size,fill,encoding){if("number"!=typeof size)throw new TypeError("Argument must be a number");var buf=Buffer(size);return void 0!==fill?"string"==typeof encoding?buf.fill(fill,encoding):buf.fill(fill):buf.fill(0),buf},SafeBuffer.allocUnsafe=function(size){if("number"!=typeof size)throw new TypeError("Argument must be a number");return Buffer(size)},SafeBuffer.allocUnsafeSlow=function(size){if("number"!=typeof size)throw new TypeError("Argument must be a number");return buffer.SlowBuffer(size)}},{buffer:26}],150:[function(require,module,exports){(function(process){const events=require("events"),through2=require("through2"),inherits=require("inherits"),WebSocket="undefined"!=typeof window&&window.WebSocket?window.WebSocket:null;function SignalhubWs(app,urls,WebSocketClass){this.opened=!1,this.sockets=[],this.app=app;const channels=this.channels=new Map;this.subscribers={get length(){return channels.size}},Array.isArray(urls)||(urls=[urls]),urls=urls.map(function(url){return-1===(url=url.replace(/\/$/,"")).indexOf("://")?"ws://"+url:url});let countOpen=0;for(let index=0;index<urls.length;index++){const socket=new WebSocketClass(`${urls[index]}/${app}`);this.sockets.push(socket),socket.addEventListener("open",()=>{if(++countOpen===urls.length){this.opened=!0,this.emit("open");for(let channel of this.channels.values())channel.emit("open")}}),socket.addEventListener("message",message=>{this.onMessage(message)})}}inherits(SignalhubWs,events.EventEmitter),SignalhubWs.prototype.subscribe=function(channel){if(this.closed)throw new Error("Cannot subscribe after close");return this.channels.has(channel)?this.channels.get(channel):(this.channels.set(channel,through2.obj()),this.channels.get(channel).on("close",()=>{this.channels.delete(channel)}),this.opened&&process.nextTick(()=>{this.channels.has(channel)&&this.channels.get(channel).emit("open")}),this.channels.get(channel))},SignalhubWs.prototype.broadcast=function(channel,message,cb){if(this.closed)throw new Error("Cannot broadcast after close");const data={app:this.app,channel:channel,message:message};this.sockets.forEach(socket=>{socket.send(JSON.stringify(data))}),cb&&cb()},SignalhubWs.prototype.onMessage=function(message){message=JSON.parse(message.data);for(let key of this.channels.keys())if(message.channel!==key){if(Array.isArray(key))for(let i=0;i<key.length;i++)key[i]===message.channel&&this.channels.get(key).write(message.message)}else this.channels.get(key).write(message.message)},SignalhubWs.prototype.close=function(cb){if(this.closed)return void(cb&&process.nextTick(cb));this.once("close:socket",()=>{this._closeChannels(cb)});const len=this.sockets.length;if(0===len)return void this.emit("close");let closed=0;this.sockets.forEach(socket=>{socket.addEventListener("close",()=>{++closed===len&&this.emit("close:socket")}),process.nextTick(function(){socket.close()})})},SignalhubWs.prototype._closeChannels=function(cb){if(this.closed)return void(cb&&process.nextTick(cb));this.closed=!0,cb&&this.on("close",cb);const len=this.channels.size;if(0===len)return void this.emit("close");let closed=0;for(let channel of this.channels.values())process.nextTick(()=>{channel.end(()=>{++closed===len&&(this.channels.clear(),this.emit("close"))})})},module.exports=function(app,urls,WebSocketClass=WebSocket){if(!WebSocketClass)throw TypeError("No WebSocket class given.");return new SignalhubWs(app,urls,WebSocketClass)}}).call(this,require("_process"))},{_process:118,events:21,inherits:92,through2:151}],151:[function(require,module,exports){(function(process){var Transform=require("readable-stream").Transform,inherits=require("util").inherits;function DestroyableTransform(opts){Transform.call(this,opts),this._destroyed=!1}function noop(chunk,enc,callback){callback(null,chunk)}function through2(construct){return function(options,transform,flush){return"function"==typeof options&&(flush=transform,transform=options,options={}),"function"!=typeof transform&&(transform=noop),"function"!=typeof flush&&(flush=null),construct(options,transform,flush)}}inherits(DestroyableTransform,Transform),DestroyableTransform.prototype.destroy=function(err){if(!this._destroyed){this._destroyed=!0;var self=this;process.nextTick(function(){err&&self.emit("error",err),self.emit("close")})}},module.exports=through2(function(options,transform,flush){var t2=new DestroyableTransform(options);return t2._transform=transform,flush&&(t2._flush=flush),t2}),module.exports.ctor=through2(function(options,transform,flush){function Through2(override){if(!(this instanceof Through2))return new Through2(override);this.options=Object.assign({},options,override),DestroyableTransform.call(this,this.options)}return inherits(Through2,DestroyableTransform),Through2.prototype._transform=transform,flush&&(Through2.prototype._flush=flush),Through2}),module.exports.obj=through2(function(options,transform,flush){var t2=new DestroyableTransform(Object.assign({objectMode:!0,highWaterMark:16},options));return t2._transform=transform,flush&&(t2._flush=flush),t2})}).call(this,require("_process"))},{_process:118,"readable-stream":147,util:180}],152:[function(require,module,exports){var varint=require("varint");exports.encode=function encode(v,b,o){v=v>=0?2*v:-2*v-1;var r=varint.encode(v,b,o);return encode.bytes=varint.encode.bytes,r},exports.decode=function decode(b,o){var v=varint.decode(b,o);return decode.bytes=varint.decode.bytes,1&v?(v+1)/-2:v/2},exports.encodingLength=function(v){return varint.encodingLength(v>=0?2*v:-2*v-1)}},{varint:155}],153:[function(require,module,exports){arguments[4][51][0].apply(exports,arguments)},{dup:51}],154:[function(require,module,exports){arguments[4][13][0].apply(exports,arguments)},{dup:13}],155:[function(require,module,exports){arguments[4][14][0].apply(exports,arguments)},{"./decode.js":153,"./encode.js":154,"./length.js":156,dup:14}],156:[function(require,module,exports){arguments[4][15][0].apply(exports,arguments)},{dup:15}],157:[function(require,module,exports){(function(Buffer){module.exports=Peer;var debug=require("debug")("simple-peer"),getBrowserRTC=require("get-browser-rtc"),inherits=require("inherits"),randombytes=require("randombytes"),stream=require("readable-stream");function Peer(opts){var self=this;if(!(self instanceof Peer))return new Peer(opts);if(self._id=randombytes(4).toString("hex").slice(0,7),self._debug("new peer %o",opts),opts=Object.assign({allowHalfOpen:!1},opts),stream.Duplex.call(self,opts),self.channelName=opts.initiator?opts.channelName||randombytes(20).toString("hex"):null,self._isChromium="undefined"!=typeof window&&!!window.webkitRTCPeerConnection,self.initiator=opts.initiator||!1,self.channelConfig=opts.channelConfig||Peer.channelConfig,self.config=opts.config||Peer.config,self.constraints=self._transformConstraints(opts.constraints||Peer.constraints),self.offerConstraints=self._transformConstraints(opts.offerConstraints||{}),self.answerConstraints=self._transformConstraints(opts.answerConstraints||{}),self.reconnectTimer=opts.reconnectTimer||!1,self.sdpTransform=opts.sdpTransform||function(sdp){return sdp},self.stream=opts.stream||!1,self.trickle=void 0===opts.trickle||opts.trickle,self.destroyed=!1,self.connected=!1,self.remoteAddress=void 0,self.remoteFamily=void 0,self.remotePort=void 0,self.localAddress=void 0,self.localPort=void 0,self._wrtc=opts.wrtc&&"object"==typeof opts.wrtc?opts.wrtc:getBrowserRTC(),!self._wrtc)throw"undefined"==typeof window?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser");if(self._pcReady=!1,self._channelReady=!1,self._iceComplete=!1,self._channel=null,self._pendingCandidates=[],self._previousStreams=[],self._chunk=null,self._cb=null,self._interval=null,self._reconnectTimeout=null,self._pc=new self._wrtc.RTCPeerConnection(self.config,self.constraints),self._isWrtc=Array.isArray(self._pc.RTCIceConnectionStates),self._isReactNativeWebrtc="number"==typeof self._pc._peerConnectionId,self._pc.oniceconnectionstatechange=function(){self._onIceConnectionStateChange()},self._pc.onsignalingstatechange=function(){self._onSignalingStateChange()},self._pc.onicecandidate=function(event){self._onIceCandidate(event)},self.initiator){var createdOffer=!1;self._pc.onnegotiationneeded=function(){createdOffer||self._createOffer(),createdOffer=!0},self._setupData({channel:self._pc.createDataChannel(self.channelName,self.channelConfig)})}else self._pc.ondatachannel=function(event){self._setupData(event)};"addTrack"in self._pc?(self.stream&&self.stream.getTracks().forEach(function(track){self._pc.addTrack(track,self.stream)}),self._pc.ontrack=function(event){self._onTrack(event)}):(self.stream&&self._pc.addStream(self.stream),self._pc.onaddstream=function(event){self._onAddStream(event)}),self.initiator&&self._isWrtc&&self._pc.onnegotiationneeded(),self._onFinishBound=function(){self._onFinish()},self.once("finish",self._onFinishBound)}function noop(){}inherits(Peer,stream.Duplex),Peer.WEBRTC_SUPPORT=!!getBrowserRTC(),Peer.config={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:global.stun.twilio.com:3478?transport=udp"}]},Peer.constraints={},Peer.channelConfig={},Object.defineProperty(Peer.prototype,"bufferSize",{get:function(){return this._channel&&this._channel.bufferedAmount||0}}),Peer.prototype.address=function(){return{port:this.localPort,family:"IPv4",address:this.localAddress}},Peer.prototype.signal=function(data){var self=this;if(self.destroyed)throw new Error("cannot signal after peer is destroyed");if("string"==typeof data)try{data=JSON.parse(data)}catch(err){data={}}self._debug("signal()"),data.candidate&&(self._pc.remoteDescription?self._addIceCandidate(data.candidate):self._pendingCandidates.push(data.candidate)),data.sdp&&self._pc.setRemoteDescription(new self._wrtc.RTCSessionDescription(data),function(){self.destroyed||(self._pendingCandidates.forEach(function(candidate){self._addIceCandidate(candidate)}),self._pendingCandidates=[],"offer"===self._pc.remoteDescription.type&&self._createAnswer())},function(err){self._onError(err)}),data.sdp||data.candidate||self._destroy(new Error("signal() called with invalid signal data"))},Peer.prototype._addIceCandidate=function(candidate){var self=this;try{self._pc.addIceCandidate(new self._wrtc.RTCIceCandidate(candidate),noop,function(err){self._onError(err)})}catch(err){self._destroy(new Error("error adding candidate: "+err.message))}},Peer.prototype.send=function(chunk){this._isWrtc&&Buffer.isBuffer(chunk)&&(chunk=new Uint8Array(chunk)),this._channel.send(chunk)},Peer.prototype.destroy=function(onclose){this._destroy(null,onclose)},Peer.prototype._destroy=function(err,onclose){if(!this.destroyed){if(onclose&&this.once("close",onclose),this._debug("destroy (error: %s)",err&&err.message),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this.destroyed=!0,this.connected=!1,this._pcReady=!1,this._channelReady=!1,this._previousStreams=null,clearInterval(this._interval),clearTimeout(this._reconnectTimeout),this._interval=null,this._reconnectTimeout=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._pc){try{this._pc.close()}catch(err){}this._pc.oniceconnectionstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,"addTrack"in this._pc?this._pc.ontrack=null:this._pc.onaddstream=null,this._pc.onnegotiationneeded=null,this._pc.ondatachannel=null}if(this._channel){try{this._channel.close()}catch(err){}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null}this._pc=null,this._channel=null,err&&this.emit("error",err),this.emit("close")}},Peer.prototype._setupData=function(event){var self=this;self._channel=event.channel,self._channel.binaryType="arraybuffer","number"==typeof self._channel.bufferedAmountLowThreshold&&(self._channel.bufferedAmountLowThreshold=65536),self.channelName=self._channel.label,self._channel.onmessage=function(event){self._onChannelMessage(event)},self._channel.onbufferedamountlow=function(){self._onChannelBufferedAmountLow()},self._channel.onopen=function(){self._onChannelOpen()},self._channel.onclose=function(){self._onChannelClose()}},Peer.prototype._read=function(){},Peer.prototype._write=function(chunk,encoding,cb){if(this.destroyed)return cb(new Error("cannot write after peer is destroyed"));if(this.connected){try{this.send(chunk)}catch(err){return this._onError(err)}this._channel.bufferedAmount>65536?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=cb):cb(null)}else this._debug("write before connect"),this._chunk=chunk,this._cb=cb},Peer.prototype._onFinish=function(){var self=this;function destroySoon(){setTimeout(function(){self._destroy()},100)}self.destroyed||(self.connected?destroySoon():self.once("connect",destroySoon))},Peer.prototype._createOffer=function(){var self=this;self.destroyed||self._pc.createOffer(function(offer){if(!self.destroyed){offer.sdp=self.sdpTransform(offer.sdp),self._pc.setLocalDescription(offer,noop,function(err){self._onError(err)});var sendOffer=function(){var signal=self._pc.localDescription||offer;self._debug("signal"),self.emit("signal",{type:signal.type,sdp:signal.sdp})};self.trickle||self._iceComplete?sendOffer():self.once("_iceComplete",sendOffer)}},function(err){self._onError(err)},self.offerConstraints)},Peer.prototype._createAnswer=function(){var self=this;self.destroyed||self._pc.createAnswer(function(answer){function sendAnswer(){var signal=self._pc.localDescription||answer;self._debug("signal"),self.emit("signal",{type:signal.type,sdp:signal.sdp})}self.destroyed||(answer.sdp=self.sdpTransform(answer.sdp),self._pc.setLocalDescription(answer,noop,function(err){self._onError(err)}),self.trickle||self._iceComplete?sendAnswer():self.once("_iceComplete",sendAnswer))},function(err){self._onError(err)},self.answerConstraints)},Peer.prototype._onIceConnectionStateChange=function(){var self=this;if(!self.destroyed){var iceGatheringState=self._pc.iceGatheringState,iceConnectionState=self._pc.iceConnectionState;self._debug("iceConnectionStateChange %s %s",iceGatheringState,iceConnectionState),self.emit("iceConnectionStateChange",iceGatheringState,iceConnectionState),"connected"!==iceConnectionState&&"completed"!==iceConnectionState||(clearTimeout(self._reconnectTimeout),self._pcReady=!0,self._maybeReady()),"disconnected"===iceConnectionState&&(self.reconnectTimer?(clearTimeout(self._reconnectTimeout),self._reconnectTimeout=setTimeout(function(){self._destroy()},self.reconnectTimer)):self._destroy()),"failed"===iceConnectionState&&self._destroy(new Error("Ice connection failed.")),"closed"===iceConnectionState&&self._destroy()}},Peer.prototype.getStats=function(cb){var self=this;0===self._pc.getStats.length?self._pc.getStats().then(function(res){var reports=[];res.forEach(function(report){reports.push(report)}),cb(reports)},function(err){self._onError(err)}):self._isReactNativeWebrtc?self._pc.getStats(null,function(res){var reports=[];res.forEach(function(report){reports.push(report)}),cb(reports)},function(err){self._onError(err)}):self._pc.getStats.length>0?self._pc.getStats(function(res){var reports=[];res.result().forEach(function(result){var report={};result.names().forEach(function(name){report[name]=result.stat(name)}),report.id=result.id,report.type=result.type,report.timestamp=result.timestamp,reports.push(report)}),cb(reports)},function(err){self._onError(err)}):cb([])},Peer.prototype._maybeReady=function(){var self=this;self._debug("maybeReady pc %s channel %s",self._pcReady,self._channelReady),!self.connected&&!self._connecting&&self._pcReady&&self._channelReady&&(self._connecting=!0,self.getStats(function(items){self._connecting=!1,self.connected=!0;var remoteCandidates={},localCandidates={},candidatePairs={};function setSelectedCandidatePair(selectedCandidatePair){var local=localCandidates[selectedCandidatePair.localCandidateId];local&&local.ip?(self.localAddress=local.ip,self.localPort=Number(local.port)):local&&local.ipAddress?(self.localAddress=local.ipAddress,self.localPort=Number(local.portNumber)):"string"==typeof selectedCandidatePair.googLocalAddress&&(local=selectedCandidatePair.googLocalAddress.split(":"),self.localAddress=local[0],self.localPort=Number(local[1]));var remote=remoteCandidates[selectedCandidatePair.remoteCandidateId];remote&&remote.ip?(self.remoteAddress=remote.ip,self.remotePort=Number(remote.port)):remote&&remote.ipAddress?(self.remoteAddress=remote.ipAddress,self.remotePort=Number(remote.portNumber)):"string"==typeof selectedCandidatePair.googRemoteAddress&&(remote=selectedCandidatePair.googRemoteAddress.split(":"),self.remoteAddress=remote[0],self.remotePort=Number(remote[1])),self.remoteFamily="IPv4",self._debug("connect local: %s:%s remote: %s:%s",self.localAddress,self.localPort,self.remoteAddress,self.remotePort)}if(items.forEach(function(item){"remotecandidate"!==item.type&&"remote-candidate"!==item.type||(remoteCandidates[item.id]=item),"localcandidate"!==item.type&&"local-candidate"!==item.type||(localCandidates[item.id]=item),"candidatepair"!==item.type&&"candidate-pair"!==item.type||(candidatePairs[item.id]=item)}),items.forEach(function(item){"transport"===item.type&&setSelectedCandidatePair(candidatePairs[item.selectedCandidatePairId]),("googCandidatePair"===item.type&&"true"===item.googActiveConnection||("candidatepair"===item.type||"candidate-pair"===item.type)&&item.selected)&&setSelectedCandidatePair(item)}),self._chunk){try{self.send(self._chunk)}catch(err){return self._onError(err)}self._chunk=null,self._debug('sent chunk from "write before connect"');var cb=self._cb;self._cb=null,cb(null)}"number"!=typeof self._channel.bufferedAmountLowThreshold&&(self._interval=setInterval(function(){self._onInterval()},150),self._interval.unref&&self._interval.unref()),self._debug("connect"),self.emit("connect")}))},Peer.prototype._onInterval=function(){!this._cb||!this._channel||this._channel.bufferedAmount>65536||this._onChannelBufferedAmountLow()},Peer.prototype._onSignalingStateChange=function(){this.destroyed||(this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))},Peer.prototype._onIceCandidate=function(event){this.destroyed||(event.candidate&&this.trickle?this.emit("signal",{candidate:{candidate:event.candidate.candidate,sdpMLineIndex:event.candidate.sdpMLineIndex,sdpMid:event.candidate.sdpMid}}):event.candidate||(this._iceComplete=!0,this.emit("_iceComplete")))},Peer.prototype._onChannelMessage=function(event){if(!this.destroyed){var data=event.data;data instanceof ArrayBuffer&&(data=new Buffer(data)),this.push(data)}},Peer.prototype._onChannelBufferedAmountLow=function(){if(!this.destroyed&&this._cb){this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);var cb=this._cb;this._cb=null,cb(null)}},Peer.prototype._onChannelOpen=function(){this.connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())},Peer.prototype._onChannelClose=function(){this.destroyed||(this._debug("on channel close"),this._destroy())},Peer.prototype._onAddStream=function(event){this.destroyed||(this._debug("on add stream"),this.emit("stream",event.stream))},Peer.prototype._onTrack=function(event){if(!this.destroyed){this._debug("on track");var id=event.streams[0].id;-1===this._previousStreams.indexOf(id)&&(this._previousStreams.push(id),this.emit("stream",event.streams[0]))}},Peer.prototype._onError=function(err){this.destroyed||(this._debug("error %s",err.message||err),this._destroy(err))},Peer.prototype._debug=function(){var args=[].slice.call(arguments);args[0]="["+this._id+"] "+args[0],debug.apply(null,args)},Peer.prototype._transformConstraints=function(constraints){if(0===Object.keys(constraints).length)return constraints;if((constraints.mandatory||constraints.optional)&&!this._isChromium){var newConstraints=Object.assign({},constraints.optional,constraints.mandatory);return void 0!==newConstraints.OfferToReceiveVideo&&(newConstraints.offerToReceiveVideo=newConstraints.OfferToReceiveVideo,delete newConstraints.OfferToReceiveVideo),void 0!==newConstraints.OfferToReceiveAudio&&(newConstraints.offerToReceiveAudio=newConstraints.OfferToReceiveAudio,delete newConstraints.OfferToReceiveAudio),newConstraints}return constraints.mandatory||constraints.optional||!this._isChromium?constraints:(void 0!==constraints.offerToReceiveVideo&&(constraints.OfferToReceiveVideo=constraints.offerToReceiveVideo,delete constraints.offerToReceiveVideo),void 0!==constraints.offerToReceiveAudio&&(constraints.OfferToReceiveAudio=constraints.offerToReceiveAudio,delete constraints.offerToReceiveAudio),{mandatory:constraints})}}).call(this,require("buffer").Buffer)},{buffer:26,debug:34,"get-browser-rtc":46,inherits:92,randombytes:138,"readable-stream":147}],158:[function(require,module,exports){function _add(a,b){var rl=a.l+b.l,a2={h:a.h+b.h+(rl/2>>>31)>>>0,l:rl>>>0};a.h=a2.h,a.l=a2.l}function _xor(a,b){a.h^=b.h,a.h>>>=0,a.l^=b.l,a.l>>>=0}function _rotl(a,n){var a2={h:a.h<<n|a.l>>>32-n,l:a.l<<n|a.h>>>32-n};a.h=a2.h,a.l=a2.l}function _rotl32(a){var al=a.l;a.l=a.h,a.h=al}function _compress(v0,v1,v2,v3){_add(v0,v1),_add(v2,v3),_rotl(v1,13),_rotl(v3,16),_xor(v1,v0),_xor(v3,v2),_rotl32(v0),_add(v2,v1),_add(v0,v3),_rotl(v1,17),_rotl(v3,21),_xor(v1,v2),_xor(v3,v0),_rotl32(v2)}function _get_int(a,offset){return a[offset+3]<<24|a[offset+2]<<16|a[offset+1]<<8|a[offset]}module.exports=function(out,m,key){var mi,k0={h:_get_int(key,4),l:_get_int(key,0)},k1={h:_get_int(key,12),l:_get_int(key,8)},v0={h:k0.h,l:k0.l},v2=k0,v1={h:k1.h,l:k1.l},v3=k1,mp=0,ml=m.length,ml7=ml-7,buf=new Uint8Array(new ArrayBuffer(8));_xor(v0,{h:1936682341,l:1886610805}),_xor(v1,{h:1685025377,l:1852075885}),_xor(v2,{h:1819895653,l:1852142177}),_xor(v3,{h:1952801890,l:2037671283});for(;mp<ml7;)mi={h:_get_int(m,mp+4),l:_get_int(m,mp)},_xor(v3,mi),_compress(v0,v1,v2,v3),_compress(v0,v1,v2,v3),_xor(v0,mi),mp+=8;buf[7]=ml;var ic=0;for(;mp<ml;)buf[ic++]=m[mp++];for(;ic<7;)buf[ic++]=0;mi={h:buf[7]<<24|buf[6]<<16|buf[5]<<8|buf[4],l:buf[3]<<24|buf[2]<<16|buf[1]<<8|buf[0]},_xor(v3,mi),_compress(v0,v1,v2,v3),_compress(v0,v1,v2,v3),_xor(v0,mi),_xor(v2,{h:0,l:255}),_compress(v0,v1,v2,v3),_compress(v0,v1,v2,v3),_compress(v0,v1,v2,v3),_compress(v0,v1,v2,v3);var h=v0;_xor(h,v1),_xor(h,v2),_xor(h,v3),out[0]=255&h.l,out[1]=h.l>>8&255,out[2]=h.l>>16&255,out[3]=h.l>>24&255,out[4]=255&h.h,out[5]=h.h>>8&255,out[6]=h.h>>16&255,out[7]=h.h>>24&255}},{}],159:[function(require,module,exports){var wasm=require("./siphash24"),fallback=require("./fallback"),assert=require("nanoassert");module.exports=siphash24;var BYTES=siphash24.BYTES=8,KEYBYTES=siphash24.KEYBYTES=16,mod=wasm();function siphash24(data,key,out,noAssert){return out||(out=new Uint8Array(8)),!0!==noAssert&&(assert(out.length>=BYTES,"output must be at least "+BYTES),assert(key.length>=KEYBYTES,"key must be at least "+KEYBYTES)),mod&&mod.exports?(data.length+24>mod.memory.length&&mod.realloc(data.length+24),mod.memory.set(key,8),mod.memory.set(data,24),mod.exports.siphash(24,data.length),out.set(mod.memory.subarray(0,8))):fallback(out,data,key),out}siphash24.WASM_SUPPORTED="undefined"!=typeof WebAssembly,siphash24.WASM_LOADED=!1,mod&&mod.onload(function(err){siphash24.WASM_LOADED=!err})},{"./fallback":158,"./siphash24":160,nanoassert:109}],160:[function(require,module,exports){function loadWebAssembly(opts){if(!loadWebAssembly.supported)return null;var s,imp=opts&&opts.imports,wasm=(s="AGFzbQEAAAABBgFgAn9/AAMCAQAFBQEBCpBOBxQCBm1lbW9yeQIAB3NpcGhhc2gAAArdCAHaCAIIfgJ/QvXKzYPXrNu38wAhAkLt3pHzlszct+QAIQNC4eSV89bs2bzsACEEQvPK0cunjNmy9AAhBUEIKQMAIQdBECkDACEIIAGtQjiGIQYgAUEHcSELIAAgAWogC2shCiAFIAiFIQUgBCAHhSEEIAMgCIUhAyACIAeFIQICQANAIAAgCkYNASAAKQMAIQkgBSAJhSEFIAIgA3whAiADQg2JIQMgAyAChSEDIAJCIIkhAiAEIAV8IQQgBUIQiSEFIAUgBIUhBSACIAV8IQIgBUIViSEFIAUgAoUhBSAEIAN8IQQgA0IRiSEDIAMgBIUhAyAEQiCJIQQgAiADfCECIANCDYkhAyADIAKFIQMgAkIgiSECIAQgBXwhBCAFQhCJIQUgBSAEhSEFIAIgBXwhAiAFQhWJIQUgBSAChSEFIAQgA3whBCADQhGJIQMgAyAEhSEDIARCIIkhBCACIAmFIQIgAEEIaiEADAALCwJAAkACQAJAAkACQAJAAkAgCw4HBwYFBAMCAQALIAYgADEABkIwhoQhBgsgBiAAMQAFQiiGhCEGCyAGIAAxAARCIIaEIQYLIAYgADEAA0IYhoQhBgsgBiAAMQACQhCGhCEGCyAGIAAxAAFCCIaEIQYLIAYgADEAAIQhBgsgBSAGhSEFIAIgA3whAiADQg2JIQMgAyAChSEDIAJCIIkhAiAEIAV8IQQgBUIQiSEFIAUgBIUhBSACIAV8IQIgBUIViSEFIAUgAoUhBSAEIAN8IQQgA0IRiSEDIAMgBIUhAyAEQiCJIQQgAiADfCECIANCDYkhAyADIAKFIQMgAkIgiSECIAQgBXwhBCAFQhCJIQUgBSAEhSEFIAIgBXwhAiAFQhWJIQUgBSAChSEFIAQgA3whBCADQhGJIQMgAyAEhSEDIARCIIkhBCACIAaFIQIgBEL/AYUhBCACIAN8IQIgA0INiSEDIAMgAoUhAyACQiCJIQIgBCAFfCEEIAVCEIkhBSAFIASFIQUgAiAFfCECIAVCFYkhBSAFIAKFIQUgBCADfCEEIANCEYkhAyADIASFIQMgBEIgiSEEIAIgA3whAiADQg2JIQMgAyAChSEDIAJCIIkhAiAEIAV8IQQgBUIQiSEFIAUgBIUhBSACIAV8IQIgBUIViSEFIAUgAoUhBSAEIAN8IQQgA0IRiSEDIAMgBIUhAyAEQiCJIQQgAiADfCECIANCDYkhAyADIAKFIQMgAkIgiSECIAQgBXwhBCAFQhCJIQUgBSAEhSEFIAIgBXwhAiAFQhWJIQUgBSAChSEFIAQgA3whBCADQhGJIQMgAyAEhSEDIARCIIkhBCACIAN8IQIgA0INiSEDIAMgAoUhAyACQiCJIQIgBCAFfCEEIAVCEIkhBSAFIASFIQUgAiAFfCECIAVCFYkhBSAFIAKFIQUgBCADfCEEIANCEYkhAyADIASFIQMgBEIgiSEEQQAgAiADIAQgBYWFhTcDAAs=","function"==typeof atob?new Uint8Array(atob(s).split("").map(charCodeAt)):new(require("buffer").Buffer)(s,"base64")),ready=null,mod={buffer:wasm,memory:null,exports:null,realloc:function(size){mod.exports.memory.grow(Math.max(0,Math.ceil(Math.abs(size-mod.memory.length)/65536))),mod.memory=new Uint8Array(mod.exports.memory.buffer)},onload:onload};return onload(function(){}),mod;function onload(cb){if(mod.exports)return cb();if(ready)ready.then(cb.bind(null,null)).catch(cb);else{try{if(opts&&opts.async)throw new Error("async");setup({instance:new WebAssembly.Instance(new WebAssembly.Module(wasm),imp)})}catch(err){ready=WebAssembly.instantiate(wasm,imp).then(setup)}onload(cb)}}function setup(w){mod.exports=w.instance.exports,mod.memory=mod.exports.memory&&mod.exports.memory.buffer&&new Uint8Array(mod.exports.memory.buffer)}}function charCodeAt(c){return c.charCodeAt(0)}module.exports=loadWebAssembly,loadWebAssembly.supported="undefined"!=typeof WebAssembly},{}],161:[function(require,module,exports){var blake2b=require("blake2b");module.exports.crypto_generichash_PRIMITIVE="blake2b",module.exports.crypto_generichash_BYTES_MIN=blake2b.BYTES_MIN,module.exports.crypto_generichash_BYTES_MAX=blake2b.BYTES_MAX,module.exports.crypto_generichash_BYTES=blake2b.BYTES,module.exports.crypto_generichash_KEYBYTES_MIN=blake2b.KEYBYTES_MIN,module.exports.crypto_generichash_KEYBYTES_MAX=blake2b.KEYBYTES_MAX,module.exports.crypto_generichash_KEYBYTES=blake2b.KEYBYTES,module.exports.crypto_generichash_WASM_SUPPORTED=blake2b.WASM_SUPPORTED,module.exports.crypto_generichash_WASM_LOADED=!1,module.exports.crypto_generichash=function(output,input,key){blake2b(output.length,key).update(input).final(output)},module.exports.crypto_generichash_ready=blake2b.ready,module.exports.crypto_generichash_batch=function(output,inputArray,key){for(var ctx=blake2b(output.length,key),i=0;i<inputArray.length;i++)ctx.update(inputArray[i]);ctx.final(output)},module.exports.crypto_generichash_instance=function(key,outlen){return null==outlen&&(outlen=module.exports.crypto_generichash_BYTES),blake2b(outlen,key)},blake2b.ready(function(err){module.exports.crypto_generichash_WASM_LOADED=blake2b.WASM_LOADED})},{blake2b:18}],162:[function(require,module,exports){var assert=require("nanoassert"),randombytes_buf=require("./randombytes").randombytes_buf,blake2b=require("blake2b");module.exports.crypto_kdf_PRIMITIVE="blake2b",module.exports.crypto_kdf_BYTES_MIN=16,module.exports.crypto_kdf_BYTES_MAX=64,module.exports.crypto_kdf_CONTEXTBYTES=8,module.exports.crypto_kdf_KEYBYTES=32,module.exports.crypto_kdf_derive_from_key=function(subkey,subkey_id,ctx,key){assert(subkey.length>=module.exports.crypto_kdf_BYTES_MIN,"subkey must be at least crypto_kdf_BYTES_MIN"),assert(subkey_id>=0&&subkey_id<=9007199254740991,"subkey_id must be safe integer"),assert(ctx.length>=module.exports.crypto_kdf_CONTEXTBYTES,"context must be at least crypto_kdf_CONTEXTBYTES");var ctx_padded=new Uint8Array(blake2b.PERSONALBYTES),salt=new Uint8Array(blake2b.SALTBYTES);ctx_padded.set(ctx,0,module.exports.crypto_kdf_CONTEXTBYTES),function(dest,int){var mul=1,i=0;for(dest[0]=255&int;++i<8&&(mul*=256);)dest[i]=int/mul&255}(salt,subkey_id);var outlen=Math.min(subkey.length,module.exports.crypto_kdf_BYTES_MAX);blake2b(outlen,key.subarray(0,module.exports.crypto_kdf_KEYBYTES),salt,ctx_padded,!0).final(subkey)},module.exports.crypto_kdf_keygen=function(out){assert(out.length>=module.exports.crypto_kdf_KEYBYTES,"out.length must be crypto_kdf_KEYBYTES"),randombytes_buf(out.subarray(0,module.exports.crypto_kdf_KEYBYTES))}},{"./randombytes":166,blake2b:18,nanoassert:109}],163:[function(require,module,exports){var siphash=require("siphash24");exports.crypto_shorthash_PRIMITIVE="siphash24",exports.crypto_shorthash_BYTES=siphash.BYTES,exports.crypto_shorthash_KEYBYTES=siphash.KEYBYTES,exports.crypto_shorthash_WASM_SUPPORTED=siphash.WASM_SUPPORTED,exports.crypto_shorthash_WASM_LOADED=siphash.WASM_LOADED,exports.crypto_shorthash=function(out,data,key,noAssert){siphash(data,key,out,noAssert)}},{siphash24:159}],164:[function(require,module,exports){var xsalsa20=require("xsalsa20");function XOR(nonce,key){this._instance=xsalsa20(nonce,key)}exports.crypto_stream_KEYBYTES=32,exports.crypto_stream_NONCEBYTES=24,exports.crypto_stream_PRIMITIVE="xsalsa20",exports.crypto_stream=function(out,nonce,key){out.fill(0),exports.crypto_stream_xor(out,out,nonce,key)},exports.crypto_stream_xor=function(out,inp,nonce,key){var xor=xsalsa20(nonce,key);xor.update(inp,out),xor.final()},exports.crypto_stream_xor_instance=function(nonce,key){return new XOR(nonce,key)},XOR.prototype.update=function(out,inp){this._instance.update(inp,out)},XOR.prototype.final=function(){this._instance.finalize(),this._instance=null}},{xsalsa20:185}],165:[function(require,module,exports){"use strict";var sodium=module.exports,cs=require("./crypto_stream"),gf=function(init){var i,r=new Float64Array(16);if(init)for(i=0;i<init.length;i++)r[i]=init[i];return r},randombytes=require("./randombytes").randombytes,_9=(new Uint8Array(16),new Uint8Array(32));_9[0]=9;var gf0=gf(),gf1=gf([1]),_121665=gf([56129,1]),D=gf([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),D2=gf([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),X=gf([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),Y=gf([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),I=gf([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function ts64(x,i,h,l){x[i]=h>>24&255,x[i+1]=h>>16&255,x[i+2]=h>>8&255,x[i+3]=255&h,x[i+4]=l>>24&255,x[i+5]=l>>16&255,x[i+6]=l>>8&255,x[i+7]=255&l}function vn(x,xi,y,yi,n){var i,d=0;for(i=0;i<n;i++)d|=x[xi+i]^y[yi+i];return(1&d-1>>>8)-1}function crypto_verify_32(x,xi,y,yi){return vn(x,xi,y,yi,32)}var poly1305=function(key){var t0,t1,t2,t3,t4,t5,t6,t7;this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.leftover=0,this.fin=0,t0=255&key[0]|(255&key[1])<<8,this.r[0]=8191&t0,t1=255&key[2]|(255&key[3])<<8,this.r[1]=8191&(t0>>>13|t1<<3),t2=255&key[4]|(255&key[5])<<8,this.r[2]=7939&(t1>>>10|t2<<6),t3=255&key[6]|(255&key[7])<<8,this.r[3]=8191&(t2>>>7|t3<<9),t4=255&key[8]|(255&key[9])<<8,this.r[4]=255&(t3>>>4|t4<<12),this.r[5]=t4>>>1&8190,t5=255&key[10]|(255&key[11])<<8,this.r[6]=8191&(t4>>>14|t5<<2),t6=255&key[12]|(255&key[13])<<8,this.r[7]=8065&(t5>>>11|t6<<5),t7=255&key[14]|(255&key[15])<<8,this.r[8]=8191&(t6>>>8|t7<<8),this.r[9]=t7>>>5&127,this.pad[0]=255&key[16]|(255&key[17])<<8,this.pad[1]=255&key[18]|(255&key[19])<<8,this.pad[2]=255&key[20]|(255&key[21])<<8,this.pad[3]=255&key[22]|(255&key[23])<<8,this.pad[4]=255&key[24]|(255&key[25])<<8,this.pad[5]=255&key[26]|(255&key[27])<<8,this.pad[6]=255&key[28]|(255&key[29])<<8,this.pad[7]=255&key[30]|(255&key[31])<<8};function crypto_stream_xor(c,cpos,m,mpos,clen,n,k){cs.crypto_stream_xor(c,m,n,k)}function crypto_onetimeauth(out,outpos,m,mpos,n,k){var s=new poly1305(k);return s.update(m,mpos,n),s.finish(out,outpos),0}function crypto_onetimeauth_verify(h,hpos,m,mpos,n,k){var x=new Uint8Array(16);return crypto_onetimeauth(x,0,m,mpos,n,k),function(x,xi,y,yi){return vn(x,xi,y,yi,16)}(h,hpos,x,0)}function crypto_secretbox_open(m,c,d,n,k){var i,x=new Uint8Array(32);if(d<32)return-1;if(function(c,cpos,clen,n,k){cs.crypto_stream(c,n,k)}(x,0,0,n,k),0!==crypto_onetimeauth_verify(c,16,c,32,d-32,x))return-1;for(crypto_stream_xor(m,0,c,0,0,n,k),i=0;i<32;i++)m[i]=0;return 0}function set25519(r,a){var i;for(i=0;i<16;i++)r[i]=0|a[i]}function car25519(o){var i,v,c=1;for(i=0;i<16;i++)v=o[i]+c+65535,c=Math.floor(v/65536),o[i]=v-65536*c;o[0]+=c-1+37*(c-1)}function sel25519(p,q,b){for(var t,c=~(b-1),i=0;i<16;i++)t=c&(p[i]^q[i]),p[i]^=t,q[i]^=t}function pack25519(o,n){var i,j,b,m=gf(),t=gf();for(i=0;i<16;i++)t[i]=n[i];for(car25519(t),car25519(t),car25519(t),j=0;j<2;j++){for(m[0]=t[0]-65517,i=1;i<15;i++)m[i]=t[i]-65535-(m[i-1]>>16&1),m[i-1]&=65535;m[15]=t[15]-32767-(m[14]>>16&1),b=m[15]>>16&1,m[14]&=65535,sel25519(t,m,1-b)}for(i=0;i<16;i++)o[2*i]=255&t[i],o[2*i+1]=t[i]>>8}function neq25519(a,b){var c=new Uint8Array(32),d=new Uint8Array(32);return pack25519(c,a),pack25519(d,b),crypto_verify_32(c,0,d,0)}function par25519(a){var d=new Uint8Array(32);return pack25519(d,a),1&d[0]}function unpack25519(o,n){var i;for(i=0;i<16;i++)o[i]=n[2*i]+(n[2*i+1]<<8);o[15]&=32767}function A(o,a,b){for(var i=0;i<16;i++)o[i]=a[i]+b[i]}function Z(o,a,b){for(var i=0;i<16;i++)o[i]=a[i]-b[i]}function M(o,a,b){var v,c,t0=0,t1=0,t2=0,t3=0,t4=0,t5=0,t6=0,t7=0,t8=0,t9=0,t10=0,t11=0,t12=0,t13=0,t14=0,t15=0,t16=0,t17=0,t18=0,t19=0,t20=0,t21=0,t22=0,t23=0,t24=0,t25=0,t26=0,t27=0,t28=0,t29=0,t30=0,b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5],b6=b[6],b7=b[7],b8=b[8],b9=b[9],b10=b[10],b11=b[11],b12=b[12],b13=b[13],b14=b[14],b15=b[15];t0+=(v=a[0])*b0,t1+=v*b1,t2+=v*b2,t3+=v*b3,t4+=v*b4,t5+=v*b5,t6+=v*b6,t7+=v*b7,t8+=v*b8,t9+=v*b9,t10+=v*b10,t11+=v*b11,t12+=v*b12,t13+=v*b13,t14+=v*b14,t15+=v*b15,t1+=(v=a[1])*b0,t2+=v*b1,t3+=v*b2,t4+=v*b3,t5+=v*b4,t6+=v*b5,t7+=v*b6,t8+=v*b7,t9+=v*b8,t10+=v*b9,t11+=v*b10,t12+=v*b11,t13+=v*b12,t14+=v*b13,t15+=v*b14,t16+=v*b15,t2+=(v=a[2])*b0,t3+=v*b1,t4+=v*b2,t5+=v*b3,t6+=v*b4,t7+=v*b5,t8+=v*b6,t9+=v*b7,t10+=v*b8,t11+=v*b9,t12+=v*b10,t13+=v*b11,t14+=v*b12,t15+=v*b13,t16+=v*b14,t17+=v*b15,t3+=(v=a[3])*b0,t4+=v*b1,t5+=v*b2,t6+=v*b3,t7+=v*b4,t8+=v*b5,t9+=v*b6,t10+=v*b7,t11+=v*b8,t12+=v*b9,t13+=v*b10,t14+=v*b11,t15+=v*b12,t16+=v*b13,t17+=v*b14,t18+=v*b15,t4+=(v=a[4])*b0,t5+=v*b1,t6+=v*b2,t7+=v*b3,t8+=v*b4,t9+=v*b5,t10+=v*b6,t11+=v*b7,t12+=v*b8,t13+=v*b9,t14+=v*b10,t15+=v*b11,t16+=v*b12,t17+=v*b13,t18+=v*b14,t19+=v*b15,t5+=(v=a[5])*b0,t6+=v*b1,t7+=v*b2,t8+=v*b3,t9+=v*b4,t10+=v*b5,t11+=v*b6,t12+=v*b7,t13+=v*b8,t14+=v*b9,t15+=v*b10,t16+=v*b11,t17+=v*b12,t18+=v*b13,t19+=v*b14,t20+=v*b15,t6+=(v=a[6])*b0,t7+=v*b1,t8+=v*b2,t9+=v*b3,t10+=v*b4,t11+=v*b5,t12+=v*b6,t13+=v*b7,t14+=v*b8,t15+=v*b9,t16+=v*b10,t17+=v*b11,t18+=v*b12,t19+=v*b13,t20+=v*b14,t21+=v*b15,t7+=(v=a[7])*b0,t8+=v*b1,t9+=v*b2,t10+=v*b3,t11+=v*b4,t12+=v*b5,t13+=v*b6,t14+=v*b7,t15+=v*b8,t16+=v*b9,t17+=v*b10,t18+=v*b11,t19+=v*b12,t20+=v*b13,t21+=v*b14,t22+=v*b15,t8+=(v=a[8])*b0,t9+=v*b1,t10+=v*b2,t11+=v*b3,t12+=v*b4,t13+=v*b5,t14+=v*b6,t15+=v*b7,t16+=v*b8,t17+=v*b9,t18+=v*b10,t19+=v*b11,t20+=v*b12,t21+=v*b13,t22+=v*b14,t23+=v*b15,t9+=(v=a[9])*b0,t10+=v*b1,t11+=v*b2,t12+=v*b3,t13+=v*b4,t14+=v*b5,t15+=v*b6,t16+=v*b7,t17+=v*b8,t18+=v*b9,t19+=v*b10,t20+=v*b11,t21+=v*b12,t22+=v*b13,t23+=v*b14,t24+=v*b15,t10+=(v=a[10])*b0,t11+=v*b1,t12+=v*b2,t13+=v*b3,t14+=v*b4,t15+=v*b5,t16+=v*b6,t17+=v*b7,t18+=v*b8,t19+=v*b9,t20+=v*b10,t21+=v*b11,t22+=v*b12,t23+=v*b13,t24+=v*b14,t25+=v*b15,t11+=(v=a[11])*b0,t12+=v*b1,t13+=v*b2,t14+=v*b3,t15+=v*b4,t16+=v*b5,t17+=v*b6,t18+=v*b7,t19+=v*b8,t20+=v*b9,t21+=v*b10,t22+=v*b11,t23+=v*b12,t24+=v*b13,t25+=v*b14,t26+=v*b15,t12+=(v=a[12])*b0,t13+=v*b1,t14+=v*b2,t15+=v*b3,t16+=v*b4,t17+=v*b5,t18+=v*b6,t19+=v*b7,t20+=v*b8,t21+=v*b9,t22+=v*b10,t23+=v*b11,t24+=v*b12,t25+=v*b13,t26+=v*b14,t27+=v*b15,t13+=(v=a[13])*b0,t14+=v*b1,t15+=v*b2,t16+=v*b3,t17+=v*b4,t18+=v*b5,t19+=v*b6,t20+=v*b7,t21+=v*b8,t22+=v*b9,t23+=v*b10,t24+=v*b11,t25+=v*b12,t26+=v*b13,t27+=v*b14,t28+=v*b15,t14+=(v=a[14])*b0,t15+=v*b1,t16+=v*b2,t17+=v*b3,t18+=v*b4,t19+=v*b5,t20+=v*b6,t21+=v*b7,t22+=v*b8,t23+=v*b9,t24+=v*b10,t25+=v*b11,t26+=v*b12,t27+=v*b13,t28+=v*b14,t29+=v*b15,t15+=(v=a[15])*b0,t1+=38*(t17+=v*b2),t2+=38*(t18+=v*b3),t3+=38*(t19+=v*b4),t4+=38*(t20+=v*b5),t5+=38*(t21+=v*b6),t6+=38*(t22+=v*b7),t7+=38*(t23+=v*b8),t8+=38*(t24+=v*b9),t9+=38*(t25+=v*b10),t10+=38*(t26+=v*b11),t11+=38*(t27+=v*b12),t12+=38*(t28+=v*b13),t13+=38*(t29+=v*b14),t14+=38*(t30+=v*b15),t0=(v=(t0+=38*(t16+=v*b1))+(c=1)+65535)-65536*(c=Math.floor(v/65536)),t1=(v=t1+c+65535)-65536*(c=Math.floor(v/65536)),t2=(v=t2+c+65535)-65536*(c=Math.floor(v/65536)),t3=(v=t3+c+65535)-65536*(c=Math.floor(v/65536)),t4=(v=t4+c+65535)-65536*(c=Math.floor(v/65536)),t5=(v=t5+c+65535)-65536*(c=Math.floor(v/65536)),t6=(v=t6+c+65535)-65536*(c=Math.floor(v/65536)),t7=(v=t7+c+65535)-65536*(c=Math.floor(v/65536)),t8=(v=t8+c+65535)-65536*(c=Math.floor(v/65536)),t9=(v=t9+c+65535)-65536*(c=Math.floor(v/65536)),t10=(v=t10+c+65535)-65536*(c=Math.floor(v/65536)),t11=(v=t11+c+65535)-65536*(c=Math.floor(v/65536)),t12=(v=t12+c+65535)-65536*(c=Math.floor(v/65536)),t13=(v=t13+c+65535)-65536*(c=Math.floor(v/65536)),t14=(v=t14+c+65535)-65536*(c=Math.floor(v/65536)),t15=(v=t15+c+65535)-65536*(c=Math.floor(v/65536)),t0=(v=(t0+=c-1+37*(c-1))+(c=1)+65535)-65536*(c=Math.floor(v/65536)),t1=(v=t1+c+65535)-65536*(c=Math.floor(v/65536)),t2=(v=t2+c+65535)-65536*(c=Math.floor(v/65536)),t3=(v=t3+c+65535)-65536*(c=Math.floor(v/65536)),t4=(v=t4+c+65535)-65536*(c=Math.floor(v/65536)),t5=(v=t5+c+65535)-65536*(c=Math.floor(v/65536)),t6=(v=t6+c+65535)-65536*(c=Math.floor(v/65536)),t7=(v=t7+c+65535)-65536*(c=Math.floor(v/65536)),t8=(v=t8+c+65535)-65536*(c=Math.floor(v/65536)),t9=(v=t9+c+65535)-65536*(c=Math.floor(v/65536)),t10=(v=t10+c+65535)-65536*(c=Math.floor(v/65536)),t11=(v=t11+c+65535)-65536*(c=Math.floor(v/65536)),t12=(v=t12+c+65535)-65536*(c=Math.floor(v/65536)),t13=(v=t13+c+65535)-65536*(c=Math.floor(v/65536)),t14=(v=t14+c+65535)-65536*(c=Math.floor(v/65536)),t15=(v=t15+c+65535)-65536*(c=Math.floor(v/65536)),t0+=c-1+37*(c-1),o[0]=t0,o[1]=t1,o[2]=t2,o[3]=t3,o[4]=t4,o[5]=t5,o[6]=t6,o[7]=t7,o[8]=t8,o[9]=t9,o[10]=t10,o[11]=t11,o[12]=t12,o[13]=t13,o[14]=t14,o[15]=t15}function S(o,a){M(o,a,a)}function inv25519(o,i){var a,c=gf();for(a=0;a<16;a++)c[a]=i[a];for(a=253;a>=0;a--)S(c,c),2!==a&&4!==a&&M(c,c,i);for(a=0;a<16;a++)o[a]=c[a]}function crypto_scalarmult(q,n,p){check(q,crypto_scalarmult_BYTES),check(n,crypto_scalarmult_SCALARBYTES),check(p,crypto_scalarmult_BYTES);var r,i,z=new Uint8Array(32),x=new Float64Array(80),a=gf(),b=gf(),c=gf(),d=gf(),e=gf(),f=gf();for(i=0;i<31;i++)z[i]=n[i];for(z[31]=127&n[31]|64,z[0]&=248,unpack25519(x,p),i=0;i<16;i++)b[i]=x[i],d[i]=a[i]=c[i]=0;for(a[0]=d[0]=1,i=254;i>=0;--i)sel25519(a,b,r=z[i>>>3]>>>(7&i)&1),sel25519(c,d,r),A(e,a,c),Z(a,a,c),A(c,b,d),Z(b,b,d),S(d,e),S(f,a),M(a,c,a),M(c,b,e),A(e,a,c),Z(a,a,c),S(b,a),Z(c,d,f),M(a,c,_121665),A(a,a,d),M(c,c,a),M(a,d,f),M(d,b,x),S(b,e),sel25519(a,b,r),sel25519(c,d,r);for(i=0;i<16;i++)x[i+16]=a[i],x[i+32]=c[i],x[i+48]=b[i],x[i+64]=d[i];var x32=x.subarray(32),x16=x.subarray(16);return inv25519(x32,x32),M(x16,x16,x32),pack25519(q,x16),0}poly1305.prototype.blocks=function(m,mpos,bytes){for(var t0,t1,t2,t3,t4,t5,t6,t7,c,d0,d1,d2,d3,d4,d5,d6,d7,d8,d9,hibit=this.fin?0:2048,h0=this.h[0],h1=this.h[1],h2=this.h[2],h3=this.h[3],h4=this.h[4],h5=this.h[5],h6=this.h[6],h7=this.h[7],h8=this.h[8],h9=this.h[9],r0=this.r[0],r1=this.r[1],r2=this.r[2],r3=this.r[3],r4=this.r[4],r5=this.r[5],r6=this.r[6],r7=this.r[7],r8=this.r[8],r9=this.r[9];bytes>=16;)h0+=8191&(t0=255&m[mpos+0]|(255&m[mpos+1])<<8),h1+=8191&(t0>>>13|(t1=255&m[mpos+2]|(255&m[mpos+3])<<8)<<3),h2+=8191&(t1>>>10|(t2=255&m[mpos+4]|(255&m[mpos+5])<<8)<<6),h3+=8191&(t2>>>7|(t3=255&m[mpos+6]|(255&m[mpos+7])<<8)<<9),h4+=8191&(t3>>>4|(t4=255&m[mpos+8]|(255&m[mpos+9])<<8)<<12),h5+=t4>>>1&8191,h6+=8191&(t4>>>14|(t5=255&m[mpos+10]|(255&m[mpos+11])<<8)<<2),h7+=8191&(t5>>>11|(t6=255&m[mpos+12]|(255&m[mpos+13])<<8)<<5),t7=255&m[mpos+14]|(255&m[mpos+15])<<8,d0=c=0,d0+=h0*r0,d0+=h1*(5*r9),d0+=h2*(5*r8),d0+=h3*(5*r7),c=(d0+=h4*(5*r6))>>>13,d0&=8191,d0+=h5*(5*r5),d0+=h6*(5*r4),d0+=h7*(5*r3),d0+=(h8+=8191&(t6>>>8|t7<<8))*(5*r2),d1=c+=(d0+=(h9+=t7>>>5|hibit)*(5*r1))>>>13,d1+=h0*r1,d1+=h1*r0,d1+=h2*(5*r9),d1+=h3*(5*r8),c=(d1+=h4*(5*r7))>>>13,d1&=8191,d1+=h5*(5*r6),d1+=h6*(5*r5),d1+=h7*(5*r4),d1+=h8*(5*r3),c+=(d1+=h9*(5*r2))>>>13,d1&=8191,d2=c,d2+=h0*r2,d2+=h1*r1,d2+=h2*r0,d2+=h3*(5*r9),c=(d2+=h4*(5*r8))>>>13,d2&=8191,d2+=h5*(5*r7),d2+=h6*(5*r6),d2+=h7*(5*r5),d2+=h8*(5*r4),d3=c+=(d2+=h9*(5*r3))>>>13,d3+=h0*r3,d3+=h1*r2,d3+=h2*r1,d3+=h3*r0,c=(d3+=h4*(5*r9))>>>13,d3&=8191,d3+=h5*(5*r8),d3+=h6*(5*r7),d3+=h7*(5*r6),d3+=h8*(5*r5),d4=c+=(d3+=h9*(5*r4))>>>13,d4+=h0*r4,d4+=h1*r3,d4+=h2*r2,d4+=h3*r1,c=(d4+=h4*r0)>>>13,d4&=8191,d4+=h5*(5*r9),d4+=h6*(5*r8),d4+=h7*(5*r7),d4+=h8*(5*r6),d5=c+=(d4+=h9*(5*r5))>>>13,d5+=h0*r5,d5+=h1*r4,d5+=h2*r3,d5+=h3*r2,c=(d5+=h4*r1)>>>13,d5&=8191,d5+=h5*r0,d5+=h6*(5*r9),d5+=h7*(5*r8),d5+=h8*(5*r7),d6=c+=(d5+=h9*(5*r6))>>>13,d6+=h0*r6,d6+=h1*r5,d6+=h2*r4,d6+=h3*r3,c=(d6+=h4*r2)>>>13,d6&=8191,d6+=h5*r1,d6+=h6*r0,d6+=h7*(5*r9),d6+=h8*(5*r8),d7=c+=(d6+=h9*(5*r7))>>>13,d7+=h0*r7,d7+=h1*r6,d7+=h2*r5,d7+=h3*r4,c=(d7+=h4*r3)>>>13,d7&=8191,d7+=h5*r2,d7+=h6*r1,d7+=h7*r0,d7+=h8*(5*r9),d8=c+=(d7+=h9*(5*r8))>>>13,d8+=h0*r8,d8+=h1*r7,d8+=h2*r6,d8+=h3*r5,c=(d8+=h4*r4)>>>13,d8&=8191,d8+=h5*r3,d8+=h6*r2,d8+=h7*r1,d8+=h8*r0,d9=c+=(d8+=h9*(5*r9))>>>13,d9+=h0*r9,d9+=h1*r8,d9+=h2*r7,d9+=h3*r6,c=(d9+=h4*r5)>>>13,d9&=8191,d9+=h5*r4,d9+=h6*r3,d9+=h7*r2,d9+=h8*r1,h0=d0=8191&(c=(c=((c+=(d9+=h9*r0)>>>13)<<2)+c|0)+(d0&=8191)|0),h1=d1+=c>>>=13,h2=d2&=8191,h3=d3&=8191,h4=d4&=8191,h5=d5&=8191,h6=d6&=8191,h7=d7&=8191,h8=d8&=8191,h9=d9&=8191,mpos+=16,bytes-=16;this.h[0]=h0,this.h[1]=h1,this.h[2]=h2,this.h[3]=h3,this.h[4]=h4,this.h[5]=h5,this.h[6]=h6,this.h[7]=h7,this.h[8]=h8,this.h[9]=h9},poly1305.prototype.finish=function(mac,macpos){var c,mask,f,i,g=new Uint16Array(10);if(this.leftover){for(i=this.leftover,this.buffer[i++]=1;i<16;i++)this.buffer[i]=0;this.fin=1,this.blocks(this.buffer,0,16)}for(c=this.h[1]>>>13,this.h[1]&=8191,i=2;i<10;i++)this.h[i]+=c,c=this.h[i]>>>13,this.h[i]&=8191;for(this.h[0]+=5*c,c=this.h[0]>>>13,this.h[0]&=8191,this.h[1]+=c,c=this.h[1]>>>13,this.h[1]&=8191,this.h[2]+=c,g[0]=this.h[0]+5,c=g[0]>>>13,g[0]&=8191,i=1;i<10;i++)g[i]=this.h[i]+c,c=g[i]>>>13,g[i]&=8191;for(g[9]-=8192,mask=(1^c)-1,i=0;i<10;i++)g[i]&=mask;for(mask=~mask,i=0;i<10;i++)this.h[i]=this.h[i]&mask|g[i];for(this.h[0]=65535&(this.h[0]|this.h[1]<<13),this.h[1]=65535&(this.h[1]>>>3|this.h[2]<<10),this.h[2]=65535&(this.h[2]>>>6|this.h[3]<<7),this.h[3]=65535&(this.h[3]>>>9|this.h[4]<<4),this.h[4]=65535&(this.h[4]>>>12|this.h[5]<<1|this.h[6]<<14),this.h[5]=65535&(this.h[6]>>>2|this.h[7]<<11),this.h[6]=65535&(this.h[7]>>>5|this.h[8]<<8),this.h[7]=65535&(this.h[8]>>>8|this.h[9]<<5),f=this.h[0]+this.pad[0],this.h[0]=65535&f,i=1;i<8;i++)f=(this.h[i]+this.pad[i]|0)+(f>>>16)|0,this.h[i]=65535&f;mac[macpos+0]=this.h[0]>>>0&255,mac[macpos+1]=this.h[0]>>>8&255,mac[macpos+2]=this.h[1]>>>0&255,mac[macpos+3]=this.h[1]>>>8&255,mac[macpos+4]=this.h[2]>>>0&255,mac[macpos+5]=this.h[2]>>>8&255,mac[macpos+6]=this.h[3]>>>0&255,mac[macpos+7]=this.h[3]>>>8&255,mac[macpos+8]=this.h[4]>>>0&255,mac[macpos+9]=this.h[4]>>>8&255,mac[macpos+10]=this.h[5]>>>0&255,mac[macpos+11]=this.h[5]>>>8&255,mac[macpos+12]=this.h[6]>>>0&255,mac[macpos+13]=this.h[6]>>>8&255,mac[macpos+14]=this.h[7]>>>0&255,mac[macpos+15]=this.h[7]>>>8&255},poly1305.prototype.update=function(m,mpos,bytes){var i,want;if(this.leftover){for((want=16-this.leftover)>bytes&&(want=bytes),i=0;i<want;i++)this.buffer[this.leftover+i]=m[mpos+i];if(bytes-=want,mpos+=want,this.leftover+=want,this.leftover<16)return;this.blocks(this.buffer,0,16),this.leftover=0}if(bytes>=16&&(want=bytes-bytes%16,this.blocks(m,mpos,want),mpos+=want,bytes-=want),bytes){for(i=0;i<bytes;i++)this.buffer[this.leftover+i]=m[mpos+i];this.leftover+=bytes}};var K=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function crypto_hashblocks_hl(hh,hl,m,n){for(var bh0,bh1,bh2,bh3,bh4,bh5,bh6,bh7,bl0,bl1,bl2,bl3,bl4,bl5,bl6,bl7,th,tl,i,j,h,l,a,b,c,d,wh=new Int32Array(16),wl=new Int32Array(16),ah0=hh[0],ah1=hh[1],ah2=hh[2],ah3=hh[3],ah4=hh[4],ah5=hh[5],ah6=hh[6],ah7=hh[7],al0=hl[0],al1=hl[1],al2=hl[2],al3=hl[3],al4=hl[4],al5=hl[5],al6=hl[6],al7=hl[7],pos=0;n>=128;){for(i=0;i<16;i++)j=8*i+pos,wh[i]=m[j+0]<<24|m[j+1]<<16|m[j+2]<<8|m[j+3],wl[i]=m[j+4]<<24|m[j+5]<<16|m[j+6]<<8|m[j+7];for(i=0;i<80;i++)if(bh0=ah0,bh1=ah1,bh2=ah2,bh3=ah3,bh4=ah4,bh5=ah5,bh6=ah6,bh7=ah7,bl0=al0,bl1=al1,bl2=al2,bl3=al3,bl4=al4,bl5=al5,bl6=al6,bl7=al7,a=65535&(l=al7),b=l>>>16,c=65535&(h=ah7),d=h>>>16,a+=65535&(l=(al4>>>14|ah4<<18)^(al4>>>18|ah4<<14)^(ah4>>>9|al4<<23)),b+=l>>>16,c+=65535&(h=(ah4>>>14|al4<<18)^(ah4>>>18|al4<<14)^(al4>>>9|ah4<<23)),d+=h>>>16,a+=65535&(l=al4&al5^~al4&al6),b+=l>>>16,c+=65535&(h=ah4&ah5^~ah4&ah6),d+=h>>>16,h=K[2*i],a+=65535&(l=K[2*i+1]),b+=l>>>16,c+=65535&h,d+=h>>>16,h=wh[i%16],b+=(l=wl[i%16])>>>16,c+=65535&h,d+=h>>>16,c+=(b+=(a+=65535&l)>>>16)>>>16,a=65535&(l=tl=65535&a|b<<16),b=l>>>16,c=65535&(h=th=65535&c|(d+=c>>>16)<<16),d=h>>>16,a+=65535&(l=(al0>>>28|ah0<<4)^(ah0>>>2|al0<<30)^(ah0>>>7|al0<<25)),b+=l>>>16,c+=65535&(h=(ah0>>>28|al0<<4)^(al0>>>2|ah0<<30)^(al0>>>7|ah0<<25)),d+=h>>>16,b+=(l=al0&al1^al0&al2^al1&al2)>>>16,c+=65535&(h=ah0&ah1^ah0&ah2^ah1&ah2),d+=h>>>16,bh7=65535&(c+=(b+=(a+=65535&l)>>>16)>>>16)|(d+=c>>>16)<<16,bl7=65535&a|b<<16,a=65535&(l=bl3),b=l>>>16,c=65535&(h=bh3),d=h>>>16,b+=(l=tl)>>>16,c+=65535&(h=th),d+=h>>>16,ah1=bh0,ah2=bh1,ah3=bh2,ah4=bh3=65535&(c+=(b+=(a+=65535&l)>>>16)>>>16)|(d+=c>>>16)<<16,ah5=bh4,ah6=bh5,ah7=bh6,ah0=bh7,al1=bl0,al2=bl1,al3=bl2,al4=bl3=65535&a|b<<16,al5=bl4,al6=bl5,al7=bl6,al0=bl7,i%16==15)for(j=0;j<16;j++)h=wh[j],a=65535&(l=wl[j]),b=l>>>16,c=65535&h,d=h>>>16,h=wh[(j+9)%16],a+=65535&(l=wl[(j+9)%16]),b+=l>>>16,c+=65535&h,d+=h>>>16,th=wh[(j+1)%16],a+=65535&(l=((tl=wl[(j+1)%16])>>>1|th<<31)^(tl>>>8|th<<24)^(tl>>>7|th<<25)),b+=l>>>16,c+=65535&(h=(th>>>1|tl<<31)^(th>>>8|tl<<24)^th>>>7),d+=h>>>16,th=wh[(j+14)%16],b+=(l=((tl=wl[(j+14)%16])>>>19|th<<13)^(th>>>29|tl<<3)^(tl>>>6|th<<26))>>>16,c+=65535&(h=(th>>>19|tl<<13)^(tl>>>29|th<<3)^th>>>6),d+=h>>>16,d+=(c+=(b+=(a+=65535&l)>>>16)>>>16)>>>16,wh[j]=65535&c|d<<16,wl[j]=65535&a|b<<16;a=65535&(l=al0),b=l>>>16,c=65535&(h=ah0),d=h>>>16,h=hh[0],b+=(l=hl[0])>>>16,c+=65535&h,d+=h>>>16,d+=(c+=(b+=(a+=65535&l)>>>16)>>>16)>>>16,hh[0]=ah0=65535&c|d<<16,hl[0]=al0=65535&a|b<<16,a=65535&(l=al1),b=l>>>16,c=65535&(h=ah1),d=h>>>16,h=hh[1],b+=(l=hl[1])>>>16,c+=65535&h,d+=h>>>16,d+=(c+=(b+=(a+=65535&l)>>>16)>>>16)>>>16,hh[1]=ah1=65535&c|d<<16,hl[1]=al1=65535&a|b<<16,a=65535&(l=al2),b=l>>>16,c=65535&(h=ah2),d=h>>>16,h=hh[2],b+=(l=hl[2])>>>16,c+=65535&h,d+=h>>>16,d+=(c+=(b+=(a+=65535&l)>>>16)>>>16)>>>16,hh[2]=ah2=65535&c|d<<16,hl[2]=al2=65535&a|b<<16,a=65535&(l=al3),b=l>>>16,c=65535&(h=ah3),d=h>>>16,h=hh[3],b+=(l=hl[3])>>>16,c+=65535&h,d+=h>>>16,d+=(c+=(b+=(a+=65535&l)>>>16)>>>16)>>>16,hh[3]=ah3=65535&c|d<<16,hl[3]=al3=65535&a|b<<16,a=65535&(l=al4),b=l>>>16,c=65535&(h=ah4),d=h>>>16,h=hh[4],b+=(l=hl[4])>>>16,c+=65535&h,d+=h>>>16,d+=(c+=(b+=(a+=65535&l)>>>16)>>>16)>>>16,hh[4]=ah4=65535&c|d<<16,hl[4]=al4=65535&a|b<<16,a=65535&(l=al5),b=l>>>16,c=65535&(h=ah5),d=h>>>16,h=hh[5],b+=(l=hl[5])>>>16,c+=65535&h,d+=h>>>16,d+=(c+=(b+=(a+=65535&l)>>>16)>>>16)>>>16,hh[5]=ah5=65535&c|d<<16,hl[5]=al5=65535&a|b<<16,a=65535&(l=al6),b=l>>>16,c=65535&(h=ah6),d=h>>>16,h=hh[6],b+=(l=hl[6])>>>16,c+=65535&h,d+=h>>>16,d+=(c+=(b+=(a+=65535&l)>>>16)>>>16)>>>16,hh[6]=ah6=65535&c|d<<16,hl[6]=al6=65535&a|b<<16,a=65535&(l=al7),b=l>>>16,c=65535&(h=ah7),d=h>>>16,h=hh[7],b+=(l=hl[7])>>>16,c+=65535&h,d+=h>>>16,d+=(c+=(b+=(a+=65535&l)>>>16)>>>16)>>>16,hh[7]=ah7=65535&c|d<<16,hl[7]=al7=65535&a|b<<16,pos+=128,n-=128}return n}function crypto_hash(out,m,n){var i,hh=new Int32Array(8),hl=new Int32Array(8),x=new Uint8Array(256),b=n;for(hh[0]=1779033703,hh[1]=3144134277,hh[2]=1013904242,hh[3]=2773480762,hh[4]=1359893119,hh[5]=2600822924,hh[6]=528734635,hh[7]=1541459225,hl[0]=4089235720,hl[1]=2227873595,hl[2]=4271175723,hl[3]=1595750129,hl[4]=2917565137,hl[5]=725511199,hl[6]=4215389547,hl[7]=327033209,crypto_hashblocks_hl(hh,hl,m,n),n%=128,i=0;i<n;i++)x[i]=m[b-n+i];for(x[n]=128,x[(n=256-128*(n<112?1:0))-9]=0,ts64(x,n-8,b/536870912|0,b<<3),crypto_hashblocks_hl(hh,hl,x,n),i=0;i<8;i++)ts64(out,8*i,hh[i],hl[i]);return 0}function add(p,q){var a=gf(),b=gf(),c=gf(),d=gf(),e=gf(),f=gf(),g=gf(),h=gf(),t=gf();Z(a,p[1],p[0]),Z(t,q[1],q[0]),M(a,a,t),A(b,p[0],p[1]),A(t,q[0],q[1]),M(b,b,t),M(c,p[3],q[3]),M(c,c,D2),M(d,p[2],q[2]),A(d,d,d),Z(e,b,a),Z(f,d,c),A(g,d,c),A(h,b,a),M(p[0],e,f),M(p[1],h,g),M(p[2],g,f),M(p[3],e,h)}function cswap(p,q,b){var i;for(i=0;i<4;i++)sel25519(p[i],q[i],b)}function pack(r,p){var tx=gf(),ty=gf(),zi=gf();inv25519(zi,p[2]),M(tx,p[0],zi),M(ty,p[1],zi),pack25519(r,ty),r[31]^=par25519(tx)<<7}function scalarmult(p,q,s){var b,i;for(set25519(p[0],gf0),set25519(p[1],gf1),set25519(p[2],gf1),set25519(p[3],gf0),i=255;i>=0;--i)cswap(p,q,b=s[i/8|0]>>(7&i)&1),add(q,p),add(p,p),cswap(p,q,b)}function scalarbase(p,s){var q=[gf(),gf(),gf(),gf()];set25519(q[0],X),set25519(q[1],Y),set25519(q[2],gf1),M(q[3],X,Y),scalarmult(p,q,s)}function crypto_sign_keypair(pk,sk,seeded){check(pk,sodium.crypto_sign_PUBLICKEYBYTES),check(sk,sodium.crypto_sign_SECRETKEYBYTES);var i,d=new Uint8Array(64),p=[gf(),gf(),gf(),gf()];for(seeded||randombytes(sk,32),crypto_hash(d,sk,32),d[0]&=248,d[31]&=127,d[31]|=64,scalarbase(p,d),pack(pk,p),i=0;i<32;i++)sk[i+32]=pk[i];return 0}var L=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function modL(r,x){var carry,i,j,k;for(i=63;i>=32;--i){for(carry=0,j=i-32,k=i-12;j<k;++j)x[j]+=carry-16*x[i]*L[j-(i-32)],carry=x[j]+128>>8,x[j]-=256*carry;x[j]+=carry,x[i]=0}for(carry=0,j=0;j<32;j++)x[j]+=carry-(x[31]>>4)*L[j],carry=x[j]>>8,x[j]&=255;for(j=0;j<32;j++)x[j]-=carry*L[j];for(i=0;i<32;i++)x[i+1]+=x[i]>>8,r[i]=255&x[i]}function reduce(r){var i,x=new Float64Array(64);for(i=0;i<64;i++)x[i]=r[i];for(i=0;i<64;i++)r[i]=0;modL(r,x)}function crypto_sign(sm,m,sk){check(sm,crypto_sign_BYTES+m.length),check(m,0),check(sk,crypto_sign_SECRETKEYBYTES);var i,j,n=m.length,d=new Uint8Array(64),h=new Uint8Array(64),r=new Uint8Array(64),x=new Float64Array(64),p=[gf(),gf(),gf(),gf()];crypto_hash(d,sk,32),d[0]&=248,d[31]&=127,d[31]|=64;for(i=0;i<n;i++)sm[64+i]=m[i];for(i=0;i<32;i++)sm[32+i]=d[32+i];for(crypto_hash(r,sm.subarray(32),n+32),reduce(r),scalarbase(p,r),pack(sm,p),i=32;i<64;i++)sm[i]=sk[i];for(crypto_hash(h,sm,n+64),reduce(h),i=0;i<64;i++)x[i]=0;for(i=0;i<32;i++)x[i]=r[i];for(i=0;i<32;i++)for(j=0;j<32;j++)x[i+j]+=h[i]*d[j];modL(sm.subarray(32),x)}function unpackneg(r,p){var t=gf(),chk=gf(),num=gf(),den=gf(),den2=gf(),den4=gf(),den6=gf();return set25519(r[2],gf1),unpack25519(r[1],p),S(num,r[1]),M(den,num,D),Z(num,num,r[2]),A(den,r[2],den),S(den2,den),S(den4,den2),M(den6,den4,den2),M(t,den6,num),M(t,t,den),function(o,i){var a,c=gf();for(a=0;a<16;a++)c[a]=i[a];for(a=250;a>=0;a--)S(c,c),1!==a&&M(c,c,i);for(a=0;a<16;a++)o[a]=c[a]}(t,t),M(t,t,num),M(t,t,den),M(t,t,den),M(r[0],t,den),S(chk,r[0]),M(chk,chk,den),neq25519(chk,num)&&M(r[0],r[0],I),S(chk,r[0]),M(chk,chk,den),neq25519(chk,num)?-1:(par25519(r[0])===p[31]>>7&&Z(r[0],gf0,r[0]),M(r[3],r[0],r[1]),0)}function crypto_sign_open(msg,sm,pk){check(msg,sm.length-crypto_sign_BYTES),check(sm,crypto_sign_BYTES),check(pk,crypto_sign_PUBLICKEYBYTES);var i,n=sm.length,m=new Uint8Array(sm.length),t=new Uint8Array(32),h=new Uint8Array(64),p=[gf(),gf(),gf(),gf()],q=[gf(),gf(),gf(),gf()];if(-1,n<64)return!1;if(unpackneg(q,pk))return!1;for(i=0;i<n;i++)m[i]=sm[i];for(i=0;i<32;i++)m[i+32]=pk[i];if(crypto_hash(h,m,n),reduce(h),scalarmult(p,q,h),scalarbase(q,sm.subarray(32)),add(p,q),pack(t,p),n-=64,crypto_verify_32(sm,0,t,0)){for(i=0;i<n;i++)m[i]=0;return!1}for(i=0;i<n;i++)msg[i]=sm[i+64];return n,!0}function crypto_secretbox_easy(o,msg,n,k){var i;check(msg,0),check(o,msg.length+sodium.crypto_secretbox_MACBYTES),check(n,crypto_secretbox_NONCEBYTES),check(k,crypto_secretbox_KEYBYTES);var m=new Uint8Array(crypto_secretbox_ZEROBYTES+msg.length),c=new Uint8Array(m.length);for(i=0;i<msg.length;i++)m[i+crypto_secretbox_ZEROBYTES]=msg[i];for(function(c,m,d,n,k){var i;if(d<32)return-1;for(crypto_stream_xor(c,0,m,0,0,n,k),crypto_onetimeauth(c,16,c,32,d-32,c),i=0;i<16;i++)c[i]=0}(c,m,m.length,n,k),i=crypto_secretbox_BOXZEROBYTES;i<c.length;i++)o[i-crypto_secretbox_BOXZEROBYTES]=c[i]}function crypto_secretbox_open_easy(msg,box,n,k){var i;check(box,sodium.crypto_secretbox_MACBYTES),check(msg,box.length-sodium.crypto_secretbox_MACBYTES),check(n,crypto_secretbox_NONCEBYTES),check(k,crypto_secretbox_KEYBYTES);var c=new Uint8Array(crypto_secretbox_BOXZEROBYTES+box.length),m=new Uint8Array(c.length);for(i=0;i<box.length;i++)c[i+crypto_secretbox_BOXZEROBYTES]=box[i];if(c.length<32)return!1;if(0!==crypto_secretbox_open(m,c,c.length,n,k))return!1;for(i=crypto_secretbox_ZEROBYTES;i<m.length;i++)msg[i-crypto_secretbox_ZEROBYTES]=m[i];return!0}var crypto_secretbox_KEYBYTES=32,crypto_secretbox_NONCEBYTES=24,crypto_secretbox_ZEROBYTES=32,crypto_secretbox_BOXZEROBYTES=16,crypto_scalarmult_BYTES=32,crypto_scalarmult_SCALARBYTES=32,crypto_sign_BYTES=64,crypto_sign_PUBLICKEYBYTES=32,crypto_sign_SECRETKEYBYTES=64;function check(buf,len){if(!buf||len&&buf.length<len)throw new Error("Argument must be a buffer"+(len?" of length "+len:""))}function forward(submodule){Object.keys(submodule).forEach(function(prop){module.exports[prop]=submodule[prop]})}sodium.memzero=function(len,offset){for(var i=offset;i<len;i++)arr[i]=0},sodium.crypto_sign_BYTES=crypto_sign_BYTES,sodium.crypto_sign_PUBLICKEYBYTES=crypto_sign_PUBLICKEYBYTES,sodium.crypto_sign_SECRETKEYBYTES=crypto_sign_SECRETKEYBYTES,sodium.crypto_sign_SEEDBYTES=32,sodium.crypto_sign_keypair=crypto_sign_keypair,sodium.crypto_sign_seed_keypair=function(pk,sk,seed){check(seed,sodium.crypto_sign_SEEDBYTES),seed.copy(sk),crypto_sign_keypair(pk,sk,!0)},sodium.crypto_sign=crypto_sign,sodium.crypto_sign_open=crypto_sign_open,sodium.crypto_sign_detached=function(sig,m,sk){var sm=new Uint8Array(m.length+crypto_sign_BYTES);crypto_sign(sm,m,sk);for(var i=0;i<crypto_sign_BYTES;i++)sig[i]=sm[i]},sodium.crypto_sign_verify_detached=function(sig,m,pk){check(sig,crypto_sign_BYTES);var sm=new Uint8Array(m.length+crypto_sign_BYTES),i=0;for(i=0;i<crypto_sign_BYTES;i++)sm[i]=sig[i];for(i=0;i<m.length;i++)sm[i+crypto_sign_BYTES]=m[i];return crypto_sign_open(m,sm,pk)},forward(require("./crypto_generichash")),forward(require("./crypto_kdf")),forward(require("./crypto_shorthash")),forward(require("./randombytes")),forward(require("./crypto_stream")),sodium.crypto_scalarmult_BYTES=crypto_scalarmult_BYTES,sodium.crypto_scalarmult_SCALARBYTES=crypto_scalarmult_SCALARBYTES,sodium.crypto_scalarmult_base=function(q,n){return crypto_scalarmult(q,n,_9)},sodium.crypto_scalarmult=crypto_scalarmult,sodium.crypto_secretbox_KEYBYTES=crypto_secretbox_KEYBYTES,sodium.crypto_secretbox_NONCEBYTES=crypto_secretbox_NONCEBYTES,sodium.crypto_secretbox_MACBYTES=16,sodium.crypto_secretbox_easy=crypto_secretbox_easy,sodium.crypto_secretbox_open_easy=crypto_secretbox_open_easy,sodium.crypto_secretbox_detached=function(o,mac,msg,n,k){check(mac,sodium.crypto_secretbox_MACBYTES);var tmp=new Uint8Array(msg.length+mac.length);crypto_secretbox_easy(tmp,msg,n,k),o.set(tmp.subarray(0,msg.length)),mac.set(tmp.subarray(msg.length))},sodium.crypto_secretbox_open_detached=function(msg,o,mac,n,k){check(mac,sodium.crypto_secretbox_MACBYTES);var tmp=new Uint8Array(o.length+mac.length);return tmp.set(o),tmp.set(mac,msg.length),crypto_secretbox_open_easy(msg,tmp,n,k)}},{"./crypto_generichash":161,"./crypto_kdf":162,"./crypto_shorthash":163,"./crypto_stream":164,"./randombytes":166}],166:[function(require,module,exports){(function(global){var assert=require("nanoassert"),randombytes=function(){var QUOTA=65536,crypto=void 0!==global?crypto=global.crypto||global.msCrypto:null;return crypto&&crypto.getRandomValues?function(out,n){for(var i=0;i<n;i+=QUOTA)crypto.getRandomValues(out.subarray(i,i+Math.min(n-i,QUOTA)))}:void 0!==require&&(crypto=require("crypto"))&&crypto.randomBytes?function(out,n){out.set(crypto.randomBytes(n))}:function(){throw new Error("No secure random number generator available")}}();Object.defineProperty(module.exports,"randombytes",{value:randombytes}),module.exports.randombytes_buf=function(out){assert(out,"out must be given"),randombytes(out,out.length)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{crypto:19,nanoassert:109}],167:[function(require,module,exports){module.exports=require("sodium-javascript")},{"sodium-javascript":165}],168:[function(require,module,exports){function defaultCmp(a,b){return a===b?0:a>b?1:-1}function eq(list,value,cmp){cmp||(cmp=defaultCmp);var i=indexOf(list,value,cmp);return-1===i?-1:0===cmp(list[i],value)?i:-1}function indexOf(list,value,cmp){cmp||(cmp=defaultCmp);for(var len=list.length,top=len-1,btm=0,mid=-1;top>=btm&&btm>=0&&top<len;){var c=cmp(list[mid=Math.floor((top+btm)/2)],value);if(0===c)return mid;c>=0?top=mid-1:btm=mid+1}return mid}exports.add=function(list,value,cmp){cmp||(cmp=defaultCmp);var top=list.push(value)-1;for(;top;){if(cmp(list[top-1],value)<0)return;list[top]=list[top-1],list[top-1]=value,top--}},exports.remove=function(list,value,cmp){var i=eq(list,value,cmp);return-1!==i&&(list.splice(i,1),!0)},exports.has=function(list,value,cmp){return eq(list,value,cmp)>-1},exports.eq=eq,exports.lte=function(list,value,cmp){cmp||(cmp=defaultCmp);var i=indexOf(list,value,cmp);if(-1===i)return-1;for(;i>=0;i--){var c=cmp(list[i],value);if(c<=0)return i}return-1},exports.lt=function(list,value,cmp){cmp||(cmp=defaultCmp);var i=indexOf(list,value,cmp);if(-1===i)return-1;for(;i>=0;i--){var c=cmp(list[i],value);if(c<0)return i}return-1},exports.gte=function(list,value,cmp){cmp||(cmp=defaultCmp);var i=indexOf(list,value,cmp);if(-1===i)return-1;for(;i<list.length;i++){var c=cmp(list[i],value);if(c>=0)return i}return-1},exports.gt=function(list,value,cmp){cmp||(cmp=defaultCmp);var i=indexOf(list,value,cmp);if(-1===i)return-1;for(;i<list.length;i++){var c=cmp(list[i],value);if(c>0)return i}return-1},exports.nearest=function(list,value,cmp){cmp||(cmp=defaultCmp);var len=list.length,top=len-1,btm=0,mid=-1,trending=1;for(;top>=btm&&btm>=0&&top<len;){mid=Math.floor((top+btm)/2);var c=cmp(list[mid],value);if(0===c)return mid;if(c>=0){if(1===trending)trending=0;else if(2===trending)return Math.abs(list[mid]-value)>Math.abs(list[mid-1]-value)?mid-1:mid;top=mid-1}else{if(1===trending)trending=2;else if(0===trending)return mid;btm=mid+1}}return mid}},{}],169:[function(require,module,exports){module.exports=function(left,right){var result=new Array(right.length),i=0,j=0;for(;i<left.length&&j<right.length;){var a=left[i],b=right[j];a!==b?a<b?i++:result[j++]=-1:result[j++]=i}for(;j<right.length;j++)result[j]=-1;return result}},{}],170:[function(require,module,exports){(function(Buffer){var pager=require("memory-pager");function Bitfield(opts){if(!(this instanceof Bitfield))return new Bitfield(opts);if(opts||(opts={}),Buffer.isBuffer(opts)&&(opts={buffer:opts}),this.pageOffset=opts.pageOffset||0,this.pageSize=opts.pageSize||1024,this.pages=opts.pages||pager(this.pageSize),this.byteLength=this.pages.length*this.pageSize,this.length=8*this.byteLength,(x=this.pageSize)&x-1)throw new Error("The page size should be a power of two");var x;if(this._trackUpdates=!!opts.trackUpdates,this._pageMask=this.pageSize-1,opts.buffer){for(var i=0;i<opts.buffer.length;i+=this.pageSize)this.pages.set(i/this.pageSize,opts.buffer.slice(i,i+this.pageSize));this.byteLength=opts.buffer.length,this.length=8*this.byteLength}}module.exports=Bitfield,Bitfield.prototype.get=function(i){var o=7&i,j=(i-o)/8;return!!(this.getByte(j)&128>>o)},Bitfield.prototype.getByte=function(i){var o=i&this._pageMask,j=(i-o)/this.pageSize,page=this.pages.get(j,!0);return page?page.buffer[o+this.pageOffset]:0},Bitfield.prototype.set=function(i,v){var o=7&i,j=(i-o)/8,b=this.getByte(j);return this.setByte(j,v?b|128>>o:b&(255^128>>o))},Bitfield.prototype.toBuffer=function(){for(var all=function(n){if(Buffer.alloc)return Buffer.alloc(n);var b=new Buffer(n);return b.fill(0),b}(this.pages.length*this.pageSize),i=0;i<this.pages.length;i++){var next=this.pages.get(i,!0),allOffset=i*this.pageSize;next&&next.buffer.copy(all,allOffset,this.pageOffset,this.pageOffset+this.pageSize)}return all},Bitfield.prototype.setByte=function(i,b){var o=i&this._pageMask,j=(i-o)/this.pageSize,page=this.pages.get(j,!1);return o+=this.pageOffset,page.buffer[o]!==b&&(page.buffer[o]=b,i>=this.byteLength&&(this.byteLength=i+1,this.length=8*this.byteLength),this._trackUpdates&&this.pages.updated(page),!0)}}).call(this,require("buffer").Buffer)},{buffer:26,"memory-pager":105}],171:[function(require,module,exports){module.exports=function(stream){var rs=stream._readableState;return rs?rs.objectMode?stream.read():stream.read((state=rs,state.buffer.length?state.buffer.head?state.buffer.head.data.length:state.buffer[0].length:state.length)):null;var state}},{}],172:[function(require,module,exports){"use strict";var Buffer=require("safe-buffer").Buffer,isEncoding=Buffer.isEncoding||function(encoding){switch((encoding=""+encoding)&&encoding.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function StringDecoder(encoding){var nb;switch(this.encoding=function(enc){var nenc=function(enc){if(!enc)return"utf8";for(var retried;;)switch(enc){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return enc;default:if(retried)return;enc=(""+enc).toLowerCase(),retried=!0}}(enc);if("string"!=typeof nenc&&(Buffer.isEncoding===isEncoding||!isEncoding(enc)))throw new Error("Unknown encoding: "+enc);return nenc||enc}(encoding),this.encoding){case"utf16le":this.text=utf16Text,this.end=utf16End,nb=4;break;case"utf8":this.fillLast=utf8FillLast,nb=4;break;case"base64":this.text=base64Text,this.end=base64End,nb=3;break;default:return this.write=simpleWrite,void(this.end=simpleEnd)}this.lastNeed=0,this.lastTotal=0,this.lastChar=Buffer.allocUnsafe(nb)}function utf8CheckByte(byte){return byte<=127?0:byte>>5==6?2:byte>>4==14?3:byte>>3==30?4:byte>>6==2?-1:-2}function utf8FillLast(buf){var p=this.lastTotal-this.lastNeed,r=function(self,buf,p){if(128!=(192&buf[0]))return self.lastNeed=0,"�";if(self.lastNeed>1&&buf.length>1){if(128!=(192&buf[1]))return self.lastNeed=1,"�";if(self.lastNeed>2&&buf.length>2&&128!=(192&buf[2]))return self.lastNeed=2,"�"}}(this,buf);return void 0!==r?r:this.lastNeed<=buf.length?(buf.copy(this.lastChar,p,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(buf.copy(this.lastChar,p,0,buf.length),void(this.lastNeed-=buf.length))}function utf16Text(buf,i){if((buf.length-i)%2==0){var r=buf.toString("utf16le",i);if(r){var c=r.charCodeAt(r.length-1);if(c>=55296&&c<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=buf[buf.length-2],this.lastChar[1]=buf[buf.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=buf[buf.length-1],buf.toString("utf16le",i,buf.length-1)}function utf16End(buf){var r=buf&&buf.length?this.write(buf):"";if(this.lastNeed){var end=this.lastTotal-this.lastNeed;return r+this.lastChar.toString("utf16le",0,end)}return r}function base64Text(buf,i){var n=(buf.length-i)%3;return 0===n?buf.toString("base64",i):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=buf[buf.length-1]:(this.lastChar[0]=buf[buf.length-2],this.lastChar[1]=buf[buf.length-1]),buf.toString("base64",i,buf.length-n))}function base64End(buf){var r=buf&&buf.length?this.write(buf):"";return this.lastNeed?r+this.lastChar.toString("base64",0,3-this.lastNeed):r}function simpleWrite(buf){return buf.toString(this.encoding)}function simpleEnd(buf){return buf&&buf.length?this.write(buf):""}exports.StringDecoder=StringDecoder,StringDecoder.prototype.write=function(buf){if(0===buf.length)return"";var r,i;if(this.lastNeed){if(void 0===(r=this.fillLast(buf)))return"";i=this.lastNeed,this.lastNeed=0}else i=0;return i<buf.length?r?r+this.text(buf,i):this.text(buf,i):r||""},StringDecoder.prototype.end=function(buf){var r=buf&&buf.length?this.write(buf):"";return this.lastNeed?r+"�":r},StringDecoder.prototype.text=function(buf,i){var total=function(self,buf,i){var j=buf.length-1;if(j<i)return 0;var nb=utf8CheckByte(buf[j]);if(nb>=0)return nb>0&&(self.lastNeed=nb-1),nb;if(--j<i||-2===nb)return 0;if((nb=utf8CheckByte(buf[j]))>=0)return nb>0&&(self.lastNeed=nb-2),nb;if(--j<i||-2===nb)return 0;if((nb=utf8CheckByte(buf[j]))>=0)return nb>0&&(2===nb?nb=0:self.lastNeed=nb-3),nb;return 0}(this,buf,i);if(!this.lastNeed)return buf.toString("utf8",i);this.lastTotal=total;var end=buf.length-(total-this.lastNeed);return buf.copy(this.lastChar,0,end),buf.toString("utf8",i,end)},StringDecoder.prototype.fillLast=function(buf){if(this.lastNeed<=buf.length)return buf.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);buf.copy(this.lastChar,this.lastTotal-this.lastNeed,0,buf.length),this.lastNeed-=buf.length}},{"safe-buffer":149}],173:[function(require,module,exports){module.exports=function(instance,prefix){return new class{constructor(instance,prefix){this._instance=instance,this._prefix=prefix,this.app=instance.app+this._prefix}subscribe(channel){return this._instance.subscribe(this._prefix+channel)}broadcast(channel,message,cb){return this._instance.broadcast(this._prefix+channel,message,cb)}close(cb){return this._instance.close(cb)}}(instance,prefix)}},{}],174:[function(require,module,exports){(function(process){var Transform=require("readable-stream").Transform,inherits=require("util").inherits,xtend=require("xtend");function DestroyableTransform(opts){Transform.call(this,opts),this._destroyed=!1}function noop(chunk,enc,callback){callback(null,chunk)}function through2(construct){return function(options,transform,flush){return"function"==typeof options&&(flush=transform,transform=options,options={}),"function"!=typeof transform&&(transform=noop),"function"!=typeof flush&&(flush=null),construct(options,transform,flush)}}inherits(DestroyableTransform,Transform),DestroyableTransform.prototype.destroy=function(err){if(!this._destroyed){this._destroyed=!0;var self=this;process.nextTick(function(){err&&self.emit("error",err),self.emit("close")})}},module.exports=through2(function(options,transform,flush){var t2=new DestroyableTransform(options);return t2._transform=transform,flush&&(t2._flush=flush),t2}),module.exports.ctor=through2(function(options,transform,flush){function Through2(override){if(!(this instanceof Through2))return new Through2(override);this.options=xtend(options,override),DestroyableTransform.call(this,this.options)}return inherits(Through2,DestroyableTransform),Through2.prototype._transform=transform,flush&&(Through2.prototype._flush=flush),Through2}),module.exports.obj=through2(function(options,transform,flush){var t2=new DestroyableTransform(xtend({objectMode:!0,highWaterMark:16},options));return t2._transform=transform,flush&&(t2._flush=flush),t2})}).call(this,require("_process"))},{_process:118,"readable-stream":147,util:180,xtend:187}],175:[function(require,module,exports){(function(setImmediate,clearImmediate){var nextTick=require("process/browser.js").nextTick,apply=Function.prototype.apply,slice=Array.prototype.slice,immediateIds={},nextImmediateId=0;function Timeout(id,clearFn){this._id=id,this._clearFn=clearFn}exports.setTimeout=function(){return new Timeout(apply.call(setTimeout,window,arguments),clearTimeout)},exports.setInterval=function(){return new Timeout(apply.call(setInterval,window,arguments),clearInterval)},exports.clearTimeout=exports.clearInterval=function(timeout){timeout.close()},Timeout.prototype.unref=Timeout.prototype.ref=function(){},Timeout.prototype.close=function(){this._clearFn.call(window,this._id)},exports.enroll=function(item,msecs){clearTimeout(item._idleTimeoutId),item._idleTimeout=msecs},exports.unenroll=function(item){clearTimeout(item._idleTimeoutId),item._idleTimeout=-1},exports._unrefActive=exports.active=function(item){clearTimeout(item._idleTimeoutId);var msecs=item._idleTimeout;msecs>=0&&(item._idleTimeoutId=setTimeout(function(){item._onTimeout&&item._onTimeout()},msecs))},exports.setImmediate="function"==typeof setImmediate?setImmediate:function(fn){var id=nextImmediateId++,args=!(arguments.length<2)&&slice.call(arguments,1);return immediateIds[id]=!0,nextTick(function(){immediateIds[id]&&(args?fn.apply(null,args):fn.call(null),exports.clearImmediate(id))}),id},exports.clearImmediate="function"==typeof clearImmediate?clearImmediate:function(id){delete immediateIds[id]}}).call(this,require("timers").setImmediate,require("timers").clearImmediate)},{"process/browser.js":118,timers:175}],176:[function(require,module,exports){var bufferAlloc=require("buffer-alloc"),UINT_32_MAX=Math.pow(2,32);exports.encodingLength=function(){return 8},exports.encode=function(num,buf,offset){buf||(buf=bufferAlloc(8)),offset||(offset=0);var top=Math.floor(num/UINT_32_MAX),rem=num-top*UINT_32_MAX;return buf.writeUInt32BE(top,offset),buf.writeUInt32BE(rem,offset+4),buf},exports.decode=function(buf,offset){offset||(offset=0);var top=buf.readUInt32BE(offset),rem=buf.readUInt32BE(offset+4);return top*UINT_32_MAX+rem},exports.encode.bytes=8,exports.decode.bytes=8},{"buffer-alloc":23}],177:[function(require,module,exports){module.exports=function(arr,i){if(i>=arr.length||i<0)return;var last=arr.pop();if(i<arr.length){var tmp=arr[i];return arr[i]=last,tmp}return last}},{}],178:[function(require,module,exports){(function(global){function config(name){try{if(!global.localStorage)return!1}catch(_){return!1}var val=global.localStorage[name];return null!=val&&"true"===String(val).toLowerCase()}module.exports=function(fn,msg){if(config("noDeprecation"))return fn;var warned=!1;return function(){if(!warned){if(config("throwDeprecation"))throw new Error(msg);config("traceDeprecation")?console.trace(msg):console.warn(msg),warned=!0}return fn.apply(this,arguments)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],179:[function(require,module,exports){arguments[4][7][0].apply(exports,arguments)},{dup:7}],180:[function(require,module,exports){arguments[4][8][0].apply(exports,arguments)},{"./support/isBuffer":179,_process:118,dup:8,inherits:92}],181:[function(require,module,exports){(function(process){var SimplePeer=require("simple-peer"),inherits=require("inherits"),events=require("events"),through=require("through2"),cuid=require("cuid"),once=require("once"),debug=require("debug")("webrtc-swarm");function WebRTCSwarm(hub,opts){if(!(this instanceof WebRTCSwarm))return new WebRTCSwarm(hub,opts);if(!hub)throw new Error("SignalHub instance required");opts||(opts={}),events.EventEmitter.call(this),this.setMaxListeners(0),this.hub=hub,this.wrtc=opts.wrtc,this.channelConfig=opts.channelConfig,this.config=opts.config,this.stream=opts.stream,this.wrap=opts.wrap||function(data){return data},this.unwrap=opts.unwrap||function(data){return data},this.offerConstraints=opts.offerConstraints||{},this.maxPeers=opts.maxPeers||1/0,this.me=opts.uuid||cuid(),debug("my uuid:",this.me),this.remotes={},this.peers=[],this.closed=!1,function(swarm,hub){hub.subscribe("all").pipe(through.obj(function(data,enc,cb){if(data=swarm.unwrap(data,"all"),swarm.closed||!data)return cb();if(debug("/all",data),data.from===swarm.me)return debug("skipping self",data.from),cb();if("connect"===data.type){if(swarm.peers.length>=swarm.maxPeers)return debug("skipping because maxPeers is met",data.from),cb();if(swarm.remotes[data.from])return debug("skipping existing remote",data.from),cb();debug("connecting to new peer (as initiator)",data.from);var peer=new SimplePeer({wrtc:swarm.wrtc,initiator:!0,channelConfig:swarm.channelConfig,config:swarm.config,stream:swarm.stream,offerConstraints:swarm.offerConstraints});setup(swarm,peer,data.from),swarm.remotes[data.from]=peer}cb()})),hub.subscribe(swarm.me).once("open",function connect(swarm,hub){if(swarm.closed||swarm.peers.length>=swarm.maxPeers)return;var data={type:"connect",from:swarm.me};data=swarm.wrap(data,"all");hub.broadcast("all",data,function(){setTimeout(connect.bind(null,swarm,hub),Math.floor(2e3*Math.random())+(swarm.peers.length?13e3:3e3))})}.bind(null,swarm,hub)).pipe(through.obj(function(data,enc,cb){if(data=swarm.unwrap(data,swarm.me),swarm.closed||!data)return cb();var peer=swarm.remotes[data.from];if(!peer){if(!data.signal||"offer"!==data.signal.type)return debug("skipping non-offer",data),cb();debug("connecting to new peer (as not initiator)",data.from),peer=swarm.remotes[data.from]=new SimplePeer({wrtc:swarm.wrtc,channelConfig:swarm.channelConfig,config:swarm.config,stream:swarm.stream,offerConstraints:swarm.offerConstraints}),setup(swarm,peer,data.from)}debug("signalling",data.from,data.signal),peer.signal(data.signal),cb()}))}(this,hub)}function setup(swarm,peer,id){peer.on("connect",function(){debug("connected to peer",id),swarm.peers.push(peer),swarm.emit("peer",peer,id),swarm.emit("connect",peer,id)});var onclose=once(function(err){debug("disconnected from peer",id,err),swarm.remotes[id]===peer&&delete swarm.remotes[id];var i=swarm.peers.indexOf(peer);i>-1&&swarm.peers.splice(i,1),swarm.emit("disconnect",peer,id)}),signals=[],sending=!1;peer.on("signal",function(sig){signals.push(sig),function kick(){if(!swarm.closed&&!sending&&signals.length){sending=!0;var data={from:swarm.me,signal:signals.shift()};data=swarm.wrap(data,id),swarm.hub.broadcast(id,data,function(){sending=!1,kick()})}}()}),peer.on("error",onclose),peer.once("close",onclose)}module.exports=WebRTCSwarm,inherits(WebRTCSwarm,events.EventEmitter),WebRTCSwarm.WEBRTC_SUPPORT=SimplePeer.WEBRTC_SUPPORT,WebRTCSwarm.prototype.close=function(cb){if(!this.closed){this.closed=!0,cb&&this.once("close",cb);var self=this;this.hub.close(function(){var len=self.peers.length;if(len>0){var closed=0;self.peers.forEach(function(peer){peer.once("close",function(){++closed===len&&self.emit("close")}),process.nextTick(function(){peer.destroy()})})}else self.emit("close")})}}}).call(this,require("_process"))},{_process:118,cuid:32,debug:34,events:21,inherits:92,once:114,"simple-peer":157,through2:174}],182:[function(require,module,exports){(function(process,global){"use strict";var Transform=require("readable-stream").Transform,duplexify=require("duplexify"),WS=require("ws"),Buffer=require("safe-buffer").Buffer;module.exports=function(target,protocols,options){var stream,socket,isBrowser="browser"===process.title,isNative=!!global.WebSocket,socketWrite=isBrowser?function socketWriteBrowser(chunk,enc,next){if(socket.bufferedAmount>bufferSize)return void setTimeout(socketWriteBrowser,bufferTimeout,chunk,enc,next);coerceToBuffer&&"string"==typeof chunk&&(chunk=Buffer.from(chunk,"utf8"));try{socket.send(chunk)}catch(err){return next(err)}next()}:function(chunk,enc,next){if(socket.readyState!==socket.OPEN)return void next();coerceToBuffer&&"string"==typeof chunk&&(chunk=Buffer.from(chunk,"utf8"));socket.send(chunk,next)};protocols&&!Array.isArray(protocols)&&"object"==typeof protocols&&(options=protocols,protocols=null,("string"==typeof options.protocol||Array.isArray(options.protocol))&&(protocols=options.protocol));options||(options={});void 0===options.objectMode&&(options.objectMode=!(!0===options.binary||void 0===options.binary));var proxy=function(options,socketWrite,socketEnd){var proxy=new Transform({objectMode:options.objectMode});return proxy._write=socketWrite,proxy._flush=socketEnd,proxy}(options,socketWrite,function(done){socket.close(),done()});options.objectMode||(proxy._writev=writev);var bufferSize=options.browserBufferSize||524288,bufferTimeout=options.browserBufferTimeout||1e3;"object"==typeof target?socket=target:(socket=isNative&&isBrowser?new WS(target,protocols):new WS(target,protocols,options)).binaryType="arraybuffer";socket.readyState===socket.OPEN?stream=proxy:(stream=stream=duplexify(void 0,void 0,options),options.objectMode||(stream._writev=writev),socket.onopen=function(){stream.setReadable(proxy),stream.setWritable(proxy),stream.emit("connect")});stream.socket=socket,socket.onclose=function(){stream.end(),stream.destroy()},socket.onerror=function(err){stream.destroy(err)},socket.onmessage=function(event){var data=event.data;data=data instanceof ArrayBuffer?Buffer.from(data):Buffer.from(data,"utf8");proxy.push(data)},proxy.on("close",function(){socket.close()});var coerceToBuffer=!options.objectMode;function writev(chunks,cb){for(var buffers=new Array(chunks.length),i=0;i<chunks.length;i++)"string"==typeof chunks[i].chunk?buffers[i]=Buffer.from(chunks[i],"utf8"):buffers[i]=chunks[i].chunk;this._write(Buffer.concat(buffers),"binary",cb)}return stream}}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:118,duplexify:41,"readable-stream":147,"safe-buffer":149,ws:183}],183:[function(require,module,exports){var ws=null;"undefined"!=typeof WebSocket?ws=WebSocket:"undefined"!=typeof MozWebSocket?ws=MozWebSocket:"undefined"!=typeof window&&(ws=window.WebSocket||window.MozWebSocket),module.exports=ws},{}],184:[function(require,module,exports){module.exports=function wrappy(fn,cb){if(fn&&cb)return wrappy(fn)(cb);if("function"!=typeof fn)throw new TypeError("need wrapper function");Object.keys(fn).forEach(function(k){wrapper[k]=fn[k]});return wrapper;function wrapper(){for(var args=new Array(arguments.length),i=0;i<args.length;i++)args[i]=arguments[i];var ret=fn.apply(this,args),cb=args[args.length-1];return"function"==typeof ret&&ret!==cb&&Object.keys(cb).forEach(function(k){ret[k]=cb[k]}),ret}}},{}],185:[function(require,module,exports){var xsalsa20=require("./xsalsa20")(),SIGMA=new Uint8Array([101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107]),head=144,top=head,free=[];function XSalsa20(nonce,key){if(!(this instanceof XSalsa20))return new XSalsa20(nonce,key);if(!nonce||nonce.length<24)throw new Error("nonce must be at least 24 bytes");if(!key||key.length<32)throw new Error("key must be at least 32 bytes");this._xor=xsalsa20&&xsalsa20.exports?new WASM(nonce,key):new Fallback(nonce,key)}function WASM(nonce,key){free.length||(free.push(head),head+=64),this._pointer=free.pop(),this._nonce=this._pointer+8,this._key=this._nonce+24,this._overflow=0,xsalsa20.memory.fill(0,this._pointer,this._pointer+8),xsalsa20.memory.set(nonce,this._nonce),xsalsa20.memory.set(key,this._key)}function Fallback(nonce,key){this._s=new Uint8Array(32),this._z=new Uint8Array(16),this._overflow=0,function(o,p,k,c){for(var u,j0=255&c[0]|(255&c[1])<<8|(255&c[2])<<16|(255&c[3])<<24,j1=255&k[0]|(255&k[1])<<8|(255&k[2])<<16|(255&k[3])<<24,j2=255&k[4]|(255&k[5])<<8|(255&k[6])<<16|(255&k[7])<<24,j3=255&k[8]|(255&k[9])<<8|(255&k[10])<<16|(255&k[11])<<24,j4=255&k[12]|(255&k[13])<<8|(255&k[14])<<16|(255&k[15])<<24,j5=255&c[4]|(255&c[5])<<8|(255&c[6])<<16|(255&c[7])<<24,j6=255&p[0]|(255&p[1])<<8|(255&p[2])<<16|(255&p[3])<<24,j7=255&p[4]|(255&p[5])<<8|(255&p[6])<<16|(255&p[7])<<24,j8=255&p[8]|(255&p[9])<<8|(255&p[10])<<16|(255&p[11])<<24,j9=255&p[12]|(255&p[13])<<8|(255&p[14])<<16|(255&p[15])<<24,j10=255&c[8]|(255&c[9])<<8|(255&c[10])<<16|(255&c[11])<<24,j11=255&k[16]|(255&k[17])<<8|(255&k[18])<<16|(255&k[19])<<24,j12=255&k[20]|(255&k[21])<<8|(255&k[22])<<16|(255&k[23])<<24,j13=255&k[24]|(255&k[25])<<8|(255&k[26])<<16|(255&k[27])<<24,j14=255&k[28]|(255&k[29])<<8|(255&k[30])<<16|(255&k[31])<<24,j15=255&c[12]|(255&c[13])<<8|(255&c[14])<<16|(255&c[15])<<24,x0=j0,x1=j1,x2=j2,x3=j3,x4=j4,x5=j5,x6=j6,x7=j7,x8=j8,x9=j9,x10=j10,x11=j11,x12=j12,x13=j13,x14=j14,x15=j15,i=0;i<20;i+=2)x0^=(u=(x12^=(u=(x8^=(u=(x4^=(u=x0+x12|0)<<7|u>>>25)+x0|0)<<9|u>>>23)+x4|0)<<13|u>>>19)+x8|0)<<18|u>>>14,x5^=(u=(x1^=(u=(x13^=(u=(x9^=(u=x5+x1|0)<<7|u>>>25)+x5|0)<<9|u>>>23)+x9|0)<<13|u>>>19)+x13|0)<<18|u>>>14,x10^=(u=(x6^=(u=(x2^=(u=(x14^=(u=x10+x6|0)<<7|u>>>25)+x10|0)<<9|u>>>23)+x14|0)<<13|u>>>19)+x2|0)<<18|u>>>14,x15^=(u=(x11^=(u=(x7^=(u=(x3^=(u=x15+x11|0)<<7|u>>>25)+x15|0)<<9|u>>>23)+x3|0)<<13|u>>>19)+x7|0)<<18|u>>>14,x0^=(u=(x3^=(u=(x2^=(u=(x1^=(u=x0+x3|0)<<7|u>>>25)+x0|0)<<9|u>>>23)+x1|0)<<13|u>>>19)+x2|0)<<18|u>>>14,x5^=(u=(x4^=(u=(x7^=(u=(x6^=(u=x5+x4|0)<<7|u>>>25)+x5|0)<<9|u>>>23)+x6|0)<<13|u>>>19)+x7|0)<<18|u>>>14,x10^=(u=(x9^=(u=(x8^=(u=(x11^=(u=x10+x9|0)<<7|u>>>25)+x10|0)<<9|u>>>23)+x11|0)<<13|u>>>19)+x8|0)<<18|u>>>14,x15^=(u=(x14^=(u=(x13^=(u=(x12^=(u=x15+x14|0)<<7|u>>>25)+x15|0)<<9|u>>>23)+x12|0)<<13|u>>>19)+x13|0)<<18|u>>>14;o[0]=x0>>>0&255,o[1]=x0>>>8&255,o[2]=x0>>>16&255,o[3]=x0>>>24&255,o[4]=x5>>>0&255,o[5]=x5>>>8&255,o[6]=x5>>>16&255,o[7]=x5>>>24&255,o[8]=x10>>>0&255,o[9]=x10>>>8&255,o[10]=x10>>>16&255,o[11]=x10>>>24&255,o[12]=x15>>>0&255,o[13]=x15>>>8&255,o[14]=x15>>>16&255,o[15]=x15>>>24&255,o[16]=x6>>>0&255,o[17]=x6>>>8&255,o[18]=x6>>>16&255,o[19]=x6>>>24&255,o[20]=x7>>>0&255,o[21]=x7>>>8&255,o[22]=x7>>>16&255,o[23]=x7>>>24&255,o[24]=x8>>>0&255,o[25]=x8>>>8&255,o[26]=x8>>>16&255,o[27]=x8>>>24&255,o[28]=x9>>>0&255,o[29]=x9>>>8&255,o[30]=x9>>>16&255,o[31]=x9>>>24&255}(this._s,nonce,key,SIGMA);for(var i=0;i<8;i++)this._z[i]=nonce[i+16]}function core_salsa20(o,p,k,c){for(var u,j0=255&c[0]|(255&c[1])<<8|(255&c[2])<<16|(255&c[3])<<24,j1=255&k[0]|(255&k[1])<<8|(255&k[2])<<16|(255&k[3])<<24,j2=255&k[4]|(255&k[5])<<8|(255&k[6])<<16|(255&k[7])<<24,j3=255&k[8]|(255&k[9])<<8|(255&k[10])<<16|(255&k[11])<<24,j4=255&k[12]|(255&k[13])<<8|(255&k[14])<<16|(255&k[15])<<24,j5=255&c[4]|(255&c[5])<<8|(255&c[6])<<16|(255&c[7])<<24,j6=255&p[0]|(255&p[1])<<8|(255&p[2])<<16|(255&p[3])<<24,j7=255&p[4]|(255&p[5])<<8|(255&p[6])<<16|(255&p[7])<<24,j8=255&p[8]|(255&p[9])<<8|(255&p[10])<<16|(255&p[11])<<24,j9=255&p[12]|(255&p[13])<<8|(255&p[14])<<16|(255&p[15])<<24,j10=255&c[8]|(255&c[9])<<8|(255&c[10])<<16|(255&c[11])<<24,j11=255&k[16]|(255&k[17])<<8|(255&k[18])<<16|(255&k[19])<<24,j12=255&k[20]|(255&k[21])<<8|(255&k[22])<<16|(255&k[23])<<24,j13=255&k[24]|(255&k[25])<<8|(255&k[26])<<16|(255&k[27])<<24,j14=255&k[28]|(255&k[29])<<8|(255&k[30])<<16|(255&k[31])<<24,j15=255&c[12]|(255&c[13])<<8|(255&c[14])<<16|(255&c[15])<<24,x0=j0,x1=j1,x2=j2,x3=j3,x4=j4,x5=j5,x6=j6,x7=j7,x8=j8,x9=j9,x10=j10,x11=j11,x12=j12,x13=j13,x14=j14,x15=j15,i=0;i<20;i+=2)x0^=(u=(x12^=(u=(x8^=(u=(x4^=(u=x0+x12|0)<<7|u>>>25)+x0|0)<<9|u>>>23)+x4|0)<<13|u>>>19)+x8|0)<<18|u>>>14,x5^=(u=(x1^=(u=(x13^=(u=(x9^=(u=x5+x1|0)<<7|u>>>25)+x5|0)<<9|u>>>23)+x9|0)<<13|u>>>19)+x13|0)<<18|u>>>14,x10^=(u=(x6^=(u=(x2^=(u=(x14^=(u=x10+x6|0)<<7|u>>>25)+x10|0)<<9|u>>>23)+x14|0)<<13|u>>>19)+x2|0)<<18|u>>>14,x15^=(u=(x11^=(u=(x7^=(u=(x3^=(u=x15+x11|0)<<7|u>>>25)+x15|0)<<9|u>>>23)+x3|0)<<13|u>>>19)+x7|0)<<18|u>>>14,x0^=(u=(x3^=(u=(x2^=(u=(x1^=(u=x0+x3|0)<<7|u>>>25)+x0|0)<<9|u>>>23)+x1|0)<<13|u>>>19)+x2|0)<<18|u>>>14,x5^=(u=(x4^=(u=(x7^=(u=(x6^=(u=x5+x4|0)<<7|u>>>25)+x5|0)<<9|u>>>23)+x6|0)<<13|u>>>19)+x7|0)<<18|u>>>14,x10^=(u=(x9^=(u=(x8^=(u=(x11^=(u=x10+x9|0)<<7|u>>>25)+x10|0)<<9|u>>>23)+x11|0)<<13|u>>>19)+x8|0)<<18|u>>>14,x15^=(u=(x14^=(u=(x13^=(u=(x12^=(u=x15+x14|0)<<7|u>>>25)+x15|0)<<9|u>>>23)+x12|0)<<13|u>>>19)+x13|0)<<18|u>>>14;x0=x0+j0|0,x1=x1+j1|0,x2=x2+j2|0,x3=x3+j3|0,x4=x4+j4|0,x5=x5+j5|0,x6=x6+j6|0,x7=x7+j7|0,x8=x8+j8|0,x9=x9+j9|0,x10=x10+j10|0,x11=x11+j11|0,x12=x12+j12|0,x13=x13+j13|0,x14=x14+j14|0,x15=x15+j15|0,o[0]=x0>>>0&255,o[1]=x0>>>8&255,o[2]=x0>>>16&255,o[3]=x0>>>24&255,o[4]=x1>>>0&255,o[5]=x1>>>8&255,o[6]=x1>>>16&255,o[7]=x1>>>24&255,o[8]=x2>>>0&255,o[9]=x2>>>8&255,o[10]=x2>>>16&255,o[11]=x2>>>24&255,o[12]=x3>>>0&255,o[13]=x3>>>8&255,o[14]=x3>>>16&255,o[15]=x3>>>24&255,o[16]=x4>>>0&255,o[17]=x4>>>8&255,o[18]=x4>>>16&255,o[19]=x4>>>24&255,o[20]=x5>>>0&255,o[21]=x5>>>8&255,o[22]=x5>>>16&255,o[23]=x5>>>24&255,o[24]=x6>>>0&255,o[25]=x6>>>8&255,o[26]=x6>>>16&255,o[27]=x6>>>24&255,o[28]=x7>>>0&255,o[29]=x7>>>8&255,o[30]=x7>>>16&255,o[31]=x7>>>24&255,o[32]=x8>>>0&255,o[33]=x8>>>8&255,o[34]=x8>>>16&255,o[35]=x8>>>24&255,o[36]=x9>>>0&255,o[37]=x9>>>8&255,o[38]=x9>>>16&255,o[39]=x9>>>24&255,o[40]=x10>>>0&255,o[41]=x10>>>8&255,o[42]=x10>>>16&255,o[43]=x10>>>24&255,o[44]=x11>>>0&255,o[45]=x11>>>8&255,o[46]=x11>>>16&255,o[47]=x11>>>24&255,o[48]=x12>>>0&255,o[49]=x12>>>8&255,o[50]=x12>>>16&255,o[51]=x12>>>24&255,o[52]=x13>>>0&255,o[53]=x13>>>8&255,o[54]=x13>>>16&255,o[55]=x13>>>24&255,o[56]=x14>>>0&255,o[57]=x14>>>8&255,o[58]=x14>>>16&255,o[59]=x14>>>24&255,o[60]=x15>>>0&255,o[61]=x15>>>8&255,o[62]=x15>>>16&255,o[63]=x15>>>24&255}module.exports=XSalsa20,XSalsa20.NONCEBYTES=24,XSalsa20.KEYBYTES=32,XSalsa20.prototype.update=function(input,output){if(!input)throw new Error("input must be Uint8Array or Buffer");return output||(output=new Uint8Array(input.length)),input.length&&this._xor.update(input,output),output},XSalsa20.prototype.final=XSalsa20.prototype.finalize=function(){this._xor.finalize(),this._xor=null},WASM.prototype.update=function(input,output){var len=this._overflow+input.length,start=head+this._overflow;(top=head+len)>=xsalsa20.memory.length&&xsalsa20.realloc(top),xsalsa20.memory.set(input,start),xsalsa20.exports.xsalsa20_xor(this._pointer,head,head,len,this._nonce,this._key),output.set(xsalsa20.memory.subarray(start,head+len)),this._overflow=63&len},WASM.prototype.finalize=function(){xsalsa20.memory.fill(0,this._pointer,this._key+32),top>head&&(xsalsa20.memory.fill(0,head,top),top=0),free.push(this._pointer)},Fallback.prototype.update=function(input,output){for(var x=new Uint8Array(64),u=0,i=this._overflow,b=input.length+this._overflow,z=this._z,mpos=-this._overflow,cpos=-this._overflow;b>=64;){for(core_salsa20(x,z,this._s,SIGMA);i<64;i++)output[cpos+i]=input[mpos+i]^x[i];for(u=1,i=8;i<16;i++)u+=255&z[i]|0,z[i]=255&u,u>>>=8;b-=64,cpos+=64,mpos+=64,i=0}if(b>0)for(core_salsa20(x,z,this._s,SIGMA);i<b;i++)output[cpos+i]=input[mpos+i]^x[i];this._overflow=63&b},Fallback.prototype.finalize=function(){this._s.fill(0),this._z.fill(0)}},{"./xsalsa20":186}],186:[function(require,module,exports){function loadWebAssembly(opts){if(!loadWebAssembly.supported)return null;var s,imp=opts&&opts.imports,wasm=(s="AGFzbQEAAAABGgNgBn9/f39/fwBgBn9/f39+fwF+YAN/f38AAwcGAAEBAgICBQUBAQroBwcoAwZtZW1vcnkCAAx4c2Fsc2EyMF94b3IAAAxjb3JlX3NhbHNhMjAABArqEQYYACAAIAEgAiADIAQgACkDACAFEAE3AwALPQBB8AAgAyAFEAMgACABIAIgA0EQaiAEQfAAEAJB8ABCADcDAEH4AEIANwMAQYABQgA3AwBBiAFCADcDAAuHBQEBfyACQQBGBEBCAA8LQdAAIAUpAwA3AwBB2AAgBUEIaikDADcDAEHgACAFQRBqKQMANwMAQegAIAVBGGopAwA3AwBBACADKQMANwMAQQggBDcDAAJAA0AgAkHAAEkNAUEQQQBB0AAQBSAAIAEpAwBBECkDAIU3AwAgAEEIaiABQQhqKQMAQRgpAwCFNwMAIABBEGogAUEQaikDAEEgKQMAhTcDACAAQRhqIAFBGGopAwBBKCkDAIU3AwAgAEEgaiABQSBqKQMAQTApAwCFNwMAIABBKGogAUEoaikDAEE4KQMAhTcDACAAQTBqIAFBMGopAwBBwAApAwCFNwMAIABBOGogAUE4aikDAEHIACkDAIU3AwBBCEEIKQMAQgF8NwMAIABBwABqIQAgAUHAAGohASACQcAAayECDAALC0EIKQMAIQQgAkEASwRAQRBBAEHQABAFAkACQAJAAkACQAJAAkACQCACQQhuDgcHBgUEAwIBAAsgAEE4aiABQThqKQMAQcgAKQMAhTcDAAsgAEEwaiABQTBqKQMAQcAAKQMAhTcDAAsgAEEoaiABQShqKQMAQTgpAwCFNwMACyAAQSBqIAFBIGopAwBBMCkDAIU3AwALIABBGGogAUEYaikDAEEoKQMAhTcDAAsgAEEQaiABQRBqKQMAQSApAwCFNwMACyAAQQhqIAFBCGopAwBBGCkDAIU3AwALIAAgASkDAEEQKQMAhTcDAAtBEEIANwMAQRhCADcDAEEgQgA3AwBBKEIANwMAQTBCADcDAEE4QgA3AwBBwABCADcDAEHIAEIANwMAQdAAQgA3AwBB2ABCADcDAEHgAEIANwMAQegAQgA3AwAgBA8LnQUBEX9B5fDBiwYhA0HuyIGZAyEIQbLaiMsHIQ1B9MqB2QYhEiACKAIAIQQgAkEEaigCACEFIAJBCGooAgAhBiACQQxqKAIAIQcgAkEQaigCACEOIAJBFGooAgAhDyACQRhqKAIAIRAgAkEcaigCACERIAEoAgAhCSABQQRqKAIAIQogAUEIaigCACELIAFBDGooAgAhDEEUIRMCQANAIBNBAEYNASAHIAMgD2pBB3dzIQcgCyAHIANqQQl3cyELIA8gCyAHakENd3MhDyADIA8gC2pBEndzIQMgDCAIIARqQQd3cyEMIBAgDCAIakEJd3MhECAEIBAgDGpBDXdzIQQgCCAEIBBqQRJ3cyEIIBEgDSAJakEHd3MhESAFIBEgDWpBCXdzIQUgCSAFIBFqQQ13cyEJIA0gCSAFakESd3MhDSAGIBIgDmpBB3dzIQYgCiAGIBJqQQl3cyEKIA4gCiAGakENd3MhDiASIA4gCmpBEndzIRIgBCADIAZqQQd3cyEEIAUgBCADakEJd3MhBSAGIAUgBGpBDXdzIQYgAyAGIAVqQRJ3cyEDIAkgCCAHakEHd3MhCSAKIAkgCGpBCXdzIQogByAKIAlqQQ13cyEHIAggByAKakESd3MhCCAOIA0gDGpBB3dzIQ4gCyAOIA1qQQl3cyELIAwgCyAOakENd3MhDCANIAwgC2pBEndzIQ0gDyASIBFqQQd3cyEPIBAgDyASakEJd3MhECARIBAgD2pBDXdzIREgEiARIBBqQRJ3cyESIBNBAmshEwwACwsgACADNgIAIABBBGogCDYCACAAQQhqIA02AgAgAEEMaiASNgIAIABBEGogCTYCACAAQRRqIAo2AgAgAEEYaiALNgIAIABBHGogDDYCAAsKACAAIAEgAhAFC90GASF/QeXwwYsGIQNB7siBmQMhCEGy2ojLByENQfTKgdkGIRIgAigCACEEIAJBBGooAgAhBSACQQhqKAIAIQYgAkEMaigCACEHIAJBEGooAgAhDiACQRRqKAIAIQ8gAkEYaigCACEQIAJBHGooAgAhESABKAIAIQkgAUEEaigCACEKIAFBCGooAgAhCyABQQxqKAIAIQwgAyETIAQhFCAFIRUgBiEWIAchFyAIIRggCSEZIAohGiALIRsgDCEcIA0hHSAOIR4gDyEfIBAhICARISEgEiEiQRQhIwJAA0AgI0EARg0BIAcgAyAPakEHd3MhByALIAcgA2pBCXdzIQsgDyALIAdqQQ13cyEPIAMgDyALakESd3MhAyAMIAggBGpBB3dzIQwgECAMIAhqQQl3cyEQIAQgECAMakENd3MhBCAIIAQgEGpBEndzIQggESANIAlqQQd3cyERIAUgESANakEJd3MhBSAJIAUgEWpBDXdzIQkgDSAJIAVqQRJ3cyENIAYgEiAOakEHd3MhBiAKIAYgEmpBCXdzIQogDiAKIAZqQQ13cyEOIBIgDiAKakESd3MhEiAEIAMgBmpBB3dzIQQgBSAEIANqQQl3cyEFIAYgBSAEakENd3MhBiADIAYgBWpBEndzIQMgCSAIIAdqQQd3cyEJIAogCSAIakEJd3MhCiAHIAogCWpBDXdzIQcgCCAHIApqQRJ3cyEIIA4gDSAMakEHd3MhDiALIA4gDWpBCXdzIQsgDCALIA5qQQ13cyEMIA0gDCALakESd3MhDSAPIBIgEWpBB3dzIQ8gECAPIBJqQQl3cyEQIBEgECAPakENd3MhESASIBEgEGpBEndzIRIgI0ECayEjDAALCyAAIAMgE2o2AgAgAEEEaiAEIBRqNgIAIABBCGogBSAVajYCACAAQQxqIAYgFmo2AgAgAEEQaiAHIBdqNgIAIABBFGogCCAYajYCACAAQRhqIAkgGWo2AgAgAEEcaiAKIBpqNgIAIABBIGogCyAbajYCACAAQSRqIAwgHGo2AgAgAEEoaiANIB1qNgIAIABBLGogDiAeajYCACAAQTBqIA8gH2o2AgAgAEE0aiAQICBqNgIAIABBOGogESAhajYCACAAQTxqIBIgImo2AgAL","function"==typeof atob?new Uint8Array(atob(s).split("").map(charCodeAt)):new(require("buffer").Buffer)(s,"base64")),ready=null,mod={buffer:wasm,memory:null,exports:null,realloc:function(size){mod.exports.memory.grow(Math.ceil(Math.abs(size-mod.memory.length)/65536)),mod.memory=new Uint8Array(mod.exports.memory.buffer)},onload:onload};return onload(function(){}),mod;function onload(cb){if(mod.exports)return cb();if(ready)ready.then(cb.bind(null,null)).catch(cb);else{try{if(opts&&opts.async)throw new Error("async");setup({instance:new WebAssembly.Instance(new WebAssembly.Module(wasm),imp)})}catch(err){ready=WebAssembly.instantiate(wasm,imp).then(setup)}onload(cb)}}function setup(w){mod.exports=w.instance.exports,mod.memory=mod.exports.memory&&mod.exports.memory.buffer&&new Uint8Array(mod.exports.memory.buffer)}}function charCodeAt(c){return c.charCodeAt(0)}module.exports=loadWebAssembly,loadWebAssembly.supported="undefined"!=typeof WebAssembly},{}],187:[function(require,module,exports){module.exports=function(){for(var target={},i=0;i<arguments.length;i++){var source=arguments[i];for(var key in source)hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};var hasOwnProperty=Object.prototype.hasOwnProperty},{}],188:[function(require,module,exports){require("@pqmcgill/dat-js"),require("dat-encoding")},{"@pqmcgill/dat-js":2,"dat-encoding":33}]},{},[188])(188)});
